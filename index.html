<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vishal Goundar">
<meta name="dcterms.date" content="2025-05-31">

<title>Traffic Density and Air Quality: Comparing Urban and Rural Auckland</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="air-quality_files/libs/clipboard/clipboard.min.js"></script>
<script src="air-quality_files/libs/quarto-html/quarto.js"></script>
<script src="air-quality_files/libs/quarto-html/popper.min.js"></script>
<script src="air-quality_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="air-quality_files/libs/quarto-html/anchor.min.js"></script>
<link href="air-quality_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="air-quality_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="air-quality_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="air-quality_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="air-quality_files/libs/bootstrap/bootstrap-32162a2fca7cb0439643f2faaab1edf3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="air-quality_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="air-quality_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="air-quality_files/libs/plotly-binding-4.10.4/plotly.js"></script>

<script src="air-quality_files/libs/typedarray-0.1/typedarray.min.js"></script>

<script src="air-quality_files/libs/jquery-3.5.1/jquery.min.js"></script>

<link href="air-quality_files/libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="air-quality_files/libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<link href="air-quality_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">

<script src="air-quality_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>



<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract"><span class="header-section-number">1</span> Abstract</a></li>
  <li><a href="#load-data-from-lawa-on-air-quality" id="toc-load-data-from-lawa-on-air-quality" class="nav-link" data-scroll-target="#load-data-from-lawa-on-air-quality"><span class="header-section-number">2</span> Load Data from LAWA on Air Quality</a>
  <ul class="collapse">
  <li><a href="#load-lawa-file" id="toc-load-lawa-file" class="nav-link" data-scroll-target="#load-lawa-file"><span class="header-section-number">2.1</span> Load LAWA file</a></li>
  <li><a href="#air-pollutant-concentration-trends-20162023" id="toc-air-pollutant-concentration-trends-20162023" class="nav-link" data-scroll-target="#air-pollutant-concentration-trends-20162023"><span class="header-section-number">2.2</span> Air Pollutant Concentration Trends (2016–2023)</a></li>
  <li><a href="#daily-trends-in-pm10-and-pm2.5-by-town" id="toc-daily-trends-in-pm10-and-pm2.5-by-town" class="nav-link" data-scroll-target="#daily-trends-in-pm10-and-pm2.5-by-town"><span class="header-section-number">2.3</span> Daily Trends in PM10 and PM2.5 by Town</a></li>
  </ul></li>
  <li><a href="#spatial-plot-of-pollutant-concentration-across-nz-20162023" id="toc-spatial-plot-of-pollutant-concentration-across-nz-20162023" class="nav-link" data-scroll-target="#spatial-plot-of-pollutant-concentration-across-nz-20162023"><span class="header-section-number">3</span> Spatial Plot of Pollutant Concentration Across NZ (2016–2023)</a>
  <ul class="collapse">
  <li><a href="#yearly-total-concentrations-of-pm10-and-pm2.5-at-nz-monitoring-sites" id="toc-yearly-total-concentrations-of-pm10-and-pm2.5-at-nz-monitoring-sites" class="nav-link" data-scroll-target="#yearly-total-concentrations-of-pm10-and-pm2.5-at-nz-monitoring-sites"><span class="header-section-number">3.1</span> Yearly Total Concentrations of PM10 and PM2.5 at NZ Monitoring Sites</a></li>
  </ul></li>
  <li><a href="#load-2018-population-data-and-regional-map-data-from-stats-nz" id="toc-load-2018-population-data-and-regional-map-data-from-stats-nz" class="nav-link" data-scroll-target="#load-2018-population-data-and-regional-map-data-from-stats-nz"><span class="header-section-number">4</span> Load 2018 population data and regional map data from Stats NZ</a>
  <ul class="collapse">
  <li><a href="#spatial-join-of-datasets-population-and-region" id="toc-spatial-join-of-datasets-population-and-region" class="nav-link" data-scroll-target="#spatial-join-of-datasets-population-and-region"><span class="header-section-number">4.1</span> Spatial join of datasets: population and region</a></li>
  <li><a href="#normalize-pollutant-concentration-by-2018-population-and-plot-concentration-per-capita-trends-for-eac-site-type." id="toc-normalize-pollutant-concentration-by-2018-population-and-plot-concentration-per-capita-trends-for-eac-site-type." class="nav-link" data-scroll-target="#normalize-pollutant-concentration-by-2018-population-and-plot-concentration-per-capita-trends-for-eac-site-type."><span class="header-section-number">4.2</span> Normalize pollutant concentration by 2018 population and plot concentration per capita trends for eac site type.</a></li>
  <li><a href="#seasonal-trends-in-pollutant-concentration-by-site-type" id="toc-seasonal-trends-in-pollutant-concentration-by-site-type" class="nav-link" data-scroll-target="#seasonal-trends-in-pollutant-concentration-by-site-type"><span class="header-section-number">4.3</span> Seasonal Trends in Pollutant Concentration by Site Type</a></li>
  <li><a href="#regional-trends-in-seasonal-per-capita-pollutant-concentration-20162023" id="toc-regional-trends-in-seasonal-per-capita-pollutant-concentration-20162023" class="nav-link" data-scroll-target="#regional-trends-in-seasonal-per-capita-pollutant-concentration-20162023"><span class="header-section-number">4.4</span> Regional Trends in Seasonal Per Capita Pollutant Concentration (2016–2023)</a></li>
  <li><a href="#comparing-total-and-per-capita-air-pollutant-concentrations-for-2018" id="toc-comparing-total-and-per-capita-air-pollutant-concentrations-for-2018" class="nav-link" data-scroll-target="#comparing-total-and-per-capita-air-pollutant-concentrations-for-2018"><span class="header-section-number">4.5</span> Comparing Total and Per Capita Air Pollutant Concentrations for 2018</a></li>
  <li><a href="#interactive-map-of-2018-particulate-matter-concentrations-by-sa2-region" id="toc-interactive-map-of-2018-particulate-matter-concentrations-by-sa2-region" class="nav-link" data-scroll-target="#interactive-map-of-2018-particulate-matter-concentrations-by-sa2-region"><span class="header-section-number">4.6</span> Interactive Map of 2018 Particulate Matter Concentrations by SA2 Region</a></li>
  <li><a href="#standardizing-daily-air-pollutant-concentrations-for-cross-regional-analysis" id="toc-standardizing-daily-air-pollutant-concentrations-for-cross-regional-analysis" class="nav-link" data-scroll-target="#standardizing-daily-air-pollutant-concentrations-for-cross-regional-analysis"><span class="header-section-number">4.7</span> Standardizing Daily Air Pollutant Concentrations for Cross-Regional Analysis</a></li>
  <li><a href="#seasonal-aggregation-and-visualization-of-air-quality-data-20162023" id="toc-seasonal-aggregation-and-visualization-of-air-quality-data-20162023" class="nav-link" data-scroll-target="#seasonal-aggregation-and-visualization-of-air-quality-data-20162023"><span class="header-section-number">4.8</span> Seasonal Aggregation and Visualization of Air Quality Data (2016–2023)</a></li>
  </ul></li>
  <li><a href="#sa2-level-air-quality-insights-for-auckland-20162023" id="toc-sa2-level-air-quality-insights-for-auckland-20162023" class="nav-link" data-scroll-target="#sa2-level-air-quality-insights-for-auckland-20162023"><span class="header-section-number">5</span> SA2-Level Air Quality Insights for Auckland (2016–2023)</a>
  <ul class="collapse">
  <li><a href="#integrating-and-enriching-air-quality-data-across-auckland-sa2-areas" id="toc-integrating-and-enriching-air-quality-data-across-auckland-sa2-areas" class="nav-link" data-scroll-target="#integrating-and-enriching-air-quality-data-across-auckland-sa2-areas"><span class="header-section-number">5.1</span> Integrating and Enriching Air Quality Data Across Auckland SA2 Areas</a></li>
  <li><a href="#air-quality-index-vs-pollutant-concentrations-across-auckland-suburbs" id="toc-air-quality-index-vs-pollutant-concentrations-across-auckland-suburbs" class="nav-link" data-scroll-target="#air-quality-index-vs-pollutant-concentrations-across-auckland-suburbs"><span class="header-section-number">5.2</span> Air Quality Index vs Pollutant Concentrations Across Auckland Suburbs</a></li>
  <li><a href="#air-temperature-versus-pollutant-concentrations-across-auckland-suburbs" id="toc-air-temperature-versus-pollutant-concentrations-across-auckland-suburbs" class="nav-link" data-scroll-target="#air-temperature-versus-pollutant-concentrations-across-auckland-suburbs"><span class="header-section-number">5.3</span> Air Temperature versus Pollutant Concentrations Across Auckland Suburbs</a></li>
  <li><a href="#explore-wind-speed-direction-and-air-temperature-across-auckland-air-quality-sites" id="toc-explore-wind-speed-direction-and-air-temperature-across-auckland-air-quality-sites" class="nav-link" data-scroll-target="#explore-wind-speed-direction-and-air-temperature-across-auckland-air-quality-sites"><span class="header-section-number">5.4</span> Explore Wind Speed, Direction, and Air Temperature Across Auckland Air Quality Sites</a></li>
  <li><a href="#weekly-and-monthly-pollutant-aqi-and-meteorological-factors-relationship-by-site" id="toc-weekly-and-monthly-pollutant-aqi-and-meteorological-factors-relationship-by-site" class="nav-link" data-scroll-target="#weekly-and-monthly-pollutant-aqi-and-meteorological-factors-relationship-by-site"><span class="header-section-number">5.5</span> Weekly and Monthly Pollutant, AQI and Meteorological Factors Relationship by Site</a></li>
  <li><a href="#visualizing-seasonal-anomalies-and-trends-in-pollutants-aqi-and-meteorological-variables" id="toc-visualizing-seasonal-anomalies-and-trends-in-pollutants-aqi-and-meteorological-variables" class="nav-link" data-scroll-target="#visualizing-seasonal-anomalies-and-trends-in-pollutants-aqi-and-meteorological-variables"><span class="header-section-number">5.6</span> Visualizing Seasonal Anomalies and Trends in Pollutants, AQI, and Meteorological Variables</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Traffic Density and Air Quality: Comparing Urban and Rural Auckland</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Vishal Goundar </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 31, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="abstract" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="abstract"><span class="header-section-number">1</span> Abstract</h2>
<p>This report analyzes the relationship between traffic density and air quality in urban and rural areas of Auckland. Using various air quality metrics and traffic data, we explore trends, correlations, and thresholds for air pollutants.</p>
</section>
<section id="load-data-from-lawa-on-air-quality" class="level2 tabset" data-number="2">
<h2 class="tabset anchored" data-number="2" data-anchor-id="load-data-from-lawa-on-air-quality"><span class="header-section-number">2</span> Load Data from LAWA on Air Quality</h2>
<details>
<summary>
Click to expand: Load LAWA Air Quality Data
</summary>
<section id="load-lawa-file" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="load-lawa-file"><span class="header-section-number">2.1</span> Load LAWA file</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a list of all sheet names in the provided Excel file to understand the structure of the data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>sheet_names <span class="ot">&lt;-</span> <span class="fu">excel_sheets</span>(<span class="st">"data/lawa/lawa_airqualitydownloaddata_2016-2023.xlsx"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>sheet_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Dataset Notices"    "Monitoring dataset" "Ten-year trends"   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Skip the first 7 rows while loading the air quality data from the "Monitoring dataset" sheet</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/lawa/lawa_airqualitydownloaddata_2016-2023.xlsx"</span>, <span class="at">sheet =</span> <span class="st">"Monitoring dataset"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the loaded data to inspect its structure</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 232,293
Columns: 12
$ Region         &lt;chr&gt; "Auckland region", "Auckland region", "Auckland region"…
$ Agency         &lt;chr&gt; "Auckland Council", "Auckland Council", "Auckland Counc…
$ `LAWA Site ID` &lt;chr&gt; "LAWA-100059", "LAWA-100059", "LAWA-100059", "LAWA-1000…
$ `Site Name`    &lt;chr&gt; "Glen Eden", "Glen Eden", "Glen Eden", "Glen Eden", "Gl…
$ `Site ID`      &lt;chr&gt; "67", "67", "67", "67", "67", "67", "67", "67", "67", "…
$ Latitude       &lt;chr&gt; "-36.922142811073", "-36.922142811073", "-36.9221428110…
$ Longitude      &lt;chr&gt; "174.652000900011", "174.652000900011", "174.6520009000…
$ Town           &lt;chr&gt; "Glen Eden", "Glen Eden", "Glen Eden", "Glen Eden", "Gl…
$ `Site Type`    &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Resi…
$ Indicator      &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM10",…
$ `Sample Date`  &lt;dttm&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-0…
$ Concentration  &lt;dbl&gt; 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2, 10.…</code></pre>
</div>
</div>
<ul>
<li>The dataset contains 232,293 observations across 12 columns, detailing air quality measurements in Auckland. It includes site locations, pollutant indicators, concentrations, agencies, and timestamps, primarily tracking pollutant levels in residential areas.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean column names to ensure consistency and remove spaces or special characters</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>(airdata)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the structure of the cleaned data</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [232,293 × 12] (S3: tbl_df/tbl/data.frame)
 $ region       : chr [1:232293] "Auckland region" "Auckland region" "Auckland region" "Auckland region" ...
 $ agency       : chr [1:232293] "Auckland Council" "Auckland Council" "Auckland Council" "Auckland Council" ...
 $ lawa_site_id : chr [1:232293] "LAWA-100059" "LAWA-100059" "LAWA-100059" "LAWA-100059" ...
 $ site_name    : chr [1:232293] "Glen Eden" "Glen Eden" "Glen Eden" "Glen Eden" ...
 $ site_id      : chr [1:232293] "67" "67" "67" "67" ...
 $ latitude     : chr [1:232293] "-36.922142811073" "-36.922142811073" "-36.922142811073" "-36.922142811073" ...
 $ longitude    : chr [1:232293] "174.652000900011" "174.652000900011" "174.652000900011" "174.652000900011" ...
 $ town         : chr [1:232293] "Glen Eden" "Glen Eden" "Glen Eden" "Glen Eden" ...
 $ site_type    : chr [1:232293] "Residential, NES site" "Residential, NES site" "Residential, NES site" "Residential, NES site" ...
 $ indicator    : chr [1:232293] "PM10" "PM10" "PM10" "PM10" ...
 $ sample_date  : POSIXct[1:232293], format: "2016-01-01" "2016-01-02" ...
 $ concentration: num [1:232293] 11.1 10.6 4.7 6.9 13.2 11.1 15.2 10.7 15.2 10.6 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the column for date to a more user-friendly name</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">date =</span> sample_date)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the updated data</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 232,293
Columns: 12
$ region        &lt;chr&gt; "Auckland region", "Auckland region", "Auckland region",…
$ agency        &lt;chr&gt; "Auckland Council", "Auckland Council", "Auckland Counci…
$ lawa_site_id  &lt;chr&gt; "LAWA-100059", "LAWA-100059", "LAWA-100059", "LAWA-10005…
$ site_name     &lt;chr&gt; "Glen Eden", "Glen Eden", "Glen Eden", "Glen Eden", "Gle…
$ site_id       &lt;chr&gt; "67", "67", "67", "67", "67", "67", "67", "67", "67", "6…
$ latitude      &lt;chr&gt; "-36.922142811073", "-36.922142811073", "-36.92214281107…
$ longitude     &lt;chr&gt; "174.652000900011", "174.652000900011", "174.65200090001…
$ town          &lt;chr&gt; "Glen Eden", "Glen Eden", "Glen Eden", "Glen Eden", "Gle…
$ site_type     &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Resid…
$ indicator     &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", …
$ date          &lt;dttm&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01…
$ concentration &lt;dbl&gt; 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2, 10.6…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a 'year' column for further analysis based on the date</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="fu">as.numeric</span>(longitude),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="fu">as.numeric</span>(latitude),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a 'year' column</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">format</span>(date, <span class="st">"%Y"</span>))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of the modified dataset</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    region             agency          lawa_site_id        site_name        
 Length:232293      Length:232293      Length:232293      Length:232293     
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
                                                                            
   site_id             latitude        longitude         town          
 Length:232293      Min.   :-46.43   Min.   :168.3   Length:232293     
 Class :character   1st Qu.:-43.38   1st Qu.:172.6   Class :character  
 Mode  :character   Median :-40.95   Median :174.8   Mode  :character  
                    Mean   :-40.54   Mean   :174.0                     
                    3rd Qu.:-37.78   3rd Qu.:175.7                     
                    Max.   :-35.73   Max.   :178.0                     
                    NA's   :717      NA's   :717                       
  site_type          indicator              date                       
 Length:232293      Length:232293      Min.   :2016-01-01 00:00:00.00  
 Class :character   Class :character   1st Qu.:2018-04-28 00:00:00.00  
 Mode  :character   Mode  :character   Median :2020-04-07 00:00:00.00  
                                       Mean   :2020-03-08 17:45:54.02  
                                       3rd Qu.:2022-02-10 01:00:00.00  
                                       Max.   :2023-12-31 01:00:00.00  
                                                                       
 concentration         year          
 Min.   : -5.568   Length:232293     
 1st Qu.:  6.404   Class :character  
 Median : 10.493   Mode  :character  
 Mean   : 12.661                     
 3rd Qu.: 16.100                     
 Max.   :202.800                     
                                     </code></pre>
</div>
</div>
<ul>
<li>There are 232,293 data observations describing air quality sites, locations, pollutants, dates, and concentration values. 717 missing longitude, and latitude values. Contration of pollutants range from -5.568µg/m³ to 202.8µg/m³.</li>
</ul>
</section></details>
</section>
<section id="air-pollutant-concentration-trends-20162023" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="air-pollutant-concentration-trends-20162023"><span class="header-section-number">2.2</span> Air Pollutant Concentration Trends (2016–2023)</h3>
<p>The boxplots below illustrate yearly trends in pollutant concentrations across New Zealand, highlighting differences in distribution and scale between pollutant types, with and without y-axis restriction.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="air-quality_files/figure-html/visualize-lawa-concentration-distribution-1.png" class="img-fluid figure-img" width="1440"></p>
<figcaption>Air Pollutant Concentration in NZ (2016–2023)</figcaption>
</figure>
</div>
</div>
</div>
<p>PM10 levels are higher, with medians often below 15µg/m³ and frequent extreme outliers (~200µg/m³), suggesting episodic spikes from dust, construction, or fires. PM2.5 shows narrower IQRs and fewer outliers (&lt;90µg/m³), indicating more consistent levels. Though lower in concentration, PM2.5 poses greater long-term health risks due to deeper lung penetration and possible cumulative effects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview observations with invalid concentration</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(concentration <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="fu">is.na</span>(concentration))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  `concentration &lt; 0` `is.na(concentration)`      n
  &lt;lgl&gt;               &lt;lgl&gt;                   &lt;int&gt;
1 FALSE               FALSE                  232186
2 TRUE                FALSE                     107</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 107 observations with negative concentration. None of the concentrations are missing.</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace negative concentration values with NA</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">concentration =</span> <span class="fu">ifelse</span>(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    concentration <span class="sc">&lt;</span> <span class="dv">0</span> , <span class="cn">NA</span>, concentration))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the format of the date column</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the observations with missing longitude and latitude</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(longitude), <span class="fu">is.na</span>(latitude)) <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(town, site_name, latitude, longitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
  town    site_name           latitude longitude     n
  &lt;chr&gt;   &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
1 Rotorua Rotorua at Moses Rd       NA        NA   717</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 717 missing coordinates in town: Rotorua at site_name: Rotorua at Moses Rd</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter Rotorua and count all site_name, longitude, and latitude</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(town <span class="sc">==</span> <span class="st">"Rotorua"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(region, site_name, latitude, longitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  region               site_name            latitude longitude     n
  &lt;chr&gt;                &lt;chr&gt;                   &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
1 Bay of Plenty region Rotorua at Edmund Rd    -38.1      176.  5428
2 Bay of Plenty region Rotorua at Moses Rd      NA         NA    717</code></pre>
</div>
</div>
<p>717 values of latitude and longitude missing for town Rotorua at site_name: Rotorua at Moses Rd. From <a href="https://www.google.com/maps/place/Edmund+Road,+Rotorua+3015/@-38.1365744,176.2093362,16z/data=!4m15!1m8!3m7!1s0x6d6c26fd8a529507:0x880fa5106b1fb10!2sEdmund+Road,+Rotorua+3015!3b1!8m2!3d-38.136431!4d176.214529!16s%2Fg%2F1tdxw6g1!3m5!1s0x6d6c26fd8a529507:0x880fa5106b1fb10!8m2!3d-38.136431!4d176.214529!16s%2Fg%2F1tdxw6g1?entry=ttu&amp;g_ep=EgoyMDI1MDUwNS4wIKXMDSoJLDEwMjExNDUzSAFQAw%3D%3D">Google Maps</a>, These coordinates roughly point to latitude: -38.1482, longitude: 176.2273</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill in missing coordinates for Rotorua at Moses Rd site name with approximate central coordinates from Google Map</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="fu">if_else</span>(</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>      site_name <span class="sc">==</span> <span class="st">"Rotorua at Moses Rd"</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(latitude),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span><span class="fl">38.1482</span>, latitude),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="fu">if_else</span>(</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>      site_name <span class="sc">==</span> <span class="st">"Rotorua at Moses Rd"</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(longitude),</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>      <span class="fl">176.2273</span>, longitude))</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the updated coordinates</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(town <span class="sc">==</span> <span class="st">"Rotorua"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(site_name, latitude, longitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  site_name            latitude longitude     n
  &lt;chr&gt;                   &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
1 Rotorua at Edmund Rd    -38.1      176.  5428
2 Rotorua at Moses Rd     -38.1      176.   717</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify site names with multiple locations</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>repeating_site <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(site_name, longitude, latitude) <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(site_name) <span class="sc">|&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(site_name)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(repeating_site)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> chr [1:18] "Anzac Square" "Geraldine" "Glen Eden" "Hampstead" "Henderson" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 18 site_name with different longitude and latitude at least once.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview coordinates for Geraldine</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(site_name <span class="sc">==</span> <span class="st">"Geraldine"</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(longitude, latitude), <span class="sc">~</span><span class="fu">format</span>(.x, <span class="at">digits =</span> <span class="dv">16</span>))) <span class="sc">|&gt;</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(longitude, latitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  longitude         latitude          
  &lt;chr&gt;             &lt;chr&gt;             
1 171.2414809999840 -44.10018100044980
2 171.2414809999841 -44.10018100044984</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The difference is in the precision in the 14th decimal places</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview locations for site_name: Anzac Square</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(site_name <span class="sc">==</span> <span class="st">"Anzac Square"</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(longitude, latitude), <span class="sc">~</span><span class="fu">format</span>(.x, <span class="at">digits =</span> <span class="dv">16</span>))) <span class="sc">|&gt;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(longitude, latitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  longitude         latitude          
  &lt;chr&gt;             &lt;chr&gt;             
1 171.2496629996010 -44.40448300080550
2 171.2496629996013 -44.40448300080546</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The difference is in the precision in the 13th and 14th decimal places</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace longitude and latitude with the maximum values for repeating sites</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_name) <span class="sc">|&gt;</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="fu">max</span>(longitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="fu">max</span>(latitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure only repeating sites were modified</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(site_name, longitude, latitude) <span class="sc">|&gt;</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(site_name) <span class="sc">|&gt;</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 2
# ℹ 2 variables: site_name &lt;chr&gt;, n &lt;int&gt;</code></pre>
</div>
</div>
</section>
<section id="daily-trends-in-pm10-and-pm2.5-by-town" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="daily-trends-in-pm10-and-pm2.5-by-town"><span class="header-section-number">2.3</span> Daily Trends in PM10 and PM2.5 by Town</h3>
<p>This plot highlights daily trends in particulate matter (PM10 and PM2.5) across New Zealand towns from 2016 to 2023, showing peak values and differences in spatial pollution patterns.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 13
Columns: 5
$ date      &lt;date&gt; 2016-04-02, 2016-04-02, 2017-04-01, 2018-03-31, 2019-04-06,…
$ indicator &lt;chr&gt; "PM10", "PM2.5", "PM10", "PM10", "PM10", "PM10", "PM2.5", "P…
$ site_name &lt;chr&gt; "Arrowtown", "Plunket AQ", "Central Dunedin", "Alexandra at …
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Industria…
$ n         &lt;int&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 232,280
Columns: 10
$ date       &lt;date&gt; 2016-01-01, 2016-01-01, 2016-01-01, 2016-01-01, 2016-01-01…
$ year       &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2016", "20…
$ indicator  &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM…
$ site_name  &lt;chr&gt; "126 Hautapu Street", "34 Maata Street", "Anzac Square", "A…
$ site_type  &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Resident…
$ town       &lt;chr&gt; "Taihape", "Taumarunui", "Timaru", "Arrowtown", "Awatoto", …
$ latitude   &lt;dbl&gt; -39.67780, -38.88618, -44.40448, -44.94857, -39.54589, -38.…
$ longitude  &lt;dbl&gt; 175.8008, 175.2710, 171.2497, 168.8457, 176.9191, 175.8584,…
$ mean_conc  &lt;dbl&gt; 8.45400, 10.57200, 16.07100, 7.70000, 29.09000, 6.19802, 10…
$ total_conc &lt;dbl&gt; 8.45400, 10.57200, 16.07100, 7.70000, 29.09000, 6.19802, 10…</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-daily-pollutant-trends-by-town-1.png" class="img-fluid figure-img" width="1440"></p>
<figcaption>Daily PM10 and PM2.5 concentrations by town (2016–2023)</figcaption>
</figure>
</div>
</div>
</div>
<p>Both PM10 and PM2.5 concentrations exhibit noticeable winter peaks (June–August) across multiple years, likely due to increased heating emissions and meteorological conditions. Summer months tend to have lower pollutant levels, reflecting improved dispersion and reduced combustion-based emissions. Occasional extreme peaks, mostly during winter months exceeding 100 µg/m³ (PM10) and 50 µg/m³ (PM2.5) indicate episodes of significantly poor air quality. Milton, Arrowtown, Timaru, Central Lower Hutt, and Tokoroa frequently experience PM10 spikes, while Rotorua, Kaiapoi, and Tokoroa see more PM2.5 surges, likely influenced by industry, transport, or topography. Pollutant levels fluctuate due to wind speed, temperature inversions, and precipitation, while seasonal trends are shaped by emissions from traffic, industrial activities, and wood burning.</p>
</section>

<section id="spatial-plot-of-pollutant-concentration-across-nz-20162023" class="level2 tabset" data-number="3">
<h2 class="tabset anchored" data-number="3" data-anchor-id="spatial-plot-of-pollutant-concentration-across-nz-20162023"><span class="header-section-number">3</span> Spatial Plot of Pollutant Concentration Across NZ (2016–2023)</h2>
<p>This map shows average PM10 and PM2.5 concentrations at monitoring sites across New Zealand, projected using NZTM2000. Higher values are observed in densely populated urban regions.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 103
Columns: 6
$ town      &lt;chr&gt; "Alexandra", "Arrowtown", "Ashburton", "Ashburton", "Aucklan…
$ site_name &lt;chr&gt; "Alexandra at 5 Ventry Street", "Arrowtown", "Hampstead", "H…
$ longitude &lt;dbl&gt; 169.3903, 168.8457, 171.7552, 171.7552, 174.7657, 174.7657, …
$ latitude  &lt;dbl&gt; -45.25485, -44.94857, -43.91224, -43.91224, -36.84743, -36.8…
$ indicator &lt;chr&gt; "PM10", "PM10", "PM10", "PM2.5", "PM10", "PM2.5", "PM10", "P…
$ mean_conc &lt;dbl&gt; 14.788923, 16.990257, 15.981660, 8.663412, 17.300244, 7.1823…</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  indicator   min   max     n
  &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
1 PM10       4.69  30.9    66
2 PM2.5      4.69  30.9    37</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 103
Columns: 5
$ town      &lt;chr&gt; "Alexandra", "Arrowtown", "Ashburton", "Ashburton", "Aucklan…
$ site_name &lt;chr&gt; "Alexandra at 5 Ventry Street", "Arrowtown", "Hampstead", "H…
$ indicator &lt;chr&gt; "PM10", "PM10", "PM10", "PM2.5", "PM10", "PM2.5", "PM10", "P…
$ mean_conc &lt;dbl&gt; 14.788923, 16.990257, 15.981660, 8.663412, 17.300244, 7.1823…
$ geometry  &lt;POINT [m]&gt; POINT (1316769 4982397), POINT (1272287 5014362), POIN…</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="air-quality_files/figure-html/Spatially-plot-average-pollutant-level-over-all-years-1.png" class="img-fluid figure-img" width="1440"></p>
<figcaption>Spatial distribution of average PM10 and PM2.5 concentrations (2016–2023)</figcaption>
</figure>
</div>
</div>
</div>
<p>PM10 and PM2.5 spatial distributions across New Zealand show differing average pollutant concentration patterns. PM10 concentrations exhibit broader regional variability, with high levels in Timaru, Arrowtown, Gore. PM2.5 concentrations appear more localized, clustering around major urban centers. The color gradient further emphasizes intensity differences, with PM10 displaying a more dispersed pattern.</p>
<section id="yearly-total-concentrations-of-pm10-and-pm2.5-at-nz-monitoring-sites" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="yearly-total-concentrations-of-pm10-and-pm2.5-at-nz-monitoring-sites"><span class="header-section-number">3.1</span> Yearly Total Concentrations of PM10 and PM2.5 at NZ Monitoring Sites</h3>
<p>This plot compares annual total pollutant concentrations at air quality sites across New Zealand from 2016 to 2023. Towns with the lowest and highest yearly values are labelled.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
   57.44  2993.20  4073.38  4148.35  5185.62 10859.53 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 32
Columns: 6
$ year       &lt;chr&gt; "2016", "2016", "2016", "2016", "2017", "2017", "2017", "20…
$ town       &lt;chr&gt; "Blenheim", "Nelson Centre/North", "Timaru", "Timaru", "Ble…
$ indicator  &lt;chr&gt; "PM2.5", "PM10", "PM10", "PM2.5", "PM2.5", "PM10", "PM2.5",…
$ latitude   &lt;dbl&gt; -41.52664, -41.28196, -44.40448, -44.40448, -41.52664, -41.…
$ longitude  &lt;dbl&gt; 173.9561, 173.2908, 171.2497, 171.2497, 173.9561, 173.2908,…
$ total_conc &lt;dbl&gt; 57.4400, 1644.5000, 8578.9230, 4666.7880, 5220.9400, 1919.5…</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-yearly-total-concentrations-at-nz-sites-1.png" class="img-fluid figure-img" width="1440"></p>
<figcaption>Boxplots of yearly total PM10 and PM2.5 concentrations across NZ sites (2016–2023)</figcaption>
</figure>
</div>
</div>
</div>
<p>Locations such as Timaru, Invercargill, and Mount Maunganui frequently appear with higher PM10 values, suggesting regional emissions from transport, industry, or meteorological conditions. Lower PM10 levels are recorded at Nelson Centre/North, Stoke, Gisborne, and Christchurch, indicating relatively better air quality in these areas.</p>
<p>Timaru, Blenheim, Tokoroa, and Kaiapoi consistently report elevated PM2.5 levels, emphasizing finer particulate pollution concerns, possibly linked to combustion sources. Sites like Blenheim, Nelson South, Hamilton, Te Kuiti, Patumahoe, Christchurch, Napier, and Awatoto exhibit lower PM2.5 concentrations, suggesting fewer major emission sources or better pollutant dispersion.</p>
<p>Seasonal influences (e.g., winter heating emissions) could explain peaks in both PM10 and PM2.5. Site-specific pollutant sources (e.g., traffic, industry, and wood burning) contribute to long-term trends.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add last two digits of year in column year</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>dailyairdata <span class="ot">&lt;-</span> dailyairdata <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">format</span>(date, <span class="st">"%y"</span>),</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">month =</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(date, <span class="st">"%m"</span>)))</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate pollutant concentrations per season per year</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>dailyairdata <span class="ot">&lt;-</span> dailyairdata <span class="sc">|&gt;</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">season =</span> <span class="fu">case_when</span>(</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">~</span> <span class="st">"Sum"</span>,</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">~</span> <span class="st">"Aut"</span>,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>) <span class="sc">~</span> <span class="st">"Win"</span>,</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>) <span class="sc">~</span> <span class="st">"Spr"</span>),</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">season_year =</span> <span class="fu">paste0</span>(season, <span class="st">"_"</span>, year))</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>season_order <span class="ot">&lt;-</span> <span class="fu">unique</span>(dailyairdata<span class="sc">$</span>season_year)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>seasonairdata <span class="ot">&lt;-</span> dailyairdata <span class="sc">|&gt;</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">season_year =</span> <span class="fu">factor</span>(season_year, <span class="at">levels =</span> season_order, <span class="at">ordered =</span> <span class="cn">TRUE</span>))</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>seasonairdata <span class="ot">&lt;-</span> seasonairdata <span class="sc">|&gt;</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season_year, town, indicator) <span class="sc">|&gt;</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_conc =</span> <span class="fu">sum</span>(total_conc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(seasonairdata<span class="sc">$</span>total_conc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    8.0   624.5  1025.2  1189.8  1399.4 12305.8 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seasonal total concentration range from 7.1µg/m³ to 31168.9µg/m³, so using log scale is valid.</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter town with the seasonal lowest and highest concentration of pollutants</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>text_label <span class="ot">&lt;-</span> seasonairdata <span class="sc">|&gt;</span> </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season_year, indicator) <span class="sc">|&gt;</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(total_conc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="fu">min</span>(total_conc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">max</span>(total_conc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">|&gt;</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(text_label)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 128
Columns: 4
$ season_year &lt;ord&gt; Sum_16, Sum_16, Sum_16, Sum_16, Aut_16, Aut_16, Aut_16, Au…
$ town        &lt;chr&gt; "Blenheim", "Christchurch", "Christchurch", "Nelson Centre…
$ indicator   &lt;chr&gt; "PM2.5", "PM10", "PM2.5", "PM10", "PM10", "PM2.5", "PM10",…
$ total_conc  &lt;dbl&gt; 57.440, 3136.030, 1147.860, 159.000, 3125.592, 1403.090, 2…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot seasonal total pollutant concentration across NZ monitoring sites (2016–2023), using boxplots, with towns labelled at the annual minimum and maximum concentration levels</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>plot_season <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> seasonairdata, <span class="fu">aes</span>(<span class="at">x =</span> season_year, <span class="at">y =</span> total_conc)) <span class="sc">+</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> town, <span class="at">color =</span> town), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> text_label,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> season_year, <span class="at">y =</span> total_conc, <span class="at">label =</span> town), <span class="at">font_face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">nudge_y =</span> <span class="fl">0.1</span>, <span class="at">check_overlap =</span> <span class="cn">TRUE</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> indicator, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>scientific) <span class="sc">+</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Total Pollutant Concentrations across Monitoring Multiple Sites in New Zealand (2016-2023)"</span>,</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Seasonal total PM10 and PM2.5 concentrations, with towns labelled at annual extremes"</span>,</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Season Year"</span>,</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Seasonal Pollutant Concentration (µg/m³)"</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>plot_season</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-seasonal-total-concentration-for-each-year-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>The plots show seasonal PM10 and PM2.5 trends (2016–2023) across NZ. PM10 levels are higher, with peaks in Mount Maunganui, Masterton, and Christchurch. PM2.5 peaks in Christchurch, Masterton, and Timaru. Both show winter highs and summer lows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect subgroup of longitude, latitude, site_type, and town</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>airdata_group <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(longitude, latitude, site_type, town)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 69
Columns: 4
$ longitude &lt;dbl&gt; 174.6520, 174.6284, 174.6284, 174.8904, 174.8640, 174.8156, …
$ latitude  &lt;dbl&gt; -36.92214, -36.86800, -36.86800, -36.90548, -37.20450, -36.9…
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, Traffic, NES site", "…
$ town      &lt;chr&gt; "Glen Eden", "Henderson", "Henderson", "Pakuranga", "Patumah…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 69 data observations.</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create label dataset of coordinates, and town</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>label_text <span class="ot">&lt;-</span> airdata_group <span class="sc">|&gt;</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(latitude, longitude, town)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(label_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 67
Columns: 3
$ latitude  &lt;dbl&gt; -36.92214, -36.86800, -36.90548, -37.20450, -36.90456, -36.8…
$ longitude &lt;dbl&gt; 174.6520, 174.6284, 174.8904, 174.8640, 174.8156, 174.7657, …
$ town      &lt;chr&gt; "Glen Eden", "Henderson", "Pakuranga", "Patumahoe", "Penrose…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a static map of spatial distribution of site types</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> airdata_group) <span class="sc">+</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">color =</span> site_type), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> label_text, <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">label =</span> town)) <span class="sc">+</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"turbo"</span>) <span class="sc">+</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Spatial Distribution of Air Quality Monitoring Site Type in New Zealand (2016–2023)"</span>,</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Monitoring site locations grouped by type"</span>,</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>, <span class="at">color =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"gray80"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>),</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>plot1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/Static-plot-of-lawa-site-types-monitoring-locations-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Residential sites are widespread, especially in southern cities like Invercargill and Christchurch. Industrial and mixed-use sites cluster in urban areas such as Wellington and Auckland. Coastal sites are scattered, with notable presence in Wellington and Taupo, reflecting urban and industrial monitoring priorities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by date, indicator, site_name, site_type, comput sum of concentrations</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>dailyairdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date, indicator, site_name, site_type) <span class="sc">|&gt;</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_conc =</span> <span class="fu">sum</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dailyairdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 232,280
Columns: 5
$ date       &lt;date&gt; 2016-01-01, 2016-01-01, 2016-01-01, 2016-01-01, 2016-01-01…
$ indicator  &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM…
$ site_name  &lt;chr&gt; "126 Hautapu Street", "34 Maata Street", "Anzac Square", "A…
$ site_type  &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Resident…
$ total_conc &lt;dbl&gt; 8.45400, 10.57200, 16.07100, 7.70000, 29.09000, 6.19802, 10…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a plot of PM2.5 and PM10 concentration versus date faceted by site_type</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dailyairdata, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> total_conc, <span class="at">color =</span> indicator)) <span class="sc">+</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># geom_text_repel(data = label_text, aes(x = longitude, y = latitude, label = town)) +</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"PM10"</span> <span class="ot">=</span> <span class="st">"#0072B2"</span>, <span class="st">"PM2.5"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>)) <span class="sc">+</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> site_type, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span> </span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Daily PM2.5 and PM10 Concentration versus Date at Site Types in New Zealand (2016–2023)"</span>,</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Pollutant Concentration grouped by Monitoring site locations type"</span>,</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Daily total concentration (µg/m³)"</span>,</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Indicator"</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot1</span></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>plot1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot_site-types-of-concentration-versus-date-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot restricted by y axis for more than 25</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> plot1 <span class="sc">+</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="cn">NA</span>)) <span class="sc">+</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Pollutant Concentration Restricted for at least 25µg/m³"</span>,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot2</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>plot2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot_site-types-of-concentration-versus-date-2.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>PM10 levels consistently exceed PM2.5, peaking in winter, especially at residential and NES sites, likely from wood burning. Industrial sites show high but less extreme values. Coastal and traffic sites show lower levels. Site type and season strongly influence pollution patterns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute scalar medians (as single value)</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>median16_pm25 <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(indicator <span class="sc">==</span> <span class="st">"PM2.5"</span>, year <span class="sc">==</span> <span class="dv">2016</span>) <span class="sc">|&gt;</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">median_val =</span> <span class="fu">median</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(median_val)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute scaler medians (as single value)</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>median16_pm10 <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(indicator <span class="sc">==</span> <span class="st">"PM10"</span>, year <span class="sc">==</span> <span class="dv">2016</span>) <span class="sc">|&gt;</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">median_val =</span> <span class="fu">median</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(median_val)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a new column using scalar values properly</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>normalize_airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">baseline =</span> <span class="fu">case_when</span>(</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>    indicator <span class="sc">==</span> <span class="st">"PM2.5"</span> <span class="sc">~</span> median16_pm25,</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>    indicator <span class="sc">==</span> <span class="st">"PM10"</span>  <span class="sc">~</span> median16_pm10,</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span>  <span class="co"># fallback for other indicators</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute normalized concentration values relative to the 2016 baseline</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>normalize_airdata <span class="ot">&lt;-</span> normalize_airdata <span class="sc">|&gt;</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">normalized_concentration =</span> concentration <span class="sc">/</span> baseline)</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly select 6 towns from the dataset for visualization</span></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">13</span>) <span class="co"># For reproducibility</span></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>townlist <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">unique</span>(airdata<span class="sc">$</span>town), <span class="dv">10</span>)</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the dataset to include only the selected towns</span></span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>normalize_filtered <span class="ot">&lt;-</span> normalize_airdata <span class="sc">|&gt;</span></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(town <span class="sc">%in%</span> townlist) <span class="sc">|&gt;</span></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">town_indicator =</span> <span class="fu">paste0</span>(town, <span class="st">"_"</span>, indicator))</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a faceted plot to visualize pollutant trends, highlighting differences across towns</span></span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">filter</span>(normalize_filtered), <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y =</span> normalized_concentration)) <span class="sc">+</span></span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> indicator), <span class="at">lwd=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> town_indicator, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"turbo"</span>) <span class="sc">+</span></span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Normalized Air Pollutant Concentrations Across Selected New Zealand Towns (2016–2023)"</span>,</span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"PM2.5 and PM10 Levels Adjusted to 2016 Median Concentration for Comparative Analysis"</span>,</span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Normalized Pollutant Concentration (Relative to 2016 Median)"</span>,</span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend =</span> <span class="st">"Pollutant Type"</span></span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a>   <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a>   <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a>   <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a>   <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a>   <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb49-57"><a href="#cb49-57" aria-hidden="true" tabindex="-1"></a>plot1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/normalized-pollution-trends-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Compared to the 2016 median concentration, PM2.5 and PM10 levels show varied trends across locations. Auckland City Centre and Rotorua exhibit sharp PM2.5 spikes around 2020, while Cromwell and Timaru experience periodic peaks in both pollutants. Other towns display stable or fluctuating patterns, with some decreasing trends in PM2.5. These changes indicate local factors affecting air quality, including urban emissions, seasonal variations, and regulatory impacts on pollutant concentrations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(region, site_type, site_name, site_id, latitude, longitude, town) <span class="sc">|&gt;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  region          site_type     site_name site_id latitude longitude town      n
  &lt;chr&gt;           &lt;chr&gt;         &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;int&gt;
1 Auckland region Residential,… Penrose   7          -36.9      175. Penr…  5466
2 Auckland region Residential,… Glen Eden 67         -36.9      175. Glen…  2827
3 Auckland region Residential,… Henderson 5          -36.9      175. Hend…   361
4 Auckland region Residential,… Pakuranga 1          -36.9      175. Paku…  2876
5 Auckland region Residential,… Patumahoe 2          -37.2      175. Patu…  5390
6 Auckland region Residential,… Queen St… 9          -36.8      175. Quee…   460</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the list of unique town from the airdata</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>town_list <span class="ot">&lt;-</span> <span class="fu">unique</span>(airdata<span class="sc">$</span>town)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the list to ensure valid sampling</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(town_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> chr [1:56] "Glen Eden" "Henderson" "Pakuranga" "Patumahoe" "Penrose" ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly select 10 town from the list (seeded for reproducibility)</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">13</span>)  </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>random_town <span class="ot">&lt;-</span> <span class="fu">sample</span>(town_list, <span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the randomly selected towns</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>random_town</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Auckland City Centre" "Cromwell"             "Morrinsville"        
 [4] "Napier"               "Pakuranga"            "Patumahoe"           
 [7] "Rotorua"              "Stoke"                "Taihape"             
[10] "Timaru"              </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by region and filter airdata for the 10 randomly selected towns </span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>airdata_random_town <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(town <span class="sc">%in%</span> random_town) <span class="sc">|&gt;</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Count number of distinct town, date, indicator</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>airdata_random_town <span class="sc">|&gt;</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(town, date, indicator) <span class="sc">|&gt;</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  town    date       indicator     n
  &lt;chr&gt;   &lt;date&gt;     &lt;chr&gt;     &lt;int&gt;
1 Rotorua 2023-01-01 PM10          2
2 Rotorua 2023-01-01 PM2.5         2
3 Rotorua 2023-01-02 PM10          2
4 Rotorua 2023-01-02 PM2.5         2
5 Rotorua 2023-01-03 PM10          2
6 Rotorua 2023-01-03 PM2.5         2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate total concentration for each town by date and indicator to prepare for plotting</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>airdata_random_town <span class="ot">&lt;-</span> airdata_random_town <span class="sc">|&gt;</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(town, date, indicator) <span class="sc">|&gt;</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_conc =</span> <span class="fu">sum</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the aggregated data</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata_random_town)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 34,897
Columns: 4
$ town       &lt;chr&gt; "Auckland City Centre", "Auckland City Centre", "Auckland C…
$ date       &lt;date&gt; 2017-03-04, 2017-03-05, 2017-03-06, 2017-03-07, 2017-03-08…
$ indicator  &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM…
$ total_conc &lt;dbl&gt; 11.5, 15.4, 14.7, 13.4, 8.2, 11.4, 20.3, 18.2, 20.7, 19.5, …</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the summary of total_conc of randomly selected town</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>airdata_random_town <span class="sc">|&gt;</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     town                date             indicator           total_conc     
 Length:34897       Min.   :2016-01-01   Length:34897       Min.   :  0.000  
 Class :character   1st Qu.:2018-02-13   Class :character   1st Qu.:  6.828  
 Mode  :character   Median :2020-01-19   Mode  :character   Median : 10.851  
                    Mean   :2020-01-14                      Mean   : 14.220  
                    3rd Qu.:2021-12-05                      3rd Qu.: 16.723  
                    Max.   :2023-12-31                      Max.   :159.579  </code></pre>
</div>
</div>
<ul>
<li>Total_conc range from 0 to 159.579 from 1 January 2016 to 31 December 2023.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace zero's with 1e-05, since log works on positive values</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>airdata_random_town <span class="ot">&lt;-</span> airdata_random_town <span class="sc">|&gt;</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_conc =</span> <span class="fu">ifelse</span>(</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>      total_conc <span class="sc">==</span> <span class="dv">0</span>, <span class="fl">1e-05</span>, total_conc))</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(airdata_random_town<span class="sc">$</span>total_conc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
  0.00001   6.82817  10.85118  14.21979  16.72300 159.57900 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Colorblind-friendly palette (Okabe-Ito)</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>colorblind_palette <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#999999"</span>, <span class="st">"#E69F00"</span>, <span class="st">"#440154"</span>, <span class="st">"#F0E442"</span>, <span class="st">"#009E73"</span>, <span class="st">"#D55E00"</span>, <span class="st">"#35b779"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#000000"</span>, <span class="st">"#660099"</span>, <span class="st">"#CC79A7"</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a reusable function to plot airdata concentration trends by selected town, indicator, and date. This function uses faceted plots with colorblind-friendly palettes for better accessibility</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>plot_selected_conc <span class="ot">&lt;-</span> <span class="cf">function</span>(data, title, subtitle, x_label, y_label, sum_var) {</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the plot using ggplot2</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> {{ sum_var }}, <span class="at">color =</span> indicator)) <span class="sc">+</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colorblind_palette) <span class="sc">+</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> town, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> title,</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> subtitle,</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> x_label,</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> y_label,</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"Indicator"</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>), <span class="co"># Center the main title</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot log-scaled airdata trends for 10 randomly selected towns using the custom plot function. The plot will show daily PM10 and PM2.5 concentrations across towns, scaled logarithmically.</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>plot_random_log <span class="ot">&lt;-</span> <span class="fu">plot_selected_conc</span>(</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> airdata_random_town,</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Air Pollutant Concentration Trends in 10 Random Town (2016-2023)"</span>,</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">subtitle =</span> <span class="st">"Log-scaled daily PM10, and PM2.5 concentration by indicatior"</span>,</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_label =</span> <span class="st">"Month-Year"</span>,</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_label =</span> <span class="st">"Daily Concentration (log scale)"</span>,</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">sum_var =</span> total_conc</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2016-01-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2023-12-31"</span>), <span class="at">by =</span> <span class="st">"6 months"</span>),</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">date_labels =</span> <span class="st">"%b %y"</span> <span class="co"># Format date for better readability</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_scientific</span>()) <span class="co"># Use log scale for concentration</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>plot_random_log</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/log-plot-lawa-concentration-trends-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Auckland shows stable PM levels, while Napier and Timaru have frequent seasonal spikes. Cromwell and Stoke reveal distinct 2023 patterns. Other towns remain stable. PM10 and PM2.5 generally align, though PM2.5 varies more, highlighting seasonal and source-specific pollution influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(site_name <span class="sc">%in%</span> town)) <span class="sc">|&gt;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(site_name, town)  <span class="sc">|&gt;</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [51 × 3] (S3: tbl_df/tbl/data.frame)
 $ site_name: chr [1:51] "126 Hautapu Street" "34 Maata Street" "Alexandra at 5 Ventry Street" "Anzac Square" ...
 $ town     : chr [1:51] "Taihape" "Taumarunui" "Alexandra" "Timaru" ...
 $ n        : int [1:51] 3072 3466 2333 5829 4782 5272 5177 2864 2675 2783 ...</code></pre>
</div>
</div>
<p>51 site_name are not same as 51 town.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview multiple groups of coordinates and region</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(longitude, latitude, region) <span class="sc">|&gt;</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  longitude latitude region                   n
      &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;                &lt;int&gt;
1      176.    -38.1 Bay of Plenty region   717
2      177.    -39.6 Hawke's Bay region    5336
3      177.    -39.5 Hawke's Bay region    3748
4      177.    -39.5 Hawke's Bay region    4782
5      177.    -38.0 Bay of Plenty region  2203
6      178.    -38.7 Gisborne region       3071</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the word region in region column then trim white space</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">str_trim</span>(<span class="fu">str_remove</span>(region, <span class="fu">regex</span>(<span class="st">"region"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))))</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(airdata<span class="sc">$</span>region, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "West Coast" "West Coast" "West Coast"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>official_nz_regions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Northland"</span>, <span class="st">"Auckland"</span>, <span class="st">"Waikato"</span>, <span class="st">"Bay of Plenty"</span>, <span class="st">"Gisborne"</span>, <span class="st">"Hawke's Bay"</span>, <span class="st">"Taranaki"</span>, <span class="st">"Manawatu-Whanganui"</span>, <span class="st">"Wellington"</span>, <span class="st">"Tasman"</span>, <span class="st">"Nelson"</span>, <span class="st">"Marlborough"</span>, <span class="st">"West Coast"</span>, <span class="st">"Canterbury"</span>, <span class="st">"Otago"</span>, <span class="st">"Southland"</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview regions in airdata not in the official list of NZ regions</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(region <span class="sc">%in%</span> official_nz_regions)) <span class="sc">|&gt;</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  region                 n
  &lt;chr&gt;              &lt;int&gt;
1 Manawatū-Whanganui  6538</code></pre>
</div>
</div>
<p>We need to clean Manawatu-Whanganui region. It has bar on top of u in Manawatu.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean region name Manawatu-Whanganui</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span> </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">ifelse</span>(region <span class="sc">==</span> <span class="st">"Manawatū-Whanganui"</span>, <span class="st">"Manawatu-Whanganui"</span>, region))</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute total concentration of groups of coordinates and region</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>region_airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="fu">round</span>(longitude, <span class="dv">5</span>), </span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="fu">round</span>(latitude, <span class="dv">5</span>),</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_conc =</span> <span class="fu">sum</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(region_airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [232,293 × 4] (S3: tbl_df/tbl/data.frame)
 $ region    : chr [1:232293] "Auckland" "Auckland" "Auckland" "Auckland" ...
 $ longitude : num [1:232293] 175 175 175 175 175 ...
 $ latitude  : num [1:232293] -36.9 -36.9 -36.9 -36.9 -36.9 ...
 $ total_conc: num [1:232293] 318149 318149 318149 318149 318149 ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count location coordinates </span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>region_airdata <span class="sc">|&gt;</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">"Wellington"</span>) <span class="sc">|&gt;</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(longitude, latitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  longitude latitude     n
      &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
1      175.    -41.3  5666
2      175.    -41.2  2892
3      175.    -41.3  5776
4      175.    -41.1  2897
5      176.    -41.0  5663
6      176.    -41.0  4388</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect coordinates and region for labelling</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>label_text <span class="ot">&lt;-</span> region_airdata <span class="sc">|&gt;</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, total_conc) <span class="sc">|&gt;</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="fu">min</span>(longitude), <span class="at">latitude =</span> <span class="fu">min</span>(latitude),</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(label_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [15 × 4] (S3: tbl_df/tbl/data.frame)
 $ region    : chr [1:15] "Auckland" "Bay of Plenty" "Canterbury" "Gisborne" ...
 $ total_conc: num [1:15] 318149 317754 643087 47055 166544 ...
 $ longitude : num [1:15] 175 176 171 178 177 ...
 $ latitude  : num [1:15] -37.2 -38.1 -44.7 -38.7 -39.6 ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Get New Zealand map</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>nz_map <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">country =</span> <span class="st">"New Zealand"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot monitoring sites locatioms colored total concentration by region</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> nz_map) <span class="sc">+</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">fill =</span> <span class="st">"gray95"</span>, <span class="at">color =</span> <span class="st">"gray80"</span>) <span class="sc">+</span>  <span class="co"># Basemap</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> region_airdata, </span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">color =</span> total_conc), <span class="at">size =</span> <span class="dv">5</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> label_text, <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">label =</span> region, <span class="at">color =</span> total_conc),</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">box.padding =</span> <span class="fl">0.3</span>, <span class="at">segment.color =</span> <span class="st">"grey30"</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">trans =</span> <span class="st">"log10"</span>,</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_scientific</span>()) <span class="sc">+</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">165</span>, <span class="dv">180</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">48</span>, <span class="sc">-</span><span class="dv">34</span>)) <span class="sc">+</span> <span class="co"># Add coord_sf to zoom in to nz</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Total Region Pollutant concentrations from Monitoring Sites locations in New Zealand"</span>,</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Longitude"</span>,</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Latitude"</span>,</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Total Pollutant</span><span class="sc">\n</span><span class="st">Concentration (µg/m³)"</span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span>  <span class="co"># Add title</span></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>) <span class="sc">+</span>  <span class="co"># Adds scale bar</span></span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tl"</span>, <span class="at">which_north =</span> <span class="st">"true"</span>, <span class="at">style =</span> <span class="fu">north_arrow_fancy_orienteering</span>())</span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Display map</span></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/map-lawa-total-concentration-by-region-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Areas such as Auckland and Canterbury exhibit higher overall pollution levels, likely due to urban density, traffic emissions, and industrial activities. The more rural regions like Gisborne appear in cooler colors, indicating lower concentrations.</p>
</section>
</section>
<section id="load-2018-population-data-and-regional-map-data-from-stats-nz" class="level2 tabset" data-number="4">
<h2 class="tabset anchored" data-number="4" data-anchor-id="load-2018-population-data-and-regional-map-data-from-stats-nz"><span class="header-section-number">4</span> Load 2018 population data and regional map data from Stats NZ</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the spatial data (GeoPackage) for SA2 regions</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>sa2_nz <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/SA2_nz.gpkg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `SA2_NZ' from data source 
  `C:\Users\vishal\Documents\Earthsci705\projectfile\project\data\SA2_NZ.gpkg' 
  using driver `GPKG'
Simple feature collection with 2151 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 1089970 ymin: 4747987 xmax: 2470102 ymax: 6194308
Projected CRS: NZGD2000 / New Zealand Transverse Mercator 2000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the spatial data structure</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(sa2_nz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,151
Columns: 4
$ SA2_Name &lt;chr&gt; "North Cape", "Rangaunu Harbour", "Karikari Peninsula", "Tang…
$ SA2_ID   &lt;int&gt; 100100, 100200, 100400, 100500, 102100, 102200, 102300, 10240…
$ Pop2018  &lt;int&gt; 1660, 2410, 1300, 1180, 1290, 2200, 1290, 1550, 900, 1760, 11…
$ geom     &lt;MULTIPOLYGON [m]&gt; MULTIPOLYGON (((1596201 615..., MULTIPOLYGON (((…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The SA2_NZ layer was read from a GeoPackage file using the GPKG driver. It contains 2,151 features with three attribute fields and multipolygon geometries in the NZGD2000 Transverse Mercator projection.</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load regional map data from [regions](https://datafinder.stats.govt.nz/layer/104254-regional-council-2020-generalised/)</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load a shape file of regions</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>regions <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/statsnz-regional-council-2020-generalised-SHP/regional-council-2020-generalised.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `regional-council-2020-generalised' from data source 
  `C:\Users\vishal\Documents\Earthsci705\projectfile\project\data\statsnz-regional-council-2020-generalised-SHP\regional-council-2020-generalised.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 17 features and 6 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 1067061 ymin: 4701317 xmax: 2523320 ymax: 6242140
Projected CRS: NZGD2000 / New Zealand Transverse Mercator 2000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(regions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 17
Columns: 7
$ REGC2020_V &lt;chr&gt; "02", "03", "04", "05", "06", "07", "08", "09", "12", "13",…
$ REGC2020_1 &lt;chr&gt; "Auckland Region", "Waikato Region", "Bay of Plenty Region"…
$ REGC2020_2 &lt;chr&gt; "Auckland Region", "Waikato Region", "Bay of Plenty Region"…
$ LAND_AREA_ &lt;dbl&gt; 4941.0723, 23900.3640, 12071.8091, 8385.3265, 14138.0113, 7…
$ AREA_SQ_KM &lt;dbl&gt; 16156.206, 34888.831, 21883.748, 13989.051, 21444.166, 1269…
$ SHAPE_Leng &lt;dbl&gt; 660973.5, 1268419.5, 1093733.7, 695917.9, 928783.7, 564431.…
$ geometry   &lt;MULTIPOLYGON [m]&gt; MULTIPOLYGON (((1745493 600..., MULTIPOLYGON (…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The regional-council-2020-generalised layer, read from an ESRI Shapefile, contains 17 multipolygon features representing New Zealand's regional councils. It includes six attribute fields and uses the NZGD2000 Transverse Mercator projected coordinate system for spatial reference.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="spatial-join-of-datasets-population-and-region" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="spatial-join-of-datasets-population-and-region"><span class="header-section-number">4.1</span> Spatial join of datasets: population and region</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find values from regions columns which does not match</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(regions) <span class="sc">|&gt;</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(REGC2020_1 <span class="sc">!=</span> REGC2020_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  REGC2020_V                REGC2020_1                REGC2020_2 LAND_AREA_
1         08 Manawatū-Whanganui Region Manawatu-Whanganui Region   22220.58
  AREA_SQ_KM SHAPE_Leng                       geometry
1   25322.14    1176349 MULTIPOLYGON (((1823327 573...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The two columns are different for Manawatu, which has a bar on top in one and the REGC2020_2 does not. Let's select REGC2020_2.</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure both layers are in same CRS</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(sa2_nz)<span class="sc">$</span>epsg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2193</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(regions)<span class="sc">$</span>epsg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2193</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># They are same, both sa2_nz and regions datasets are in crs of epsg:2193</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform a spatial join to assign each SA2 to a region</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>sa2_nz <span class="ot">&lt;-</span> <span class="fu">st_join</span>(sa2_nz, regions[, <span class="fu">c</span>(<span class="st">"REGC2020_2"</span>, <span class="st">"geometry"</span>)]) </span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview column names of sa2_nz</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sa2_nz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SA2_Name"   "SA2_ID"     "Pop2018"    "REGC2020_2" "geom"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 5 columns of SA2_Name, SA2_ID, Pop2018, REGC2020_2, and geom </span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Count added regions</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="fu">st_drop_geometry</span>(sa2_nz) <span class="sc">|&gt;</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(REGC2020_2) <span class="sc">|&gt;</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   17 obs. of  1 variable:
 $ REGC2020_2: chr  "Northland Region" "Auckland Region" "Bay of Plenty Region" "Taranaki Region" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The column contains 17 distinct regions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform the coordinate reference system (CRS) of sa2_nz to WGS84</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>sa2_nz <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(sa2_nz, <span class="at">crs =</span> <span class="dv">4326</span>)  </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(sa2_nz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,332
Columns: 5
$ SA2_Name   &lt;chr&gt; "North Cape", "Rangaunu Harbour", "Karikari Peninsula", "Ta…
$ SA2_ID     &lt;int&gt; 100100, 100200, 100400, 100500, 102100, 102200, 102300, 102…
$ Pop2018    &lt;int&gt; 1660, 2410, 1300, 1180, 1290, 2200, 1290, 1550, 900, 1760, …
$ REGC2020_2 &lt;chr&gt; "Northland Region", "Northland Region", "Northland Region",…
$ geom       &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((172.9585 -3..., MULTIPOLYGON (…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This dataset includes 2,332 rows with SA2 names, IDs, 2018 population data, regional council names, and multipolygon geometries, representing spatial boundaries for statistical areas across New Zealand.</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check class of geom</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(sa2_nz<span class="sc">$</span>geom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sfc_MULTIPOLYGON" "sfc"             </code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The geom column in sa2_nz is of class sfc_MULTIPOLYGON, meaning it stores spatial features as multipolygons using the simple features (sf) framework for geospatial vector data in R.</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean column names of sa2_nz </span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>sa2_nz <span class="ot">&lt;-</span> sa2_nz <span class="sc">|&gt;</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="co"># View column names of sa2_nz</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sa2_nz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sa2_name"   "sa2_id"     "pop2018"    "regc2020_2" "geom"      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview names of geographical units</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_drop_geometry</span>(sa2_nz) <span class="sc">|&gt;</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   2151 obs. of  1 variable:
 $ sa2_name: chr  "North Cape" "Rangaunu Harbour" "Karikari Peninsula" "Tangonge" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 2151 distinct sa2_name in the dataset sa2_nz</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="co"># View distinct region in sa2_nz</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(sa2_nz) <span class="sc">|&gt;</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(regc2020_2) <span class="sc">|&gt;</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 17
Columns: 1
$ regc2020_2 &lt;chr&gt; "Northland Region", "Auckland Region", "Bay of Plenty Regio…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 17 distinct region in the sa2_nz dataset</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename region column and remove region from values</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>sa2_nz <span class="ot">&lt;-</span> sa2_nz <span class="sc">|&gt;</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">region =</span> regc2020_2) <span class="sc">|&gt;</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">str_trim</span>(<span class="fu">str_remove</span>(region, <span class="fu">regex</span>(<span class="st">"region"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))))</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(sa2_nz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,332
Columns: 5
$ sa2_name &lt;chr&gt; "North Cape", "Rangaunu Harbour", "Karikari Peninsula", "Tang…
$ sa2_id   &lt;int&gt; 100100, 100200, 100400, 100500, 102100, 102200, 102300, 10240…
$ pop2018  &lt;int&gt; 1660, 2410, 1300, 1180, 1290, 2200, 1290, 1550, 900, 1760, 11…
$ region   &lt;chr&gt; "Northland", "Northland", "Northland", "Northland", "Northlan…
$ geom     &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((172.9585 -3..., MULTIPOLYGON (((…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate centroids of geometry polygons</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>sa2_centroids <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(sa2_nz)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview first few rows</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(sa2_centroids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,332
Columns: 5
$ sa2_name &lt;chr&gt; "North Cape", "Rangaunu Harbour", "Karikari Peninsula", "Tang…
$ sa2_id   &lt;int&gt; 100100, 100200, 100400, 100500, 102100, 102200, 102300, 10240…
$ pop2018  &lt;int&gt; 1660, 2410, 1300, 1180, 1290, 2200, 1290, 1550, 900, 1760, 11…
$ region   &lt;chr&gt; "Northland", "Northland", "Northland", "Northland", "Northlan…
$ geom     &lt;POINT [°]&gt; POINT (172.9301 -34.61058), POINT (173.1995 -34.9607), …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sa2_centroids has 2332 rows with 5 columns, geom column is of point type</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract longitude and latitude from centroids</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>sa2_centroids <span class="ot">&lt;-</span> sa2_centroids <span class="sc">|&gt;</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="fu">st_coordinates</span>(geom)[, <span class="dv">1</span>],</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="fu">st_coordinates</span>(geom)[, <span class="dv">2</span>])</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(sa2_centroids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,332
Columns: 7
$ sa2_name  &lt;chr&gt; "North Cape", "Rangaunu Harbour", "Karikari Peninsula", "Tan…
$ sa2_id    &lt;int&gt; 100100, 100200, 100400, 100500, 102100, 102200, 102300, 1024…
$ pop2018   &lt;int&gt; 1660, 2410, 1300, 1180, 1290, 2200, 1290, 1550, 900, 1760, 1…
$ region    &lt;chr&gt; "Northland", "Northland", "Northland", "Northland", "Northla…
$ geom      &lt;POINT [°]&gt; POINT (172.9301 -34.61058), POINT (173.1995 -34.9607),…
$ longitude &lt;dbl&gt; 172.9301, 173.1995, 173.3659, 173.1831, 173.4844, 173.8903, …
$ latitude  &lt;dbl&gt; -34.61058, -34.96070, -34.92885, -35.15506, -35.46800, -35.1…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now there are two more columns of longitude and latitude of double type</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by region and slice minimum location and preserve geometry</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>label_text <span class="ot">&lt;-</span> sa2_centroids <span class="sc">|&gt;</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(<span class="at">order_by =</span> longitude <span class="sc">+</span> latitude, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> <span class="co"># Sum ensures SW-most</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(region, longitude, latitude)</span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(label_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 17
Columns: 4
$ region    &lt;chr&gt; "Area Outside", "Auckland", "Bay of Plenty", "Canterbury", "…
$ longitude &lt;dbl&gt; -176.5269, 174.7283, 175.9479, 169.2815, 176.7677, 176.3104,…
$ latitude  &lt;dbl&gt; -43.93630, -37.25538, -39.05760, -44.94244, -38.45032, -40.5…
$ geom      &lt;POINT [°]&gt; POINT (-176.5269 -43.9363), POINT (174.7283 -37.25538)…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Label_text contains 17 rows of regions with minimum longitude, minimum latitude, geometry column of point type</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview class</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(label_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The object label_text is a spatial data frame of class sf, meaning it contains geospatial features along with attribute data, making it compatible with tidyverse and spatial analysis functions.</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check coordinate reference system are same</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(sa2_nz) <span class="sc">==</span> <span class="fu">st_crs</span>(label_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Classes of datasets: sa2_nz and label_text are same</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group and merge SA2 polygons by region to get region-level boundaries and region total population</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>region_boundaries <span class="ot">&lt;-</span> sa2_nz <span class="sc">|&gt;</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop =</span> <span class="fu">sum</span>(pop2018),</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">geometry =</span> <span class="fu">st_union</span>(geom), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a glimpse</span></span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(region_boundaries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 17
Columns: 3
$ region    &lt;chr&gt; "Area Outside", "Auckland", "Bay of Plenty", "Canterbury", "…
$ total_pop &lt;int&gt; 690, 1667670, 350600, 641650, 57340, 181840, 273240, 60040, …
$ geometry  &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-176.5709 -..., MULTIPOLYGON ((…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The region_boundaries dataset contains 17 regions with total population and multipolygon geometries. It uses the WGS 84 geodetic coordinate system and covers New Zealand's full extent, making it suitable for spatial analysis and regional population visualization.</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot region population with both SA2 polygons and region boundaries</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>plot_spatial <span class="ot">&lt;-</span> <span class="cf">function</span>(data, fill_var) {</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data) <span class="sc">+</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> {{ fill_var }}), <span class="at">color =</span> <span class="st">"#999999"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span>  <span class="co"># SA2 polygons</span></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text_repel</span>(</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> label_text,</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">label =</span> region),</span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>,</span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">12</span>  <span class="co"># Ensures reproducible label placement</span></span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">165</span>, <span class="dv">180</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">48</span>, <span class="sc">-</span><span class="dv">34</span>)) <span class="sc">+</span></span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis_c</span>(</span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">option =</span> <span class="st">"turbo"</span>, </span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_scientific</span>()</span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb127-18"><a href="#cb127-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb127-19"><a href="#cb127-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb127-20"><a href="#cb127-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>,</span>
<span id="cb127-21"><a href="#cb127-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">"Population (2018)"</span></span>
<span id="cb127-22"><a href="#cb127-22" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb127-23"><a href="#cb127-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb127-24"><a href="#cb127-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_north_arrow</span>(</span>
<span id="cb127-25"><a href="#cb127-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">location =</span> <span class="st">"tl"</span>, <span class="at">which_north =</span> <span class="st">"true"</span>,</span>
<span id="cb127-26"><a href="#cb127-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="fu">north_arrow_fancy_orienteering</span>())</span>
<span id="cb127-27"><a href="#cb127-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb127-28"><a href="#cb127-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-29"><a href="#cb127-29" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">plot_spatial</span>(sa2_nz, pop2018) <span class="sc">+</span></span>
<span id="cb127-30"><a href="#cb127-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"SA2 Population"</span>) </span>
<span id="cb127-31"><a href="#cb127-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-32"><a href="#cb127-32" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot_spatial</span>(region_boundaries, total_pop) <span class="sc">+</span> </span>
<span id="cb127-33"><a href="#cb127-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Region Population"</span>) </span>
<span id="cb127-34"><a href="#cb127-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-35"><a href="#cb127-35" aria-hidden="true" tabindex="-1"></a>combined_plot <span class="ot">&lt;-</span> plot1 <span class="sc">+</span> plot2 <span class="sc">+</span></span>
<span id="cb127-36"><a href="#cb127-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb127-37"><a href="#cb127-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span><span class="st">"Spatial Distribution of the 2018 Population in SA2 Areas (Left) and Regions (Right) of New Zealand"</span>,</span>
<span id="cb127-38"><a href="#cb127-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"A comparison of population patterns across fine-scale SA2 areas and broader regional boundaries"</span>,</span>
<span id="cb127-39"><a href="#cb127-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb127-40"><a href="#cb127-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb127-41"><a href="#cb127-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb127-42"><a href="#cb127-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb127-43"><a href="#cb127-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb127-44"><a href="#cb127-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb127-45"><a href="#cb127-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-46"><a href="#cb127-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb127-47"><a href="#cb127-47" aria-hidden="true" tabindex="-1"></a>combined_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-population-trends-in-each-region-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>These maps compare population distribution in New Zealand at different scales. The SA2 Population map (left) provides detailed insights, highlighting densely populated urban clusters, while the Region Population map (right) aggregates data, emphasizing regional total population concentration. Auckland appears dominant in both maps, though the finer SA2 breakdown reveals local density patterns. The left map’s scale (0–6,000) captures variations within cities, whereas the right map (400,000–1.6 million) focuses on broader regional totals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Explore sa2_nz</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(sa2_nz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sa2_nz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sa2_name" "sa2_id"   "pop2018"  "region"   "geom"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The sa2_nz object is a simple features (sf) spatial data frame containing five columns: sa2_name, sa2_id, pop2018, region, and geom. It includes 2018 population data and multipolygon geometries for each SA2 area in New Zealand.</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Explore airdata</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "region"        "agency"        "lawa_site_id"  "site_name"    
 [5] "site_id"       "latitude"      "longitude"     "town"         
 [9] "site_type"     "indicator"     "date"          "concentration"
[13] "year"         </code></pre>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The airdata object is a tibble data frame containing air quality data, including region, site details, location, pollutant indicators, concentration values, and corresponding dates and years for analysis.</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert airdata data.frame to sf</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert columns "longitude" and "latitude" to WGS84 (EPSG:4326)</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(airdata, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata<span class="sc">$</span>geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sfc_POINT of length 232293; first list element:  'XY' num [1:2] 174.7 -36.9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The geometry column in airdata now contains 232,293 spatial point features in WGS84 coordinates, each representing air monitoring locations with longitude and latitude, starting near Auckland at (174.7, -36.9).</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview region not in airdata region</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(sa2_nz) <span class="sc">|&gt;</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(region <span class="sc">%in%</span> airdata<span class="sc">$</span>region)) <span class="sc">|&gt;</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(region) <span class="sc">|&gt;</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        region  n
1 Area Outside  1
2     Taranaki 65</code></pre>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The region: Area Outside and Taranaki are not in airdata</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Count region, town, site_name</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(airdata) <span class="sc">|&gt;</span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(region, town, site_name) <span class="sc">|&gt;</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 67
Columns: 3
$ region    &lt;chr&gt; "Auckland", "Auckland", "Auckland", "Auckland", "Auckland", …
$ town      &lt;chr&gt; "Glen Eden", "Henderson", "Pakuranga", "Patumahoe", "Penrose…
$ site_name &lt;chr&gt; "Glen Eden", "Henderson", "Pakuranga", "Patumahoe", "Penrose…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 67 distinct region, town, and site_name</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview matching CRS</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(sa2_centroids)<span class="sc">$</span>epsg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4326</code></pre>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(airdata)<span class="sc">$</span>epsg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4326</code></pre>
</div>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Both datasets have same crs epsg of 4326</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview summary</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(sa2_centroids<span class="sc">$</span>geom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sfc_POINT of length 2332; first list element:  'XY' num [1:2] 172.9 -34.6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(airdata<span class="sc">$</span>geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sfc_POINT of length 232293; first list element:  'XY' num [1:2] 174.7 -36.9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sa2_centroids has 2,332 points; airdata has 232,293 points. Both are sfc_POINT with XY coordinates in WGS84.</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview sa2_name in region Waikato</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(sa2_centroids) <span class="sc">|&gt;</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">"Waikato"</span>) <span class="sc">|&gt;</span></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 264
Columns: 1
$ sa2_name &lt;chr&gt; "National Park", "Tangiwai", "Tahuroa", "Richmond Downs-Wardv…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co">#There are 264 distinct sa2_name in region: Waikato</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview site_name for region Waikato in airdata</span></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(airdata) <span class="sc">|&gt;</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">"Waikato"</span>) <span class="sc">|&gt;</span></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(site_name) <span class="sc">|&gt;</span></span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8
Columns: 1
$ site_name &lt;chr&gt; "Billah Street", "Bloodbank", "Bowling Club", "Claudelands",…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 8 site_name in region: Waikato</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform a spatial join of airdata and sa2_centroids to assign each SA2 to a region</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>airdata_with_sa2 <span class="ot">&lt;-</span> <span class="fu">st_join</span>(airdata, sa2_centroids[, <span class="fu">c</span>(<span class="st">"region"</span>, <span class="st">"sa2_name"</span>, <span class="st">"pop2018"</span>, <span class="st">"geom"</span>)], <span class="at">join =</span> st_nearest_feature)</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview column names </span></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(airdata_with_sa2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "region.x"      "agency"        "lawa_site_id"  "site_name"    
 [5] "site_id"       "town"          "site_type"     "indicator"    
 [9] "date"          "concentration" "year"          "geometry"     
[13] "region.y"      "sa2_name"      "pop2018"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove columns not needed</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>airdata_with_sa2 <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>region.y, <span class="sc">-</span>town, <span class="sc">-</span>site_id, <span class="sc">-</span>agency, <span class="sc">-</span>site_name) <span class="sc">|&gt;</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">region =</span> region.x)</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(airdata_with_sa2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "region"        "lawa_site_id"  "site_type"     "indicator"    
 [5] "date"          "concentration" "year"          "geometry"     
 [9] "sa2_name"      "pop2018"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save RAM, remove data not needed</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(airdata)</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(sa2_centroids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview summary of concentration</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(airdata_with_sa2<span class="sc">$</span>concentration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
   0.00    6.41   10.50   12.67   16.10  202.80     107 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Concentration ranges from 0 to 202.8, with mean 12.67, median 10.5, and 107 missing values (NA's).</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Use ARIMA imputation to approximate the missing concentration values.</span></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>airdata_with_sa2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(airdata_with_sa2) <span class="sc">|&gt;</span></span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">arima_concentration =</span> <span class="fu">na_kalman</span>(concentration, <span class="at">model =</span> <span class="st">"auto.arima"</span>))  <span class="co"># ARIMA imputation</span></span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(airdata_with_sa2<span class="sc">$</span>arima_concentration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  0.000   6.407  10.494  12.664  16.100 202.800 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All the 107 missing values are now computed using ARIMA and ranges from 0 to 202.8 with a mean of 12.664 and median of 10.494</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="normalize-pollutant-concentration-by-2018-population-and-plot-concentration-per-capita-trends-for-eac-site-type." class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="normalize-pollutant-concentration-by-2018-population-and-plot-concentration-per-capita-trends-for-eac-site-type."><span class="header-section-number">4.2</span> Normalize pollutant concentration by 2018 population and plot concentration per capita trends for eac site type.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute total daily pollutant concentrations</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_type_indicator =</span> <span class="fu">paste0</span>(site_type, <span class="st">"_"</span>, indicator)) <span class="sc">|&gt;</span></span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, site_type_indicator, site_type, indicator, date, sa2_name, pop2018) <span class="sc">|&gt;</span></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_conc =</span> <span class="fu">sum</span>(arima_concentration),</span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-10"><a href="#cb165-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary statistics</span></span>
<span id="cb165-11"><a href="#cb165-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata<span class="sc">$</span>total_conc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00    6.40   10.47   12.87   16.16  202.80 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># total_conc ranges from 0 to 202.8, with mean 12.87, median 10.47.</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate daily concentration per pop2018 </span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">conc_per_capita =</span> total_conc <span class="sc">/</span> pop2018 )</span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the new column</span></span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata<span class="sc">$</span>conc_per_capita)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
0.000000 0.002628 0.004437 0.007249 0.007542 0.486536 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># conc_per_pop18 ranges from 0 to 0.486536 with a mean of 0.007249 and a median of 0.004437</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform daily_airdata into a long format for easier plotting</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate total concentration and per capita concentration into a "Type" column</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>long_data <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_type) <span class="sc">|&gt;</span></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(total_conc, conc_per_capita),</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Type"</span>,</span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Value"</span>) <span class="sc">|&gt;</span></span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert 'Type' to a factor to control the facets order</span></span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Type =</span> <span class="fu">factor</span>(Type, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"total_conc"</span>, <span class="st">"conc_per_capita"</span>))) </span>
<span id="cb170-11"><a href="#cb170-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-12"><a href="#cb170-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define custom labels for facets to make them more descriptive</span></span>
<span id="cb170-13"><a href="#cb170-13" aria-hidden="true" tabindex="-1"></a>facet_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb170-14"><a href="#cb170-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_conc =</span> <span class="st">"Daily Concentration (µg/m³)"</span>,</span>
<span id="cb170-15"><a href="#cb170-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">conc_per_capita =</span> <span class="st">"Daily Concentration per Capita (µg/m³/person)"</span></span>
<span id="cb170-16"><a href="#cb170-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb170-17"><a href="#cb170-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-18"><a href="#cb170-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Using column plot, compare daily total and per capita pollutant concentrations by site type</span></span>
<span id="cb170-19"><a href="#cb170-19" aria-hidden="true" tabindex="-1"></a>pollutant_concentration_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(long_data, <span class="fu">aes</span>(<span class="at">x =</span> Value, <span class="at">y =</span> site_type, <span class="at">fill =</span> indicator)) <span class="sc">+</span></span>
<span id="cb170-20"><a href="#cb170-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.8</span>), <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb170-21"><a href="#cb170-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> Type, <span class="at">scales =</span> <span class="st">"free_x"</span>, <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">Type =</span> facet_labels)) <span class="sc">+</span></span>
<span id="cb170-22"><a href="#cb170-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>)) <span class="sc">+</span> </span>
<span id="cb170-23"><a href="#cb170-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total and Per Capita Daily Pollutant Concentrations (2016–2024)"</span>,</span>
<span id="cb170-24"><a href="#cb170-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Daily Concentration (Total and Per Capita)"</span>,</span>
<span id="cb170-25"><a href="#cb170-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Monitoring Site Type"</span>, <span class="at">fill =</span> <span class="st">"Indicator"</span>,</span>
<span id="cb170-26"><a href="#cb170-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Per capita values were calculated using 2018 population estimates."</span></span>
<span id="cb170-27"><a href="#cb170-27" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb170-28"><a href="#cb170-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb170-29"><a href="#cb170-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb170-30"><a href="#cb170-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb170-31"><a href="#cb170-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb170-32"><a href="#cb170-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb170-33"><a href="#cb170-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb170-34"><a href="#cb170-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb170-35"><a href="#cb170-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb170-36"><a href="#cb170-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-37"><a href="#cb170-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb170-38"><a href="#cb170-38" aria-hidden="true" tabindex="-1"></a>pollutant_concentration_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/pivot_long_format_and_plot_total_per_capita_concentration-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Traffic and industrial sites generally show high total pollutant concentrations, especially for PM10. However, per capita values are lower in densely populated areas due to population dilution. In contrast, mixed-use or coastal sites with fewer residents exhibit higher per capita concentrations despite moderate total values. PM10 levels consistently exceed PM2.5 across all site types, highlighting its dominance in daily particulate pollution from 2016 to 2024.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize conc_per_capita and classify based on how many standard deviations from the mean</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_type, indicator) <span class="sc">|&gt;</span></span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">z_score =</span> <span class="fu">scale</span>(conc_per_capita),</span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">conc_per_capita_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a>           z_score <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">~</span> <span class="st">"Low"</span>,</span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a>           z_score <span class="sc">&lt;=</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Moderate"</span>,</span>
<span id="cb171-8"><a href="#cb171-8" aria-hidden="true" tabindex="-1"></a>           z_score <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"High"</span>,</span>
<span id="cb171-9"><a href="#cb171-9" aria-hidden="true" tabindex="-1"></a>           <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Very High"</span></span>
<span id="cb171-10"><a href="#cb171-10" aria-hidden="true" tabindex="-1"></a>         ))</span>
<span id="cb171-11"><a href="#cb171-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-12"><a href="#cb171-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define function for pollutant trends categorised by z-anomaly</span></span>
<span id="cb171-13"><a href="#cb171-13" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="cf">function</span>(data, title_var) {</span>
<span id="cb171-14"><a href="#cb171-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> conc_per_capita)) <span class="sc">+</span></span>
<span id="cb171-15"><a href="#cb171-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="fu">aes</span>(<span class="at">color =</span> conc_per_capita_category)) <span class="sc">+</span></span>
<span id="cb171-16"><a href="#cb171-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> site_type, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb171-17"><a href="#cb171-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(</span>
<span id="cb171-18"><a href="#cb171-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"Concentration Category"</span>, </span>
<span id="cb171-19"><a href="#cb171-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Low"</span> <span class="ot">=</span> <span class="st">"#1b9e77"</span>, <span class="st">"Moderate"</span> <span class="ot">=</span> <span class="st">"#7570b3"</span>,</span>
<span id="cb171-20"><a href="#cb171-20" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"High"</span> <span class="ot">=</span> <span class="st">"#d95f02"</span>, <span class="st">"Very High"</span> <span class="ot">=</span> <span class="st">"#e7298a"</span>)</span>
<span id="cb171-21"><a href="#cb171-21" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb171-22"><a href="#cb171-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb171-23"><a href="#cb171-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb171-24"><a href="#cb171-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(title_var, <span class="st">" Daily Concentration Per Capita Trends by Site Type (2016-2023)"</span>),</span>
<span id="cb171-25"><a href="#cb171-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"By 2018 population Categorized by Z-anomaly"</span>,</span>
<span id="cb171-26"><a href="#cb171-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Concentration per capita (µg/m³/person)"</span></span>
<span id="cb171-27"><a href="#cb171-27" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb171-28"><a href="#cb171-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb171-29"><a href="#cb171-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb171-30"><a href="#cb171-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb171-31"><a href="#cb171-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb171-32"><a href="#cb171-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb171-33"><a href="#cb171-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb171-34"><a href="#cb171-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb171-35"><a href="#cb171-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb171-36"><a href="#cb171-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb171-37"><a href="#cb171-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-38"><a href="#cb171-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb171-39"><a href="#cb171-39" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">p</span>(<span class="fu">filter</span>(daily_airdata, indicator <span class="sc">==</span> <span class="st">"PM10"</span>), <span class="st">"PM10"</span>)</span>
<span id="cb171-40"><a href="#cb171-40" aria-hidden="true" tabindex="-1"></a>plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-pollutant-trends-zscore-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Industrial and multi-category sites show the highest PM10 variability, peaking in 2018, 2020, and 2022. Residential and NES sites maintain lower levels with fewer spikes. Traffic-influenced sites experience occasional peaks but remain relatively stable. Overall, site type strongly impacts PM10 trends, with industrial areas displaying the widest range.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">p</span>(<span class="fu">filter</span>(daily_airdata, indicator <span class="sc">==</span> <span class="st">"PM2.5"</span>), <span class="st">"PM2.5"</span>)</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-pollution-trend-pm25-zscore-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Industrial sites show the highest PM2.5 concentrations with frequent High and Very High Z-anomalies. Residential sites vary, with some exhibiting moderate pollution trends. Coastal and NES sites tend toward lower anomalies. Mixed-use sites Residential-Industrial and Residential-Traffic show inconsistent trends. Overall, site type strongly influences anomaly frequency, highlighting regional air quality disparities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract year and classify per capita categories</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">format</span>(date, <span class="st">"%Y"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_type, indicator, year) <span class="sc">|&gt;</span></span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">conc_per_capita_category =</span> <span class="fu">ntile</span>(conc_per_capita, <span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">conc_per_capita_category =</span> <span class="fu">factor</span>(</span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a>    conc_per_capita_category, </span>
<span id="cb173-9"><a href="#cb173-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Moderate"</span>, <span class="st">"High"</span>, <span class="st">"Very High"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb173-10"><a href="#cb173-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb173-11"><a href="#cb173-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-12"><a href="#cb173-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define jitter plot function by year and site_type</span></span>
<span id="cb173-13"><a href="#cb173-13" aria-hidden="true" tabindex="-1"></a>jitter_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, title_var) {</span>
<span id="cb173-14"><a href="#cb173-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(year), <span class="at">y =</span> conc_per_capita)) <span class="sc">+</span></span>
<span id="cb173-15"><a href="#cb173-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">color =</span> conc_per_capita_category), <span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb173-16"><a href="#cb173-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> site_type, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb173-17"><a href="#cb173-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis_d</span>(</span>
<span id="cb173-18"><a href="#cb173-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"Concentration Category"</span>, <span class="at">option =</span> <span class="st">"C"</span></span>
<span id="cb173-19"><a href="#cb173-19" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb173-20"><a href="#cb173-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb173-21"><a href="#cb173-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb173-22"><a href="#cb173-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(title_var, <span class="st">"Per Capita Concentration by Year and Site (2016-2023)"</span>),</span>
<span id="cb173-23"><a href="#cb173-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Jittered points grouped by per capita concentration category"</span>,</span>
<span id="cb173-24"><a href="#cb173-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Concentration per capita (µg/m³/person)"</span></span>
<span id="cb173-25"><a href="#cb173-25" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb173-26"><a href="#cb173-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb173-27"><a href="#cb173-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb173-28"><a href="#cb173-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb173-29"><a href="#cb173-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb173-30"><a href="#cb173-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb173-31"><a href="#cb173-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb173-32"><a href="#cb173-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb173-33"><a href="#cb173-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb173-34"><a href="#cb173-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb173-35"><a href="#cb173-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-36"><a href="#cb173-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot and save</span></span>
<span id="cb173-37"><a href="#cb173-37" aria-hidden="true" tabindex="-1"></a>plot_jitter <span class="ot">&lt;-</span> <span class="fu">jitter_plot</span>(<span class="fu">filter</span>(daily_airdata, indicator <span class="sc">==</span> <span class="st">"PM10"</span>), <span class="st">"PM10"</span>)</span>
<span id="cb173-38"><a href="#cb173-38" aria-hidden="true" tabindex="-1"></a>plot_jitter</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/jitter-plot-by-year-site-and-plot-PM10-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>The plots show PM10 per capita concentrations across sites from 2016 to 2023, classified into four concentration levels. Residential and industrial sites saw the sharpest increases in 2023. Coastal and traffic sites remained relatively stable, though minor fluctuations occurred. The categorization highlights notable shifts in pollution patterns, emphasizing areas experiencing heightened exposure. Standardization using 2018 population refines comparisons across sites.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot and save</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>plot_jitter <span class="ot">&lt;-</span> <span class="fu">jitter_plot</span>(<span class="fu">filter</span>(daily_airdata, indicator <span class="sc">==</span> <span class="st">"PM2.5"</span>), <span class="st">"PM2.5"</span>)</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>plot_jitter</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/jitter-plot-by-year-for-pm25-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>The PM2.5 jitter plots reveal distinct site-specific trends. Industrial sites show the highest variability, with elevated peaks in 2023. Residential sites display moderate fluctuations, reflecting seasonal shifts. Coastal sites exhibit the lowest PM2.5 concentrations, with stable trends. Traffic sites maintain consistently high pollution, showing persistent emissions. These differences underscore varying exposure risks based on site type and location.</p>
</section>
<section id="seasonal-trends-in-pollutant-concentration-by-site-type" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="seasonal-trends-in-pollutant-concentration-by-site-type"><span class="header-section-number">4.3</span> Seasonal Trends in Pollutant Concentration by Site Type</h3>
<p>Visualizing pollutant concentration per capita across seasons and site types, highlighting PM10 and PM2.5 variations, seasonal peaks, and site-specific dispersion dynamics from 2016 to 2023.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate daily air quality data into seasonal trends</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>seasondata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(date, <span class="st">"%y"</span>)),</span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">season =</span> <span class="fu">case_when</span>(</span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">month</span>(date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">~</span> <span class="st">"Sum"</span>, <span class="co"># Summer</span></span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">month</span>(date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">~</span> <span class="st">"Aut"</span>, <span class="co"># Autumn</span></span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">month</span>(date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>) <span class="sc">~</span> <span class="st">"Win"</span>, <span class="co"># Winter</span></span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">month</span>(date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>) <span class="sc">~</span> <span class="st">"Spr"</span>, <span class="co"># Spring</span></span>
<span id="cb175-10"><a href="#cb175-10" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span>),</span>
<span id="cb175-11"><a href="#cb175-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">season =</span> <span class="fu">factor</span>(season, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Sum"</span>, <span class="st">"Aut"</span>, <span class="st">"Win"</span>, <span class="st">"Spr"</span>)),</span>
<span id="cb175-12"><a href="#cb175-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">season_year =</span> <span class="fu">paste0</span>(season, year),</span>
<span id="cb175-13"><a href="#cb175-13" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Use this to sort by season-year properly</span></span>
<span id="cb175-14"><a href="#cb175-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">season_year =</span> <span class="fu">factor</span>(season_year, </span>
<span id="cb175-15"><a href="#cb175-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="fu">unique</span>(season_year[<span class="fu">order</span>(year, season)])))</span>
<span id="cb175-16"><a href="#cb175-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-17"><a href="#cb175-17" aria-hidden="true" tabindex="-1"></a>sitedata <span class="ot">&lt;-</span> seasondata <span class="sc">|&gt;</span></span>
<span id="cb175-18"><a href="#cb175-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season_year, year, site_type, indicator) <span class="sc">|&gt;</span></span>
<span id="cb175-19"><a href="#cb175-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb175-20"><a href="#cb175-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_conc_per_capita =</span> <span class="fu">sum</span>(conc_per_capita, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb175-21"><a href="#cb175-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb175-22"><a href="#cb175-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-23"><a href="#cb175-23" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(seasondata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 228,625
Columns: 14
$ region                   &lt;chr&gt; "Auckland", "Auckland", "Auckland", "Auckland…
$ site_type_indicator      &lt;chr&gt; "Residential, Industrial, NES site_PM10", "Re…
$ site_type                &lt;chr&gt; "Residential, Industrial, NES site", "Residen…
$ indicator                &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10…
$ date                     &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-06, 2016-01-…
$ sa2_name                 &lt;chr&gt; "Ellerslie South", "Ellerslie South", "Ellers…
$ pop2018                  &lt;int&gt; 2720, 2720, 2720, 2720, 2720, 2720, 2720, 272…
$ total_conc               &lt;dbl&gt; 15.8, 11.2, 11.9, 8.7, 9.8, 9.1, 14.1, 6.8, 8…
$ conc_per_capita          &lt;dbl&gt; 0.005808824, 0.004117647, 0.004375000, 0.0031…
$ z_score                  &lt;dbl[,1]&gt; &lt;matrix[26 x 1]&gt;
$ conc_per_capita_category &lt;fct&gt; Moderate, Low, Low, Low, Low, Low, Modera…
$ year                     &lt;dbl&gt; 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 1…
$ season                   &lt;fct&gt; Sum, Sum, Sum, Sum, Sum, Sum, Sum, Sum, Sum, …
$ season_year              &lt;fct&gt; Sum16, Sum16, Sum16, Sum16, Sum16, Sum16, Sum…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the heatmap of seasondata</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sitedata, <span class="fu">aes</span>(<span class="at">x =</span> season_year, <span class="at">y =</span> site_type, <span class="at">fill =</span> total_conc_per_capita)) <span class="sc">+</span></span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"grey90"</span>) <span class="sc">+</span></span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> indicator) <span class="sc">+</span></span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"C"</span>,</span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"Total Concentration</span><span class="sc">\n</span><span class="st">(per capita, 2018 pop)"</span>) <span class="sc">+</span></span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Heatmap of Seasonal Pollutant Concentration Per Capita (2016-2023)"</span>,</span>
<span id="cb177-9"><a href="#cb177-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Summed by site type and season, normalized by 2018 population"</span>,</span>
<span id="cb177-10"><a href="#cb177-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Season-Year"</span>, <span class="at">y =</span> <span class="st">"Site Type"</span>) <span class="sc">+</span></span>
<span id="cb177-11"><a href="#cb177-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb177-12"><a href="#cb177-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb177-13"><a href="#cb177-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb177-14"><a href="#cb177-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb177-15"><a href="#cb177-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb177-16"><a href="#cb177-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb177-17"><a href="#cb177-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb177-18"><a href="#cb177-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-19"><a href="#cb177-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb177-20"><a href="#cb177-20" aria-hidden="true" tabindex="-1"></a>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/seasonal-pollution-by-site-type-heatmap-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>The heatmap shows PM10 concentrations generally higher than PM2.5 across most site types and seasons from 2016–2023. PM10 peaks prominently at “Residential, NES site” and “Residential, Traffic, Industrial, Coastal, NES site”, reaching values above 30. PM2.5 values remain mostly below 10, with modest elevations at residential sites. Missing data patterns differ slightly between the two pollutants, notably in residential-industrial combinations.</p>
</section>
<section id="regional-trends-in-seasonal-per-capita-pollutant-concentration-20162023" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="regional-trends-in-seasonal-per-capita-pollutant-concentration-20162023"><span class="header-section-number">4.4</span> Regional Trends in Seasonal Per Capita Pollutant Concentration (2016–2023)</h3>
<p>This heatmap shows seasonal per capita pollutant concentrations across regions (2016–2023), helping identify spatial and temporal pollution trends.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate seasonal data to region</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>regiondata <span class="ot">&lt;-</span> seasondata <span class="sc">|&gt;</span></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, season_year, year, indicator) <span class="sc">|&gt;</span></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_conc_per_capita =</span> <span class="fu">sum</span>(conc_per_capita, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(regiondata<span class="sc">$</span>total_conc_per_capita)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
 0.003854  0.516080  1.029960  1.991850  2.228748 19.300111 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This shows the summary statistics of a dataset, indicating a right-skewed distribution with a mean (1.99) higher than the median (1.03) and a maximum value of 19.3.</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the heatmap</span></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(regiondata, <span class="fu">aes</span>(<span class="at">x =</span> season_year, <span class="at">y =</span> region, <span class="at">fill =</span> total_conc_per_capita)) <span class="sc">+</span></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"grey90"</span>) <span class="sc">+</span></span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add lockdown marker (assuming x-axis is a factor or character)</span></span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">which</span>(<span class="fu">levels</span>(<span class="fu">factor</span>(regiondata<span class="sc">$</span>season_year)) <span class="sc">==</span> <span class="st">"Aut20"</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#E69F00"</span>, <span class="at">lwd =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> indicator) <span class="sc">+</span></span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_continuous_sequential</span>(</span>
<span id="cb180-10"><a href="#cb180-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"Mint"</span>, <span class="at">name =</span> <span class="st">"Total Concentration</span><span class="sc">\n</span><span class="st">(per capita, 2018 pop)"</span>, <span class="at">rev =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb180-11"><a href="#cb180-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb180-12"><a href="#cb180-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Air Pollution per Capita Across NZ Regions (2016–2023)"</span>,</span>
<span id="cb180-13"><a href="#cb180-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Summed pollutant concentrations by region and season (normalized by 2018 population), with COVID-19 lockdown marked (in orange)"</span>,</span>
<span id="cb180-14"><a href="#cb180-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Season-Year"</span>, <span class="at">y =</span> <span class="st">"Region"</span>) <span class="sc">+</span></span>
<span id="cb180-15"><a href="#cb180-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb180-16"><a href="#cb180-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb180-17"><a href="#cb180-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb180-18"><a href="#cb180-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb180-19"><a href="#cb180-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb180-20"><a href="#cb180-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb180-21"><a href="#cb180-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb180-22"><a href="#cb180-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-23"><a href="#cb180-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb180-24"><a href="#cb180-24" aria-hidden="true" tabindex="-1"></a>p1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/seasonal-pollution-by-region-heatmap-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>The PM10 plot shows consistently higher concentrations across regions, while PM2.5 exhibits more variability with lower overall levels. Seasonal patterns are evident in both, but PM10 peaks are more pronounced. COVID-19 lockdowns affected both pollutants, with sharper declines in PM2.5. Regional disparities are stronger in PM10, highlighting differences in pollution dynamics and sources. The PM2.5 plot has more white spaces, indicating lower concentrations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata_with_sa2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 232,293
Columns: 11
$ region              &lt;chr&gt; "Auckland", "Auckland", "Auckland", "Auckland", "A…
$ lawa_site_id        &lt;chr&gt; "LAWA-100059", "LAWA-100059", "LAWA-100059", "LAWA…
$ site_type           &lt;chr&gt; "Residential, NES site", "Residential, NES site", …
$ indicator           &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "P…
$ date                &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2…
$ concentration       &lt;dbl&gt; 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2…
$ year                &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2…
$ geometry            &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -3…
$ sa2_name            &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Ed…
$ pop2018             &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 37…
$ arima_concentration &lt;dbl&gt; 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview repeating geometry last few rows</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sa2_name, geometry, pop2018) <span class="sc">|&gt;</span></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            sa2_name                   geometry pop2018    n
61        Washington POINT (173.2735 -41.27823)    2990 5066
62     Waterloo West POINT (174.9209 -41.21261)    2370 2892
63          Westlake POINT (174.7489 -36.78031)    3120 5493
64 Whangarei Central POINT (174.3242 -35.72673)    1000 5524
65            Winton POINT (168.3235 -46.14758)    2400 1379
66    Woolston South POINT (172.6813 -43.55716)     530 5809</code></pre>
</div>
</div>
</section>
<section id="comparing-total-and-per-capita-air-pollutant-concentrations-for-2018" class="level3" data-number="4.5">
<h3 data-number="4.5" class="anchored" data-anchor-id="comparing-total-and-per-capita-air-pollutant-concentrations-for-2018"><span class="header-section-number">4.5</span> Comparing Total and Per Capita Air Pollutant Concentrations for 2018</h3>
<p>To ensure consistency, we focus on 2018—the year for which both pollutant and population data are available. We aggregate total pollutant concentrations by SA2 regions and compute per capita values using 2018 population figures. Spatial visualisations then highlight the distribution of PM2.5 and PM10 levels across New Zealand, both in total and per person.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter 2018 data and summarise total pollutant concentration by SA2, indicator, and population</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>airdata_group <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2018</span>) <span class="sc">|&gt;</span></span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name, geometry, indicator, pop2018) <span class="sc">|&gt;</span></span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_conc18 =</span> <span class="fu">sum</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Display structure of the summarised dataset (86 rows x 5 columns)</span></span>
<span id="cb185-10"><a href="#cb185-10" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 86
Columns: 5
$ sa2_name     &lt;chr&gt; "Alexandra South", "Allandale", "Arrowtown", "Bird Area",…
$ geometry     &lt;POINT [°]&gt; POINT (169.3903 -45.25485), POINT (176.9812 -37.960…
$ indicator    &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM2.5", …
$ pop2018      &lt;int&gt; 2710, 2610, 2970, 2310, 2940, 2230, 2230, 2210, 3220, 322…
$ total_conc18 &lt;dbl&gt; 5114.2000, 4258.1750, 6292.2000, 3976.0280, 3072.2500, 50…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate per capita pollutant concentration for each SA2</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>airdata_group <span class="ot">&lt;-</span> airdata_group <span class="sc">|&gt;</span></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">conc_per_capita18 =</span> total_conc18 <span class="sc">/</span> pop2018)</span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure airdata_group is an sf (spatial features) object</span></span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>airdata_group <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(airdata_group)</span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarise distribution of per capita concentrations</span></span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(airdata_group<span class="sc">$</span>conc_per_capita18)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
 0.07344  1.19984  1.72504  2.15444  2.47601 11.94561 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Per capita PM10 concentration ranges from 0.07 to 11.95, with a median of 1.73 and a mean of 2.15.</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare label data: unique combinations of SA2, indicator, concentration values, and geometry</span></span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>label_text <span class="ot">&lt;-</span> airdata_group <span class="sc">|&gt;</span></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sa2_name, indicator, total_conc18, conc_per_capita18, geometry) <span class="sc">|&gt;</span></span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>n)</span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Confirm label_text is a dataframe</span></span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(label_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert label_text to an sf object for spatial operations</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>label_text <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(label_text)</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract longitude and latitude from geometry column for text placement</span></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>label_text<span class="sc">$</span>longitude <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(label_text)[, <span class="dv">1</span>]</span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>label_text<span class="sc">$</span>latitude  <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(label_text)[, <span class="dv">2</span>]</span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarise longitude range — confirms spatial extent within New Zealand</span></span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(label_text<span class="sc">$</span>longitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  168.4   172.6   174.8   174.0   175.7   177.0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarise latitude range — confirms coverage from South to North Island</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(label_text<span class="sc">$</span>latitude) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 -46.43  -43.38  -40.95  -40.49  -37.67  -35.73 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a reusable function to map pollutant concentrations by SA2</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="cf">function</span>(indicator_var, color_var) {</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> sa2_nz) <span class="sc">+</span></span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span>  <span class="co"># base map</span></span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> airdata_group <span class="sc">|&gt;</span> <span class="fu">filter</span>(indicator <span class="sc">==</span> {{indicator_var}}), <span class="fu">aes</span>(<span class="at">color =</span> {{ color_var }}), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text_repel</span>(<span class="at">data =</span> label_text <span class="sc">|&gt;</span> <span class="fu">filter</span>(indicator <span class="sc">==</span> {{indicator_var}}), <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">label =</span> sa2_name), <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">labels =</span>  scales<span class="sc">::</span><span class="fu">label_scientific</span>()) <span class="sc">+</span> </span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">165</span>, <span class="dv">180</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">48</span>, <span class="sc">-</span><span class="dv">34</span>)) <span class="sc">+</span> <span class="co"># Add coord_sf to zoom in to nz</span></span>
<span id="cb195-9"><a href="#cb195-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb195-10"><a href="#cb195-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb195-11"><a href="#cb195-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Longitude"</span>,</span>
<span id="cb195-12"><a href="#cb195-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Latitude"</span>) <span class="sc">+</span></span>
<span id="cb195-13"><a href="#cb195-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb195-14"><a href="#cb195-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb195-15"><a href="#cb195-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb195-16"><a href="#cb195-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb195-17"><a href="#cb195-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.legend =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb195-18"><a href="#cb195-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb195-19"><a href="#cb195-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb195-20"><a href="#cb195-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_north_arrow</span>(</span>
<span id="cb195-21"><a href="#cb195-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">location =</span> <span class="st">"tl"</span>, <span class="at">which_north =</span> <span class="st">"true"</span>,</span>
<span id="cb195-22"><a href="#cb195-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="fu">north_arrow_fancy_orienteering</span>())</span>
<span id="cb195-23"><a href="#cb195-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb195-24"><a href="#cb195-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-25"><a href="#cb195-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Create spatial plots for PM10 and PM2.5 total concentrations (2018)</span></span>
<span id="cb195-26"><a href="#cb195-26" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">plot</span>(<span class="st">"PM10"</span>, total_conc18) <span class="sc">+</span></span>
<span id="cb195-27"><a href="#cb195-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total PM10"</span>, <span class="at">color =</span> <span class="st">"Total (µg/m³)"</span>)</span>
<span id="cb195-28"><a href="#cb195-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-29"><a href="#cb195-29" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot</span>(<span class="st">"PM2.5"</span>, total_conc18) <span class="sc">+</span> </span>
<span id="cb195-30"><a href="#cb195-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total PM2.5"</span>, <span class="at">color =</span> <span class="st">"Total (µg/m³)"</span>)</span>
<span id="cb195-31"><a href="#cb195-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-32"><a href="#cb195-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine plots into one figure with title and subtitle</span></span>
<span id="cb195-33"><a href="#cb195-33" aria-hidden="true" tabindex="-1"></a>combined_plot <span class="ot">&lt;-</span> plot1 <span class="sc">+</span> plot2 <span class="sc">+</span></span>
<span id="cb195-34"><a href="#cb195-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb195-35"><a href="#cb195-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Total PM2.5 and PM10 Concentration Across New Zealand for the Year Ending 2018"</span>,</span>
<span id="cb195-36"><a href="#cb195-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Spatial distribution of cumulative pollutant concentrations by SA2 region"</span>) <span class="sc">&amp;</span></span>
<span id="cb195-37"><a href="#cb195-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb195-38"><a href="#cb195-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb195-39"><a href="#cb195-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb195-40"><a href="#cb195-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-41"><a href="#cb195-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb195-42"><a href="#cb195-42" aria-hidden="true" tabindex="-1"></a>combined_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/aggregate-and-map-pollution-2018-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Air pollution varies across New Zealand, with PM10 and PM2.5 showing distinct spatial patterns. PM10 concentrations, which include coarse and fine particles, are more widespread, while PM2.5—primarily from combustion sources—forms hotspots in urban areas. Regions like Meeanee–Awatoto and Mayfair appear prominently in both datasets, while Ruakaka and Mount Maunganui Central show pollutant-specific trends. The broader spread of PM10 suggests diverse sources, including road dust, whereas PM2.5 aligns with industrial and traffic emissions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create map of per capita PM10 concentrations for 2018</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">plot</span>(<span class="st">"PM10"</span>, conc_per_capita18) <span class="sc">+</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"PM10 Per Capita"</span>, <span class="at">color =</span> <span class="st">"Per Capita (µg/m³)"</span>) <span class="sc">+</span> <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>) </span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create map of per capita PM2.5 concentrations for 2018</span></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot</span>(<span class="st">"PM2.5"</span>, conc_per_capita18) <span class="sc">+</span></span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"PM2.5 Per Capita"</span>, <span class="at">color =</span> <span class="st">"Per Capita (µg/m³)"</span>) <span class="sc">+</span> </span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>) </span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine both plots with shared title and styling</span></span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a>per_capita18_plot <span class="ot">&lt;-</span> plot1 <span class="sc">+</span> plot2 <span class="sc">+</span></span>
<span id="cb196-12"><a href="#cb196-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb196-13"><a href="#cb196-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Geospatial Distribution of Air Pollutants Per Capita (2018)"</span>,</span>
<span id="cb196-14"><a href="#cb196-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Comparison of PM10 and PM2.5 concentrations across SA2 regions"</span>) <span class="sc">&amp;</span></span>
<span id="cb196-15"><a href="#cb196-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb196-16"><a href="#cb196-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb196-17"><a href="#cb196-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb196-18"><a href="#cb196-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-19"><a href="#cb196-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb196-20"><a href="#cb196-20" aria-hidden="true" tabindex="-1"></a>per_capita18_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/map-per-capita-pollutants-2018-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Air quality varies across New Zealand, with PM10 and PM2.5 concentrations showing distinct patterns. PM10 levels are higher in Whangarei Central, Gore Main, Taihape and Parkside, while PM2.5 hotspots include Whangarai Central, Kuripuni, Redwoodtown East, and Mount Maunganui Central. PM10 appears more widespread, whereas PM2.5 is more localized in urban areas. These differences matter—PM2.5 particles penetrate deeper into lungs, posing greater health risks. Understanding these trends helps highlight potential environmental influences, such as traffic patterns or meteorological conditions.</p>
</section>
<section id="interactive-map-of-2018-particulate-matter-concentrations-by-sa2-region" class="level3" data-number="4.6">
<h3 data-number="4.6" class="anchored" data-anchor-id="interactive-map-of-2018-particulate-matter-concentrations-by-sa2-region"><span class="header-section-number">4.6</span> Interactive Map of 2018 Particulate Matter Concentrations by SA2 Region</h3>
<p>To enhance spatial interpretation, we created an interactive map showing PM10 and PM2.5 concentrations across New Zealand for 2018. Marker size represents total pollutant concentration (µg/m³), while color intensity indicates per capita exposure (µg/m³/person). This visualization allows users to explore regional air quality disparities in both absolute and population-adjusted terms.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Plotly map: marker size = total concentration, color = per capita concentration</span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>interactive_map18 <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> label_text, <span class="at">type =</span> <span class="st">'scattermapbox'</span>, <span class="at">mode =</span> <span class="st">'markers'</span>,</span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">lat =</span> <span class="sc">~</span>latitude, <span class="at">lon =</span> <span class="sc">~</span>longitude,</span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="cn">NULL</span>, <span class="at">showlegend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="sc">~</span><span class="fu">paste0</span>(<span class="st">"SA2: "</span>, sa2_name,</span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"</span><span class="sc">\n</span><span class="st">Indicator: "</span>, indicator,</span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"</span><span class="sc">\n</span><span class="st">Total Concentration: "</span>, total_conc18,</span>
<span id="cb197-9"><a href="#cb197-9" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"</span><span class="sc">\n</span><span class="st">Concentration Per Capita: "</span>, conc_per_capita18),</span>
<span id="cb197-10"><a href="#cb197-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">marker =</span> <span class="fu">list</span>(</span>
<span id="cb197-11"><a href="#cb197-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="sc">~</span>scales<span class="sc">::</span><span class="fu">rescale</span>(total_conc18, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">20</span>)),</span>
<span id="cb197-12"><a href="#cb197-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="sc">~</span>conc_per_capita18, <span class="at">colorscale =</span> <span class="st">'Plasma'</span>,</span>
<span id="cb197-13"><a href="#cb197-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">opacity =</span> <span class="fl">0.8</span>, <span class="at">showscale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb197-14"><a href="#cb197-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">colorbar =</span> <span class="fu">list</span>(</span>
<span id="cb197-15"><a href="#cb197-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Per Capita Conc. (µg/m³/person)"</span>,</span>
<span id="cb197-16"><a href="#cb197-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fl">0.95</span>, <span class="at">xanchor =</span> <span class="st">"left"</span>, <span class="at">len =</span> <span class="fl">0.75</span>)</span>
<span id="cb197-17"><a href="#cb197-17" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">|&gt;</span></span>
<span id="cb197-18"><a href="#cb197-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb197-19"><a href="#cb197-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">list</span>(</span>
<span id="cb197-20"><a href="#cb197-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="fu">paste0</span>(</span>
<span id="cb197-21"><a href="#cb197-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;b&gt;Unified Map of Particulate Matter Concentrations (2018)&lt;/b&gt;&lt;br&gt;"</span>,</span>
<span id="cb197-22"><a href="#cb197-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;span style='font-size:18px;'&gt;Marker Size: Total Concentration (µg/m³),</span></span>
<span id="cb197-23"><a href="#cb197-23" aria-hidden="true" tabindex="-1"></a><span class="st">        Color: Per Capita (µg/m³/person)&lt;/span&gt;"</span>), <span class="at">x =</span> <span class="fl">0.5</span>),</span>
<span id="cb197-24"><a href="#cb197-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapbox =</span> <span class="fu">list</span>(</span>
<span id="cb197-25"><a href="#cb197-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="st">"open-street-map"</span>, <span class="at">zoom =</span> <span class="dv">5</span>,</span>
<span id="cb197-26"><a href="#cb197-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">center =</span> <span class="fu">list</span>(</span>
<span id="cb197-27"><a href="#cb197-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">lat =</span> <span class="fu">median</span>(label_text<span class="sc">$</span>latitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb197-28"><a href="#cb197-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">lon =</span> <span class="fu">median</span>(label_text<span class="sc">$</span>longitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb197-29"><a href="#cb197-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb197-30"><a href="#cb197-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-31"><a href="#cb197-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb197-32"><a href="#cb197-32" aria-hidden="true" tabindex="-1"></a>interactive_map18</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-564d3c7482de82c4bd43" style="width:100%;height:260px;"></div>
<script type="application/json" data-for="htmlwidget-564d3c7482de82c4bd43">{"x":{"visdat":{"2b84218874c":["function () ","plotlyVisDat"],"2b843327b92":["function () ","data"]},"cur_data":"2b843327b92","attrs":{"2b84218874c":{"mode":"markers","lat":{},"lon":{},"showlegend":false,"text":{},"marker":{"size":{},"color":{},"colorscale":"Plasma","opacity":0.80000000000000004,"showscale":true,"colorbar":{"title":"Per Capita Conc. (µg/m³/person)","x":0.94999999999999996,"xanchor":"left","len":0.75}},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scattermapbox"},"2b843327b92":{"mode":"markers","lat":{},"lon":{},"showlegend":false,"text":{},"marker":{"size":{},"color":{},"colorscale":"Plasma","opacity":0.80000000000000004,"showscale":true,"colorbar":{"title":"Per Capita Conc. (µg/m³/person)","x":0.94999999999999996,"xanchor":"left","len":0.75}},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scattermapbox","x":{},"y":{},"_bbox":[168.36991681000001,-46.431928390000003,176.98120116999999,-35.726732210000002],"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":{"text":"<b>Unified Map of Particulate Matter Concentrations (2018)<\/b><br><span style='font-size:18px;'>Marker Size: Total Concentration (µg/m³),<br />        Color: Per Capita (µg/m³/person)<\/span>","x":0.5},"mapbox":{"style":"open-street-map","zoom":5,"center":{"lat":-40.95230652,"lon":174.76880900000003}},"xaxis":{"title":"x"},"yaxis":{"title":"y"},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"mode":"markers","lat":[-45.254852,-37.960750580000003,-44.948571270000002,-38.691894929999997,-37.683528899999999,-40.959198239999999,-40.959198239999999,-45.86909824,-37.777543180000002,-37.777543180000002,-45.190852329999998,-45.045879059999997,-41.121542999999974,-36.904558461006303,-36.904558461006303,-44.100181000449801,-44.100181000449801,-36.922142811073002,-46.106208889999998,-43.912238001285893,-43.912238001285893,-36.8680004511356,-41.267711429999999,-41.267711429999999,-43.384643000579501,-43.384643000579501,-40.95230652,-40.95230652,-43.307540001188499,-43.307540001188499,-41.314170019999999,-38.135818479999998,-38.135818479999998,-39.500164509999998,-39.638873269999998,-39.638873269999998,-39.545889350000003,-39.545889350000003,-37.807709979999998,-46.121327919999999,-37.649612619999999,-37.669638999999997,-37.670021060000003,-37.662139889999999,-37.662139889999999,-37.6434195,-37.6541,-37.66057215,-44.404483000805463,-44.404483000805463,-37.204503610808089,-37.204503610808089,-38.05712209,-36.847430000000003,-36.847430000000003,-41.526639879999998,-41.526639879999998,-42.114231930000003,-41.3395984,-35.894313879999999,-41.281961500000001,-45.871813070000002,-43.511257001057103,-43.511257001057103,-38.221616740000002,-38.221616740000002,-46.431928390000003,-36.905483750710502,-41.295116849999999,-39.677799999999998,-38.886175000000001,-38.33779552,-37.140490550000003,-41.293621999999971,-41.293621999999971,-44.732601001408,-44.732601001408,-41.278229529999997,-41.278229529999997,-41.212606999999899,-36.780305250869901,-36.780305250869901,-35.726732210000002,-35.726732210000002,-43.55715800095718,-43.55715800095718],"lon":[169.390333,176.98120116999999,168.84573717000001,176.09117495000001,176.13549805,175.65321069999999,175.65321069999999,170.51770311000001,175.28715905000001,175.28715905000001,169.32131981000001,169.21000461,175.07034500000009,174.815563500351,174.815563500351,171.24148099998411,171.24148099998411,174.6520009000113,168.93967924,171.7552360004602,171.7552360004602,174.6284,174.95375106,174.95375106,172.65199100072721,172.65199100072721,175.64661441999999,175.64661441999999,172.59526499979901,172.59526499979901,173.23720159999999,176.21420287999999,176.21420287999999,176.89701746,176.85880198000001,176.85880198000001,176.91912704000001,176.91912704000001,175.28036621000001,169.96150159999999,175.53579672000001,176.17971600000001,176.18357850000001,176.1873932,176.1873932,176.1850786,176.1859,176.1691179,171.2496629996013,171.2496629996013,174.86401940002824,174.86401940002824,175.77192840999999,174.76570000000001,174.76570000000001,173.95608203,173.95608203,171.86288712000001,173.18316353,174.45716173,173.29078544999999,170.35672382000001,172.63370500048501,172.63370500048501,175.85843044000001,175.85843044000001,168.36991681000001,174.8904,173.24237590000001,175.80083999999999,175.27104600000001,175.16533762,175.54629323,174.77191800000003,174.77191800000003,171.04992999942601,171.04992999942601,173.27352647999999,173.27352647999999,174.92087600000002,174.74890449976101,174.74890449976101,174.32424642999999,174.32424642999999,172.68127600047541,172.68127600047541],"showlegend":false,"text":["SA2: Alexandra South<br />Indicator: PM10<br />Total Concentration: 5114.2<br />Concentration Per Capita: 1.88715867158672","SA2: Allandale<br />Indicator: PM10<br />Total Concentration: 4258.175<br />Concentration Per Capita: 1.6314846743295","SA2: Arrowtown<br />Indicator: PM10<br />Total Concentration: 6292.2<br />Concentration Per Capita: 2.11858585858586","SA2: Bird Area<br />Indicator: PM10<br />Total Concentration: 3976.02802<br />Concentration Per Capita: 1.72122425108225","SA2: Brookfield East<br />Indicator: PM10<br />Total Concentration: 3072.25<br />Concentration Per Capita: 1.04498299319728","SA2: Cameron and Soldiers Park<br />Indicator: PM10<br />Total Concentration: 5087.39<br />Concentration Per Capita: 2.28134080717489","SA2: Cameron and Soldiers Park<br />Indicator: PM2.5<br />Total Concentration: 3605.64<br />Concentration Per Capita: 1.61687892376682","SA2: Campus South<br />Indicator: PM10<br />Total Concentration: 5350.4<br />Concentration Per Capita: 2.42099547511312","SA2: Claudelands<br />Indicator: PM10<br />Total Concentration: 4195.91194<br />Concentration Per Capita: 1.30307824223602","SA2: Claudelands<br />Indicator: PM2.5<br />Total Concentration: 844.20908<br />Concentration Per Capita: 0.262176732919255","SA2: Clyde<br />Indicator: PM10<br />Total Concentration: 3365<br />Concentration Per Capita: 2.85169491525424","SA2: Cromwell East<br />Indicator: PM10<br />Total Concentration: 3185.2<br />Concentration Per Capita: 1.19744360902256","SA2: Ebdentown<br />Indicator: PM10<br />Total Concentration: 3746.11<br />Concentration Per Capita: 1.45763035019455","SA2: Ellerslie South<br />Indicator: PM10<br />Total Concentration: 5166.8<br />Concentration Per Capita: 1.89955882352941","SA2: Ellerslie South<br />Indicator: PM2.5<br />Total Concentration: 2284.3<br />Concentration Per Capita: 0.839816176470588","SA2: Geraldine<br />Indicator: PM10<br />Total Concentration: 5851.876<br />Concentration Per Capita: 2.12795490909091","SA2: Geraldine<br />Indicator: PM2.5<br />Total Concentration: 3512.952<br />Concentration Per Capita: 1.27743709090909","SA2: Glen Eden Central<br />Indicator: PM10<br />Total Concentration: 4166.3<br />Concentration Per Capita: 1.09928759894459","SA2: Gore Main<br />Indicator: PM10<br />Total Concentration: 6811.45<br />Concentration Per Capita: 5.36334645669291","SA2: Hampstead<br />Indicator: PM10<br />Total Concentration: 5844.644<br />Concentration Per Capita: 1.93531258278146","SA2: Hampstead<br />Indicator: PM2.5<br />Total Concentration: 3269.338<br />Concentration Per Capita: 1.08256225165563","SA2: Henderson Lincoln South<br />Indicator: PM10<br />Total Concentration: 4138.8<br />Concentration Per Capita: 1.53288888888889","SA2: Homedale East<br />Indicator: PM10<br />Total Concentration: 3962.13<br />Concentration Per Capita: 1.25781904761905","SA2: Homedale East<br />Indicator: PM2.5<br />Total Concentration: 2074.36<br />Concentration Per Capita: 0.658526984126984","SA2: Kaiapoi Central<br />Indicator: PM10<br />Total Concentration: 5986.641<br />Concentration Per Capita: 2.69668513513514","SA2: Kaiapoi Central<br />Indicator: PM2.5<br />Total Concentration: 3622.129<br />Concentration Per Capita: 1.63158963963964","SA2: Kuripuni<br />Indicator: PM10<br />Total Concentration: 5048.94<br />Concentration Per Capita: 2.96996470588235","SA2: Kuripuni<br />Indicator: PM2.5<br />Total Concentration: 3473.11<br />Concentration Per Capita: 2.04300588235294","SA2: Lilybrook<br />Indicator: PM10<br />Total Concentration: 5648.284<br />Concentration Per Capita: 1.85189639344262","SA2: Lilybrook<br />Indicator: PM2.5<br />Total Concentration: 2595.197<br />Concentration Per Capita: 0.850884262295082","SA2: Maitlands<br />Indicator: PM10<br />Total Concentration: 164.5<br />Concentration Per Capita: 0.0734375","SA2: Mangakakahi West<br />Indicator: PM10<br />Total Concentration: 4718.263<br />Concentration Per Capita: 2.12534369369369","SA2: Mangakakahi West<br />Indicator: PM2.5<br />Total Concentration: 3255.47<br />Concentration Per Capita: 1.46642792792793","SA2: Marewa West<br />Indicator: PM10<br />Total Concentration: 4637.09<br />Concentration Per Capita: 2.60510674157303","SA2: Mayfair<br />Indicator: PM10<br />Total Concentration: 4889.56<br />Concentration Per Capita: 1.59269055374593","SA2: Mayfair<br />Indicator: PM2.5<br />Total Concentration: 3141.9<br />Concentration Per Capita: 1.02342019543974","SA2: Meeanee-Awatoto<br />Indicator: PM10<br />Total Concentration: 7065.12<br />Concentration Per Capita: 2.6966106870229","SA2: Meeanee-Awatoto<br />Indicator: PM2.5<br />Total Concentration: 2194.1<br />Concentration Per Capita: 0.837442748091603","SA2: Melville North<br />Indicator: PM10<br />Total Concentration: 4386.86012<br />Concentration Per Capita: 1.48204733783784","SA2: Milton<br />Indicator: PM10<br />Total Concentration: 4561.1<br />Concentration Per Capita: 2.07322727272727","SA2: Morrinsville East<br />Indicator: PM10<br />Total Concentration: 1808.20755<br />Concentration Per Capita: 0.366033917004049","SA2: Mount Maunganui Central<br />Indicator: PM10<br />Total Concentration: 2132.39<br />Concentration Per Capita: 5.92330555555556","SA2: Mount Maunganui Central<br />Indicator: PM10<br />Total Concentration: 2605.434<br />Concentration Per Capita: 7.23731666666667","SA2: Mount Maunganui Central<br />Indicator: PM10<br />Total Concentration: 3495.916<br />Concentration Per Capita: 9.71087777777778","SA2: Mount Maunganui Central<br />Indicator: PM2.5<br />Total Concentration: 1071.3<br />Concentration Per Capita: 2.97583333333333","SA2: Mount Maunganui North<br />Indicator: PM10<br />Total Concentration: 283.985<br />Concentration Per Capita: 0.0816048850574713","SA2: Mount Maunganui South<br />Indicator: PM10<br />Total Concentration: 1870.28<br />Concentration Per Capita: 0.617254125412541","SA2: Otumoetai North<br />Indicator: PM10<br />Total Concentration: 1689.915<br />Concentration Per Capita: 0.384946469248292","SA2: Parkside<br />Indicator: PM10<br />Total Concentration: 7360.756<br />Concentration Per Capita: 3.00439020408163","SA2: Parkside<br />Indicator: PM2.5<br />Total Concentration: 4035.274<br />Concentration Per Capita: 1.6470506122449","SA2: Puni<br />Indicator: PM10<br />Total Concentration: 4349.3<br />Concentration Per Capita: 2.63593939393939","SA2: Puni<br />Indicator: PM2.5<br />Total Concentration: 1593.9<br />Concentration Per Capita: 0.966","SA2: Putaruru<br />Indicator: PM10<br />Total Concentration: 4001.48685<br />Concentration Per Capita: 0.899210528089888","SA2: Queen Street<br />Indicator: PM10<br />Total Concentration: 5694.6<br />Concentration Per Capita: 2.33385245901639","SA2: Queen Street<br />Indicator: PM2.5<br />Total Concentration: 2338.4<br />Concentration Per Capita: 0.958360655737705","SA2: Redwoodtown East<br />Indicator: PM10<br />Total Concentration: 6961.5<br />Concentration Per Capita: 2.47740213523132","SA2: Redwoodtown East<br />Indicator: PM2.5<br />Total Concentration: 4824.63<br />Concentration Per Capita: 1.71695017793594","SA2: Reefton<br />Indicator: PM10<br />Total Concentration: 3052.12<br />Concentration Per Capita: 3.24693617021277","SA2: Richmond Central (Tasman District)<br />Indicator: PM10<br />Total Concentration: 6785<br />Concentration Per Capita: 3.55235602094241","SA2: Ruakaka<br />Indicator: PM10<br />Total Concentration: 4529.304913<br />Concentration Per Capita: 1.70274620789474","SA2: Rutherford<br />Indicator: PM10<br />Total Concentration: 1536<br />Concentration Per Capita: 0.575280898876405","SA2: Seddon Park<br />Indicator: PM10<br />Total Concentration: 6277.3<br />Concentration Per Capita: 2.14242320819113","SA2: St Albans North<br />Indicator: PM10<br />Total Concentration: 6369.855<br />Concentration Per Capita: 2.85643721973094","SA2: St Albans North<br />Indicator: PM2.5<br />Total Concentration: 2831.497<br />Concentration Per Capita: 1.26972959641256","SA2: Stanley Park<br />Indicator: PM10<br />Total Concentration: 4925.84208<br />Concentration Per Capita: 2.12320779310345","SA2: Stanley Park<br />Indicator: PM2.5<br />Total Concentration: 2860.82443<br />Concentration Per Capita: 1.23311397844828","SA2: Strathern<br />Indicator: PM10<br />Total Concentration: 7473.85<br />Concentration Per Capita: 3.2924449339207","SA2: Sunnyhills East<br />Indicator: PM10<br />Total Concentration: 4646.5<br />Concentration Per Capita: 1.29790502793296","SA2: Tahuna Hills<br />Indicator: PM10<br />Total Concentration: 6508.66<br />Concentration Per Capita: 2.20632542372881","SA2: Taihape<br />Indicator: PM10<br />Total Concentration: 6242.098<br />Concentration Per Capita: 3.54664659090909","SA2: Taumarunui Central<br />Indicator: PM10<br />Total Concentration: 3806.652<br />Concentration Per Capita: 2.47185194805195","SA2: Te Kuiti West<br />Indicator: PM10<br />Total Concentration: 4835.51358<br />Concentration Per Capita: 1.79758869144981","SA2: Thames Central<br />Indicator: PM10<br />Total Concentration: 1974.37152<br />Concentration Per Capita: 1.82812177777778","SA2: Vivian West<br />Indicator: PM10<br />Total Concentration: 4538.48<br />Concentration Per Capita: 1.20704255319149","SA2: Vivian West<br />Indicator: PM2.5<br />Total Concentration: 1953.25<br />Concentration Per Capita: 0.519481382978723","SA2: Waimate East<br />Indicator: PM10<br />Total Concentration: 4929.26<br />Concentration Per Capita: 2.95165269461078","SA2: Waimate East<br />Indicator: PM2.5<br />Total Concentration: 2771.666<br />Concentration Per Capita: 1.65968023952096","SA2: Washington<br />Indicator: PM10<br />Total Concentration: 6054.34<br />Concentration Per Capita: 2.02486287625418","SA2: Washington<br />Indicator: PM2.5<br />Total Concentration: 3374.6<br />Concentration Per Capita: 1.12862876254181","SA2: Waterloo West<br />Indicator: PM10<br />Total Concentration: 4097.37<br />Concentration Per Capita: 1.72884810126582","SA2: Westlake<br />Indicator: PM10<br />Total Concentration: 5038<br />Concentration Per Capita: 1.61474358974359","SA2: Westlake<br />Indicator: PM2.5<br />Total Concentration: 2360.5<br />Concentration Per Capita: 0.756570512820513","SA2: Whangarei Central<br />Indicator: PM10<br />Total Concentration: 4836.034552<br />Concentration Per Capita: 4.836034552","SA2: Whangarei Central<br />Indicator: PM2.5<br />Total Concentration: 2247.491037<br />Concentration Per Capita: 2.247491037","SA2: Woolston South<br />Indicator: PM10<br />Total Concentration: 6331.171<br />Concentration Per Capita: 11.9456056603774","SA2: Woolston South<br />Indicator: PM2.5<br />Total Concentration: 2487.357<br />Concentration Per Capita: 4.69312641509434"],"marker":{"color":[1.8871586715867159,1.6314846743295019,2.1185858585858584,1.7212242510822511,1.0449829931972789,2.281340807174888,1.6168789237668162,2.4209954751131222,1.3030782422360248,0.26217673291925464,2.8516949152542375,1.1974436090225564,1.4576303501945527,1.8995588235294119,0.83981617647058826,2.1279549090909091,1.2774370909090909,1.0992875989445912,5.3633464566929137,1.935312582781457,1.0825622516556292,1.532888888888889,1.2578190476190476,0.65852698412698418,2.6966851351351351,1.6315896396396397,2.9699647058823526,2.0430058823529413,1.8518963934426229,0.85088426229508196,0.073437500000000003,2.1253436936936936,1.4664279279279278,2.6051067415730338,1.5926905537459284,1.0234201954397395,2.6966106870229005,0.83744274809160302,1.482047337837838,2.0732272727272729,0.36603391700404858,5.9233055555555554,7.2373166666666675,9.7108777777777782,2.9758333333333331,0.081604885057471266,0.61725412541254121,0.38494646924829157,3.0043902040816328,1.647050612244898,2.635939393939394,0.96600000000000008,0.89921052808988755,2.3338524590163936,0.9583606557377049,2.4774021352313169,1.7169501779359431,3.2469361702127659,3.5523560209424083,1.7027462078947369,0.57528089887640455,2.1424232081911265,2.8564372197309416,1.2697295964125559,2.1232077931034485,1.2331139784482759,3.2924449339207049,1.2979050279329609,2.2063254237288135,3.546646590909091,2.4718519480519481,1.797588691449814,1.8281217777777776,1.2070425531914892,0.51948138297872337,2.9516526946107784,1.6596802395209582,2.0248628762541805,1.1286287625418059,1.7288481012658228,1.6147435897435898,0.7565705128205128,4.8360345520000001,2.2474910369999996,11.945605660377359,4.6931264150943397],"size":[16.126085082804899,14.72072072072072,18.060046378952983,14.257510755402327,12.773748691744135,16.082070225122617,13.649432576084056,16.51386238174393,14.618501409838084,9.1159007244146188,13.254365983295369,12.959182417041188,13.880046789386196,16.212440230663464,11.48014529335714,17.337152003940158,13.497263641773891,14.569886515216812,18.912516160807733,17.325278991976031,13.097314535492213,14.524738861868702,14.23469391943196,11.135479899033431,17.558400131338626,13.676503109031582,16.018945597077714,13.431853721603151,17.002908329742041,11.990555110919576,8,15.476062303761621,13.074546984341971,15.342797923207947,15.757286215600566,12.888095384678529,19.328974532619178,11.332060990375341,14.931987309405077,15.218042644010755,10.698528679020706,11.230749656262184,12.007361530095015,13.46929508095795,9.4887233474932788,8.1961624494654099,10.800435059204991,10.504323913891112,19.814329865172688,14.354776826940835,14.870323626587863,10.346692934392252,14.299307352910997,17.078946828377351,11.568963040489237,19.158858174803505,15.650688501713558,12.74070060949332,18.869092326951098,15.165843605245335,10.251636602433869,18.035584559502553,18.187535143343798,12.378496583143509,15.816851698167415,12.426644388351907,20,15.358246629317245,18.415415871452318,17.977792279751277,13.979440579531694,15.668556432514517,10.971325526893636,15.180906646965871,10.936649633688358,15.822463009706746,12.280270065053664,17.669543803484579,13.27012661864598,14.456721869933714,16.000985039709413,11.605245336452626,15.669411729360339,11.419714809661597,18.124026349812226,11.813510640481027],"colorscale":"Plasma","opacity":0.80000000000000004,"showscale":true,"colorbar":{"title":"Per Capita Conc. (µg/m³/person)","x":0.94999999999999996,"xanchor":"left","len":0.75},"line":{"color":"rgba(31,119,180,1)"}},"type":"scattermapbox","line":{"color":"rgba(31,119,180,1)"},"frame":null},{"mode":"markers","lat":[-45.254852,-37.960750580000003,-44.948571270000002,-38.691894929999997,-37.683528899999999,-40.959198239999999,-40.959198239999999,-45.86909824,-37.777543180000002,-37.777543180000002,-45.190852329999998,-45.045879059999997,-41.121542999999974,-36.904558461006303,-36.904558461006303,-44.100181000449801,-44.100181000449801,-36.922142811073002,-46.106208889999998,-43.912238001285893,-43.912238001285893,-36.8680004511356,-41.267711429999999,-41.267711429999999,-43.384643000579501,-43.384643000579501,-40.95230652,-40.95230652,-43.307540001188499,-43.307540001188499,-41.314170019999999,-38.135818479999998,-38.135818479999998,-39.500164509999998,-39.638873269999998,-39.638873269999998,-39.545889350000003,-39.545889350000003,-37.807709979999998,-46.121327919999999,-37.649612619999999,-37.669638999999997,-37.670021060000003,-37.662139889999999,-37.662139889999999,-37.6434195,-37.6541,-37.66057215,-44.404483000805463,-44.404483000805463,-37.204503610808089,-37.204503610808089,-38.05712209,-36.847430000000003,-36.847430000000003,-41.526639879999998,-41.526639879999998,-42.114231930000003,-41.3395984,-35.894313879999999,-41.281961500000001,-45.871813070000002,-43.511257001057103,-43.511257001057103,-38.221616740000002,-38.221616740000002,-46.431928390000003,-36.905483750710502,-41.295116849999999,-39.677799999999998,-38.886175000000001,-38.33779552,-37.140490550000003,-41.293621999999971,-41.293621999999971,-44.732601001408,-44.732601001408,-41.278229529999997,-41.278229529999997,-41.212606999999899,-36.780305250869901,-36.780305250869901,-35.726732210000002,-35.726732210000002,-43.55715800095718,-43.55715800095718],"lon":[169.390333,176.98120116999999,168.84573717000001,176.09117495000001,176.13549805,175.65321069999999,175.65321069999999,170.51770311000001,175.28715905000001,175.28715905000001,169.32131981000001,169.21000461,175.07034500000009,174.815563500351,174.815563500351,171.24148099998411,171.24148099998411,174.6520009000113,168.93967924,171.7552360004602,171.7552360004602,174.6284,174.95375106,174.95375106,172.65199100072721,172.65199100072721,175.64661441999999,175.64661441999999,172.59526499979901,172.59526499979901,173.23720159999999,176.21420287999999,176.21420287999999,176.89701746,176.85880198000001,176.85880198000001,176.91912704000001,176.91912704000001,175.28036621000001,169.96150159999999,175.53579672000001,176.17971600000001,176.18357850000001,176.1873932,176.1873932,176.1850786,176.1859,176.1691179,171.2496629996013,171.2496629996013,174.86401940002824,174.86401940002824,175.77192840999999,174.76570000000001,174.76570000000001,173.95608203,173.95608203,171.86288712000001,173.18316353,174.45716173,173.29078544999999,170.35672382000001,172.63370500048501,172.63370500048501,175.85843044000001,175.85843044000001,168.36991681000001,174.8904,173.24237590000001,175.80083999999999,175.27104600000001,175.16533762,175.54629323,174.77191800000003,174.77191800000003,171.04992999942601,171.04992999942601,173.27352647999999,173.27352647999999,174.92087600000002,174.74890449976101,174.74890449976101,174.32424642999999,174.32424642999999,172.68127600047541,172.68127600047541],"showlegend":false,"text":["SA2: Alexandra South<br />Indicator: PM10<br />Total Concentration: 5114.2<br />Concentration Per Capita: 1.88715867158672","SA2: Allandale<br />Indicator: PM10<br />Total Concentration: 4258.175<br />Concentration Per Capita: 1.6314846743295","SA2: Arrowtown<br />Indicator: PM10<br />Total Concentration: 6292.2<br />Concentration Per Capita: 2.11858585858586","SA2: Bird Area<br />Indicator: PM10<br />Total Concentration: 3976.02802<br />Concentration Per Capita: 1.72122425108225","SA2: Brookfield East<br />Indicator: PM10<br />Total Concentration: 3072.25<br />Concentration Per Capita: 1.04498299319728","SA2: Cameron and Soldiers Park<br />Indicator: PM10<br />Total Concentration: 5087.39<br />Concentration Per Capita: 2.28134080717489","SA2: Cameron and Soldiers Park<br />Indicator: PM2.5<br />Total Concentration: 3605.64<br />Concentration Per Capita: 1.61687892376682","SA2: Campus South<br />Indicator: PM10<br />Total Concentration: 5350.4<br />Concentration Per Capita: 2.42099547511312","SA2: Claudelands<br />Indicator: PM10<br />Total Concentration: 4195.91194<br />Concentration Per Capita: 1.30307824223602","SA2: Claudelands<br />Indicator: PM2.5<br />Total Concentration: 844.20908<br />Concentration Per Capita: 0.262176732919255","SA2: Clyde<br />Indicator: PM10<br />Total Concentration: 3365<br />Concentration Per Capita: 2.85169491525424","SA2: Cromwell East<br />Indicator: PM10<br />Total Concentration: 3185.2<br />Concentration Per Capita: 1.19744360902256","SA2: Ebdentown<br />Indicator: PM10<br />Total Concentration: 3746.11<br />Concentration Per Capita: 1.45763035019455","SA2: Ellerslie South<br />Indicator: PM10<br />Total Concentration: 5166.8<br />Concentration Per Capita: 1.89955882352941","SA2: Ellerslie South<br />Indicator: PM2.5<br />Total Concentration: 2284.3<br />Concentration Per Capita: 0.839816176470588","SA2: Geraldine<br />Indicator: PM10<br />Total Concentration: 5851.876<br />Concentration Per Capita: 2.12795490909091","SA2: Geraldine<br />Indicator: PM2.5<br />Total Concentration: 3512.952<br />Concentration Per Capita: 1.27743709090909","SA2: Glen Eden Central<br />Indicator: PM10<br />Total Concentration: 4166.3<br />Concentration Per Capita: 1.09928759894459","SA2: Gore Main<br />Indicator: PM10<br />Total Concentration: 6811.45<br />Concentration Per Capita: 5.36334645669291","SA2: Hampstead<br />Indicator: PM10<br />Total Concentration: 5844.644<br />Concentration Per Capita: 1.93531258278146","SA2: Hampstead<br />Indicator: PM2.5<br />Total Concentration: 3269.338<br />Concentration Per Capita: 1.08256225165563","SA2: Henderson Lincoln South<br />Indicator: PM10<br />Total Concentration: 4138.8<br />Concentration Per Capita: 1.53288888888889","SA2: Homedale East<br />Indicator: PM10<br />Total Concentration: 3962.13<br />Concentration Per Capita: 1.25781904761905","SA2: Homedale East<br />Indicator: PM2.5<br />Total Concentration: 2074.36<br />Concentration Per Capita: 0.658526984126984","SA2: Kaiapoi Central<br />Indicator: PM10<br />Total Concentration: 5986.641<br />Concentration Per Capita: 2.69668513513514","SA2: Kaiapoi Central<br />Indicator: PM2.5<br />Total Concentration: 3622.129<br />Concentration Per Capita: 1.63158963963964","SA2: Kuripuni<br />Indicator: PM10<br />Total Concentration: 5048.94<br />Concentration Per Capita: 2.96996470588235","SA2: Kuripuni<br />Indicator: PM2.5<br />Total Concentration: 3473.11<br />Concentration Per Capita: 2.04300588235294","SA2: Lilybrook<br />Indicator: PM10<br />Total Concentration: 5648.284<br />Concentration Per Capita: 1.85189639344262","SA2: Lilybrook<br />Indicator: PM2.5<br />Total Concentration: 2595.197<br />Concentration Per Capita: 0.850884262295082","SA2: Maitlands<br />Indicator: PM10<br />Total Concentration: 164.5<br />Concentration Per Capita: 0.0734375","SA2: Mangakakahi West<br />Indicator: PM10<br />Total Concentration: 4718.263<br />Concentration Per Capita: 2.12534369369369","SA2: Mangakakahi West<br />Indicator: PM2.5<br />Total Concentration: 3255.47<br />Concentration Per Capita: 1.46642792792793","SA2: Marewa West<br />Indicator: PM10<br />Total Concentration: 4637.09<br />Concentration Per Capita: 2.60510674157303","SA2: Mayfair<br />Indicator: PM10<br />Total Concentration: 4889.56<br />Concentration Per Capita: 1.59269055374593","SA2: Mayfair<br />Indicator: PM2.5<br />Total Concentration: 3141.9<br />Concentration Per Capita: 1.02342019543974","SA2: Meeanee-Awatoto<br />Indicator: PM10<br />Total Concentration: 7065.12<br />Concentration Per Capita: 2.6966106870229","SA2: Meeanee-Awatoto<br />Indicator: PM2.5<br />Total Concentration: 2194.1<br />Concentration Per Capita: 0.837442748091603","SA2: Melville North<br />Indicator: PM10<br />Total Concentration: 4386.86012<br />Concentration Per Capita: 1.48204733783784","SA2: Milton<br />Indicator: PM10<br />Total Concentration: 4561.1<br />Concentration Per Capita: 2.07322727272727","SA2: Morrinsville East<br />Indicator: PM10<br />Total Concentration: 1808.20755<br />Concentration Per Capita: 0.366033917004049","SA2: Mount Maunganui Central<br />Indicator: PM10<br />Total Concentration: 2132.39<br />Concentration Per Capita: 5.92330555555556","SA2: Mount Maunganui Central<br />Indicator: PM10<br />Total Concentration: 2605.434<br />Concentration Per Capita: 7.23731666666667","SA2: Mount Maunganui Central<br />Indicator: PM10<br />Total Concentration: 3495.916<br />Concentration Per Capita: 9.71087777777778","SA2: Mount Maunganui Central<br />Indicator: PM2.5<br />Total Concentration: 1071.3<br />Concentration Per Capita: 2.97583333333333","SA2: Mount Maunganui North<br />Indicator: PM10<br />Total Concentration: 283.985<br />Concentration Per Capita: 0.0816048850574713","SA2: Mount Maunganui South<br />Indicator: PM10<br />Total Concentration: 1870.28<br />Concentration Per Capita: 0.617254125412541","SA2: Otumoetai North<br />Indicator: PM10<br />Total Concentration: 1689.915<br />Concentration Per Capita: 0.384946469248292","SA2: Parkside<br />Indicator: PM10<br />Total Concentration: 7360.756<br />Concentration Per Capita: 3.00439020408163","SA2: Parkside<br />Indicator: PM2.5<br />Total Concentration: 4035.274<br />Concentration Per Capita: 1.6470506122449","SA2: Puni<br />Indicator: PM10<br />Total Concentration: 4349.3<br />Concentration Per Capita: 2.63593939393939","SA2: Puni<br />Indicator: PM2.5<br />Total Concentration: 1593.9<br />Concentration Per Capita: 0.966","SA2: Putaruru<br />Indicator: PM10<br />Total Concentration: 4001.48685<br />Concentration Per Capita: 0.899210528089888","SA2: Queen Street<br />Indicator: PM10<br />Total Concentration: 5694.6<br />Concentration Per Capita: 2.33385245901639","SA2: Queen Street<br />Indicator: PM2.5<br />Total Concentration: 2338.4<br />Concentration Per Capita: 0.958360655737705","SA2: Redwoodtown East<br />Indicator: PM10<br />Total Concentration: 6961.5<br />Concentration Per Capita: 2.47740213523132","SA2: Redwoodtown East<br />Indicator: PM2.5<br />Total Concentration: 4824.63<br />Concentration Per Capita: 1.71695017793594","SA2: Reefton<br />Indicator: PM10<br />Total Concentration: 3052.12<br />Concentration Per Capita: 3.24693617021277","SA2: Richmond Central (Tasman District)<br />Indicator: PM10<br />Total Concentration: 6785<br />Concentration Per Capita: 3.55235602094241","SA2: Ruakaka<br />Indicator: PM10<br />Total Concentration: 4529.304913<br />Concentration Per Capita: 1.70274620789474","SA2: Rutherford<br />Indicator: PM10<br />Total Concentration: 1536<br />Concentration Per Capita: 0.575280898876405","SA2: Seddon Park<br />Indicator: PM10<br />Total Concentration: 6277.3<br />Concentration Per Capita: 2.14242320819113","SA2: St Albans North<br />Indicator: PM10<br />Total Concentration: 6369.855<br />Concentration Per Capita: 2.85643721973094","SA2: St Albans North<br />Indicator: PM2.5<br />Total Concentration: 2831.497<br />Concentration Per Capita: 1.26972959641256","SA2: Stanley Park<br />Indicator: PM10<br />Total Concentration: 4925.84208<br />Concentration Per Capita: 2.12320779310345","SA2: Stanley Park<br />Indicator: PM2.5<br />Total Concentration: 2860.82443<br />Concentration Per Capita: 1.23311397844828","SA2: Strathern<br />Indicator: PM10<br />Total Concentration: 7473.85<br />Concentration Per Capita: 3.2924449339207","SA2: Sunnyhills East<br />Indicator: PM10<br />Total Concentration: 4646.5<br />Concentration Per Capita: 1.29790502793296","SA2: Tahuna Hills<br />Indicator: PM10<br />Total Concentration: 6508.66<br />Concentration Per Capita: 2.20632542372881","SA2: Taihape<br />Indicator: PM10<br />Total Concentration: 6242.098<br />Concentration Per Capita: 3.54664659090909","SA2: Taumarunui Central<br />Indicator: PM10<br />Total Concentration: 3806.652<br />Concentration Per Capita: 2.47185194805195","SA2: Te Kuiti West<br />Indicator: PM10<br />Total Concentration: 4835.51358<br />Concentration Per Capita: 1.79758869144981","SA2: Thames Central<br />Indicator: PM10<br />Total Concentration: 1974.37152<br />Concentration Per Capita: 1.82812177777778","SA2: Vivian West<br />Indicator: PM10<br />Total Concentration: 4538.48<br />Concentration Per Capita: 1.20704255319149","SA2: Vivian West<br />Indicator: PM2.5<br />Total Concentration: 1953.25<br />Concentration Per Capita: 0.519481382978723","SA2: Waimate East<br />Indicator: PM10<br />Total Concentration: 4929.26<br />Concentration Per Capita: 2.95165269461078","SA2: Waimate East<br />Indicator: PM2.5<br />Total Concentration: 2771.666<br />Concentration Per Capita: 1.65968023952096","SA2: Washington<br />Indicator: PM10<br />Total Concentration: 6054.34<br />Concentration Per Capita: 2.02486287625418","SA2: Washington<br />Indicator: PM2.5<br />Total Concentration: 3374.6<br />Concentration Per Capita: 1.12862876254181","SA2: Waterloo West<br />Indicator: PM10<br />Total Concentration: 4097.37<br />Concentration Per Capita: 1.72884810126582","SA2: Westlake<br />Indicator: PM10<br />Total Concentration: 5038<br />Concentration Per Capita: 1.61474358974359","SA2: Westlake<br />Indicator: PM2.5<br />Total Concentration: 2360.5<br />Concentration Per Capita: 0.756570512820513","SA2: Whangarei Central<br />Indicator: PM10<br />Total Concentration: 4836.034552<br />Concentration Per Capita: 4.836034552","SA2: Whangarei Central<br />Indicator: PM2.5<br />Total Concentration: 2247.491037<br />Concentration Per Capita: 2.247491037","SA2: Woolston South<br />Indicator: PM10<br />Total Concentration: 6331.171<br />Concentration Per Capita: 11.9456056603774","SA2: Woolston South<br />Indicator: PM2.5<br />Total Concentration: 2487.357<br />Concentration Per Capita: 4.69312641509434"],"marker":{"color":[1.8871586715867159,1.6314846743295019,2.1185858585858584,1.7212242510822511,1.0449829931972789,2.281340807174888,1.6168789237668162,2.4209954751131222,1.3030782422360248,0.26217673291925464,2.8516949152542375,1.1974436090225564,1.4576303501945527,1.8995588235294119,0.83981617647058826,2.1279549090909091,1.2774370909090909,1.0992875989445912,5.3633464566929137,1.935312582781457,1.0825622516556292,1.532888888888889,1.2578190476190476,0.65852698412698418,2.6966851351351351,1.6315896396396397,2.9699647058823526,2.0430058823529413,1.8518963934426229,0.85088426229508196,0.073437500000000003,2.1253436936936936,1.4664279279279278,2.6051067415730338,1.5926905537459284,1.0234201954397395,2.6966106870229005,0.83744274809160302,1.482047337837838,2.0732272727272729,0.36603391700404858,5.9233055555555554,7.2373166666666675,9.7108777777777782,2.9758333333333331,0.081604885057471266,0.61725412541254121,0.38494646924829157,3.0043902040816328,1.647050612244898,2.635939393939394,0.96600000000000008,0.89921052808988755,2.3338524590163936,0.9583606557377049,2.4774021352313169,1.7169501779359431,3.2469361702127659,3.5523560209424083,1.7027462078947369,0.57528089887640455,2.1424232081911265,2.8564372197309416,1.2697295964125559,2.1232077931034485,1.2331139784482759,3.2924449339207049,1.2979050279329609,2.2063254237288135,3.546646590909091,2.4718519480519481,1.797588691449814,1.8281217777777776,1.2070425531914892,0.51948138297872337,2.9516526946107784,1.6596802395209582,2.0248628762541805,1.1286287625418059,1.7288481012658228,1.6147435897435898,0.7565705128205128,4.8360345520000001,2.2474910369999996,11.945605660377359,4.6931264150943397],"size":[16.126085082804899,14.72072072072072,18.060046378952983,14.257510755402327,12.773748691744135,16.082070225122617,13.649432576084056,16.51386238174393,14.618501409838084,9.1159007244146188,13.254365983295369,12.959182417041188,13.880046789386196,16.212440230663464,11.48014529335714,17.337152003940158,13.497263641773891,14.569886515216812,18.912516160807733,17.325278991976031,13.097314535492213,14.524738861868702,14.23469391943196,11.135479899033431,17.558400131338626,13.676503109031582,16.018945597077714,13.431853721603151,17.002908329742041,11.990555110919576,8,15.476062303761621,13.074546984341971,15.342797923207947,15.757286215600566,12.888095384678529,19.328974532619178,11.332060990375341,14.931987309405077,15.218042644010755,10.698528679020706,11.230749656262184,12.007361530095015,13.46929508095795,9.4887233474932788,8.1961624494654099,10.800435059204991,10.504323913891112,19.814329865172688,14.354776826940835,14.870323626587863,10.346692934392252,14.299307352910997,17.078946828377351,11.568963040489237,19.158858174803505,15.650688501713558,12.74070060949332,18.869092326951098,15.165843605245335,10.251636602433869,18.035584559502553,18.187535143343798,12.378496583143509,15.816851698167415,12.426644388351907,20,15.358246629317245,18.415415871452318,17.977792279751277,13.979440579531694,15.668556432514517,10.971325526893636,15.180906646965871,10.936649633688358,15.822463009706746,12.280270065053664,17.669543803484579,13.27012661864598,14.456721869933714,16.000985039709413,11.605245336452626,15.669411729360339,11.419714809661597,18.124026349812226,11.813510640481027],"colorscale":"Plasma","opacity":0.80000000000000004,"showscale":true,"colorbar":{"title":"Per Capita Conc. (µg/m³/person)","x":0.94999999999999996,"xanchor":"left","len":0.75},"line":{"color":"rgba(255,127,14,1)"}},"type":"scattermapbox","_bbox":[168.36991681000001,-46.431928390000003,176.98120116999999,-35.726732210000002],"line":{"color":"rgba(255,127,14,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>htmlwidgets<span class="sc">::</span><span class="fu">saveWidget</span>(interactive_map18, <span class="st">"dist.html"</span>, <span class="at">selfcontained =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>New Zealand’s air quality varies significantly across regions, with particulate matter (PM) concentrations reflecting both human activity and environmental conditions. This map highlights total and per capita PM levels, revealing how pollution impacts individuals versus overall atmospheric load. The deep red zones indicate areas where residents experience heightened exposure, often influenced by traffic, industry, or natural events. Future analyses could explore seasonal changes, meteorological influences, and links to traffic congestion.</p>
</section>
<section id="standardizing-daily-air-pollutant-concentrations-for-cross-regional-analysis" class="level3" data-number="4.7">
<h3 data-number="4.7" class="anchored" data-anchor-id="standardizing-daily-air-pollutant-concentrations-for-cross-regional-analysis"><span class="header-section-number">4.7</span> Standardizing Daily Air Pollutant Concentrations for Cross-Regional Analysis</h3>
<p>To enable consistent comparisons across regions, we first removed duplicate entries by aggregating pollutant data by SA2, region, date, and indicator. We then calculated total daily concentrations and standardized them using z-scores. This normalization allows us to detect anomalies and analyze trends over time on a common scale, regardless of differences in baseline pollution levels across regions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Check for duplicate pollutant entries recorded on the same day, in the same location, for the same indicator</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(airdata_with_sa2) <span class="sc">|&gt;</span></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sa2_name, region, date, indicator) <span class="sc">|&gt;</span></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,972
Columns: 5
$ sa2_name  &lt;chr&gt; "Alexandra South", "Alexandra South", "Alexandra South", "Al…
$ region    &lt;chr&gt; "Otago", "Otago", "Otago", "Otago", "Otago", "Otago", "Otago…
$ date      &lt;date&gt; 2018-03-31, 2019-04-06, 2020-04-04, 2021-04-03, 2016-04-02,…
$ indicator &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM1…
$ n         &lt;int&gt; 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co"># → Some SA2 regions record pollutant levels multiple times per day per indicator.</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine duplicates by summing concentration values across SA2 name, region, date, and indicator. This step ensures cleaner trend lines for time-series analysis</span></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(airdata_with_sa2) <span class="sc">|&gt;</span></span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">region_indicator =</span> <span class="fu">paste</span>(region, indicator, <span class="at">sep =</span> <span class="st">" - "</span>)) <span class="sc">|&gt;</span></span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name, region, date, indicator, region_indicator, pop2018) <span class="sc">|&gt;</span></span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">region_concentration =</span> <span class="fu">sum</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb201-9"><a href="#cb201-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb201-10"><a href="#cb201-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb201-11"><a href="#cb201-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-12"><a href="#cb201-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Confirm that aggregation at the region-date-indicator level has resolved duplicates</span></span>
<span id="cb201-13"><a href="#cb201-13" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb201-14"><a href="#cb201-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(region, date, indicator) <span class="sc">|&gt;</span></span>
<span id="cb201-15"><a href="#cb201-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb201-16"><a href="#cb201-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 45,633
Columns: 4
$ region    &lt;chr&gt; "Auckland", "Auckland", "Auckland", "Auckland", "Auckland", …
$ date      &lt;date&gt; 2016-01-01, 2016-01-01, 2016-01-02, 2016-01-02, 2016-01-03,…
$ indicator &lt;chr&gt; "PM10", "PM2.5", "PM10", "PM2.5", "PM10", "PM2.5", "PM10", "…
$ n         &lt;int&gt; 6, 3, 6, 3, 5, 2, 5, 2, 5, 2, 6, 3, 5, 2, 5, 2, 5, 2, 5, 2, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Further aggregate by region, date, and indicator to prepare for regional trend analysis</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="ot">&lt;-</span> daily_airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, date, indicator, region_indicator, pop2018) <span class="sc">|&gt;</span></span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">region_concentration =</span> <span class="fu">sum</span>(region_concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-8"><a href="#cb203-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean pollutant concentration for each region and indicator combination</span></span>
<span id="cb203-9"><a href="#cb203-9" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="ot">&lt;-</span> daily_airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb203-10"><a href="#cb203-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, indicator) <span class="sc">|&gt;</span></span>
<span id="cb203-11"><a href="#cb203-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">grp_mean =</span> <span class="fu">mean</span>(region_concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb203-12"><a href="#cb203-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb203-13"><a href="#cb203-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-14"><a href="#cb203-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute standardized concentrations (z-scores) to enable cross-region comparison on a uniform scale</span></span>
<span id="cb203-15"><a href="#cb203-15" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="ot">&lt;-</span> daily_airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb203-16"><a href="#cb203-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, indicator) <span class="sc">|&gt;</span></span>
<span id="cb203-17"><a href="#cb203-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb203-18"><a href="#cb203-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_concentration =</span> (region_concentration <span class="sc">-</span> <span class="fu">mean</span>(region_concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(region_concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb203-19"><a href="#cb203-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb203-20"><a href="#cb203-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb203-21"><a href="#cb203-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-22"><a href="#cb203-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of standardized concentration values</span></span>
<span id="cb203-23"><a href="#cb203-23" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata_with_sa2<span class="sc">$</span>sd_concentration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-2.2741 -0.6267 -0.2622  0.0000  0.3367 21.5596 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co"># → Standardized concentration ranges from -2.57 to 7.99, with a median of -0.26 and a mean of 0.</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of raw regional concentrations</span></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata_with_sa2<span class="sc">$</span>region_concentration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00    6.40   10.46   12.86   16.16  202.80 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="co"># → Regional concentration ranges from 0 to 549.98 µg/m³, with a median of 22.88 and a mean of 40.62.</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to randomly select a fixed number of regions, filter the dataset accordingly, and replace zero concentrations with a small positive value to avoid log/scale issues</span></span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>prepare_selected_airdata <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">n_regions =</span> <span class="dv">5</span>, <span class="at">seed =</span> <span class="dv">123</span>) {</span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed) <span class="co"># Ensure reproducibility</span></span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb207-7"><a href="#cb207-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Randomly sample 'n_regions' unique region names</span></span>
<span id="cb207-8"><a href="#cb207-8" aria-hidden="true" tabindex="-1"></a>  selected_regions <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">unique</span>(data<span class="sc">$</span>region), <span class="at">size =</span> n_regions)</span>
<span id="cb207-9"><a href="#cb207-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb207-10"><a href="#cb207-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter to selected regions and replace zero concentration values</span></span>
<span id="cb207-11"><a href="#cb207-11" aria-hidden="true" tabindex="-1"></a>  data_filtered <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb207-12"><a href="#cb207-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(region <span class="sc">%in%</span> selected_regions) <span class="sc">|&gt;</span></span>
<span id="cb207-13"><a href="#cb207-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb207-14"><a href="#cb207-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">region_concentration =</span> <span class="fu">ifelse</span>(region_concentration <span class="sc">==</span> <span class="dv">0</span>, <span class="fl">1e-05</span>, region_concentration)</span>
<span id="cb207-15"><a href="#cb207-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb207-16"><a href="#cb207-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb207-17"><a href="#cb207-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb207-18"><a href="#cb207-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb207-19"><a href="#cb207-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data_filtered,</span>
<span id="cb207-20"><a href="#cb207-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">selected_regions =</span> selected_regions</span>
<span id="cb207-21"><a href="#cb207-21" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb207-22"><a href="#cb207-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply function to filter dataset and get selected regions</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">prepare_selected_airdata</span>(daily_airdata_with_sa2, <span class="dv">6</span>)</span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>daily_airdata_selected <span class="ot">&lt;-</span> result<span class="sc">$</span>data</span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a>selected_regions <span class="ot">&lt;-</span> result<span class="sc">$</span>selected_regions</span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview column names and selected regions</span></span>
<span id="cb208-7"><a href="#cb208-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(daily_airdata_selected)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "region"               "date"                 "indicator"           
[4] "region_indicator"     "pop2018"              "region_concentration"
[7] "grp_mean"             "sd_concentration"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>selected_regions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "West Coast"         "Canterbury"         "Wellington"        
[4] "Otago"              "Bay of Plenty"      "Manawatu-Whanganui"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a faceted line plot showing log-scale air pollutant concentration trends by region. This visualizes pollutant concentrations across selected regions from 2016 to 2023</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>plot_log_by_region <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> daily_airdata_selected, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> region_concentration, <span class="at">color =</span> indicator)) <span class="sc">+</span></span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> region)) <span class="sc">+</span></span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"PM10"</span> <span class="ot">=</span> <span class="st">"#0072B2"</span>, <span class="st">"PM2.5"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>)) <span class="sc">+</span></span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Log-Scale Trends in Air Pollutant Concentration in Selected Regions (2016-2023)"</span>,</span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Log-transformed trends in PM2.5 and PM10 concentration"</span>,</span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Month-Year"</span>,</span>
<span id="cb212-9"><a href="#cb212-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Total Pollutant Concentration (log scale)"</span>,</span>
<span id="cb212-10"><a href="#cb212-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Pollutant Type"</span>) <span class="sc">+</span></span>
<span id="cb212-11"><a href="#cb212-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb212-12"><a href="#cb212-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb212-13"><a href="#cb212-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb212-14"><a href="#cb212-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb212-15"><a href="#cb212-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>), <span class="co"># Center the main title</span></span>
<span id="cb212-16"><a href="#cb212-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb212-17"><a href="#cb212-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> <span class="co"># Center the subtitle</span></span>
<span id="cb212-18"><a href="#cb212-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> region, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb212-19"><a href="#cb212-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb212-20"><a href="#cb212-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2016-01-01"</span>),</span>
<span id="cb212-21"><a href="#cb212-21" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">as.Date</span>(<span class="st">"2023-12-31"</span>), <span class="at">by =</span> <span class="st">"6 months"</span>), <span class="co"># tick every 6 months</span></span>
<span id="cb212-22"><a href="#cb212-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">"%b %y"</span>) <span class="sc">+</span></span>
<span id="cb212-23"><a href="#cb212-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_scientific</span>()) <span class="co"># Apply log10 scale</span></span>
<span id="cb212-24"><a href="#cb212-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-25"><a href="#cb212-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb212-26"><a href="#cb212-26" aria-hidden="true" tabindex="-1"></a>plot_log_by_region</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-log-concentration-by-region-facets-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Air pollution trends across New Zealand regions reveal intriguing variations. Canterbury’s pronounced seasonal fluctuations hint at climatic influences, while Otago’s cyclical peaks suggest recurring pollution sources. Bay of Plenty and Wellington maintain relatively stable pollutant levels, contrasting with the West Coast’s dramatic drops, possibly due to extreme weather events or data gaps. The use of log scales provides clarity in detecting subtle changes over time, distinguishing PM2.5 and PM10 trends.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to compute specified quantiles (e.g., thresholds) for a numeric column in a dataframe</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>compute_quantiles <span class="ot">&lt;-</span> <span class="cf">function</span>(data, column, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>)) {</span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a>  column_data <span class="ot">&lt;-</span> data[[<span class="fu">deparse</span>(<span class="fu">substitute</span>(column))]]</span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quantile</span>(column_data, <span class="at">probs =</span> probs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute moderate and extreme anomaly thresholds (5th, 10th, 90th, 95th percentiles)</span></span>
<span id="cb213-8"><a href="#cb213-8" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">compute_quantiles</span>(daily_airdata_selected, sd_concentration)</span>
<span id="cb213-9"><a href="#cb213-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(quantiles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        5%        10%        90%        95% 
-0.9538486 -0.8320200  1.1835574  1.9922713 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with both threshold lines in new colors</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>plot_region_zanomaly <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> daily_airdata_selected, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> sd_concentration, <span class="at">color =</span> indicator)) <span class="sc">+</span></span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> region)) <span class="sc">+</span></span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"PM10"</span> <span class="ot">=</span> <span class="st">"#0072B2"</span>, <span class="st">"PM2.5"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>)) <span class="sc">+</span></span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 10th–90th percentile range</span></span>
<span id="cb215-7"><a href="#cb215-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="st">"10%"</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#009E73"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span>  <span class="co"># Bluish green</span></span>
<span id="cb215-8"><a href="#cb215-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="st">"90%"</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#009E73"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb215-9"><a href="#cb215-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-10"><a href="#cb215-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 5th–95th percentile range</span></span>
<span id="cb215-11"><a href="#cb215-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="st">"5%"</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span>  <span class="co"># Reddish purple</span></span>
<span id="cb215-12"><a href="#cb215-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="st">"95%"</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb215-13"><a href="#cb215-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-14"><a href="#cb215-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> region, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb215-15"><a href="#cb215-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb215-16"><a href="#cb215-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2016-01-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2023-12-31"</span>), <span class="at">by =</span> <span class="st">"6 months"</span>),</span>
<span id="cb215-17"><a href="#cb215-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">"%b %y"</span></span>
<span id="cb215-18"><a href="#cb215-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb215-19"><a href="#cb215-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb215-20"><a href="#cb215-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb215-21"><a href="#cb215-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Standardized PM2.5 and PM10 Trends by Region (2016–2023)"</span>,</span>
<span id="cb215-22"><a href="#cb215-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Z-score trends with 10th/90th (green) and 5th/95th (purple) percentiles marking moderate and extreme anomalies"</span>,</span>
<span id="cb215-23"><a href="#cb215-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Month–Year"</span>,</span>
<span id="cb215-24"><a href="#cb215-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized Concentration (Z-score)"</span>,</span>
<span id="cb215-25"><a href="#cb215-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Pollutant"</span></span>
<span id="cb215-26"><a href="#cb215-26" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb215-27"><a href="#cb215-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb215-28"><a href="#cb215-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>), </span>
<span id="cb215-29"><a href="#cb215-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb215-30"><a href="#cb215-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb215-31"><a href="#cb215-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb215-32"><a href="#cb215-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb215-33"><a href="#cb215-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb215-34"><a href="#cb215-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb215-35"><a href="#cb215-35" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb215-36"><a href="#cb215-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-37"><a href="#cb215-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot</span></span>
<span id="cb215-38"><a href="#cb215-38" aria-hidden="true" tabindex="-1"></a>plot_region_zanomaly</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/zscore-threshold-lines-by-region-plot-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Regional air quality trends reveal striking differences in pollutant behavior, particularly in extreme cases. Canterbury exhibits persistently high PM2.5 and PM10 levels, frequently exceeding the 90th and 95th percentiles, indicating prolonged pollution events. In contrast, Bay of Plenty and Wellington experience volatile PM2.5 concentrations, with frequent spikes surpassing upper quantiles. Otago and West Coast display seasonal PM10 peaks, reflecting meteorological influences rather than urban emissions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign pollution category based on standardized concentration thresholds</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorize each day's standardized concentration as "good", "typical", or "bad", based on 10th and 90th percentile z-score thresholds computed earlier</span></span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>daily_airdata_selected <span class="ot">&lt;-</span> daily_airdata_selected <span class="sc">|&gt;</span></span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pollution_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a>    sd_concentration <span class="sc">&lt;</span> quantiles[<span class="st">"10%"</span>] <span class="sc">~</span> <span class="st">"good"</span>,<span class="co"># below 10th</span></span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a>    sd_concentration <span class="sc">&gt;</span> quantiles[<span class="st">"90%"</span>] <span class="sc">~</span> <span class="st">"bad"</span>, <span class="co"># above 90th</span></span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"typical"</span>)) <span class="co"># between 10th and 90th</span></span>
<span id="cb216-8"><a href="#cb216-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-9"><a href="#cb216-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a faceted column plot showing daily standardized concentrations. Fill color reflects pollution category: good (green), typical (grey), bad (orange)</span></span>
<span id="cb216-10"><a href="#cb216-10" aria-hidden="true" tabindex="-1"></a>plot_threshold <span class="ot">&lt;-</span> <span class="cf">function</span>(xvar, yvar) {</span>
<span id="cb216-11"><a href="#cb216-11" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> daily_airdata_selected, <span class="fu">aes</span>(<span class="at">x =</span> {{xvar}}, <span class="at">y =</span> {{yvar}}, <span class="at">fill =</span> pollution_category)) <span class="sc">+</span></span>
<span id="cb216-12"><a href="#cb216-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> <span class="co"># stack columns side by side</span></span>
<span id="cb216-13"><a href="#cb216-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"good"</span> <span class="ot">=</span> <span class="st">"#1b9e77"</span>, <span class="st">"typical"</span> <span class="ot">=</span> <span class="st">"#999999"</span>, <span class="st">"bad"</span> <span class="ot">=</span> <span class="st">"#d95f02"</span>)) <span class="sc">+</span></span>
<span id="cb216-14"><a href="#cb216-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb216-15"><a href="#cb216-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb216-16"><a href="#cb216-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Month–Year"</span>, </span>
<span id="cb216-17"><a href="#cb216-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Daily Standardized Concentration"</span>, </span>
<span id="cb216-18"><a href="#cb216-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Pollution Category"</span>) <span class="sc">+</span></span>
<span id="cb216-19"><a href="#cb216-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb216-20"><a href="#cb216-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb216-21"><a href="#cb216-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb216-22"><a href="#cb216-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb216-23"><a href="#cb216-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb216-24"><a href="#cb216-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb216-25"><a href="#cb216-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>), </span>
<span id="cb216-26"><a href="#cb216-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb216-27"><a href="#cb216-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb216-28"><a href="#cb216-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb216-29"><a href="#cb216-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-30"><a href="#cb216-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb216-31"><a href="#cb216-31" aria-hidden="true" tabindex="-1"></a>plot_zscore_pollution_categories <span class="ot">&lt;-</span> <span class="fu">plot_threshold</span>(date, sd_concentration) <span class="sc">+</span></span>
<span id="cb216-32"><a href="#cb216-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> region_indicator, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb216-33"><a href="#cb216-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(</span>
<span id="cb216-34"><a href="#cb216-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.Date</span>(<span class="st">"2016-01-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2023-12-31"</span>), <span class="at">by =</span> <span class="st">"6 months"</span>), <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">date_format</span>(<span class="st">"%b%y"</span>)) <span class="sc">+</span></span>
<span id="cb216-35"><a href="#cb216-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb216-36"><a href="#cb216-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Categorized Standardized Daily Air Pollution Levels by Region (2016–2023)"</span>,</span>
<span id="cb216-37"><a href="#cb216-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Z-score scaled concentrations colored by pollution severity based on 10th/90th percentile cutoffs"</span>)</span>
<span id="cb216-38"><a href="#cb216-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-39"><a href="#cb216-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb216-40"><a href="#cb216-40" aria-hidden="true" tabindex="-1"></a>plot_zscore_pollution_categories</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-daily-zscore-pollution-categories-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Across the regions of New Zealand depicted, a common thread of seasonal air pollution emerges, with particulate matter (PM10 and PM2.5) concentrations generally peaking during the colder winter months. Canterbury stands out with a seemingly higher frequency of “Bad” air quality days, especially for PM2.5, suggesting potential issues with pollutant trapping. Bay of Plenty also exhibits a clear seasonal pattern with notable “Bad” days. In contrast, Wellington appears to enjoy relatively better air quality with less pronounced seasonal variation and fewer instances of “Bad” pollution. Otago and the West Coast, for which only PM10 data is shown, also display seasonal trends but seem to experience fewer severe pollution episodes than Canterbury. These regional differences likely stem from a combination of factors including heating practices, local industrial activity, topography, and prevailing weather patterns.</p>
</section>
<section id="seasonal-aggregation-and-visualization-of-air-quality-data-20162023" class="level3" data-number="4.8">
<h3 data-number="4.8" class="anchored" data-anchor-id="seasonal-aggregation-and-visualization-of-air-quality-data-20162023"><span class="header-section-number">4.8</span> Seasonal Aggregation and Visualization of Air Quality Data (2016–2023)</h3>
<p>This section defines seasonal categories, computes total and seasonal pollutant concentrations by region, and calculates z-score anomalies. It then visualizes seasonal trends in PM2.5 and PM10 concentrations across selected New Zealand regions from 2016 to 2023 using a log-scaled line plot, highlighting temporal and spatial variations in air quality.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to classify dates into custom seasons</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>get_season <span class="ot">&lt;-</span> <span class="cf">function</span>(date) {</span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a>  month <span class="ot">&lt;-</span> <span class="fu">month</span>(date)</span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">case_when</span>(</span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>)  <span class="sc">~</span> <span class="st">"Sum"</span>, <span class="co"># Summer: Dec–Feb</span></span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)   <span class="sc">~</span> <span class="st">"Aut"</span>, <span class="co"># Autumn: Mar–May</span></span>
<span id="cb217-7"><a href="#cb217-7" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>)   <span class="sc">~</span> <span class="st">"Win"</span>, <span class="co"># Winter: Jun–Aug</span></span>
<span id="cb217-8"><a href="#cb217-8" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>) <span class="sc">~</span> <span class="st">"Spr"</span> <span class="co"># Spring: Sep–Nov</span></span>
<span id="cb217-9"><a href="#cb217-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb217-10"><a href="#cb217-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb217-11"><a href="#cb217-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-12"><a href="#cb217-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract 'season' and 'year' from the date column</span></span>
<span id="cb217-13"><a href="#cb217-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Factorize 'season' for ordered plotting</span></span>
<span id="cb217-14"><a href="#cb217-14" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(airdata_with_sa2) <span class="sc">|&gt;</span></span>
<span id="cb217-15"><a href="#cb217-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb217-16"><a href="#cb217-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">season =</span> <span class="fu">get_season</span>(date),</span>
<span id="cb217-17"><a href="#cb217-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">season =</span> <span class="fu">factor</span>(season, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Sum"</span>, <span class="st">"Aut"</span>, <span class="st">"Win"</span>, <span class="st">"Spr"</span>)),</span>
<span id="cb217-18"><a href="#cb217-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">format</span>(date, <span class="st">"%y"</span>) </span>
<span id="cb217-19"><a href="#cb217-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb217-20"><a href="#cb217-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, season, year, indicator, pop2018) <span class="sc">|&gt;</span></span>
<span id="cb217-21"><a href="#cb217-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb217-22"><a href="#cb217-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">region_concentration =</span> <span class="fu">sum</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb217-23"><a href="#cb217-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb217-24"><a href="#cb217-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb217-25"><a href="#cb217-25" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata_with_sa2<span class="sc">$</span>region_concentration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    8.0   612.2  1002.8  1081.7  1346.3  5898.8 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Region concentration ranges 12.41–21558.9, median 2055.98, mean 3535.07, skewed right distribution.</span></span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize distribution of season and year</span></span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata_with_sa2<span class="sc">$</span>season)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sum Aut Win Spr 
680 671 684 684 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">as.integer</span>(daily_airdata_with_sa2<span class="sc">$</span>year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  16.00   18.00   20.00   19.64   22.00   23.00 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Season column shows balanced seasonal distribution. Year column spans from 2016 to 2023 with median year 2020.</span></span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute seasonal mean, standard deviation, and z-anomaly by region and indicator</span></span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="ot">&lt;-</span> daily_airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, season, indicator) <span class="sc">|&gt;</span></span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">seasonal_mean =</span> <span class="fu">mean</span>(region_concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb223-8"><a href="#cb223-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">seasonal_sd =</span> <span class="fu">sd</span>(region_concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb223-9"><a href="#cb223-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_concentration =</span> (region_concentration <span class="sc">-</span> seasonal_mean) <span class="sc">/</span> seasonal_sd</span>
<span id="cb223-10"><a href="#cb223-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb223-11"><a href="#cb223-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb223-12"><a href="#cb223-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-13"><a href="#cb223-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize seasonal statistics</span></span>
<span id="cb223-14"><a href="#cb223-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata_with_sa2<span class="sc">$</span>seasonal_mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  169.6   691.1  1092.0  1081.7  1384.6  2631.9 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata_with_sa2<span class="sc">$</span>seasonal_sd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   41.8   148.9   248.3   346.6   405.0  1288.8 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seasonal mean ranges from 204.8 to 17998.3 with mean 3535.1; seasonal SD ranges 41.8–5301, mean 713.8.</span></span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata_with_sa2<span class="sc">$</span>sd_concentration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-3.3050 -0.6890 -0.1014  0.0000  0.6288  3.8590 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SD concentration ranges from -2.402 to 2.195, mean approximately zero.</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate ordered season-year combinations for time-series plotting</span></span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique sorted years from the data</span></span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(daily_airdata_with_sa2<span class="sc">$</span>year))</span>
<span id="cb229-6"><a href="#cb229-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-7"><a href="#cb229-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define ordered season labels</span></span>
<span id="cb229-8"><a href="#cb229-8" aria-hidden="true" tabindex="-1"></a>season_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Sum"</span>, <span class="st">"Aut"</span>, <span class="st">"Win"</span>, <span class="st">"Spr"</span>)</span>
<span id="cb229-9"><a href="#cb229-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-10"><a href="#cb229-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate ordered levels like "Sum16", "Aut16", ..., "Spr23"</span></span>
<span id="cb229-11"><a href="#cb229-11" aria-hidden="true" tabindex="-1"></a>season_year_levels <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">outer</span>(season_order, years, paste0))</span>
<span id="cb229-12"><a href="#cb229-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-13"><a href="#cb229-13" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(season_year_levels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> chr [1:32] "Sum16" "Aut16" "Win16" "Spr16" "Sum17" "Aut17" "Win17" "Spr17" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and factorize 'season_year'</span></span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="ot">&lt;-</span> daily_airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">season_year =</span> <span class="fu">paste0</span>(season, year),</span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">season_year =</span> <span class="fu">factor</span>(season_year, <span class="at">levels =</span> season_year_levels),</span>
<span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">region_indicator =</span> <span class="fu">paste0</span>(region, <span class="st">"_"</span>, indicator)</span>
<span id="cb231-7"><a href="#cb231-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb231-8"><a href="#cb231-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-9"><a href="#cb231-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview distinct levels</span></span>
<span id="cb231-10"><a href="#cb231-10" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(daily_airdata_with_sa2<span class="sc">$</span>season_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Factor w/ 32 levels "Sum16","Aut16",..: 1 1 1 1 1 1 1 1 1 5 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define plotting function for seasonal trends</span></span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, y_var) {</span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> season_year, <span class="at">y =</span> {{y_var}}, <span class="at">color =</span> indicator)) <span class="sc">+</span></span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> indicator)) <span class="sc">+</span></span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"PM10"</span> <span class="ot">=</span> <span class="st">"#0072B2"</span>, <span class="st">"PM2.5"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>)) <span class="sc">+</span></span>
<span id="cb233-7"><a href="#cb233-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb233-8"><a href="#cb233-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Season_Year"</span>, <span class="at">color =</span> <span class="st">"Indicator"</span>) <span class="sc">+</span></span>
<span id="cb233-9"><a href="#cb233-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb233-10"><a href="#cb233-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb233-11"><a href="#cb233-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb233-12"><a href="#cb233-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb233-13"><a href="#cb233-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb233-14"><a href="#cb233-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb233-15"><a href="#cb233-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select a reproducible random sample of 6 regions for focused seasonal trend visualization</span></span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">prepare_selected_airdata</span>(daily_airdata_with_sa2, <span class="at">n_regions =</span> <span class="dv">6</span>, <span class="at">seed =</span> <span class="dv">1234</span>)</span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a>daily_airdata_selected <span class="ot">&lt;-</span> result<span class="sc">$</span>data</span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a>selected_regions <span class="ot">&lt;-</span> result<span class="sc">$</span>selected_regions</span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect structure of the selected dataset and confirm chosen regions</span></span>
<span id="cb234-7"><a href="#cb234-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(daily_airdata_selected)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "region"               "season"               "year"                
 [4] "indicator"            "pop2018"              "region_concentration"
 [7] "seasonal_mean"        "seasonal_sd"          "sd_concentration"    
[10] "season_year"          "region_indicator"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>selected_regions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Tasman"             "Otago"              "Manawatu-Whanganui"
[4] "Hawke's Bay"        "Northland"          "West Coast"        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute distribution quantiles (5th, 10th, 90th, 95th percentiles) for reference lines</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">compute_quantiles</span>(daily_airdata_selected, region_concentration)</span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(quantiles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       5%       10%       90%       95% 
 317.6326  415.3020 1894.4922 2280.6600 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate seasonal concentration trends with reference bands for selected regions and indicators</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>seasonal_concentration_plot <span class="ot">&lt;-</span> <span class="fu">plot</span>(daily_airdata_selected, region_concentration) <span class="sc">+</span></span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> region, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Trends of Pollutants in Selected New Zealand Regions (2016–2023)"</span>,</span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Seasonal average pollutant concentrations (log scale) across six randomly selected regions, highlighting inter-seasonal variability"</span>,</span>
<span id="cb240-7"><a href="#cb240-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Seasonal Average Concentration (µg/m³, log scale)"</span>) <span class="sc">+</span></span>
<span id="cb240-8"><a href="#cb240-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>scientific) <span class="sc">+</span></span>
<span id="cb240-9"><a href="#cb240-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb240-10"><a href="#cb240-10" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Add horizontal dashed lines for 10th–90th percentile range</span></span>
<span id="cb240-11"><a href="#cb240-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="dv">2</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#009E73"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span>  <span class="co"># Bluish green</span></span>
<span id="cb240-12"><a href="#cb240-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="dv">3</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#009E73"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb240-13"><a href="#cb240-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb240-14"><a href="#cb240-14" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Add horizontal dashed lines for 5th–95th percentile range</span></span>
<span id="cb240-15"><a href="#cb240-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="dv">1</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Reddish purple</span></span>
<span id="cb240-16"><a href="#cb240-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="dv">4</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)</span>
<span id="cb240-17"><a href="#cb240-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-18"><a href="#cb240-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb240-19"><a href="#cb240-19" aria-hidden="true" tabindex="-1"></a>seasonal_concentration_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/seasonal-trends-selected-regions-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Otago shows high seasonal PM10 variability, while Hawke’s Bay and Manawatu-Whanganui remain stable. PM2.5 fluctuates in Tasman and West Coast but stays consistent in Northland. Winter pollution spikes, likely from heating emissions, persist. Quantile lines reveal extremes—Otago’s PM10 fluctuates widely, while Hawke’s Bay and Manawatu-Whanganui have tighter bands, emphasizing seasonal influences on air quality across regions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute quantiles (5th, 10th, 90th, 95th percentiles) for Z-score scaled seasonal concentrations</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 'daily_airdata_selected' contains data; 'sd_concentration' is the standardized concentration column</span></span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">compute_quantiles</span>(daily_airdata_selected, sd_concentration)</span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(quantiles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       5%       10%       90%       95% 
-1.551783 -1.217957  1.285400  1.687826 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate seasonal trend plot of standardized pollutant concentrations across selected regions</span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>seasonal_zscore_plot <span class="ot">&lt;-</span> <span class="fu">plot</span>(daily_airdata_selected, sd_concentration) <span class="sc">+</span></span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> region, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Standardized Seasonal Variations in PM2.5 and PM10 Across NZ Regions (2016–2023)"</span>,</span>
<span id="cb243-6"><a href="#cb243-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Z-score scaled concentrations per season and region. Dashed green lines = moderate (10th/90th), purple = extreme (5th/95th) thresholds"</span>,</span>
<span id="cb243-7"><a href="#cb243-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized Concentration (Z-score)"</span></span>
<span id="cb243-8"><a href="#cb243-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb243-9"><a href="#cb243-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add dashed lines for moderate concentration range (10th–90th percentile)</span></span>
<span id="cb243-10"><a href="#cb243-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="dv">2</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#009E73"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span>  <span class="co"># Bluish green</span></span>
<span id="cb243-11"><a href="#cb243-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="dv">3</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#009E73"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb243-12"><a href="#cb243-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb243-13"><a href="#cb243-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add dashed lines for extreme concentration range (5th–95th percentile)</span></span>
<span id="cb243-14"><a href="#cb243-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="dv">1</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Reddish purple</span></span>
<span id="cb243-15"><a href="#cb243-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="dv">4</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)</span>
<span id="cb243-16"><a href="#cb243-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-17"><a href="#cb243-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb243-18"><a href="#cb243-18" aria-hidden="true" tabindex="-1"></a>seasonal_zscore_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-zscore-seasonal-trends-selected-regions-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>The plots show varying pollution trends across NZ regions from 2016-2023. Hawke’s Bay and Northland exhibit frequent extreme PM2.5 concentrations. Manawatu-Whanganui and Tasman show moderate PM10 fluctuations, while West Coast consistently stays within normal ranges. Otago experiences occasional moderate PM10 increases. Overall, PM10 often reaches extreme levels more frequently than PM2.5 in several regions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorize pollution levels based on standardized (Z-score) concentration thresholds</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>daily_airdata_selected <span class="ot">&lt;-</span> daily_airdata_selected <span class="sc">|&gt;</span></span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">pollution_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a>      sd_concentration <span class="sc">&lt;</span> quantiles[<span class="st">"10%"</span>] <span class="sc">~</span> <span class="st">"good"</span>,</span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a>      sd_concentration <span class="sc">&gt;</span> quantiles[<span class="st">"90%"</span>] <span class="sc">~</span> <span class="st">"bad"</span>,</span>
<span id="cb244-7"><a href="#cb244-7" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"typical"</span>),</span>
<span id="cb244-8"><a href="#cb244-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb244-9"><a href="#cb244-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to ordered factor for consistent plotting</span></span>
<span id="cb244-10"><a href="#cb244-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pollution_category =</span> <span class="fu">factor</span>(pollution_category, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"good"</span>, <span class="st">"typical"</span>, <span class="st">"bad"</span>)))</span>
<span id="cb244-11"><a href="#cb244-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-12"><a href="#cb244-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a plot highlighting pollution category over time</span></span>
<span id="cb244-13"><a href="#cb244-13" aria-hidden="true" tabindex="-1"></a>categorized_pollution_plot <span class="ot">&lt;-</span> <span class="fu">plot_threshold</span>(season_year, sd_concentration) <span class="sc">+</span></span>
<span id="cb244-14"><a href="#cb244-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> region, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb244-15"><a href="#cb244-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb244-16"><a href="#cb244-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Categorized Standardized Air Pollution Concentration Trends (2016–2023)"</span>,</span>
<span id="cb244-17"><a href="#cb244-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Z-score concentrations classified as Good (&lt;10th), Typical (10th–90th), or Bad (&gt;90th percentile)"</span>,</span>
<span id="cb244-18"><a href="#cb244-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Season-Year"</span>,</span>
<span id="cb244-19"><a href="#cb244-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized Concentration (Z-score)"</span></span>
<span id="cb244-20"><a href="#cb244-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb244-21"><a href="#cb244-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-22"><a href="#cb244-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot</span></span>
<span id="cb244-23"><a href="#cb244-23" aria-hidden="true" tabindex="-1"></a>categorized_pollution_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-categorized-zscore-seasonal-trends-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>All regions exhibit periods of “bad” (orange) and “good” (teal) pollution categories, with “typical” (grey) being most frequent. Otago, Manawatu-Whanganui, and Hawke’s Bay show more frequent “bad” periods, particularly earlier in the time series. Northland, Tasman, and West Coast experience fewer “bad” periods, with Tasman and West Coast showing more consistent “good” periods later on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute per capita pollutant concentration by dividing total regional concentration by 2018 population</span></span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Assumes population remained relatively stable between 2016–2023</span></span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a>daily_airdata_selected <span class="ot">&lt;-</span> daily_airdata_selected <span class="sc">|&gt;</span></span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, indicator) <span class="sc">|&gt;</span></span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb245-6"><a href="#cb245-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">concentration_per_capita =</span> region_concentration <span class="sc">/</span> pop2018,</span>
<span id="cb245-7"><a href="#cb245-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb245-8"><a href="#cb245-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standardize per capita concentration within each region-indicator group</span></span>
<span id="cb245-9"><a href="#cb245-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_concentration =</span> (concentration_per_capita <span class="sc">-</span> <span class="fu">mean</span>(concentration_per_capita, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))<span class="sc">/</span> <span class="fu">sd</span>(concentration_per_capita, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb245-10"><a href="#cb245-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb245-11"><a href="#cb245-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-12"><a href="#cb245-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create faceted column plot of standardized per capita concentrations</span></span>
<span id="cb245-13"><a href="#cb245-13" aria-hidden="true" tabindex="-1"></a>plot_per_capita_sd <span class="ot">&lt;-</span> <span class="fu">plot_threshold</span>(season_year, sd_concentration) <span class="sc">+</span></span>
<span id="cb245-14"><a href="#cb245-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> region, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb245-15"><a href="#cb245-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb245-16"><a href="#cb245-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Standardized Seasonal Air Pollution Concentration Per Capita by Region (2016–2023)"</span>,</span>
<span id="cb245-17"><a href="#cb245-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Z-score scaled concentrations adjusted for 2018 population; colored thresholds highlight top and bottom 10%"</span>,</span>
<span id="cb245-18"><a href="#cb245-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized Per Capita Concentration (Z-score)"</span>)</span>
<span id="cb245-19"><a href="#cb245-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-20"><a href="#cb245-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb245-21"><a href="#cb245-21" aria-hidden="true" tabindex="-1"></a>plot_per_capita_sd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-standardized-concentration-per-capita-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>The graphs display standardized seasonal air pollution concentrations per capita for various regions from 2016 to 2023. Hawke’s Bay and Tasman show more frequent “good” (teal) periods, particularly in later years. Manawatu-Whanganui and Northland exhibit a higher prevalence of “bad” (orange) periods, especially in the earlier years. Hawke’s Bay and Otago present a mix, with Otago having some notable “bad” spikes later on. Overall, there’s regional variability in pollution trends, with some areas consistently better or worse.</p>
</section>
</section>
<section id="sa2-level-air-quality-insights-for-auckland-20162023" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="sa2-level-air-quality-insights-for-auckland-20162023"><span class="header-section-number">5</span> SA2-Level Air Quality Insights for Auckland (2016–2023)</h2>
<p>This map highlights spatial variation in particulate pollution across Auckland SA2 zones, helping identify areas with elevated per capita exposure for targeted environmental interventions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the airdata_with_sa2 dataset to include only Auckland region</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>airdata_with_sa2 <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">"Auckland"</span>)</span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a><span class="co"># View the structure of the filtered data</span></span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata_with_sa2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 29,308
Columns: 11
$ region              &lt;chr&gt; "Auckland", "Auckland", "Auckland", "Auckland", "A…
$ lawa_site_id        &lt;chr&gt; "LAWA-100059", "LAWA-100059", "LAWA-100059", "LAWA…
$ site_type           &lt;chr&gt; "Residential, NES site", "Residential, NES site", …
$ indicator           &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "P…
$ date                &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2…
$ concentration       &lt;dbl&gt; 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2…
$ year                &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2…
$ geometry            &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -3…
$ sa2_name            &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Ed…
$ pop2018             &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 37…
$ arima_concentration &lt;dbl&gt; 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove unneeded columns for summary calculations</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>airdata_with_sa2 <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>region, <span class="sc">-</span>lawa_site_id, <span class="sc">-</span>arima_concentration)</span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract longitude and latitude from geometry column</span></span>
<span id="cb248-6"><a href="#cb248-6" aria-hidden="true" tabindex="-1"></a>airdata_with_sa2 <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb248-7"><a href="#cb248-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb248-8"><a href="#cb248-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">1</span>],</span>
<span id="cb248-9"><a href="#cb248-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">2</span>]</span>
<span id="cb248-10"><a href="#cb248-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb248-11"><a href="#cb248-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-12"><a href="#cb248-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarise concentration data by SA2 area</span></span>
<span id="cb248-13"><a href="#cb248-13" aria-hidden="true" tabindex="-1"></a>airdata_summary <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb248-14"><a href="#cb248-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name, longitude, latitude) <span class="sc">|&gt;</span></span>
<span id="cb248-15"><a href="#cb248-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb248-16"><a href="#cb248-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">sa2_conc =</span> <span class="fu">sum</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># Sum conc.</span></span>
<span id="cb248-17"><a href="#cb248-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">sa2_conc_per_capita =</span> sa2_conc <span class="sc">/</span> pop2018 <span class="sc">*</span> <span class="dv">100</span>, <span class="co"># Per capita conc.</span></span>
<span id="cb248-18"><a href="#cb248-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb248-19"><a href="#cb248-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb248-20"><a href="#cb248-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(sa2_name, longitude, latitude, sa2_conc, sa2_conc_per_capita)</span>
<span id="cb248-21"><a href="#cb248-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-22"><a href="#cb248-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Output for verification</span></span>
<span id="cb248-23"><a href="#cb248-23" aria-hidden="true" tabindex="-1"></a>airdata_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 5
  sa2_name                longitude latitude sa2_conc sa2_conc_per_capita
  &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;               &lt;dbl&gt;
1 Ellerslie South              175.    -36.9   57527.               2115.
2 Glen Eden Central            175.    -36.9   35021.                924.
3 Henderson Lincoln South      175.    -36.9   34102.               1263.
4 Puni                         175.    -37.2   45549.               2761.
5 Queen Street                 175.    -36.8   55926.               2292.
6 Sunnyhills East              175.    -36.9   36121.               1009.
7 Westlake                     175.    -36.8   53903.               1728.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a Plotly map where:</span></span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a><span class="co"># - Marker color represents concentration per capita</span></span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - Marker size is fixed (not scaled by concentration)</span></span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a>sa2_auckland_per_capita <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(</span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> airdata_summary, <span class="at">type =</span> <span class="st">'scattermapbox'</span>, <span class="at">mode =</span> <span class="st">'markers'</span>,</span>
<span id="cb250-6"><a href="#cb250-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">lat =</span> <span class="sc">~</span>latitude, <span class="at">lon =</span> <span class="sc">~</span>longitude,</span>
<span id="cb250-7"><a href="#cb250-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="cn">NULL</span>, <span class="at">showlegend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb250-8"><a href="#cb250-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="sc">~</span><span class="fu">paste0</span>(</span>
<span id="cb250-9"><a href="#cb250-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SA2: "</span>, sa2_name,</span>
<span id="cb250-10"><a href="#cb250-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"&lt;br&gt;Site Concentration: "</span>, <span class="fu">round</span>(sa2_conc, <span class="dv">1</span>), <span class="st">" µg/m³"</span>,</span>
<span id="cb250-11"><a href="#cb250-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"&lt;br&gt;Per Capita: "</span>, <span class="fu">round</span>(sa2_conc_per_capita, <span class="dv">2</span>), <span class="st">" µg/m³/person"</span>),</span>
<span id="cb250-12"><a href="#cb250-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">marker =</span> <span class="fu">list</span>(</span>
<span id="cb250-13"><a href="#cb250-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">20</span>, <span class="co"># Marker size is fixed</span></span>
<span id="cb250-14"><a href="#cb250-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="sc">~</span>sa2_conc_per_capita, </span>
<span id="cb250-15"><a href="#cb250-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">colorscale =</span> <span class="st">'Viridis'</span>,</span>
<span id="cb250-16"><a href="#cb250-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">opacity =</span> <span class="dv">1</span>, <span class="at">showscale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb250-17"><a href="#cb250-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">colorbar =</span> <span class="fu">list</span>(</span>
<span id="cb250-18"><a href="#cb250-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Per Capita Conc. (µg/m³/person)"</span>,</span>
<span id="cb250-19"><a href="#cb250-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fl">0.95</span>, <span class="at">xanchor =</span> <span class="st">"left"</span>, <span class="at">len =</span> <span class="fl">0.75</span>)</span>
<span id="cb250-20"><a href="#cb250-20" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">|&gt;</span></span>
<span id="cb250-21"><a href="#cb250-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb250-22"><a href="#cb250-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">list</span>(</span>
<span id="cb250-23"><a href="#cb250-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="sc">~</span><span class="fu">paste</span>(</span>
<span id="cb250-24"><a href="#cb250-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;b&gt;SA2:&lt;/b&gt;"</span>, sa2_name,</span>
<span id="cb250-25"><a href="#cb250-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;br&gt;&lt;b&gt;Total Concentration:&lt;/b&gt;"</span>, <span class="fu">round</span>(sa2_conc), <span class="st">"µg/m³"</span>,</span>
<span id="cb250-26"><a href="#cb250-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;br&gt;&lt;b&gt;Per Capita:&lt;/b&gt;"</span>, <span class="fu">round</span>(sa2_conc_per_capita, <span class="dv">2</span>), <span class="st">"µg/m³/person"</span>),</span>
<span id="cb250-27"><a href="#cb250-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">26</span>)  <span class="co"># ← title font size</span></span>
<span id="cb250-28"><a href="#cb250-28" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb250-29"><a href="#cb250-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapbox =</span> <span class="fu">list</span>(</span>
<span id="cb250-30"><a href="#cb250-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="st">"open-street-map"</span>, <span class="at">zoom =</span> <span class="dv">10</span>,</span>
<span id="cb250-31"><a href="#cb250-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">center =</span> <span class="fu">list</span>(</span>
<span id="cb250-32"><a href="#cb250-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">lat =</span> <span class="fu">median</span>(airdata_summary<span class="sc">$</span>latitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb250-33"><a href="#cb250-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">lon =</span> <span class="fu">median</span>(airdata_summary<span class="sc">$</span>longitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb250-34"><a href="#cb250-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb250-35"><a href="#cb250-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-36"><a href="#cb250-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the interactive map</span></span>
<span id="cb250-37"><a href="#cb250-37" aria-hidden="true" tabindex="-1"></a>sa2_auckland_per_capita</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-304bb7dd29b53d76c60e" style="width:100%;height:260px;"></div>
<script type="application/json" data-for="htmlwidget-304bb7dd29b53d76c60e">{"x":{"visdat":{"2b84ae38a3":["function () ","plotlyVisDat"]},"cur_data":"2b84ae38a3","attrs":{"2b84ae38a3":{"mode":"markers","lat":{},"lon":{},"showlegend":false,"text":{},"marker":{"size":20,"color":{},"colorscale":"Viridis","opacity":1,"showscale":true,"colorbar":{"title":"Per Capita Conc. (µg/m³/person)","x":0.94999999999999996,"xanchor":"left","len":0.75}},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scattermapbox"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":{"text":["<b>SA2:<\/b> Ellerslie South <br><b>Total Concentration:<\/b> 57527 µg/m³ <br><b>Per Capita:<\/b> 2114.95 µg/m³/person","<b>SA2:<\/b> Glen Eden Central <br><b>Total Concentration:<\/b> 35021 µg/m³ <br><b>Per Capita:<\/b> 924.04 µg/m³/person","<b>SA2:<\/b> Henderson Lincoln South <br><b>Total Concentration:<\/b> 34102 µg/m³ <br><b>Per Capita:<\/b> 1263.02 µg/m³/person","<b>SA2:<\/b> Puni <br><b>Total Concentration:<\/b> 45549 µg/m³ <br><b>Per Capita:<\/b> 2760.53 µg/m³/person","<b>SA2:<\/b> Queen Street <br><b>Total Concentration:<\/b> 55926 µg/m³ <br><b>Per Capita:<\/b> 2292.04 µg/m³/person","<b>SA2:<\/b> Sunnyhills East <br><b>Total Concentration:<\/b> 36121 µg/m³ <br><b>Per Capita:<\/b> 1008.97 µg/m³/person","<b>SA2:<\/b> Westlake <br><b>Total Concentration:<\/b> 53903 µg/m³ <br><b>Per Capita:<\/b> 1727.67 µg/m³/person"],"x":0.5,"font":{"size":26}},"mapbox":{"style":"open-street-map","zoom":10,"center":{"lat":-36.904558461006303,"lon":174.76570000000001}},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"mode":"markers","lat":[-36.904558461006303,-36.922142811073002,-36.8680004511356,-37.204503610808089,-36.847430000000003,-36.905483750710502,-36.780305250869901],"lon":[174.815563500351,174.6520009000113,174.6284,174.86401940002824,174.76570000000001,174.8904,174.74890449976101],"showlegend":false,"text":["SA2: Ellerslie South<br>Site Concentration: 57526.8 µg/m³<br>Per Capita: 2114.95 µg/m³/person","SA2: Glen Eden Central<br>Site Concentration: 35021.2 µg/m³<br>Per Capita: 924.04 µg/m³/person","SA2: Henderson Lincoln South<br>Site Concentration: 34101.5 µg/m³<br>Per Capita: 1263.02 µg/m³/person","SA2: Puni<br>Site Concentration: 45548.7 µg/m³<br>Per Capita: 2760.53 µg/m³/person","SA2: Queen Street<br>Site Concentration: 55925.9 µg/m³<br>Per Capita: 2292.04 µg/m³/person","SA2: Sunnyhills East<br>Site Concentration: 36121.1 µg/m³<br>Per Capita: 1008.97 µg/m³/person","SA2: Westlake<br>Site Concentration: 53903.4 µg/m³<br>Per Capita: 1727.67 µg/m³/person"],"marker":{"color":[2114.9542647058825,924.04274406332456,1263.02,2760.5264242424246,2292.0437704918031,1008.9686871508379,1727.6718910256409],"size":20,"colorscale":"Viridis","opacity":1,"showscale":true,"colorbar":{"title":"Per Capita Conc. (µg/m³/person)","x":0.94999999999999996,"xanchor":"left","len":0.75},"line":{"color":"rgba(31,119,180,1)"}},"type":"scattermapbox","line":{"color":"rgba(31,119,180,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save map as a self-contained HTML widget</span></span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>htmlwidgets<span class="sc">::</span><span class="fu">saveWidget</span>(sa2_auckland_per_capita, <span class="st">"dist.html"</span>, <span class="at">selfcontained =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The interactive map reveals spatial disparities in air quality across Auckland SA2 areas from 2016 to 2023. Puni consistently exhibits the highest particulate matter concentrations, indicating significant localized pollution sources. Glen Eden Central, Sunnyhills East, and Henderson Lincoln South show notably low levels, suggesting relatively clean air. Queen Street, Ellerslie South, and Westlake maintain moderate concentrations, likely reflecting persistent but stable urban emissions over time.</p>
<section id="integrating-and-enriching-air-quality-data-across-auckland-sa2-areas" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="integrating-and-enriching-air-quality-data-across-auckland-sa2-areas"><span class="header-section-number">5.1</span> Integrating and Enriching Air Quality Data Across Auckland SA2 Areas</h3>
<p>This section consolidates Air Quality Index (AQI) and key pollutant readings—including NO2, NO, PM10, and PM2.5—across multiple SA2 regions in Auckland. A reusable function is defined to prepare pollutant-specific datasets, which are then systematically merged with the main air quality dataset by date and SA2 name. This process results in a comprehensive, temporally aligned dataset suitable for spatial and temporal air quality analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>prepare_pollutant_data <span class="ot">&lt;-</span> <span class="cf">function</span>(file_path, column_name, <span class="at">start_date =</span> <span class="st">"2016-01-01"</span>, <span class="at">end_date =</span> <span class="st">"2024-12-31"</span>) {</span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read CSV</span></span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb252-5"><a href="#cb252-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename columns</span></span>
<span id="cb252-6"><a href="#cb252-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"date"</span>, column_name)</span>
<span id="cb252-7"><a href="#cb252-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb252-8"><a href="#cb252-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove first row (header row re-imported as data)</span></span>
<span id="cb252-9"><a href="#cb252-9" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df[<span class="sc">-</span><span class="dv">1</span>, ]</span>
<span id="cb252-10"><a href="#cb252-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb252-11"><a href="#cb252-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert columns</span></span>
<span id="cb252-12"><a href="#cb252-12" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb252-13"><a href="#cb252-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb252-14"><a href="#cb252-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb252-15"><a href="#cb252-15" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!!</span><span class="fu">sym</span>(column_name) <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(.data[[column_name]])</span>
<span id="cb252-16"><a href="#cb252-16" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb252-17"><a href="#cb252-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb252-18"><a href="#cb252-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter by date range</span></span>
<span id="cb252-19"><a href="#cb252-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(start_date), date <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(end_date)) <span class="sc">|&gt;</span></span>
<span id="cb252-20"><a href="#cb252-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb252-21"><a href="#cb252-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by date and sum the specified column</span></span>
<span id="cb252-22"><a href="#cb252-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb252-23"><a href="#cb252-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="sc">!!</span><span class="fu">sym</span>(column_name) <span class="sc">:</span><span class="er">=</span> <span class="fu">sum</span>(.data[[column_name]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb252-24"><a href="#cb252-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb252-25"><a href="#cb252-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb252-26"><a href="#cb252-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using pivot_wider() function to extract wide form of indicator</span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>airdata_with_sa2 <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> indicator,</span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> concentration</span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb253-7"><a href="#cb253-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-8"><a href="#cb253-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a glimpse</span></span>
<span id="cb253-9"><a href="#cb253-9" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata_with_sa2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 19,338
Columns: 10
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Residenti…
$ date      &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01-05,…
$ year      &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2016", "201…
$ geometry  &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -36.92214), …
$ sa2_name  &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Eden Central…
$ pop2018   &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, …
$ longitude &lt;dbl&gt; 174.652, 174.652, 174.652, 174.652, 174.652, 174.652, 174.65…
$ latitude  &lt;dbl&gt; -36.92214, -36.92214, -36.92214, -36.92214, -36.92214, -36.9…
$ PM10      &lt;dbl&gt; 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2, 10.6, 15…
$ PM2.5     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove PM10, and PM2.5 columns</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a>airdata_with_sa2 <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>PM10, <span class="sc">-</span>PM2<span class="fl">.5</span>)</span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a glimpse</span></span>
<span id="cb255-6"><a href="#cb255-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata_with_sa2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 19,338
Columns: 8
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Residenti…
$ date      &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01-05,…
$ year      &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2016", "201…
$ geometry  &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -36.92214), …
$ sa2_name  &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Eden Central…
$ pop2018   &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, …
$ longitude &lt;dbl&gt; 174.652, 174.652, 174.652, 174.652, 174.652, 174.652, 174.65…
$ latitude  &lt;dbl&gt; -36.92214, -36.92214, -36.92214, -36.92214, -36.92214, -36.9…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Quality Index - Henderson</span></span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>aqi_henderson <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/henderson/aqi-henderson/DataSetExport-AQI.Air Quality Index (AQI) - Unverified@5-Instantaneous-AQI-20250522060037.csv"</span>, <span class="st">"AQI"</span>)</span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Quality Index - Pakuranga</span></span>
<span id="cb257-5"><a href="#cb257-5" aria-hidden="true" tabindex="-1"></a>aqi_pakuranga <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/pakuranga/aqi-pakuranga/DataSetExport-AQI.Air Quality Index (AQI) - Unverified@1-Instantaneous-AQI-20250522055337.csv"</span>, <span class="st">"AQI"</span>)</span>
<span id="cb257-6"><a href="#cb257-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-7"><a href="#cb257-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Quality Index - Glen Eden</span></span>
<span id="cb257-8"><a href="#cb257-8" aria-hidden="true" tabindex="-1"></a>aqi_gleneden <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/gleneden/aqi-gleneden/DataSetExport-AQI.Air Quality Index (AQI) - Unverified@67-Instantaneous-AQI-20250522053925.csv"</span>, <span class="st">"AQI"</span>)</span>
<span id="cb257-9"><a href="#cb257-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-10"><a href="#cb257-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Quality Index - Patumahoe</span></span>
<span id="cb257-11"><a href="#cb257-11" aria-hidden="true" tabindex="-1"></a>aqi_patumahoe <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/patumahoe/aqi-patumahoe/DataSetExport-AQI.Air Quality Index (AQI) - Unverified@2-Maximum-AQI-20250412191546.csv"</span>, <span class="st">"AQI"</span>)</span>
<span id="cb257-12"><a href="#cb257-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-13"><a href="#cb257-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Quality Index - Takapuna</span></span>
<span id="cb257-14"><a href="#cb257-14" aria-hidden="true" tabindex="-1"></a>aqi_takapuna <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/takapuna/aqi-takapuna/DataSetExport-AQI.Air Quality Index (AQI) - Unverified@23-Instantaneous-AQI-20250513132258.csv"</span>, <span class="st">"AQI"</span>)</span>
<span id="cb257-15"><a href="#cb257-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-16"><a href="#cb257-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Quality Index - Penrose</span></span>
<span id="cb257-17"><a href="#cb257-17" aria-hidden="true" tabindex="-1"></a>aqi_penrose <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/penrose/aqi-penrose/DataSetExport-AQI.Air Quality Index (AQI) - Unverified@23-Instantaneous-AQI-20250513132258.csv"</span>, <span class="st">"AQI"</span>)</span>
<span id="cb257-18"><a href="#cb257-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-19"><a href="#cb257-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Quality Index - Queen Street</span></span>
<span id="cb257-20"><a href="#cb257-20" aria-hidden="true" tabindex="-1"></a>aqi_queenstreet <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/queenstreet/aqi-queenstreet/DataSetExport-AQI.Air Quality Index (AQI) - Unverified@9-Maximum-AQI-20250412201809.csv"</span>, <span class="st">"AQI"</span>)</span>
<span id="cb257-21"><a href="#cb257-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-22"><a href="#cb257-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind rows of air quality index</span></span>
<span id="cb257-23"><a href="#cb257-23" aria-hidden="true" tabindex="-1"></a>bind_pollutant_data <span class="ot">&lt;-</span> <span class="cf">function</span>(data_list, sa2_names) {</span>
<span id="cb257-24"><a href="#cb257-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(data_list) <span class="ot">&lt;-</span> sa2_names</span>
<span id="cb257-25"><a href="#cb257-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(data_list, <span class="at">.id =</span> <span class="st">"sa2_name"</span>)</span>
<span id="cb257-26"><a href="#cb257-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb257-27"><a href="#cb257-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-28"><a href="#cb257-28" aria-hidden="true" tabindex="-1"></a>aqi_combined <span class="ot">&lt;-</span> <span class="fu">bind_pollutant_data</span>(</span>
<span id="cb257-29"><a href="#cb257-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(aqi_henderson, aqi_pakuranga, aqi_gleneden, aqi_patumahoe, aqi_takapuna, aqi_penrose, aqi_queenstreet),</span>
<span id="cb257-30"><a href="#cb257-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>, <span class="st">"Glen Eden Central"</span>, <span class="st">"Puni"</span>, <span class="st">"Westlake"</span>, <span class="st">"Ellerslie South"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb257-31"><a href="#cb257-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-32"><a href="#cb257-32" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(aqi_combined)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 19,057
Columns: 3
$ sa2_name &lt;chr&gt; "Henderson Lincoln South", "Henderson Lincoln South", "Hender…
$ date     &lt;date&gt; 2016-02-01, 2016-02-02, 2016-02-03, 2016-02-04, 2016-02-05, …
$ AQI      &lt;dbl&gt; 197, 575, 579, 487, 156, 85, 520, 721, 594, 676, 263, 151, 63…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join by matching rows where both date and sa2_name are same </span></span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a>merged_airdata <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(aqi_combined, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span> <span class="ot">=</span> <span class="st">"date"</span>, <span class="st">"sa2_name"</span> <span class="ot">=</span> <span class="st">"sa2_name"</span>)) </span>
<span id="cb259-4"><a href="#cb259-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-5"><a href="#cb259-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a glimpse</span></span>
<span id="cb259-6"><a href="#cb259-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(merged_airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 19,338
Columns: 9
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Residenti…
$ date      &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01-05,…
$ year      &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2016", "201…
$ geometry  &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -36.92214), …
$ sa2_name  &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Eden Central…
$ pop2018   &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, …
$ longitude &lt;dbl&gt; 174.652, 174.652, 174.652, 174.652, 174.652, 174.652, 174.65…
$ latitude  &lt;dbl&gt; -36.92214, -36.92214, -36.92214, -36.92214, -36.92214, -36.9…
$ AQI       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitrogen Oxide (NO2) - Henderson</span></span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>no2_henderson <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/henderson/no2-henderson/DataSetExport-NO2.24-Hour Aggregate (╡g m│)@5-Instantaneous-ug m^3-20250522063804.csv"</span>, <span class="st">"NO2"</span>)</span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitrogen Oxide (NO2) - Glen Eden</span></span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a>no2_gleneden <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/gleneden/no2-gleneden/DataSetExport-NO2.24-Hour Aggregate (╡g m│)@67-Instantaneous-ug m^3-20250522064657.csv"</span>, <span class="st">"NO2"</span>)</span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-7"><a href="#cb261-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitrogen Oxide (NO2) - Patumahoe</span></span>
<span id="cb261-8"><a href="#cb261-8" aria-hidden="true" tabindex="-1"></a>no2_patumahoe <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/patumahoe/no2-patumahoe/DataSetExport-NO2.24-Hour Aggregate (╡g m│)@2-Maximum-ug m^3-20250417183335.csv"</span>, <span class="st">"NO2"</span>)</span>
<span id="cb261-9"><a href="#cb261-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-10"><a href="#cb261-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitrogen Oxide (NO2) - Takapuna</span></span>
<span id="cb261-11"><a href="#cb261-11" aria-hidden="true" tabindex="-1"></a>no2_takapuna <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/takapuna/no2-takapuna/DataSetExport-NO2.24-Hour Aggregate (╡g m│)@23-Instantaneous-ug m^3-20250513123549.csv"</span>, <span class="st">"NO2"</span>)</span>
<span id="cb261-12"><a href="#cb261-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-13"><a href="#cb261-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitrogen Oxide (NO2) - Penrose</span></span>
<span id="cb261-14"><a href="#cb261-14" aria-hidden="true" tabindex="-1"></a>no2_penrose <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/penrose/no2-penrose/DataSetExport-NO2.24-Hour Aggregate (╡g m│)@7-Instantaneous-ug m^3-20250514220927.csv"</span>, <span class="st">"NO2"</span>)</span>
<span id="cb261-15"><a href="#cb261-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-16"><a href="#cb261-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitrogen Oxide (NO2) - Queen Street</span></span>
<span id="cb261-17"><a href="#cb261-17" aria-hidden="true" tabindex="-1"></a>no2_queenstreet <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/queenstreet/no2-queenstreet/DataSetExport-NO2.24-Hour Aggregate (╡g m│)@9-Maximum-ug m^3-20250417181653.csv"</span>, <span class="st">"NO2"</span>)</span>
<span id="cb261-18"><a href="#cb261-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-19"><a href="#cb261-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind Rows of Nitrogen Dioxide (NO2)</span></span>
<span id="cb261-20"><a href="#cb261-20" aria-hidden="true" tabindex="-1"></a>no2_combined <span class="ot">&lt;-</span> <span class="fu">bind_pollutant_data</span>(</span>
<span id="cb261-21"><a href="#cb261-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(no2_henderson, no2_gleneden, no2_patumahoe, no2_takapuna, no2_penrose, no2_queenstreet),</span>
<span id="cb261-22"><a href="#cb261-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Henderson Lincoln South"</span>, <span class="st">"Glen Eden Central"</span>, <span class="st">"Puni"</span>, <span class="st">"Westlake"</span>, <span class="st">"Ellerslie South"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb261-23"><a href="#cb261-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-24"><a href="#cb261-24" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(no2_combined)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 16,062
Columns: 3
$ sa2_name &lt;chr&gt; "Henderson Lincoln South", "Henderson Lincoln South", "Hender…
$ date     &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01-05, …
$ NO2      &lt;dbl&gt; 6.6, 3.3, 2.9, 1.8, 3.9, 7.8, 7.9, 5.4, 7.1, 2.4, 1.2, 7.9, 9…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join by matching rows where both date and sa2_name are same </span></span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>merged_airdata <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(no2_combined, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span> <span class="ot">=</span> <span class="st">"date"</span>, <span class="st">"sa2_name"</span> <span class="ot">=</span> <span class="st">"sa2_name"</span>)) </span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a glimpse</span></span>
<span id="cb263-6"><a href="#cb263-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(merged_airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 19,338
Columns: 10
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Residenti…
$ date      &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01-05,…
$ year      &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2016", "201…
$ geometry  &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -36.92214), …
$ sa2_name  &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Eden Central…
$ pop2018   &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, …
$ longitude &lt;dbl&gt; 174.652, 174.652, 174.652, 174.652, 174.652, 174.652, 174.65…
$ latitude  &lt;dbl&gt; -36.92214, -36.92214, -36.92214, -36.92214, -36.92214, -36.9…
$ AQI       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ NO2       &lt;dbl&gt; 3.4, 2.0, 3.8, 1.3, 2.5, 4.2, 4.5, 2.7, 4.1, 0.6, 0.4, 3.0, …</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitric Oxide (NO) - Henderson</span></span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a>no_henderson <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/henderson/no-henderson/DataSetExport-NO.24-Hour Aggregate (╡g m│)@5-Instantaneous-ug m^3-20250522071408.csv"</span>, <span class="st">"NO"</span>)</span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-4"><a href="#cb265-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitric Oxide (NO) - Glen Eden</span></span>
<span id="cb265-5"><a href="#cb265-5" aria-hidden="true" tabindex="-1"></a>no_gleneden <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/gleneden/no-gleneden/DataSetExport-NO.24-Hour Aggregate (╡g m│)@67-Instantaneous-ug m^3-20250522071648.csv"</span>, <span class="st">"NO"</span>)</span>
<span id="cb265-6"><a href="#cb265-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-7"><a href="#cb265-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitric Oxide (NO) - Patumahoe</span></span>
<span id="cb265-8"><a href="#cb265-8" aria-hidden="true" tabindex="-1"></a>no_patumahoe <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/patumahoe/no-patumahoe/DataSetExport-NO.24-Hour Aggregate (╡g m│)@2-Maximum-ug m^3-20250417183303.csv"</span>, <span class="st">"NO"</span>)</span>
<span id="cb265-9"><a href="#cb265-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-10"><a href="#cb265-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitric Oxide (NO) - Takapuna</span></span>
<span id="cb265-11"><a href="#cb265-11" aria-hidden="true" tabindex="-1"></a>no_takapuna <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/takapuna/no-takapuna/DataSetExport-NO.24-Hour Aggregate (╡g m│)@23-Instantaneous-ug m^3-20250517231409.csv"</span>, <span class="st">"NO"</span>)</span>
<span id="cb265-12"><a href="#cb265-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-13"><a href="#cb265-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitric Oxide (NO) - Penrose</span></span>
<span id="cb265-14"><a href="#cb265-14" aria-hidden="true" tabindex="-1"></a>no_penrose <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/penrose/no-penrose/DataSetExport-NO.24-Hour Aggregate (╡g m│)@7-Instantaneous-ug m^3-20250517231058.csv"</span>, <span class="st">"NO"</span>)</span>
<span id="cb265-15"><a href="#cb265-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-16"><a href="#cb265-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitrogen Oxide (NO) - Queen Street</span></span>
<span id="cb265-17"><a href="#cb265-17" aria-hidden="true" tabindex="-1"></a>no_queenstreet <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/queenstreet/no-queenstreet/DataSetExport-NO.24-Hour Aggregate (╡g m│)@9-Instantaneous-ug m^3-20250430044717.csv"</span>, <span class="st">"NO"</span>)</span>
<span id="cb265-18"><a href="#cb265-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-19"><a href="#cb265-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind Rows of NO dataframes</span></span>
<span id="cb265-20"><a href="#cb265-20" aria-hidden="true" tabindex="-1"></a>no_combined <span class="ot">&lt;-</span> <span class="fu">bind_pollutant_data</span>(</span>
<span id="cb265-21"><a href="#cb265-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(no_henderson, no_gleneden, no_patumahoe, no_takapuna, no_penrose, no_queenstreet),</span>
<span id="cb265-22"><a href="#cb265-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Henderson Lincoln South"</span>, <span class="st">"Glen Eden Central"</span>, <span class="st">"Puni"</span>, <span class="st">"Westlake"</span>, <span class="st">"Ellerslie South"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb265-23"><a href="#cb265-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-24"><a href="#cb265-24" aria-hidden="true" tabindex="-1"></a>no_combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="st">`</span><span class="at">Henderson Lincoln South</span><span class="st">`</span> <span class="ot">=</span> no_henderson, <span class="st">`</span><span class="at">Glen Eden Central</span><span class="st">`</span> <span class="ot">=</span> no_gleneden, <span class="at">Puni =</span> no_patumahoe, <span class="at">Westlake =</span> no_takapuna, <span class="st">`</span><span class="at">Ellerslie South</span><span class="st">`</span> <span class="ot">=</span> no_penrose, <span class="st">`</span><span class="at">Queen Street</span><span class="st">`</span> <span class="ot">=</span> no_queenstreet, <span class="at">.id =</span> <span class="st">"sa2_name"</span>)</span>
<span id="cb265-25"><a href="#cb265-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-26"><a href="#cb265-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join by matching rows where both date and sa2_name are same </span></span>
<span id="cb265-27"><a href="#cb265-27" aria-hidden="true" tabindex="-1"></a>merged_airdata <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb265-28"><a href="#cb265-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(no_combined, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span> <span class="ot">=</span> <span class="st">"date"</span>, <span class="st">"sa2_name"</span> <span class="ot">=</span> <span class="st">"sa2_name"</span>)) </span>
<span id="cb265-29"><a href="#cb265-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-30"><a href="#cb265-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a glimpse</span></span>
<span id="cb265-31"><a href="#cb265-31" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(merged_airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 19,338
Columns: 11
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Residenti…
$ date      &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01-05,…
$ year      &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2016", "201…
$ geometry  &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -36.92214), …
$ sa2_name  &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Eden Central…
$ pop2018   &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, …
$ longitude &lt;dbl&gt; 174.652, 174.652, 174.652, 174.652, 174.652, 174.652, 174.65…
$ latitude  &lt;dbl&gt; -36.92214, -36.92214, -36.92214, -36.92214, -36.92214, -36.9…
$ AQI       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ NO2       &lt;dbl&gt; 3.4, 2.0, 3.8, 1.3, 2.5, 4.2, 4.5, 2.7, 4.1, 0.6, 0.4, 3.0, …
$ NO        &lt;dbl&gt; 1.9, 0.4, 0.7, 0.4, 0.8, 1.5, 2.5, 0.8, 1.4, 0.3, 0.3, 1.2, …</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Particulate Matter 10 (PM10) - Henderson</span></span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a>pm10_henderson <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/henderson/pm10-henderson/DataSetExport-PM10.24-Hour Aggregate (╡g m│)@5-Instantaneous-ug m^3-20250522072915.csv"</span>, <span class="st">"PM10"</span>)</span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-4"><a href="#cb267-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Particulate Matter 10 (PM10) - Pakuranga</span></span>
<span id="cb267-5"><a href="#cb267-5" aria-hidden="true" tabindex="-1"></a>pm10_pakuranga <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/pakuranga/pm10-pakuranga/DataSetExport-PM10.24-Hour Aggregate (╡g m│)@1-Instantaneous-ug m^3-20250522073103.csv"</span>, <span class="st">"PM10"</span>)</span>
<span id="cb267-6"><a href="#cb267-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-7"><a href="#cb267-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Particulate Matter 10 (PM10) - Glen Eden</span></span>
<span id="cb267-8"><a href="#cb267-8" aria-hidden="true" tabindex="-1"></a>pm10_gleneden <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/gleneden/pm10-gleneden/DataSetExport-PM10.24-Hour Aggregate (╡g m│)@67-Instantaneous-ug m^3-20250522073329.csv"</span>, <span class="st">"PM10"</span>)</span>
<span id="cb267-9"><a href="#cb267-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-10"><a href="#cb267-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Particulate Matter 10 (PM10) - Patumahoe</span></span>
<span id="cb267-11"><a href="#cb267-11" aria-hidden="true" tabindex="-1"></a>pm10_patumahoe <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/patumahoe/pm10-patumahoe/DataSetExport-PM10.24-Hour Aggregate (╡g m│)@2-Maximum-ug m^3-20250417183456.csv"</span>, <span class="st">"PM10"</span>)</span>
<span id="cb267-12"><a href="#cb267-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-13"><a href="#cb267-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Particulate Matter 10 (PM10) - Takapuna</span></span>
<span id="cb267-14"><a href="#cb267-14" aria-hidden="true" tabindex="-1"></a>pm10_takapuna <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/takapuna/pm10-takapuna/DataSetExport-PM10.24-Hour Aggregate (╡g m│)@23-Instantaneous-ug m^3-20250515001633.csv"</span>, <span class="st">"PM10"</span>)</span>
<span id="cb267-15"><a href="#cb267-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-16"><a href="#cb267-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Particulate Matter 10 (PM10) - Penrose</span></span>
<span id="cb267-17"><a href="#cb267-17" aria-hidden="true" tabindex="-1"></a>pm10_penrose <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/penrose/pm10-penrose/DataSetExport-PM10.24-Hour Aggregate (╡g m│)@7-Instantaneous-ug m^3-20250515001754.csv"</span>, <span class="st">"PM10"</span>)</span>
<span id="cb267-18"><a href="#cb267-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-19"><a href="#cb267-19" aria-hidden="true" tabindex="-1"></a>pm10_queenstreet <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/queenstreet/pm10-queenstreet/DataSetExport-PM10.24-Hour Aggregate (╡g m│) - Unverified@9-Maximum-ug m^3-20250417181740.csv"</span>, <span class="st">"PM10"</span>)</span>
<span id="cb267-20"><a href="#cb267-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-21"><a href="#cb267-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind Rows of PM10 dataframes</span></span>
<span id="cb267-22"><a href="#cb267-22" aria-hidden="true" tabindex="-1"></a>pm10_combined <span class="ot">&lt;-</span> <span class="fu">bind_pollutant_data</span>(</span>
<span id="cb267-23"><a href="#cb267-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(pm10_henderson, pm10_pakuranga, pm10_gleneden, pm10_patumahoe, pm10_takapuna, pm10_penrose, pm10_queenstreet),</span>
<span id="cb267-24"><a href="#cb267-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>, <span class="st">"Glen Eden Central"</span>, <span class="st">"Puni"</span>, <span class="st">"Westlake"</span>, <span class="st">"Ellerslie South"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb267-25"><a href="#cb267-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-26"><a href="#cb267-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join ny matching rows where both date and sa2_name are same </span></span>
<span id="cb267-27"><a href="#cb267-27" aria-hidden="true" tabindex="-1"></a>merged_airdata <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb267-28"><a href="#cb267-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pm10_combined, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span> <span class="ot">=</span> <span class="st">"date"</span>, <span class="st">"sa2_name"</span> <span class="ot">=</span> <span class="st">"sa2_name"</span>)) </span>
<span id="cb267-29"><a href="#cb267-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-30"><a href="#cb267-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a glimpse</span></span>
<span id="cb267-31"><a href="#cb267-31" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(merged_airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 19,338
Columns: 12
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Residenti…
$ date      &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01-05,…
$ year      &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2016", "201…
$ geometry  &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -36.92214), …
$ sa2_name  &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Eden Central…
$ pop2018   &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, …
$ longitude &lt;dbl&gt; 174.652, 174.652, 174.652, 174.652, 174.652, 174.652, 174.65…
$ latitude  &lt;dbl&gt; -36.92214, -36.92214, -36.92214, -36.92214, -36.92214, -36.9…
$ AQI       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ NO2       &lt;dbl&gt; 3.4, 2.0, 3.8, 1.3, 2.5, 4.2, 4.5, 2.7, 4.1, 0.6, 0.4, 3.0, …
$ NO        &lt;dbl&gt; 1.9, 0.4, 0.7, 0.4, 0.8, 1.5, 2.5, 0.8, 1.4, 0.3, 0.3, 1.2, …
$ PM10      &lt;dbl&gt; 11.4, 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2, 10…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Particulate Matter 2.5 (PM2.5) - Patumahoe</span></span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a>pm2<span class="fl">.5</span>_patumahoe <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/patumahoe/pm2.5-patumahoe/DataSetExport-PM2,5.24-Hour Aggregate (╡g m│)@2-Maximum-ug m^3-20250417183512.csv"</span>, <span class="st">"PM2.5"</span>)</span>
<span id="cb269-3"><a href="#cb269-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-4"><a href="#cb269-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Particulate Matter 2.5 (PM2.5) - Takapuna</span></span>
<span id="cb269-5"><a href="#cb269-5" aria-hidden="true" tabindex="-1"></a>pm2<span class="fl">.5</span>_takapuna <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/takapuna/pm2.5-takapuna/DataSetExport-PM2,5.24-Hour Aggregate (╡g m│)@23-Instantaneous-ug m^3-20250515010302.csv"</span>, <span class="st">"PM2.5"</span>)</span>
<span id="cb269-6"><a href="#cb269-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-7"><a href="#cb269-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Particulate Matter 2.5 (PM2.5) - Penrose</span></span>
<span id="cb269-8"><a href="#cb269-8" aria-hidden="true" tabindex="-1"></a>pm2<span class="fl">.5</span>_penrose <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/penrose/pm2.5-penrose/DataSetExport-PM2,5.24-Hour Aggregate (╡g m│)@7-Instantaneous-ug m^3-20250515010122.csv"</span>, <span class="st">"PM2.5"</span>)</span>
<span id="cb269-9"><a href="#cb269-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-10"><a href="#cb269-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Particulate Matter 2.5 (PM2.5) - Queen Street</span></span>
<span id="cb269-11"><a href="#cb269-11" aria-hidden="true" tabindex="-1"></a>pm2<span class="fl">.5</span>_queenstreet <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/queenstreet/pm2.5-queenstreet/DataSetExport-PM2,5.24-Hour Aggregate (╡g m│) - Unverified@9-Maximum-ug m^3-20250417181802.csv"</span>, <span class="st">"PM2.5"</span>)</span>
<span id="cb269-12"><a href="#cb269-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-13"><a href="#cb269-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind Rows of PM2.5 dataframes</span></span>
<span id="cb269-14"><a href="#cb269-14" aria-hidden="true" tabindex="-1"></a>pm2<span class="fl">.5</span>_combined <span class="ot">&lt;-</span> <span class="fu">bind_pollutant_data</span>(</span>
<span id="cb269-15"><a href="#cb269-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(pm2<span class="fl">.5</span>_patumahoe, pm2<span class="fl">.5</span>_takapuna, pm2<span class="fl">.5</span>_penrose, pm2<span class="fl">.5</span>_queenstreet),</span>
<span id="cb269-16"><a href="#cb269-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Westlake"</span>, <span class="st">"Ellerslie South"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb269-17"><a href="#cb269-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-18"><a href="#cb269-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join by matching rows where both date and sa2_name are same</span></span>
<span id="cb269-19"><a href="#cb269-19" aria-hidden="true" tabindex="-1"></a>merged_airdata <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb269-20"><a href="#cb269-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pm2<span class="fl">.5</span>_combined, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span> <span class="ot">=</span> <span class="st">"date"</span>, <span class="st">"sa2_name"</span> <span class="ot">=</span> <span class="st">"sa2_name"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Sulphur Dioxide (SO2) - Penrose</span></span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a>so2_penrose <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/penrose/so2-penrose/DataSetExport-SO2.24-Hour Aggregate (╡g m│)@7-Instantaneous-ug m^3-20250514230023.csv"</span>, <span class="st">"SO2"</span>)</span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-4"><a href="#cb270-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind Rows of SO2</span></span>
<span id="cb270-5"><a href="#cb270-5" aria-hidden="true" tabindex="-1"></a>so2_combined <span class="ot">&lt;-</span> <span class="fu">bind_pollutant_data</span>(</span>
<span id="cb270-6"><a href="#cb270-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(so2_penrose),</span>
<span id="cb270-7"><a href="#cb270-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Ellerslie South"</span>))</span>
<span id="cb270-8"><a href="#cb270-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-9"><a href="#cb270-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join by matching rows where both date and sa2_name are same</span></span>
<span id="cb270-10"><a href="#cb270-10" aria-hidden="true" tabindex="-1"></a>merged_airdata <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb270-11"><a href="#cb270-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(so2_combined, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span> <span class="ot">=</span> <span class="st">"date"</span>, <span class="st">"sa2_name"</span> <span class="ot">=</span> <span class="st">"sa2_name"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Temperature - Henderson</span></span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a>airtemp_henderson <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/henderson/airtemp-henderson/DataSetExport-Air Temp.24-Hour Aggregate (░C)@5-Instantaneous-degC-20250522081344.csv"</span>, <span class="st">"AirTemp"</span>)</span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-4"><a href="#cb271-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Temperature - Pakuranga</span></span>
<span id="cb271-5"><a href="#cb271-5" aria-hidden="true" tabindex="-1"></a>airtemp_pakuranga <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/pakuranga/airtemp-pakuranga/DataSetExport-Air Temp.24-Hour Aggregate (░C)@1-Instantaneous-degC-20250522082128.csv"</span>, <span class="st">"AirTemp"</span>)</span>
<span id="cb271-6"><a href="#cb271-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-7"><a href="#cb271-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Temperature - Glen Eden</span></span>
<span id="cb271-8"><a href="#cb271-8" aria-hidden="true" tabindex="-1"></a>airtemp_gleneden <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/gleneden/airtemp-gleneden/DataSetExport-Air Temp.24-Hour Aggregate (░C)@67-Instantaneous-degC-20250522082803.csv"</span>, <span class="st">"AirTemp"</span>)</span>
<span id="cb271-9"><a href="#cb271-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-10"><a href="#cb271-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Temperature - Takapuna</span></span>
<span id="cb271-11"><a href="#cb271-11" aria-hidden="true" tabindex="-1"></a>airtemp_takapuna <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/takapuna/airtemp-takapuna/DataSetExport-Air Temp.24-Hour Aggregate (░C)@23-Instantaneous-degC-20250514062829.csv"</span>, <span class="st">"AirTemp"</span>)</span>
<span id="cb271-12"><a href="#cb271-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-13"><a href="#cb271-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Temperature - Penrose</span></span>
<span id="cb271-14"><a href="#cb271-14" aria-hidden="true" tabindex="-1"></a>airtemp_penrose <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/penrose/airtemp-penrose/DataSetExport-Air Temp.24-Hour Aggregate (░C)@7-Instantaneous-degC-20250514064042.csv"</span>, <span class="st">"AirTemp"</span>)</span>
<span id="cb271-15"><a href="#cb271-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-16"><a href="#cb271-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Temperature - Queen Street</span></span>
<span id="cb271-17"><a href="#cb271-17" aria-hidden="true" tabindex="-1"></a>airtemp_queenstreet <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/queenstreet/airtemp-queenstreet/DataSetExport-Air Temp.24-Hour Aggregate (░C)@9-Maximum-degC-20250417181451.csv"</span>, <span class="st">"AirTemp"</span>)</span>
<span id="cb271-18"><a href="#cb271-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-19"><a href="#cb271-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind rows</span></span>
<span id="cb271-20"><a href="#cb271-20" aria-hidden="true" tabindex="-1"></a>airtemp_combined <span class="ot">&lt;-</span> <span class="fu">bind_pollutant_data</span>(</span>
<span id="cb271-21"><a href="#cb271-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(airtemp_henderson, airtemp_pakuranga, airtemp_gleneden, airtemp_takapuna, airtemp_penrose, airtemp_queenstreet),</span>
<span id="cb271-22"><a href="#cb271-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>, <span class="st">"Glen Eden Central"</span>, <span class="st">"Westlake"</span>, <span class="st">"Ellerslie South"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb271-23"><a href="#cb271-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-24"><a href="#cb271-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join by matching rows where both date and sa2_name are same </span></span>
<span id="cb271-25"><a href="#cb271-25" aria-hidden="true" tabindex="-1"></a>merged_airdata <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb271-26"><a href="#cb271-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(airtemp_combined, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span> <span class="ot">=</span> <span class="st">"date"</span>, <span class="st">"sa2_name"</span> <span class="ot">=</span> <span class="st">"sa2_name"</span>)) </span>
<span id="cb271-27"><a href="#cb271-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-28"><a href="#cb271-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a glimpse</span></span>
<span id="cb271-29"><a href="#cb271-29" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(merged_airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 19,338
Columns: 15
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Residenti…
$ date      &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01-05,…
$ year      &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2016", "201…
$ geometry  &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -36.92214), …
$ sa2_name  &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Eden Central…
$ pop2018   &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, …
$ longitude &lt;dbl&gt; 174.652, 174.652, 174.652, 174.652, 174.652, 174.652, 174.65…
$ latitude  &lt;dbl&gt; -36.92214, -36.92214, -36.92214, -36.92214, -36.92214, -36.9…
$ AQI       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ NO2       &lt;dbl&gt; 3.4, 2.0, 3.8, 1.3, 2.5, 4.2, 4.5, 2.7, 4.1, 0.6, 0.4, 3.0, …
$ NO        &lt;dbl&gt; 1.9, 0.4, 0.7, 0.4, 0.8, 1.5, 2.5, 0.8, 1.4, 0.3, 0.3, 1.2, …
$ PM10      &lt;dbl&gt; 11.4, 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2, 10…
$ PM2.5     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ SO2       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ AirTemp   &lt;dbl&gt; 21, 19, 18, 21, 19, 17, 17, 19, 20, 19, 18, 20, 19, 18, 20, …</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Wind Direction - Henderson</span></span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a>winddir_henderson <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/henderson/winddir-henderson/DataSetExport-Wind Dir.24-Hour Aggregate (░) - Unverified@5-Instantaneous-deg-20250522081739.csv"</span>, <span class="st">"WindDir"</span>)</span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Wind Direction - Pakuranga</span></span>
<span id="cb273-5"><a href="#cb273-5" aria-hidden="true" tabindex="-1"></a>winddir_pakuranga <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/pakuranga/winddir-pakuranga/DataSetExport-Wind Dir.24-Hour Aggregate (░) - Unverified@1-Instantaneous-deg-20250522082446.csv"</span>, <span class="st">"WindDir"</span>)</span>
<span id="cb273-6"><a href="#cb273-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-7"><a href="#cb273-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Wind Direction - Glen Eden</span></span>
<span id="cb273-8"><a href="#cb273-8" aria-hidden="true" tabindex="-1"></a>winddir_gleneden <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/gleneden/winddir-gleneden/DataSetExport-Wind Dir.24-Hour Aggregate (░) - Unverified@67-Instantaneous-deg-20250522083144.csv"</span>, <span class="st">"WindDir"</span>)</span>
<span id="cb273-9"><a href="#cb273-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-10"><a href="#cb273-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Wind Direction - Takapuna</span></span>
<span id="cb273-11"><a href="#cb273-11" aria-hidden="true" tabindex="-1"></a>winddir_takapuna <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/takapuna/winddir-takapuna/DataSetExport-Wind Dir.24-Hour Aggregate (░) - Unverified@23-Instantaneous-deg-20250522083849.csv"</span>, <span class="st">"WindDir"</span>)</span>
<span id="cb273-12"><a href="#cb273-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-13"><a href="#cb273-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Wind Direction - Penrose</span></span>
<span id="cb273-14"><a href="#cb273-14" aria-hidden="true" tabindex="-1"></a>winddir_penrose <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/penrose/winddir-penrose/DataSetExport-Wind Dir.24-Hour Aggregate (░) - Unverified@7-Instantaneous-deg-20250522084231.csv"</span>, <span class="st">"WindDir"</span>)</span>
<span id="cb273-15"><a href="#cb273-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-16"><a href="#cb273-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind rows</span></span>
<span id="cb273-17"><a href="#cb273-17" aria-hidden="true" tabindex="-1"></a>winddir_combined <span class="ot">&lt;-</span> <span class="fu">bind_pollutant_data</span>(</span>
<span id="cb273-18"><a href="#cb273-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(winddir_henderson, winddir_pakuranga, winddir_gleneden, winddir_takapuna, winddir_penrose),</span>
<span id="cb273-19"><a href="#cb273-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>, <span class="st">"Glen Eden Central"</span>, <span class="st">"Westlake"</span>, <span class="st">"Ellerslie South"</span>))</span>
<span id="cb273-20"><a href="#cb273-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-21"><a href="#cb273-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join by matching rows where both date and sa2_name are same </span></span>
<span id="cb273-22"><a href="#cb273-22" aria-hidden="true" tabindex="-1"></a>merged_airdata <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb273-23"><a href="#cb273-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(winddir_combined, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span> <span class="ot">=</span> <span class="st">"date"</span>, <span class="st">"sa2_name"</span> <span class="ot">=</span> <span class="st">"sa2_name"</span>)) </span>
<span id="cb273-24"><a href="#cb273-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-25"><a href="#cb273-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a glimpse</span></span>
<span id="cb273-26"><a href="#cb273-26" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(merged_airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 19,338
Columns: 16
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Residenti…
$ date      &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01-05,…
$ year      &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2016", "201…
$ geometry  &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -36.92214), …
$ sa2_name  &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Eden Central…
$ pop2018   &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, …
$ longitude &lt;dbl&gt; 174.652, 174.652, 174.652, 174.652, 174.652, 174.652, 174.65…
$ latitude  &lt;dbl&gt; -36.92214, -36.92214, -36.92214, -36.92214, -36.92214, -36.9…
$ AQI       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ NO2       &lt;dbl&gt; 3.4, 2.0, 3.8, 1.3, 2.5, 4.2, 4.5, 2.7, 4.1, 0.6, 0.4, 3.0, …
$ NO        &lt;dbl&gt; 1.9, 0.4, 0.7, 0.4, 0.8, 1.5, 2.5, 0.8, 1.4, 0.3, 0.3, 1.2, …
$ PM10      &lt;dbl&gt; 11.4, 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2, 10…
$ PM2.5     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ SO2       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ AirTemp   &lt;dbl&gt; 21, 19, 18, 21, 19, 17, 17, 19, 20, 19, 18, 20, 19, 18, 20, …
$ WindDir   &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Wind Speed - Henderson</span></span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a>windspeed_henderson <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/henderson/windspeed-henderson/DataSetExport-Wind Speed m s.24-Hour Aggregate (m s)@5-Instantaneous-m s-20250522081853.csv"</span>, <span class="st">"WindSpeed"</span>)</span>
<span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Wind Speed - Pakuranga</span></span>
<span id="cb275-5"><a href="#cb275-5" aria-hidden="true" tabindex="-1"></a>windspeed_pakuranga <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/pakuranga/windspeed-pakuranga/DataSetExport-Wind Speed m s.24-Hour Aggregate (m s)@1-Instantaneous-m s-20250522082606.csv"</span>, <span class="st">"WindSpeed"</span>)</span>
<span id="cb275-6"><a href="#cb275-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-7"><a href="#cb275-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Wind Speed - Glen Eden</span></span>
<span id="cb275-8"><a href="#cb275-8" aria-hidden="true" tabindex="-1"></a>windspeed_gleneden <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/gleneden/windspeed-gleneden/DataSetExport-Wind Speed m s.24-Hour Aggregate (m s)@67-Instantaneous-m s-20250522083258.csv"</span>, <span class="st">"WindSpeed"</span>)</span>
<span id="cb275-9"><a href="#cb275-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-10"><a href="#cb275-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Wind Speed - Takapuna</span></span>
<span id="cb275-11"><a href="#cb275-11" aria-hidden="true" tabindex="-1"></a>windspeed_takapuna <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/takapuna/windspeed-takapuna/DataSetExport-Wind Speed m s.24-Hour Aggregate (m s)@23-Instantaneous-m s-20250522084008.csv"</span>, <span class="st">"WindSpeed"</span>)</span>
<span id="cb275-12"><a href="#cb275-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-13"><a href="#cb275-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Wind Speed - Penrose</span></span>
<span id="cb275-14"><a href="#cb275-14" aria-hidden="true" tabindex="-1"></a>windspeed_penrose <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/penrose/windspeed-penrose/DataSetExport-Wind Speed m s.24-Hour Aggregate (m s)@7-Instantaneous-m s-20250522084333.csv"</span>, <span class="st">"WindSpeed"</span>)</span>
<span id="cb275-15"><a href="#cb275-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-16"><a href="#cb275-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind rows</span></span>
<span id="cb275-17"><a href="#cb275-17" aria-hidden="true" tabindex="-1"></a>windspeed_combined <span class="ot">&lt;-</span> <span class="fu">bind_pollutant_data</span>(</span>
<span id="cb275-18"><a href="#cb275-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(windspeed_henderson, windspeed_pakuranga, windspeed_gleneden, windspeed_takapuna, windspeed_penrose),</span>
<span id="cb275-19"><a href="#cb275-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>, <span class="st">"Glen Eden Central"</span>, <span class="st">"Westlake"</span>, <span class="st">"Ellerslie South"</span>))</span>
<span id="cb275-20"><a href="#cb275-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-21"><a href="#cb275-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join by matching rows where both date and sa2_name are same </span></span>
<span id="cb275-22"><a href="#cb275-22" aria-hidden="true" tabindex="-1"></a>merged_airdata <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb275-23"><a href="#cb275-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(windspeed_combined, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span> <span class="ot">=</span> <span class="st">"date"</span>, <span class="st">"sa2_name"</span> <span class="ot">=</span> <span class="st">"sa2_name"</span>)) </span>
<span id="cb275-24"><a href="#cb275-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-25"><a href="#cb275-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a glimpse</span></span>
<span id="cb275-26"><a href="#cb275-26" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(merged_airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 19,338
Columns: 17
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Residenti…
$ date      &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01-05,…
$ year      &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2016", "201…
$ geometry  &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -36.92214), …
$ sa2_name  &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Eden Central…
$ pop2018   &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, …
$ longitude &lt;dbl&gt; 174.652, 174.652, 174.652, 174.652, 174.652, 174.652, 174.65…
$ latitude  &lt;dbl&gt; -36.92214, -36.92214, -36.92214, -36.92214, -36.92214, -36.9…
$ AQI       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ NO2       &lt;dbl&gt; 3.4, 2.0, 3.8, 1.3, 2.5, 4.2, 4.5, 2.7, 4.1, 0.6, 0.4, 3.0, …
$ NO        &lt;dbl&gt; 1.9, 0.4, 0.7, 0.4, 0.8, 1.5, 2.5, 0.8, 1.4, 0.3, 0.3, 1.2, …
$ PM10      &lt;dbl&gt; 11.4, 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2, 10…
$ PM2.5     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ SO2       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ AirTemp   &lt;dbl&gt; 21, 19, 18, 21, 19, 17, 17, 19, 20, 19, 18, 20, 19, 18, 20, …
$ WindDir   &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ WindSpeed &lt;dbl&gt; 2.0, 2.5, 2.6, 3.0, 2.0, 1.7, 1.7, 2.7, 3.2, 2.7, 2.3, 1.7, …</code></pre>
</div>
</div>
<details>
<summary>
Correlation Heatmaps by Site
</summary>
<p>This section visualizes the relationships between weather and air quality variables across Auckland sites. Correlation heatmaps are generated to identify pollutant interdependencies and meteorological influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a>plot_heatmap <span class="ot">&lt;-</span> <span class="cf">function</span>(data, title_var) {</span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a>  correlation_data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_modify</span>(<span class="sc">~</span> {</span>
<span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> .x  <span class="co"># Assign the subset data frame</span></span>
<span id="cb277-5"><a href="#cb277-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(<span class="fu">na.omit</span>(df)) <span class="sc">&gt;=</span> <span class="dv">2</span>) { </span>
<span id="cb277-6"><a href="#cb277-6" aria-hidden="true" tabindex="-1"></a>    corr_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(df, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb277-7"><a href="#cb277-7" aria-hidden="true" tabindex="-1"></a>    corr_long <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.table</span>(corr_matrix))</span>
<span id="cb277-8"><a href="#cb277-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(corr_long) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Var1"</span>, <span class="st">"Var2"</span>, <span class="st">"Correlation"</span>)</span>
<span id="cb277-9"><a href="#cb277-9" aria-hidden="true" tabindex="-1"></a>    corr_long</span>
<span id="cb277-10"><a href="#cb277-10" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb277-11"><a href="#cb277-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">Var1 =</span> <span class="fu">character</span>(), <span class="at">Var2 =</span> <span class="fu">character</span>(), <span class="at">Correlation =</span> <span class="fu">numeric</span>())</span>
<span id="cb277-12"><a href="#cb277-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb277-13"><a href="#cb277-13" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span></span>
<span id="cb277-14"><a href="#cb277-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb277-15"><a href="#cb277-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-16"><a href="#cb277-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the correlation heatmap</span></span>
<span id="cb277-17"><a href="#cb277-17" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(correlation_data, <span class="fu">aes</span>(<span class="at">x =</span> Var1, <span class="at">y =</span> Var2, <span class="at">fill =</span> Correlation)) <span class="sc">+</span></span>
<span id="cb277-18"><a href="#cb277-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span> <span class="co">#color = "white") +</span></span>
<span id="cb277-19"><a href="#cb277-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(Correlation, <span class="dv">2</span>)), <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb277-20"><a href="#cb277-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(</span>
<span id="cb277-21"><a href="#cb277-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">option =</span> <span class="st">"mako"</span>,  </span>
<span id="cb277-22"><a href="#cb277-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb277-23"><a href="#cb277-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Pearson r"</span></span>
<span id="cb277-24"><a href="#cb277-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb277-25"><a href="#cb277-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb277-26"><a href="#cb277-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb277-27"><a href="#cb277-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Correlation Matrix of Daily Weather and Air Quality Variables (2016–2024)"</span>,</span>
<span id="cb277-28"><a href="#cb277-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"For "</span>, title_var, <span class="st">" in Auckland"</span>),</span>
<span id="cb277-29"><a href="#cb277-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">fill =</span> <span class="st">"Pearson r"</span></span>
<span id="cb277-30"><a href="#cb277-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb277-31"><a href="#cb277-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb277-32"><a href="#cb277-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb277-33"><a href="#cb277-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb277-34"><a href="#cb277-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb277-35"><a href="#cb277-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb277-36"><a href="#cb277-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb277-37"><a href="#cb277-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb277-38"><a href="#cb277-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb277-39"><a href="#cb277-39" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(p)</span>
<span id="cb277-40"><a href="#cb277-40" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find which factor has all missing values</span></span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a>merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(WindSpeed, WindDir, AirTemp, AQI, NO2, NO, PM10, PM2<span class="fl">.5</span>, SO2) <span class="sc">|&gt;</span></span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">all</span>(<span class="fu">is.na</span>(.x))),</span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 10
  sa2_name         WindSpeed WindDir AirTemp AQI   NO2   NO    PM10  PM2.5 SO2  
  &lt;chr&gt;            &lt;lgl&gt;     &lt;lgl&gt;   &lt;lgl&gt;   &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt;
1 Ellerslie South  FALSE     FALSE   FALSE   FALSE FALSE FALSE FALSE FALSE FALSE
2 Glen Eden Centr… FALSE     FALSE   FALSE   FALSE FALSE FALSE FALSE TRUE  TRUE 
3 Henderson Linco… FALSE     FALSE   FALSE   FALSE FALSE FALSE FALSE TRUE  TRUE 
4 Puni             TRUE      TRUE    TRUE    FALSE FALSE FALSE FALSE FALSE TRUE 
5 Queen Street     TRUE      TRUE    FALSE   FALSE FALSE FALSE FALSE FALSE TRUE 
6 Sunnyhills East  FALSE     FALSE   FALSE   FALSE TRUE  TRUE  FALSE TRUE  TRUE 
7 Westlake         FALSE     FALSE   FALSE   FALSE FALSE FALSE FALSE FALSE TRUE </code></pre>
</div>
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ellerslie South has numeric data for all variables</span></span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Glen Eden Central and Henderson Lincoln South has all data missing for PM2.5 and SO2</span></span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Puni has all data missing for WindSpeed, WindDir, AirTemp, and SO2</span></span>
<span id="cb280-4"><a href="#cb280-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Queen Street does not contain data for WindSpeed, WindDir, and SO2</span></span>
<span id="cb280-5"><a href="#cb280-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Sunnyhills East has all data missing for NO2, NO, PM2.5, SO2</span></span>
<span id="cb280-6"><a href="#cb280-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Westlake has all data missing for SO2</span></span>
<span id="cb280-7"><a href="#cb280-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-8"><a href="#cb280-8" aria-hidden="true" tabindex="-1"></a>ellerslie_data <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb280-9"><a href="#cb280-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>) <span class="sc">|&gt;</span></span>
<span id="cb280-10"><a href="#cb280-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(WindSpeed, WindDir, AirTemp, AQI, NO2, NO, PM10, PM2<span class="fl">.5</span>, SO2)</span>
<span id="cb280-11"><a href="#cb280-11" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap <span class="ot">&lt;-</span> <span class="fu">plot_heatmap</span>(ellerslie_data, <span class="st">"Ellerslie South site"</span>)</span>
<span id="cb280-12"><a href="#cb280-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-13"><a href="#cb280-13" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-correlation-ellerslie-data-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>NO and NO2 have the highest correlations (0.78), indicating strong correlation. NO and NO2 also show high correlation with SO2 (0.7 and 0.57). AirTemp negatively correlates with NO2 (-0.48), while WindSpeed has weak correlations with pollutants (-0.47 to 0.24). AQI has 0 correlation with WindSpeed. Correlations suggest meteorological influences on air pollution dynamics at Ellerslie South.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View the number of missing values in key columns</span></span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a>ellerslie_data <span class="sc">|&gt;</span></span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(WindSpeed, WindDir, AirTemp, AQI, NO2, NO, PM10, PM2<span class="fl">.5</span>, SO2), <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 9
  WindSpeed WindDir AirTemp   AQI   NO2    NO  PM10 PM2.5   SO2
      &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
1       358     229     355   246   386   393   313   788   435</code></pre>
</div>
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Impute missing values using Kalman smoothing (auto ARIMA model)</span></span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This method handles time-series gaps more intelligently than simple methods</span></span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a>ellerslie_data <span class="ot">&lt;-</span> ellerslie_data <span class="sc">|&gt;</span> </span>
<span id="cb283-4"><a href="#cb283-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb283-5"><a href="#cb283-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">WindSpeed =</span> <span class="fu">na_kalman</span>(WindSpeed, <span class="at">model =</span> <span class="st">"auto.arima"</span>),</span>
<span id="cb283-6"><a href="#cb283-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">WindDir =</span> <span class="fu">na_kalman</span>(WindDir, <span class="at">model =</span> <span class="st">"auto.arima"</span>),</span>
<span id="cb283-7"><a href="#cb283-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">AirTemp =</span> <span class="fu">na_kalman</span>(AirTemp, <span class="at">model =</span> <span class="st">"auto.arima"</span>),</span>
<span id="cb283-8"><a href="#cb283-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">AQI =</span> <span class="fu">na_kalman</span>(AQI, <span class="at">model =</span> <span class="st">"auto.arima"</span>),</span>
<span id="cb283-9"><a href="#cb283-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">NO2 =</span> <span class="fu">na_kalman</span>(NO2, <span class="at">model =</span> <span class="st">"auto.arima"</span>),</span>
<span id="cb283-10"><a href="#cb283-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">NO =</span> <span class="fu">na_kalman</span>(NO, <span class="at">model =</span> <span class="st">"auto.arima"</span>),</span>
<span id="cb283-11"><a href="#cb283-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">PM10 =</span> <span class="fu">na_kalman</span>(PM10, <span class="at">model =</span> <span class="st">"auto.arima"</span>),</span>
<span id="cb283-12"><a href="#cb283-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">PM2.5 =</span> <span class="fu">na_kalman</span>(PM2<span class="fl">.5</span>, <span class="at">model =</span> <span class="st">"auto.arima"</span>),</span>
<span id="cb283-13"><a href="#cb283-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">SO2 =</span> <span class="fu">na_kalman</span>(SO2, <span class="at">model =</span> <span class="st">"auto.arima"</span>))</span>
<span id="cb283-14"><a href="#cb283-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-15"><a href="#cb283-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a heatmap of correlations after imputing missing values</span></span>
<span id="cb283-16"><a href="#cb283-16" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap <span class="ot">&lt;-</span> <span class="fu">plot_heatmap</span>(ellerslie_data, <span class="st">"ARIMA approximated missing values at Ellerslie South site"</span>)</span>
<span id="cb283-17"><a href="#cb283-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-18"><a href="#cb283-18" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/impute-and-correlation-plot-ellerslie-data-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>SO2, NO, and NO2 show strong positive correlations, indicating shared sources. PM2.5 is tightly linked with PM10 and NO. Wind speed inversely correlates with AQI and all pollutants except PM10, suggesting pollutant dispersion. Air temperature correlates negatively with AQI and all pollutants but positively with PM10 concentrations, reflecting meteorological influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the required columns</span></span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a>gleneden_data <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">==</span> <span class="st">"Glen Eden Central"</span>) <span class="sc">|&gt;</span></span>
<span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(WindSpeed, WindDir, AirTemp, AQI, NO2, NO, PM10)</span>
<span id="cb284-5"><a href="#cb284-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-6"><a href="#cb284-6" aria-hidden="true" tabindex="-1"></a><span class="co"># View the number of missing values in key columns</span></span>
<span id="cb284-7"><a href="#cb284-7" aria-hidden="true" tabindex="-1"></a>gleneden_data <span class="sc">|&gt;</span></span>
<span id="cb284-8"><a href="#cb284-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(WindSpeed, WindDir, AirTemp, AQI, NO2, NO, PM10), <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  WindSpeed WindDir AirTemp   AQI   NO2    NO  PM10
      &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
1       235     273     266   253   324   331   274</code></pre>
</div>
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a heatmap of correlations</span></span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap <span class="ot">&lt;-</span> <span class="fu">plot_heatmap</span>(gleneden_data, <span class="st">"Glen Eden Central site"</span>)</span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-4"><a href="#cb286-4" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/correlation-plot-glen-eden-data-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>NO2 shows a strong positive correlation with NO. WindSpeed has a negative correlation with NO and NO2, suggesting pollutant dispersion. AirTemp correlates negatively but weakly with AQI and pollutants, reflecting indirect effects on pollution levels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb287"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the columns required</span></span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a>henderson_data <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">==</span> <span class="st">"Henderson Lincoln South"</span>) <span class="sc">|&gt;</span></span>
<span id="cb287-4"><a href="#cb287-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(WindSpeed, WindDir, AirTemp, AQI, NO2, NO, PM10)</span>
<span id="cb287-5"><a href="#cb287-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-6"><a href="#cb287-6" aria-hidden="true" tabindex="-1"></a><span class="co"># View the number of missing values in key columns</span></span>
<span id="cb287-7"><a href="#cb287-7" aria-hidden="true" tabindex="-1"></a>henderson_data <span class="sc">|&gt;</span></span>
<span id="cb287-8"><a href="#cb287-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(WindSpeed, WindDir, AirTemp, AQI, NO2, NO, PM10), <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  WindSpeed WindDir AirTemp   AQI   NO2    NO  PM10
      &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
1       293     151     293   216  1158   478   947</code></pre>
</div>
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a heatmap of correlations</span></span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap <span class="ot">&lt;-</span> <span class="fu">plot_heatmap</span>(henderson_data, <span class="st">"Henderson Lincoln South site"</span>)</span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/correlation-plot-henderson-data-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>The correlation matrix at Henderson Lincoln South (2016–2024) reveals strong positive correlation between NO and NO2 (0.81), suggesting co-emission sources. Conversely, NO and NO2 show negative correlation with AirTemp (-0.3 and -0.34), indicating atmospheric dispersion effects. PM10 and AQI exhibit a positive correlation (0.73), reflecting air quality deterioration with increased PM10 levels. NO and NO2 shows negative correlation with WindSpeed, implying pollutant dispersion under higher wind conditions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the required columns</span></span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a>puni_data <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">==</span> <span class="st">"Puni"</span>) <span class="sc">|&gt;</span></span>
<span id="cb290-4"><a href="#cb290-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(AQI, NO2, NO, PM10, PM2<span class="fl">.5</span>)</span>
<span id="cb290-5"><a href="#cb290-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-6"><a href="#cb290-6" aria-hidden="true" tabindex="-1"></a><span class="co"># View the number of missing values in key columns</span></span>
<span id="cb290-7"><a href="#cb290-7" aria-hidden="true" tabindex="-1"></a>puni_data <span class="sc">|&gt;</span></span>
<span id="cb290-8"><a href="#cb290-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(AQI, NO2, NO, PM10, PM2<span class="fl">.5</span>), <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
    AQI   NO2    NO  PM10 PM2.5
  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
1   252   340   339   297   571</code></pre>
</div>
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a heatmap of correlations</span></span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap <span class="ot">&lt;-</span> <span class="fu">plot_heatmap</span>(puni_data, <span class="st">"Puni site"</span>)</span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/correlation-plot-puni-data-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>NO and NO2 show the strongest correlation (0.57), indicating linked emissions. PM10 and NO2 exhibit the weakest negative correlation (-0.11). AQI weakly correlates with other pollutants, suggesting multifactorial influences. The matrix highlights variability in pollutant interactions over time and site conditions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the required columns</span></span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a>queen_data <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb293-3"><a href="#cb293-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">==</span> <span class="st">"Queen Street"</span>) <span class="sc">|&gt;</span></span>
<span id="cb293-4"><a href="#cb293-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(AirTemp, AQI, NO2, NO, PM10, PM2<span class="fl">.5</span>)</span>
<span id="cb293-5"><a href="#cb293-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-6"><a href="#cb293-6" aria-hidden="true" tabindex="-1"></a><span class="co"># View the number of missing values in key columns</span></span>
<span id="cb293-7"><a href="#cb293-7" aria-hidden="true" tabindex="-1"></a>queen_data <span class="sc">|&gt;</span></span>
<span id="cb293-8"><a href="#cb293-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(AirTemp, AQI, NO2, NO, PM10, PM2<span class="fl">.5</span>), <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  AirTemp   AQI   NO2    NO  PM10 PM2.5
    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
1     362   161   302   309   447   447</code></pre>
</div>
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a heatmap of correlations </span></span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap <span class="ot">&lt;-</span> <span class="fu">plot_heatmap</span>(queen_data, <span class="st">"Queen Street site"</span>)</span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-4"><a href="#cb295-4" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/correlation-plot-queen-street-data-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>The correlation matrix shows strong positive correlations between NO and NO2 (0.86) and between PM2.5 and PM10 (0.85). AirTemp has a moderate negative correlation with NO2 (-0.33), suggesting temperature influences nitrogen dioxide concentrations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb296"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select required columns</span></span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a>sunnyhills_data <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb296-3"><a href="#cb296-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">==</span> <span class="st">"Sunnyhills East"</span>) <span class="sc">|&gt;</span></span>
<span id="cb296-4"><a href="#cb296-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(WindSpeed, WindDir, AirTemp, AQI, PM10)</span>
<span id="cb296-5"><a href="#cb296-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-6"><a href="#cb296-6" aria-hidden="true" tabindex="-1"></a><span class="co"># View the number of missing values in key columns</span></span>
<span id="cb296-7"><a href="#cb296-7" aria-hidden="true" tabindex="-1"></a>sunnyhills_data <span class="sc">|&gt;</span></span>
<span id="cb296-8"><a href="#cb296-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(WindSpeed, WindDir, AirTemp, AQI, PM10), <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
  WindSpeed WindDir AirTemp   AQI  PM10
      &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;
1       417     858     416  1465   358</code></pre>
</div>
<div class="sourceCode cell-code" id="cb298"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a heatmap of correlations</span></span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap <span class="ot">&lt;-</span> <span class="fu">plot_heatmap</span>(sunnyhills_data, <span class="st">"Sunnyhills East site"</span>)</span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-4"><a href="#cb298-4" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/correlation-plot-sunnyhills-data-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>WindSpeed and WindDir show the moderate positive correlation (0.48), indicating wind speed tends to rise with directional shifts. PM10 and AQI correlate’s moderately (0.51), linking pollution levels with air quality index changes. AirTemp has weak connections, with WindSpeed and WindDir.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb299"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the required columns</span></span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a>westlake_data <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">==</span> <span class="st">"Westlake"</span>) <span class="sc">|&gt;</span></span>
<span id="cb299-4"><a href="#cb299-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(WindSpeed, WindDir, AirTemp, AQI, NO2, NO, PM10, PM2<span class="fl">.5</span>)</span>
<span id="cb299-5"><a href="#cb299-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-6"><a href="#cb299-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a heatmap of correlations</span></span>
<span id="cb299-7"><a href="#cb299-7" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap <span class="ot">&lt;-</span> <span class="fu">plot_heatmap</span>(westlake_data, <span class="st">"Westlake site"</span>)</span>
<span id="cb299-8"><a href="#cb299-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-9"><a href="#cb299-9" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/correlation-plot-westlake-data-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
NO and NO2 strongly correlate (0.76), indicating related emission sources. NO2 and NO inversely correlates with WindSpeed (-0.46 and -0.55), suggesting dispersion effects. PM2.5 and AQI correlate moderately (0.39), reflecting air quality dependencies. NO2 and WindDir show moderate correlation (0.45), hinting at directional transport influences. NO and NO2 negatively correlates with AirTemp.
</details>
<details>
<summary>
Temporal Trends in Daily Pollutant Concentrations
</summary>
<p>This section explores daily pollutant trends across Auckland sites from 2016 to 2024. After imputing missing values using ARIMA and median substitution, visualizations reveal site-specific air quality patterns and temporal changes in key pollutants like AQI, NO2, NO, PM10, PM2.5, and SO2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find approximate values for missing ones, fill the missing values with ARIMA approximated values.</span></span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb300-4"><a href="#cb300-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_modify</span>(<span class="sc">~</span> {</span>
<span id="cb300-5"><a href="#cb300-5" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> .</span>
<span id="cb300-6"><a href="#cb300-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb300-7"><a href="#cb300-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply ARIMA imputation only if the entire column is not all NA</span></span>
<span id="cb300-8"><a href="#cb300-8" aria-hidden="true" tabindex="-1"></a>    data<span class="sc">$</span>WindSpeed <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(data<span class="sc">$</span>WindSpeed))) data<span class="sc">$</span>WindSpeed <span class="cf">else</span> <span class="fu">na_kalman</span>(data<span class="sc">$</span>WindSpeed, <span class="at">model =</span> <span class="st">"auto.arima"</span>)</span>
<span id="cb300-9"><a href="#cb300-9" aria-hidden="true" tabindex="-1"></a>    data<span class="sc">$</span>WindDir <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(data<span class="sc">$</span>WindDir))) data<span class="sc">$</span>WindDir <span class="cf">else</span> <span class="fu">na_kalman</span>(data<span class="sc">$</span>WindDir, <span class="at">model =</span> <span class="st">"auto.arima"</span>)</span>
<span id="cb300-10"><a href="#cb300-10" aria-hidden="true" tabindex="-1"></a>    data<span class="sc">$</span>AirTemp <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(data<span class="sc">$</span>AirTemp))) data<span class="sc">$</span>AirTemp <span class="cf">else</span> <span class="fu">na_kalman</span>(data<span class="sc">$</span>AirTemp, <span class="at">model =</span> <span class="st">"auto.arima"</span>)</span>
<span id="cb300-11"><a href="#cb300-11" aria-hidden="true" tabindex="-1"></a>    data<span class="sc">$</span>AQI  <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(data<span class="sc">$</span>AQI)))  data<span class="sc">$</span>AQI  <span class="cf">else</span> <span class="fu">na_kalman</span>(data<span class="sc">$</span>AQI, <span class="at">model =</span> <span class="st">"auto.arima"</span>)</span>
<span id="cb300-12"><a href="#cb300-12" aria-hidden="true" tabindex="-1"></a>    data<span class="sc">$</span>NO2   <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(data<span class="sc">$</span>NO2)))  data<span class="sc">$</span>NO2 <span class="cf">else</span> <span class="fu">na_kalman</span>(data<span class="sc">$</span>NO2, <span class="at">model =</span> <span class="st">"auto.arima"</span>)</span>
<span id="cb300-13"><a href="#cb300-13" aria-hidden="true" tabindex="-1"></a>    data<span class="sc">$</span>NO   <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(data<span class="sc">$</span>NO)))  data<span class="sc">$</span>NO <span class="cf">else</span> <span class="fu">na_kalman</span>(data<span class="sc">$</span>NO, <span class="at">model =</span> <span class="st">"auto.arima"</span>)</span>
<span id="cb300-14"><a href="#cb300-14" aria-hidden="true" tabindex="-1"></a>    data<span class="sc">$</span>PM10 <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(data<span class="sc">$</span>PM10))) data<span class="sc">$</span>PM10 <span class="cf">else</span> <span class="fu">na_kalman</span>(data<span class="sc">$</span>PM10, <span class="at">model =</span> <span class="st">"auto.arima"</span>)</span>
<span id="cb300-15"><a href="#cb300-15" aria-hidden="true" tabindex="-1"></a>    data<span class="sc">$</span>PM2<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(data<span class="sc">$</span>PM2<span class="fl">.5</span>))) data<span class="sc">$</span>PM2<span class="fl">.5</span> <span class="cf">else</span> <span class="fu">na_kalman</span>(data<span class="sc">$</span>PM2<span class="fl">.5</span>, <span class="at">model =</span> <span class="st">"auto.arima"</span>)</span>
<span id="cb300-16"><a href="#cb300-16" aria-hidden="true" tabindex="-1"></a>    data<span class="sc">$</span>SO2 <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(data<span class="sc">$</span>SO2))) data<span class="sc">$</span>SO2 <span class="cf">else</span> <span class="fu">na_kalman</span>(data<span class="sc">$</span>SO2, <span class="at">model =</span> <span class="st">"auto.arima"</span>)</span>
<span id="cb300-17"><a href="#cb300-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb300-18"><a href="#cb300-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(data)</span>
<span id="cb300-19"><a href="#cb300-19" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">|&gt;</span></span>
<span id="cb300-20"><a href="#cb300-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb300-21"><a href="#cb300-21" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb300-22"><a href="#cb300-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Produce a daily_airdata dataset that contains daily total pollutant concentrations and AQI for each SA2_name</span></span>
<span id="cb300-23"><a href="#cb300-23" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb300-24"><a href="#cb300-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name, date) <span class="sc">|&gt;</span></span>
<span id="cb300-25"><a href="#cb300-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb300-26"><a href="#cb300-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">NO2 =</span> <span class="fu">sum</span>(NO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb300-27"><a href="#cb300-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">NO =</span> <span class="fu">sum</span>(NO, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb300-28"><a href="#cb300-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">PM10 =</span> <span class="fu">sum</span>(PM10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb300-29"><a href="#cb300-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">PM2.5 =</span> <span class="fu">sum</span>(PM2<span class="fl">.5</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb300-30"><a href="#cb300-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">SO2 =</span> <span class="fu">sum</span>(SO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb300-31"><a href="#cb300-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">AQI =</span> <span class="fu">sum</span>(AQI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb300-32"><a href="#cb300-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb300-33"><a href="#cb300-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-34"><a href="#cb300-34" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(daily_airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "sa2_name"  "site_type" "date"      "year"      "geometry"  "pop2018"  
 [7] "longitude" "latitude"  "AQI"       "NO2"       "NO"        "PM10"     
[13] "PM2.5"     "SO2"       "AirTemp"   "WindDir"   "WindSpeed"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to plot pollutants versus date for each sa2_name</span></span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a>plot_pollutant <span class="ot">&lt;-</span> <span class="cf">function</span>(data, yvar) {</span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> .data[[yvar]])) <span class="sc">+</span></span>
<span id="cb302-4"><a href="#cb302-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> color_group)) <span class="sc">+</span></span>
<span id="cb302-5"><a href="#cb302-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_cor</span>(</span>
<span id="cb302-6"><a href="#cb302-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">"pearson"</span>, <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb302-7"><a href="#cb302-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">label.x.npc =</span> <span class="st">"center"</span>, <span class="at">label.y.npc =</span> <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb302-8"><a href="#cb302-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> sa2_name, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb302-9"><a href="#cb302-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_identity</span>(</span>
<span id="cb302-10"><a href="#cb302-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="fu">paste</span>(yvar, <span class="st">"Level"</span>),</span>
<span id="cb302-11"><a href="#cb302-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">guide =</span> <span class="st">"legend"</span>,</span>
<span id="cb302-12"><a href="#cb302-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Moderate"</span>, <span class="st">"High"</span>),</span>
<span id="cb302-13"><a href="#cb302-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"#377eb8"</span>, <span class="st">"#A0AEB2"</span>, <span class="st">"#E24A33"</span>)</span>
<span id="cb302-14"><a href="#cb302-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb302-15"><a href="#cb302-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_date</span>(</span>
<span id="cb302-16"><a href="#cb302-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2016-01-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2024-12-31"</span>), <span class="at">by =</span> <span class="st">"6 months"</span>),</span>
<span id="cb302-17"><a href="#cb302-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">date_labels =</span> <span class="st">"%b %y"</span>) <span class="sc">+</span></span>
<span id="cb302-18"><a href="#cb302-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb302-19"><a href="#cb302-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb302-20"><a href="#cb302-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Daily Trend of"</span>, yvar, <span class="st">"at Each Site in Auckland (2016–2024)"</span>),</span>
<span id="cb302-21"><a href="#cb302-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Missing values are approximate by ARIMA method"</span>,</span>
<span id="cb302-22"><a href="#cb302-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Month Year"</span>, </span>
<span id="cb302-23"><a href="#cb302-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">bquote</span>(.(yvar) <span class="sc">~</span> <span class="st">"Concentration ("</span> <span class="sc">*</span> mu <span class="sc">*</span> <span class="st">"g/"</span> <span class="sc">*</span> m<span class="sc">^</span><span class="dv">3</span> <span class="sc">*</span> <span class="st">")"</span>) ) <span class="sc">+</span></span>
<span id="cb302-24"><a href="#cb302-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb302-25"><a href="#cb302-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb302-26"><a href="#cb302-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb302-27"><a href="#cb302-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb302-28"><a href="#cb302-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb302-29"><a href="#cb302-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb302-30"><a href="#cb302-30" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb302-31"><a href="#cb302-31" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb303"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 10th and 90th percentiles</span></span>
<span id="cb303-2"><a href="#cb303-2" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(daily_airdata<span class="sc">$</span>AQI, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb303-3"><a href="#cb303-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-4"><a href="#cb303-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add color grouping based on AQI percentiles</span></span>
<span id="cb303-5"><a href="#cb303-5" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb303-6"><a href="#cb303-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb303-7"><a href="#cb303-7" aria-hidden="true" tabindex="-1"></a>    AQI <span class="sc">&lt;=</span> quantiles[<span class="dv">1</span>] <span class="sc">~</span> <span class="st">"#377eb8"</span>,</span>
<span id="cb303-8"><a href="#cb303-8" aria-hidden="true" tabindex="-1"></a>    AQI <span class="sc">&gt;=</span> quantiles[<span class="dv">2</span>] <span class="sc">~</span> <span class="st">"#E24A33"</span>,</span>
<span id="cb303-9"><a href="#cb303-9" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"#A0AEB2"</span></span>
<span id="cb303-10"><a href="#cb303-10" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb303-11"><a href="#cb303-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-12"><a href="#cb303-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate plot</span></span>
<span id="cb303-13"><a href="#cb303-13" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_date <span class="ot">&lt;-</span> <span class="fu">plot_pollutant</span>(daily_airdata, <span class="st">"AQI"</span>) <span class="sc">+</span></span>
<span id="cb303-14"><a href="#cb303-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"AQI"</span>)</span>
<span id="cb303-15"><a href="#cb303-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-16"><a href="#cb303-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb303-17"><a href="#cb303-17" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_date</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-auckland-aqi-vs-date-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Queen Street shows the strongest AQI decline (R = –0.35), indicating worsening air quality. Puni and Sunnyhills East have frequent extreme spikes with moderate declines. Henderson Lincoln South, Westlake, and Ellerslie South show smaller but significant decreases. Glen Eden Central exhibit weak, significant positive trend. AQI trends vary notably across Auckland sites.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 10th and 90th percentiles</span></span>
<span id="cb304-2"><a href="#cb304-2" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(daily_airdata<span class="sc">$</span>NO2, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb304-3"><a href="#cb304-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-4"><a href="#cb304-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add color grouping based on NO2 percentiles</span></span>
<span id="cb304-5"><a href="#cb304-5" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb304-6"><a href="#cb304-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb304-7"><a href="#cb304-7" aria-hidden="true" tabindex="-1"></a>    NO2 <span class="sc">&lt;=</span> quantiles[<span class="dv">1</span>] <span class="sc">~</span> <span class="st">"#377eb8"</span>,</span>
<span id="cb304-8"><a href="#cb304-8" aria-hidden="true" tabindex="-1"></a>    NO2 <span class="sc">&gt;=</span> quantiles[<span class="dv">2</span>] <span class="sc">~</span> <span class="st">"#E24A33"</span>,</span>
<span id="cb304-9"><a href="#cb304-9" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"#A0AEB2"</span></span>
<span id="cb304-10"><a href="#cb304-10" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb304-11"><a href="#cb304-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-12"><a href="#cb304-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate plot</span></span>
<span id="cb304-13"><a href="#cb304-13" aria-hidden="true" tabindex="-1"></a>plot_no2_vs_date <span class="ot">&lt;-</span> <span class="fu">plot_pollutant</span>(<span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">!=</span> <span class="st">"Sunnyhills East"</span>), <span class="st">"NO2"</span>)</span>
<span id="cb304-14"><a href="#cb304-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-15"><a href="#cb304-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb304-16"><a href="#cb304-16" aria-hidden="true" tabindex="-1"></a>plot_no2_vs_date</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-auckland-no2-vs-date-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Queen Street show consistently high NO2 levels, especially pre-2021, with clear downward trend (R = –0.38). Westlake and Ellerslie South also show moderate levels and significant declines. Henderson Lincoln South has low-moderate values with a weak trend (R = –0.11). Glen Eden Central and Puni stands out with the lowest and a slight positive trend (R = 0.063 and 0.016) with Puni being stable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb305"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 10th and 90th percentiles</span></span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(daily_airdata<span class="sc">$</span>NO, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb305-3"><a href="#cb305-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-4"><a href="#cb305-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add color grouping based on NO percentiles</span></span>
<span id="cb305-5"><a href="#cb305-5" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb305-6"><a href="#cb305-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb305-7"><a href="#cb305-7" aria-hidden="true" tabindex="-1"></a>    NO <span class="sc">&lt;=</span> quantiles[<span class="dv">1</span>] <span class="sc">~</span> <span class="st">"#377eb8"</span>,</span>
<span id="cb305-8"><a href="#cb305-8" aria-hidden="true" tabindex="-1"></a>    NO <span class="sc">&gt;=</span> quantiles[<span class="dv">2</span>] <span class="sc">~</span> <span class="st">"#E24A33"</span>,</span>
<span id="cb305-9"><a href="#cb305-9" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"#A0AEB2"</span></span>
<span id="cb305-10"><a href="#cb305-10" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb305-11"><a href="#cb305-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-12"><a href="#cb305-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate plot</span></span>
<span id="cb305-13"><a href="#cb305-13" aria-hidden="true" tabindex="-1"></a>plot_no_vs_date <span class="ot">&lt;-</span> <span class="fu">plot_pollutant</span>(<span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">!=</span> <span class="st">"Sunnyhills East"</span>), <span class="st">"NO"</span>)</span>
<span id="cb305-14"><a href="#cb305-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-15"><a href="#cb305-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb305-16"><a href="#cb305-16" aria-hidden="true" tabindex="-1"></a>plot_no_vs_date</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-auckland-no-vs-date-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>NO levels varied notably across sites. Queen Street showed frequent high NO levels, while Henderson Lincoln South recorded predominantly moderate and low levels. Ellerslie South and Westlake had moderate NO with few high peaks. Notably, Puni and Glen Eden Central showed a positive trend, while others showed declining or fluctuating NO levels over time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb306"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 10th and 90th percentiles</span></span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(daily_airdata<span class="sc">$</span>PM10, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-4"><a href="#cb306-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add color grouping based on PM10 percentiles</span></span>
<span id="cb306-5"><a href="#cb306-5" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb306-6"><a href="#cb306-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb306-7"><a href="#cb306-7" aria-hidden="true" tabindex="-1"></a>    PM10 <span class="sc">&lt;=</span> quantiles[<span class="dv">1</span>] <span class="sc">~</span> <span class="st">"#377eb8"</span>,</span>
<span id="cb306-8"><a href="#cb306-8" aria-hidden="true" tabindex="-1"></a>    PM10 <span class="sc">&gt;=</span> quantiles[<span class="dv">2</span>] <span class="sc">~</span> <span class="st">"#E24A33"</span>,</span>
<span id="cb306-9"><a href="#cb306-9" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"#A0AEB2"</span></span>
<span id="cb306-10"><a href="#cb306-10" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb306-11"><a href="#cb306-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-12"><a href="#cb306-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate plot</span></span>
<span id="cb306-13"><a href="#cb306-13" aria-hidden="true" tabindex="-1"></a>plot_pm10_vs_date <span class="ot">&lt;-</span> <span class="fu">plot_pollutant</span>(daily_airdata, <span class="st">"PM10"</span>)</span>
<span id="cb306-14"><a href="#cb306-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-15"><a href="#cb306-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb306-16"><a href="#cb306-16" aria-hidden="true" tabindex="-1"></a>plot_pm10_vs_date</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-auckland-pm10-vs-date-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>PM10 levels vary across Auckland sites, with notable trends. Queen Street (R = 0.16) shows an increasing trend, while Henderson Lincoln South (R = -0.26) and Ellerslie South (R = -0.097) show declines. Puni (R = -0.064), Glen Eden Central (R = -0.099), and Ellerslie South (R = -0.097) show minor decreases.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb307"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 10th and 90th percentiles</span></span>
<span id="cb307-2"><a href="#cb307-2" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(daily_airdata<span class="sc">$</span>PM2<span class="fl">.5</span>, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb307-3"><a href="#cb307-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb307-4"><a href="#cb307-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add color grouping based on PM2.5 percentiles</span></span>
<span id="cb307-5"><a href="#cb307-5" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb307-6"><a href="#cb307-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb307-7"><a href="#cb307-7" aria-hidden="true" tabindex="-1"></a>    PM2<span class="fl">.5</span> <span class="sc">&lt;=</span> quantiles[<span class="dv">1</span>] <span class="sc">~</span> <span class="st">"#377eb8"</span>,</span>
<span id="cb307-8"><a href="#cb307-8" aria-hidden="true" tabindex="-1"></a>    PM2<span class="fl">.5</span> <span class="sc">&gt;=</span> quantiles[<span class="dv">2</span>] <span class="sc">~</span> <span class="st">"#E24A33"</span>,</span>
<span id="cb307-9"><a href="#cb307-9" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"#A0AEB2"</span></span>
<span id="cb307-10"><a href="#cb307-10" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb307-11"><a href="#cb307-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb307-12"><a href="#cb307-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate plot</span></span>
<span id="cb307-13"><a href="#cb307-13" aria-hidden="true" tabindex="-1"></a>plot_pm25_vs_date <span class="ot">&lt;-</span> <span class="fu">plot_pollutant</span>(<span class="fu">filter</span>(daily_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sunnyhills East"</span>, <span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>))), <span class="st">"PM2.5"</span>)</span>
<span id="cb307-14"><a href="#cb307-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb307-15"><a href="#cb307-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb307-16"><a href="#cb307-16" aria-hidden="true" tabindex="-1"></a>plot_pm25_vs_date</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-auckland-pm25-vs-date-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Queen Street and Puni shows a moderate positive trend over time (R = 0.12 and R = 0.11). Ellerslie South and Westlake experience frequent high levels, and shows moderate and weak trends. Statistical significance confirms clear differences across site-specific trends.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb308"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 10th and 90th percentiles</span></span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(daily_airdata<span class="sc">$</span>SO2, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-4"><a href="#cb308-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add color grouping based on SO2 percentiles</span></span>
<span id="cb308-5"><a href="#cb308-5" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb308-6"><a href="#cb308-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb308-7"><a href="#cb308-7" aria-hidden="true" tabindex="-1"></a>    SO2 <span class="sc">&lt;=</span> quantiles[<span class="dv">1</span>] <span class="sc">~</span> <span class="st">"#377eb8"</span>,</span>
<span id="cb308-8"><a href="#cb308-8" aria-hidden="true" tabindex="-1"></a>    SO2 <span class="sc">&gt;=</span> quantiles[<span class="dv">2</span>] <span class="sc">~</span> <span class="st">"#E24A33"</span>,</span>
<span id="cb308-9"><a href="#cb308-9" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"#A0AEB2"</span></span>
<span id="cb308-10"><a href="#cb308-10" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb308-11"><a href="#cb308-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-12"><a href="#cb308-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate plot</span></span>
<span id="cb308-13"><a href="#cb308-13" aria-hidden="true" tabindex="-1"></a>plot_so2_vs_date <span class="ot">&lt;-</span> <span class="fu">plot_pollutant</span>(<span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>), <span class="st">"SO2"</span>)</span>
<span id="cb308-14"><a href="#cb308-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-15"><a href="#cb308-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb308-16"><a href="#cb308-16" aria-hidden="true" tabindex="-1"></a>plot_so2_vs_date</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-auckland-so2-vs-date-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>The graph presents daily SO2 levels at Ellerslie South, Auckland (2016–2024), highlighting ARIMA-estimated missing values and a weak negative correlation, emphasizing seasonal fluctuations and long-term variability in pollutant concentrations.</p>
</details></section>
<section id="air-quality-index-vs-pollutant-concentrations-across-auckland-suburbs" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="air-quality-index-vs-pollutant-concentrations-across-auckland-suburbs"><span class="header-section-number">5.2</span> Air Quality Index vs Pollutant Concentrations Across Auckland Suburbs</h3>
<p>This section explores how daily concentrations of NO2, NO, PM10, PM2.5, and SO2 relate to the Air Quality Index (AQI) from 2016 to 2024. Using GAM trend lines and Pearson correlations across Auckland suburbs, the plots highlight varying relationships between pollutants and AQI, revealing regional differences in air quality responses.</p>
<details>
<summary>
Air Quality Index vs Pollutant Concentrations Across Auckland Suburbs
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb309"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a custom plotting function to examine the relationship between AQI and a selected pollutant</span></span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_pollutants <span class="ot">&lt;-</span> <span class="cf">function</span>(data, xvar) {</span>
<span id="cb309-3"><a href="#cb309-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> .data[[xvar]], <span class="at">y =</span> AQI)) <span class="sc">+</span></span>
<span id="cb309-4"><a href="#cb309-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color_group)) <span class="sc">+</span> <span class="co"># Scatter plot colored by AQI categories</span></span>
<span id="cb309-5"><a href="#cb309-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="co"># Add smooth GAM trend line</span></span>
<span id="cb309-6"><a href="#cb309-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_identity</span>(</span>
<span id="cb309-7"><a href="#cb309-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"AQI Level"</span>,  <span class="co"># Title for the legend</span></span>
<span id="cb309-8"><a href="#cb309-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">guide =</span> <span class="st">"legend"</span>, </span>
<span id="cb309-9"><a href="#cb309-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Low AQI"</span>, <span class="st">"High AQI"</span>, <span class="st">"Mid-range"</span>), <span class="co"># Labels for color groups</span></span>
<span id="cb309-10"><a href="#cb309-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"#377eb8"</span>, <span class="st">"#E24A33"</span>, <span class="st">"#A0AEB2"</span>) <span class="co"># Color codes matching the legend labels</span></span>
<span id="cb309-11"><a href="#cb309-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb309-12"><a href="#cb309-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>scientific) <span class="sc">+</span> <span class="co"># Apply log scale to AQI </span></span>
<span id="cb309-13"><a href="#cb309-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_cor</span>(<span class="at">method =</span> <span class="st">"pearson"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span> <span class="co"># Display Pearson correlation coefficients</span></span>
<span id="cb309-14"><a href="#cb309-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> sa2_name, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span> <span class="co"># One panel per SA2 suburb with independent scales</span></span>
<span id="cb309-15"><a href="#cb309-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb309-16"><a href="#cb309-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb309-17"><a href="#cb309-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Relationship Between Daily "</span>, xvar, <span class="st">" Concentration and Air Quality Index (2016–2024)"</span>),</span>
<span id="cb309-18"><a href="#cb309-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"GAM smooth trend with Pearson correlation for each SA2 region"</span>,</span>
<span id="cb309-19"><a href="#cb309-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">bquote</span>(.(xvar) <span class="sc">~</span> <span class="st">"Concentration ("</span> <span class="sc">*</span> mu <span class="sc">*</span> <span class="st">"g/"</span> <span class="sc">*</span> m<span class="sc">^</span><span class="dv">3</span> <span class="sc">*</span> <span class="st">")"</span>), <span class="co"># Dynamic x-axis label with units</span></span>
<span id="cb309-20"><a href="#cb309-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Air Quality Index (log scale)"</span> <span class="co"># y-axis label</span></span>
<span id="cb309-21"><a href="#cb309-21" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb309-22"><a href="#cb309-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb309-23"><a href="#cb309-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb309-24"><a href="#cb309-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb309-25"><a href="#cb309-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb309-26"><a href="#cb309-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb309-27"><a href="#cb309-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb309-28"><a href="#cb309-28" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb309-29"><a href="#cb309-29" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb310"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checks if NO2 data is available for Sunnyhills East (it's not)</span></span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb310-3"><a href="#cb310-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">==</span> <span class="st">"Sunnyhills East"</span>) <span class="sc">|&gt;</span></span>
<span id="cb310-4"><a href="#cb310-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(NO2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
    NO2     n
  &lt;dbl&gt; &lt;int&gt;
1     0  2876</code></pre>
</div>
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 10th and 90th percentiles</span></span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(daily_airdata<span class="sc">$</span>AQI, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorizes AQI into Low, Mid-range, and High using 10th and 90th percentiles</span></span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb312-6"><a href="#cb312-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb312-7"><a href="#cb312-7" aria-hidden="true" tabindex="-1"></a>    AQI <span class="sc">&lt;=</span> quantiles[<span class="dv">1</span>] <span class="sc">~</span> <span class="st">"#377eb8"</span>,</span>
<span id="cb312-8"><a href="#cb312-8" aria-hidden="true" tabindex="-1"></a>    AQI <span class="sc">&gt;=</span> quantiles[<span class="dv">2</span>] <span class="sc">~</span> <span class="st">"#E24A33"</span>,</span>
<span id="cb312-9"><a href="#cb312-9" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"#A0AEB2"</span></span>
<span id="cb312-10"><a href="#cb312-10" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb312-11"><a href="#cb312-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-12"><a href="#cb312-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots AQI vs NO2 for Auckland suburbs (excluding Sunnyhills East)</span></span>
<span id="cb312-13"><a href="#cb312-13" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_no2 <span class="ot">&lt;-</span> <span class="fu">plot_aqi_vs_pollutants</span>(</span>
<span id="cb312-14"><a href="#cb312-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">!=</span> <span class="st">"Sunnyhills East"</span>), <span class="st">"NO2"</span>)</span>
<span id="cb312-15"><a href="#cb312-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-16"><a href="#cb312-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb312-17"><a href="#cb312-17" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_no2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-auckland-aqi-vs-no2-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Queen Street shows a clear upward trend in AQI with increasing NO2, reinforced by a strong correlation (R = 0.49). Ellerslie South and Westlake follow similar, though weaker, trends. Sites like Puni, Henderson Lincoln South, and Glen Eden Central show slight AQI declines as NO2 rises, with Puni’s correlation (R = -0.048) suggesting a modest inverse relationship between pollution levels and air quality categorization.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb313"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots AQI vs NO across Auckland suburbs</span></span>
<span id="cb313-2"><a href="#cb313-2" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_no <span class="ot">&lt;-</span> <span class="fu">plot_aqi_vs_pollutants</span>(<span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">!=</span> <span class="st">"Sunnyhills East"</span>), <span class="st">"NO"</span>)</span>
<span id="cb313-3"><a href="#cb313-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-4"><a href="#cb313-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb313-5"><a href="#cb313-5" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_no</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-auckland-aqi-vs-no-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Queen Street shows the moderate positive correlation (R = 0.35), while Puni has a weak negative correlation (R = -0.049). Ellerslie South and Westlake also show notable trends (R = 0.14, 0.17). AQI categories highlight pollutant variability, with high AQI associated with elevated NO levels across sites. Henderson Lincoln South shows no clear correlation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb314"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots AQI vs PM10 for all Auckland suburbs</span></span>
<span id="cb314-2"><a href="#cb314-2" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_pm10 <span class="ot">&lt;-</span> <span class="fu">plot_aqi_vs_pollutants</span>(daily_airdata, <span class="st">"PM10"</span>)</span>
<span id="cb314-3"><a href="#cb314-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-4"><a href="#cb314-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb314-5"><a href="#cb314-5" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_pm10</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-auckland-aqi-vs-pm10-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>PM10 concentration correlates moderately with AQI across regions, with R values between 0.22 and 0.41. The GAM trend lines indicate varying patterns, suggesting differences in pollution dynamics. High AQI levels align with increased PM10, while low AQI spans broader concentration ranges. Regional variations highlight distinct pollutant behaviors, emphasizing localized air quality influences and the need for tailored mitigation strategies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb315"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots AQI vs PM2.5 (excludes suburbs with incomplete PM2.5 data)</span></span>
<span id="cb315-2"><a href="#cb315-2" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_pm2<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">plot_aqi_vs_pollutants</span>(</span>
<span id="cb315-3"><a href="#cb315-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(daily_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>)), <span class="st">"PM2.5"</span>)</span>
<span id="cb315-4"><a href="#cb315-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb315-5"><a href="#cb315-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb315-6"><a href="#cb315-6" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_pm2<span class="fl">.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-auckland-aqi-vs-pm25-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>The GAM smooth trends show increasing PM2.5 concentrations with AQI across all regions, though with variations in slope. Correlation coefficients indicate weak to moderate positive associations (R = 0.18 to 0.34). Queen Street exhibit highest correlations. Categories reveal AQI levels predominantly in the low to mid range, with high AQI events infrequent yet impactful.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb316"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots AQI vs SO2 specifically for Ellerslie South</span></span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_so2 <span class="ot">&lt;-</span> <span class="fu">plot_aqi_vs_pollutants</span>(<span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>), <span class="st">"SO2"</span>)</span>
<span id="cb316-3"><a href="#cb316-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-4"><a href="#cb316-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb316-5"><a href="#cb316-5" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_so2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-auckland-aqi-vs-so2-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>SO2 concentration and AQI in Ellerslie South show a weak correlation (R = 0.059, p = 0.0016). High AQI events are rare, with most readings in low-to-mid categories. No strong temporal trend is evident.</p>
</details>
</section>
<section id="air-temperature-versus-pollutant-concentrations-across-auckland-suburbs" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="air-temperature-versus-pollutant-concentrations-across-auckland-suburbs"><span class="header-section-number">5.3</span> Air Temperature versus Pollutant Concentrations Across Auckland Suburbs</h3>
<p>This section explores how daily air temperature influences pollutant concentrations (NO2, NO, PM10, PM2.5, SO2) across selected Auckland suburbs. Using GAM smoothing and correlation analysis, both raw and standardized data are examined to reveal regional trends and statistical relationships, highlighting the impact of temperature extremes on urban air quality from 2016 to 2024.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb317"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 10th and 90th percentiles</span></span>
<span id="cb317-2"><a href="#cb317-2" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(daily_airdata<span class="sc">$</span>AirTemp, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb317-3"><a href="#cb317-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-4"><a href="#cb317-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorizes air temperature into Low, Mid-range, and High using 10th and 90th percentiles</span></span>
<span id="cb317-5"><a href="#cb317-5" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb317-6"><a href="#cb317-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb317-7"><a href="#cb317-7" aria-hidden="true" tabindex="-1"></a>    AirTemp <span class="sc">&lt;=</span> quantiles[<span class="dv">1</span>] <span class="sc">~</span> <span class="st">"#377eb8"</span>,</span>
<span id="cb317-8"><a href="#cb317-8" aria-hidden="true" tabindex="-1"></a>    AirTemp <span class="sc">&gt;=</span> quantiles[<span class="dv">2</span>] <span class="sc">~</span> <span class="st">"#E24A33"</span>,</span>
<span id="cb317-9"><a href="#cb317-9" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"#A0AEB2"</span></span>
<span id="cb317-10"><a href="#cb317-10" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb317-11"><a href="#cb317-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-12"><a href="#cb317-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a custom plotting function to examine the relationship between air temperature and a selected pollutant</span></span>
<span id="cb317-13"><a href="#cb317-13" aria-hidden="true" tabindex="-1"></a>plot_airtemp_vs_pollutants <span class="ot">&lt;-</span> <span class="cf">function</span>(data, yvar, stat_y) {</span>
<span id="cb317-14"><a href="#cb317-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> AirTemp, <span class="at">y =</span> .data[[yvar]])) <span class="sc">+</span></span>
<span id="cb317-15"><a href="#cb317-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color_group)) <span class="sc">+</span> <span class="co"># Scatter plot colored by pollutant categories</span></span>
<span id="cb317-16"><a href="#cb317-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="co"># Add smooth GAM trend line</span></span>
<span id="cb317-17"><a href="#cb317-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_identity</span>(</span>
<span id="cb317-18"><a href="#cb317-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"AirTemp Level"</span>,  <span class="co"># Title for the legend</span></span>
<span id="cb317-19"><a href="#cb317-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">guide =</span> <span class="st">"legend"</span>, </span>
<span id="cb317-20"><a href="#cb317-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Cold"</span>, <span class="st">"Warm"</span>, <span class="st">"Hot"</span>), <span class="co"># Labels for color groups</span></span>
<span id="cb317-21"><a href="#cb317-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"#377eb8"</span>, <span class="st">"#A0AEB2"</span>, <span class="st">"#E24A33"</span>) <span class="co"># Color codes matching the legend labels</span></span>
<span id="cb317-22"><a href="#cb317-22" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb317-23"><a href="#cb317-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>scientific) <span class="sc">+</span> <span class="co"># Apply log scale to AQI </span></span>
<span id="cb317-24"><a href="#cb317-24" aria-hidden="true" tabindex="-1"></a>   <span class="fu">stat_cor</span>(</span>
<span id="cb317-25"><a href="#cb317-25" aria-hidden="true" tabindex="-1"></a>     <span class="at">method =</span> <span class="st">"pearson"</span>, <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb317-26"><a href="#cb317-26" aria-hidden="true" tabindex="-1"></a>     <span class="at">label.x.npc =</span> <span class="st">"left"</span>, <span class="at">label.y.npc =</span> stat_y) <span class="sc">+</span></span>
<span id="cb317-27"><a href="#cb317-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> sa2_name, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span> <span class="co"># One panel per SA2 suburb with independent scales</span></span>
<span id="cb317-28"><a href="#cb317-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb317-29"><a href="#cb317-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb317-30"><a href="#cb317-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Relationship Between Daily Air Temperature and "</span>, yvar, <span class="st">" Concentration (2016–2024)"</span>),</span>
<span id="cb317-31"><a href="#cb317-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"GAM smooth trend with Pearson correlation for each SA2 region"</span>,</span>
<span id="cb317-32"><a href="#cb317-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Air Temperature (°C)"</span>,</span>
<span id="cb317-33"><a href="#cb317-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">bquote</span>(.(yvar) <span class="sc">~</span> <span class="st">"Concentration ("</span> <span class="sc">*</span> mu <span class="sc">*</span> <span class="st">"g/"</span> <span class="sc">*</span> m<span class="sc">^</span><span class="dv">3</span> <span class="sc">*</span> <span class="st">")"</span>) <span class="co"># Dynamic y-axis label with units</span></span>
<span id="cb317-34"><a href="#cb317-34" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb317-35"><a href="#cb317-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb317-36"><a href="#cb317-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb317-37"><a href="#cb317-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb317-38"><a href="#cb317-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb317-39"><a href="#cb317-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb317-40"><a href="#cb317-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb317-41"><a href="#cb317-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb317-42"><a href="#cb317-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb317-43"><a href="#cb317-43" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb317-44"><a href="#cb317-44" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb318"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View distinct values of AirTemp in each sa2_name</span></span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb318-3"><a href="#cb318-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb318-4"><a href="#cb318-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_rows =</span> <span class="fu">n</span>(), </span>
<span id="cb318-5"><a href="#cb318-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">missing_airtemp =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(AirTemp)),</span>
<span id="cb318-6"><a href="#cb318-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 3
  sa2_name                total_rows missing_airtemp
  &lt;chr&gt;                        &lt;int&gt;           &lt;int&gt;
1 Ellerslie South               2879               0
2 Glen Eden Central             2827               0
3 Henderson Lincoln South       2823               0
4 Puni                          2834            2834
5 Queen Street                  2276               0
6 Sunnyhills East               2876               0
7 Westlake                      2823               0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb320"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Puni has all values missing, while others have partial missing data</span></span>
<span id="cb320-2"><a href="#cb320-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-3"><a href="#cb320-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out "Puni"</span></span>
<span id="cb320-4"><a href="#cb320-4" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb320-5"><a href="#cb320-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">!=</span> <span class="st">"Puni"</span>) <span class="sc">|&gt;</span></span>
<span id="cb320-6"><a href="#cb320-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb320-7"><a href="#cb320-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Approximate missing AirTemp using ARIMA imputation</span></span>
<span id="cb320-8"><a href="#cb320-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AirTemp =</span> <span class="fu">na_kalman</span>(AirTemp, <span class="at">model =</span> <span class="st">"auto.arima"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb320-9"><a href="#cb320-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb320-10"><a href="#cb320-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-11"><a href="#cb320-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if missing values are all approximated</span></span>
<span id="cb320-12"><a href="#cb320-12" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb320-13"><a href="#cb320-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb320-14"><a href="#cb320-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(AirTemp)) <span class="sc">|&gt;</span> </span>
<span id="cb320-15"><a href="#cb320-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 18
# ℹ 18 variables: sa2_name &lt;chr&gt;, site_type &lt;chr&gt;, date &lt;date&gt;, year &lt;chr&gt;,
#   geometry &lt;GEOMETRY [°]&gt;, pop2018 &lt;int&gt;, longitude &lt;dbl&gt;, latitude &lt;dbl&gt;,
#   AQI &lt;dbl&gt;, NO2 &lt;dbl&gt;, NO &lt;dbl&gt;, PM10 &lt;dbl&gt;, PM2.5 &lt;dbl&gt;, SO2 &lt;dbl&gt;,
#   AirTemp &lt;dbl&gt;, WindDir &lt;dbl&gt;, WindSpeed &lt;dbl&gt;, color_group &lt;chr&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb322"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All missing AirTemp values are approximated</span></span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-3"><a href="#cb322-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardized air temperature, air pollutants, and AQI for each site</span></span>
<span id="cb322-4"><a href="#cb322-4" aria-hidden="true" tabindex="-1"></a>standardized_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb322-5"><a href="#cb322-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb322-6"><a href="#cb322-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb322-7"><a href="#cb322-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">AirTemp =</span> (AirTemp <span class="sc">-</span> <span class="fu">mean</span>(AirTemp)) <span class="sc">/</span> <span class="fu">sd</span>(AirTemp),</span>
<span id="cb322-8"><a href="#cb322-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">AQI =</span> (AQI <span class="sc">-</span> <span class="fu">mean</span>(AQI)) <span class="sc">/</span> <span class="fu">sd</span>(AQI),</span>
<span id="cb322-9"><a href="#cb322-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">NO2 =</span> (NO2 <span class="sc">-</span> <span class="fu">mean</span>(NO2)) <span class="sc">/</span> <span class="fu">sd</span>(NO2),</span>
<span id="cb322-10"><a href="#cb322-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">NO =</span> (NO <span class="sc">-</span> <span class="fu">mean</span>(NO)) <span class="sc">/</span> <span class="fu">sd</span>(NO),</span>
<span id="cb322-11"><a href="#cb322-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">PM10 =</span> (PM10 <span class="sc">-</span> <span class="fu">mean</span>(PM10)) <span class="sc">/</span> <span class="fu">sd</span>(PM10),</span>
<span id="cb322-12"><a href="#cb322-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">PM2.5 =</span> (PM2<span class="fl">.5</span> <span class="sc">-</span> <span class="fu">mean</span>(PM2<span class="fl">.5</span>)) <span class="sc">/</span> <span class="fu">sd</span>(PM2<span class="fl">.5</span>),</span>
<span id="cb322-13"><a href="#cb322-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">SO2 =</span> (SO2 <span class="sc">-</span> <span class="fu">mean</span>(SO2)) <span class="sc">/</span> <span class="fu">sd</span>(SO2)</span>
<span id="cb322-14"><a href="#cb322-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb322-15"><a href="#cb322-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb322-16"><a href="#cb322-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-17"><a href="#cb322-17" aria-hidden="true" tabindex="-1"></a><span class="co"># View the selected column details</span></span>
<span id="cb322-18"><a href="#cb322-18" aria-hidden="true" tabindex="-1"></a>standardized_airdata <span class="sc">|&gt;</span></span>
<span id="cb322-19"><a href="#cb322-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(AirTemp, AQI, NO2, NO, PM10, PM2<span class="fl">.5</span>, SO2) <span class="sc">|&gt;</span></span>
<span id="cb322-20"><a href="#cb322-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">skim</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">select(…)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">16504</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 6%">
<col style="width: 3%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 7%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AirTemp</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-14.87</td>
<td style="text-align: right;">-0.42</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">4.03</td>
<td style="text-align: left;">▁▁▁▇▆</td>
</tr>
<tr class="even">
<td style="text-align: left;">AQI</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-2.44</td>
<td style="text-align: right;">-0.32</td>
<td style="text-align: right;">-0.10</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">35.23</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NO2</td>
<td style="text-align: right;">2876</td>
<td style="text-align: right;">0.83</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-3.50</td>
<td style="text-align: right;">-0.74</td>
<td style="text-align: right;">-0.17</td>
<td style="text-align: right;">0.62</td>
<td style="text-align: right;">13.24</td>
<td style="text-align: left;">▇▇▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">NO</td>
<td style="text-align: right;">2876</td>
<td style="text-align: right;">0.83</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1.77</td>
<td style="text-align: right;">-0.71</td>
<td style="text-align: right;">-0.34</td>
<td style="text-align: right;">0.41</td>
<td style="text-align: right;">9.30</td>
<td style="text-align: left;">▇▂▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PM10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-3.01</td>
<td style="text-align: right;">-0.65</td>
<td style="text-align: right;">-0.12</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">25.18</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">PM2.5</td>
<td style="text-align: right;">8526</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-2.90</td>
<td style="text-align: right;">-0.72</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">39.01</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SO2</td>
<td style="text-align: right;">13625</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-2.61</td>
<td style="text-align: right;">-0.57</td>
<td style="text-align: right;">-0.16</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">8.74</td>
<td style="text-align: left;">▆▇▁▁▁</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb323"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All variables are approximately centered around zero, confirming successful standardization. The missing value counts are for the sites not having that pollutant. Histograms show skewness, with AQI and PM pollutants heavily right-skewed, and NO2 and SO2 slightly more dispersed.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
AQI vs Air Temperature
</summary>
<p>Visually check for correlation between raw air temperature and AQI levels across sites. Explore whether AQI vary consistently with temperature. Assess whether standardizing air temperature and AQI improves clarity of trends. Reduces distortion from temperature outliers for better pattern detection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb324"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw air temperature vs AQI for selected sites</span></span>
<span id="cb324-2"><a href="#cb324-2" aria-hidden="true" tabindex="-1"></a>plot_airtemp_vs_aqi <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(</span>
<span id="cb324-3"><a href="#cb324-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">!=</span> <span class="st">"Puni"</span>), <span class="st">"AQI"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb324-4"><a href="#cb324-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Air Quality Index (AQI)"</span>)</span>
<span id="cb324-5"><a href="#cb324-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-6"><a href="#cb324-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb324-7"><a href="#cb324-7" aria-hidden="true" tabindex="-1"></a>plot_airtemp_vs_aqi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-airtemp-vs-aqi-all-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>AQI declines with temperature significantly at Queen Street (R = -0.12), Ellerslie South (R = -0.085), and Glen Eden Central (R = -0.082), suggesting a weak negative trend. Westlake, Henderson Lincoln South, and Sunnyhills East shows non-significant correlation (p &gt; 0.001), while other sites exhibit insignificant trends. Potential outliers may exist where AQI spikes unexpectedly, possibly due to local pollution events.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb325"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot standardized air temperature vs AQI standardized for selected sites</span></span>
<span id="cb325-2"><a href="#cb325-2" aria-hidden="true" tabindex="-1"></a>standardize_airtemp_vs_aqi <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(<span class="fu">filter</span>(standardized_airdata, sa2_name <span class="sc">!=</span> <span class="st">"Puni"</span>), <span class="st">"AQI"</span>, <span class="st">"top"</span>) <span class="sc">+</span> </span>
<span id="cb325-3"><a href="#cb325-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span> <span class="co"># Change to normal scale</span></span>
<span id="cb325-4"><a href="#cb325-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb325-5"><a href="#cb325-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Relationship Between Daily Standardized Air Temperature and AQI Standardized (2016–2024)"</span>,</span>
<span id="cb325-6"><a href="#cb325-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Standardized Air Temperature"</span>,</span>
<span id="cb325-7"><a href="#cb325-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Standardized AQI"</span>)</span>
<span id="cb325-8"><a href="#cb325-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-9"><a href="#cb325-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb325-10"><a href="#cb325-10" aria-hidden="true" tabindex="-1"></a>standardize_airtemp_vs_aqi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-standardized-airtemp-vs-aqi-standardized-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
Standardized AQI data improves clarity but retains similar trends. Ellerslie South loses significance (p &gt; 0.001). Queen Street, Glen Eden Central and Henderson Lincoln South have weak significant correlations. Sunnyhills East correlation remains insignificant. Possibilities of outliers at all the sites, likely due to pollution spikes. Temperature categories remain unchanged. Standardization highlights variability but doesn’t alter trends significantly.
</details>
<details>
<summary>
NO2 vs Air Temperature
</summary>
<p>Visually check for correlation between raw air temperature and NO2 levels across sites. Explore whether NO2 concentrations vary consistently with air temperature. Assess whether standardizing air temperature and NO2 improves clarity of trends. Reduces distortion from temperature outliers for better pattern detection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb326"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checks if NO2 data is available for Sunnyhills East (it's not)</span></span>
<span id="cb326-2"><a href="#cb326-2" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb326-3"><a href="#cb326-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sunnyhills East"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb326-4"><a href="#cb326-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(NO2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
    NO2     n
  &lt;dbl&gt; &lt;int&gt;
1     0  2876</code></pre>
</div>
<div class="sourceCode cell-code" id="cb328"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw air temperature vs NO2 for selected sites</span></span>
<span id="cb328-2"><a href="#cb328-2" aria-hidden="true" tabindex="-1"></a>plot_airtemp_vs_no2 <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(</span>
<span id="cb328-3"><a href="#cb328-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(daily_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Sunnyhills East"</span>)), <span class="st">"NO2"</span>, <span class="st">"bottom"</span>)</span>
<span id="cb328-4"><a href="#cb328-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb328-5"><a href="#cb328-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb328-6"><a href="#cb328-6" aria-hidden="true" tabindex="-1"></a>plot_airtemp_vs_no2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-airtemp-vs-no2-at-all-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>All regions show a negative correlation between air temperature and NO2, strongest in Ellerslie South (R = -0.28). Cold days (blue) generally have higher NO2. Queen Street shows more scatter, suggesting potential outliers. Nonlinear trends suggest other influencing factors, and hot days (red) consistently show lower concentrations. Outliers may exist at very low or high concentrations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb329"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot standardized air temperature vs NO2 standardized for selected sites</span></span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a>standardize_airtemp_vs_no2 <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(<span class="fu">filter</span>(standardized_airdata, sa2_name <span class="sc">!=</span> <span class="st">"Sunnyhills East"</span>), <span class="st">"NO2"</span>, <span class="st">"top"</span>) <span class="sc">+</span> </span>
<span id="cb329-3"><a href="#cb329-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span> <span class="co"># Change to normal scale</span></span>
<span id="cb329-4"><a href="#cb329-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb329-5"><a href="#cb329-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Relationship Between Daily Standardized Air Temperature and NO2 Standardized (2016–2024)"</span>,</span>
<span id="cb329-6"><a href="#cb329-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Standardized Air Temperature"</span>,</span>
<span id="cb329-7"><a href="#cb329-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Standardized NO2 Concentration"</span>)</span>
<span id="cb329-8"><a href="#cb329-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-9"><a href="#cb329-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb329-10"><a href="#cb329-10" aria-hidden="true" tabindex="-1"></a>standardize_airtemp_vs_no2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-standardized-airtemp-vs-no2-standardized-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
The standardized graph refines trends by normalizing variables, highlighting clearer negative correlations between air temperature and NO2 levels across sites. While both graphs show high significance (p &lt; 0.00001), the standardized version enhances visibility of minor variations. Outliers remain evident at extreme temperatures, suggesting local influences.
</details>
<details>
<summary>
NO vs Air Temperature
</summary>
<p>Identify general pattern between raw air temperature and NO levels across sites. Check for outliers or nonlinear trends in NO vs temperature. Use standardized temperature and standardized NO levels to evaluate cleaner NO trends. Highlights central tendency while minimizing extreme value effects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb330"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checks if NO data is available for Sunnyhills East (it's not)</span></span>
<span id="cb330-2"><a href="#cb330-2" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb330-3"><a href="#cb330-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sunnyhills East"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb330-4"><a href="#cb330-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(NO)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
     NO     n
  &lt;dbl&gt; &lt;int&gt;
1     0  2876</code></pre>
</div>
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw air temperature vs NO for selected sites</span></span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true" tabindex="-1"></a>plot_airtemp_vs_no <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(</span>
<span id="cb332-3"><a href="#cb332-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(daily_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Sunnyhills East"</span>)), <span class="st">"NO"</span>, <span class="st">"bottom"</span>)</span>
<span id="cb332-4"><a href="#cb332-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-5"><a href="#cb332-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb332-6"><a href="#cb332-6" aria-hidden="true" tabindex="-1"></a>plot_airtemp_vs_no</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-airtemp-vs-no-auckland-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>The graph shows that NO concentration generally decreases as temperature rises, except on Queen Street. Correlations range from -0.1 to -0.2, all statistically significant (p &lt; 0.0001). Outliers appear at all sites, particularly at higher temperatures. Different sites exhibit distinct trends, suggesting environmental factors may influence NO levels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb333"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot standardized air temperature vs NO standardized for selected sites</span></span>
<span id="cb333-2"><a href="#cb333-2" aria-hidden="true" tabindex="-1"></a>standardize_airtemp_vs_no <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(<span class="fu">filter</span>(standardized_airdata, sa2_name <span class="sc">!=</span> <span class="st">"Sunnyhills East"</span>), <span class="st">"NO"</span>, <span class="st">"top"</span>) <span class="sc">+</span> </span>
<span id="cb333-3"><a href="#cb333-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span> <span class="co"># Change to normal scale</span></span>
<span id="cb333-4"><a href="#cb333-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb333-5"><a href="#cb333-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Relationship Between Daily Standardized Air Temperature and NO Standardized (2016–2024)"</span>,</span>
<span id="cb333-6"><a href="#cb333-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Standardized Air Temperature"</span>,</span>
<span id="cb333-7"><a href="#cb333-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Standardized NO Concentration"</span>)</span>
<span id="cb333-8"><a href="#cb333-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb333-9"><a href="#cb333-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb333-10"><a href="#cb333-10" aria-hidden="true" tabindex="-1"></a>standardize_airtemp_vs_no</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-standardized-airtemp-vs-no-standardized-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
Standardization reveals clearer trends: NO concentration decreases more uniformly with temperature, strengthening correlations (-0.06 to -0.13). Significance remains unchanged, except Queen Street correlation is now non-significant. Category divisions (cold, warm, hot) show more distinct separation, reducing overlap. Outliers persist but are more identifiable at extreme temperatures and extreme NO concentration. The refined view emphasizes regional differences and environmental influences more effectively.
</details>
<details>
<summary>
PM10 vs Air Temperature
</summary>
<p>Examine how PM10 concentrations change with raw temperature. Helps identify seasonal or heat-related pollution effects. Use standardized temperature and standard PM10 concentrations to clarify relationship. Removes noise from extreme temperature values to focus on main trend.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb334"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw air temperature vs PM10 for selected sites</span></span>
<span id="cb334-2"><a href="#cb334-2" aria-hidden="true" tabindex="-1"></a>plot_airtemp_vs_pm10 <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(</span>
<span id="cb334-3"><a href="#cb334-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">!=</span> <span class="st">"Puni"</span>), <span class="st">"PM10"</span>, <span class="st">"top"</span>)</span>
<span id="cb334-4"><a href="#cb334-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb334-5"><a href="#cb334-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb334-6"><a href="#cb334-6" aria-hidden="true" tabindex="-1"></a>plot_airtemp_vs_pm10</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-airtemp-vs-pm10-auckland-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Ellerslie South and Westlake show no clear trend, with weak correlations and non-significant relationships. Glen Eden, Henderson Lincoln South, and Sunnyhills East show mild downward trends with significant negative correlations. Queen Street shows a weak, significant upward trend. Temperature-related PM10 effects vary by site, with some showing clear relationships while others remain inconclusive.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb335"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot standardized air temperature vs PM10 standardized for each site </span></span>
<span id="cb335-2"><a href="#cb335-2" aria-hidden="true" tabindex="-1"></a>plot_standardized_airtemp_vs_pm10 <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(standardized_airdata, <span class="st">"PM10"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb335-3"><a href="#cb335-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb335-4"><a href="#cb335-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Relationship Between Daily Standardized Air Temperature and PM10 Concentration Standardized (2016–2024)"</span>),</span>
<span id="cb335-5"><a href="#cb335-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Air Temperature"</span>,</span>
<span id="cb335-6"><a href="#cb335-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized PM10"</span>)</span>
<span id="cb335-7"><a href="#cb335-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb335-8"><a href="#cb335-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb335-9"><a href="#cb335-9" aria-hidden="true" tabindex="-1"></a>plot_standardized_airtemp_vs_pm10</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-standardized-airtemp-vs-pm10-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
Ellerslie South and Westlake show no clear trend, with weak correlations and no significance. Glen Eden Central shows weak upward trend with significant positive correlations. The rest of the sites exhibits weak non-significant upward and downward trends. Outliers are present at all sites, especially Queen Street and Sunnyhills East. Temperature categories influence PM10 differently across sites.
</details>
<details>
<summary>
PM2.5 vs Air Temperature
</summary>
<p>Investigate PM2.5 variation with raw air temperature across selected sites. Detect possible temperature-dependent behavior of fine particulates. Compare standardized temperature effect on standardized PM2.5. Filter out extreme values to enhance trend visibility. Improves trend interpretation by reducing the impact of outliers in both variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb336"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw air temperature vs PM2.5 (data available for 3 sites)</span></span>
<span id="cb336-2"><a href="#cb336-2" aria-hidden="true" tabindex="-1"></a>plot_airtemp_vs_pm2<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(</span>
<span id="cb336-3"><a href="#cb336-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ellerslie South"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Westlake"</span>)), <span class="st">"PM2.5"</span>, <span class="st">"bottom"</span>)</span>
<span id="cb336-4"><a href="#cb336-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb336-5"><a href="#cb336-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb336-6"><a href="#cb336-6" aria-hidden="true" tabindex="-1"></a>plot_airtemp_vs_pm2<span class="fl">.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-airtemp-vs-pm25-selected-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Westlake shows the strongest negative correlation (-0.14), suggesting PM2.5 decreases as temperature rises. Ellerslie South follows (-0.093), while Queen Street’s correlation is weak and non-significant (0.052, p=0.014). Cold temperatures generally align with higher PM2.5 levels. Outliers, especially in Westlake, indicate extreme PM2.5 spikes at warm and hot temperatures, likely from localized emissions or meteorological influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb337"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot standardized air temperature vs PM2.5 standardized</span></span>
<span id="cb337-2"><a href="#cb337-2" aria-hidden="true" tabindex="-1"></a>plot_standardized_airtemp_vs_pm2<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(<span class="fu">filter</span>(standardized_airdata, sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ellerslie South"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Westlake"</span>)), <span class="st">"PM2.5"</span>, <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb337-3"><a href="#cb337-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb337-4"><a href="#cb337-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Relationship Between Standardized Daily Air Temperature and Daily PM2.5 Concentration Standardized (2016–2024)"</span>),</span>
<span id="cb337-5"><a href="#cb337-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Air Temperature"</span>,</span>
<span id="cb337-6"><a href="#cb337-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized PM2.5"</span>)</span>
<span id="cb337-7"><a href="#cb337-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-8"><a href="#cb337-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb337-9"><a href="#cb337-9" aria-hidden="true" tabindex="-1"></a>plot_standardized_airtemp_vs_pm2<span class="fl">.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-standardized-airtemp-vs-pm25-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
Air temperature and PM2.5 levels shows negative significant correlations at Ellerslie South and Westlake whereas Queen Street shows non-significant correlation. PM2.5 outliers might arise from local pollution spikes. Statistical significance depends on seasonal variation and source proximity.
</details>
<details>
<summary>
SO2 vs Air Temperature
</summary>
<p>Analyze SO2 variation with raw air temperature at Ellerslie (only site with SO2 data). Evaluate site-specific patterns in SO2 behavior with temperature. Repeat analysis using standardized temperature and standardized SO2. Improve visualization by reducing impact of temperature outliers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw air temperature vs SO2 (SO2 data is available for Ellerslie site only)</span></span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a>airtemp_vs_so2 <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(</span>
<span id="cb338-3"><a href="#cb338-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>), <span class="st">"SO2"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb338-4"><a href="#cb338-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">""</span>, <span class="at">subtitle =</span> <span class="st">"Raw Data"</span>) <span class="sc">+</span></span>
<span id="cb338-5"><a href="#cb338-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb338-6"><a href="#cb338-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-7"><a href="#cb338-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot standardized air temperature vs SO2 standardized </span></span>
<span id="cb338-8"><a href="#cb338-8" aria-hidden="true" tabindex="-1"></a>standardized_airtemp_vs_so2 <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(<span class="fu">filter</span>(standardized_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>), <span class="st">"SO2"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb338-9"><a href="#cb338-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb338-10"><a href="#cb338-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">""</span>, <span class="at">subtitle =</span> <span class="st">"Standardized Data"</span>,</span>
<span id="cb338-11"><a href="#cb338-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Air Temperature"</span>,</span>
<span id="cb338-12"><a href="#cb338-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized SO2"</span>) <span class="sc">+</span></span>
<span id="cb338-13"><a href="#cb338-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb338-14"><a href="#cb338-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-15"><a href="#cb338-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb338-16"><a href="#cb338-16" aria-hidden="true" tabindex="-1"></a>combined_airtemp_vs_so2 <span class="ot">&lt;-</span> airtemp_vs_so2 <span class="sc">+</span> standardized_airtemp_vs_so2 <span class="sc">+</span></span>
<span id="cb338-17"><a href="#cb338-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">+</span> <span class="co"># Collect legend</span></span>
<span id="cb338-18"><a href="#cb338-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb338-19"><a href="#cb338-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Daily Air Temperature and SO2 Concentration (2016–2024)"</span>,</span>
<span id="cb338-20"><a href="#cb338-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"GAM smooth trend with Pearson correlation for each SA2 region"</span>,</span>
<span id="cb338-21"><a href="#cb338-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb338-22"><a href="#cb338-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb338-23"><a href="#cb338-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb338-24"><a href="#cb338-24" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb338-25"><a href="#cb338-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-26"><a href="#cb338-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb338-27"><a href="#cb338-27" aria-hidden="true" tabindex="-1"></a>combined_airtemp_vs_so2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-airtemp-vs-so2-ellerslie-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
The standardized data plot shows a slightly stronger negative correlation between air temperature and SO2 concentration (R = -0.16, significant). The raw data data weakens this correlation (R = -0.13, significant). Cold days generally show higher SO2 levels, while warm and hot days show a downward trend. The GAM smooth confirms overall SO2 decrease with rising temperature.
</details>
</section>
<section id="explore-wind-speed-direction-and-air-temperature-across-auckland-air-quality-sites" class="level3" data-number="5.4">
<h3 data-number="5.4" class="anchored" data-anchor-id="explore-wind-speed-direction-and-air-temperature-across-auckland-air-quality-sites"><span class="header-section-number">5.4</span> Explore Wind Speed, Direction, and Air Temperature Across Auckland Air Quality Sites</h3>
<p>n this section, I investigate key meteorological factors—specifically wind speed, wind direction, and air temperature—across various Auckland air quality monitoring sites from 2016 to 2024. By visualizing and analyzing the relationships between these variables, I aim to uncover temporal trends, site-specific patterns, and correlations that may influence local air pollution dynamics. Sites with incomplete or invalid data (e.g., entirely missing or extreme negative values) are identified and excluded to ensure valid interpretation. Correlation coefficients are computed for each site to quantify the strength and direction of relationships between variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb339"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify sites where WindSpeed is missing for all observations</span></span>
<span id="cb339-2"><a href="#cb339-2" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb339-3"><a href="#cb339-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb339-4"><a href="#cb339-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">all</span>(<span class="fu">is.na</span>(WindSpeed))) <span class="sc">|&gt;</span></span>
<span id="cb339-5"><a href="#cb339-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb339-6"><a href="#cb339-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sa2_name, WindSpeed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  sa2_name     WindSpeed     n
  &lt;chr&gt;            &lt;dbl&gt; &lt;int&gt;
1 Queen Street        NA  2276</code></pre>
</div>
<div class="sourceCode cell-code" id="cb341"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a><span class="co"># =&gt; Queen Street has no WindSpeed data and will be excluded from plotting</span></span>
<span id="cb341-2"><a href="#cb341-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-3"><a href="#cb341-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out Queen Street due to entirely missing WindSpeed data</span></span>
<span id="cb341-4"><a href="#cb341-4" aria-hidden="true" tabindex="-1"></a>daily_windspeed <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb341-5"><a href="#cb341-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">!=</span> <span class="st">"Queen Street"</span>)</span>
<span id="cb341-6"><a href="#cb341-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-7"><a href="#cb341-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create scatter plot of daily WindSpeed over time, faceted by site</span></span>
<span id="cb341-8"><a href="#cb341-8" aria-hidden="true" tabindex="-1"></a>plot_pts <span class="ot">&lt;-</span> <span class="cf">function</span>(data, xvar) {</span>
<span id="cb341-9"><a href="#cb341-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> {{xvar}}, <span class="at">y =</span> WindSpeed)) <span class="sc">+</span></span>
<span id="cb341-10"><a href="#cb341-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> site_type)) <span class="sc">+</span></span>
<span id="cb341-11"><a href="#cb341-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_cor</span>(</span>
<span id="cb341-12"><a href="#cb341-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">"pearson"</span>, <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb341-13"><a href="#cb341-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">label.x.npc =</span> <span class="st">"left"</span>, <span class="at">label.y.npc =</span> <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb341-14"><a href="#cb341-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> sa2_name, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb341-15"><a href="#cb341-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"G"</span>) <span class="sc">+</span> </span>
<span id="cb341-16"><a href="#cb341-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb341-17"><a href="#cb341-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb341-18"><a href="#cb341-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Distribution of Daily Wind Speed vs. Date by Sites in Auckland (2016–2024)"</span>,</span>
<span id="cb341-19"><a href="#cb341-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Excludes Queen Street and Puni (all missing values)"</span>,</span>
<span id="cb341-20"><a href="#cb341-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Wind Speed (m/s)"</span>, <span class="at">color =</span> <span class="st">"Site Type"</span>) <span class="sc">+</span></span>
<span id="cb341-21"><a href="#cb341-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb341-22"><a href="#cb341-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb341-23"><a href="#cb341-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb341-24"><a href="#cb341-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb341-25"><a href="#cb341-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb341-26"><a href="#cb341-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb341-27"><a href="#cb341-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb341-28"><a href="#cb341-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb341-29"><a href="#cb341-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-30"><a href="#cb341-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb341-31"><a href="#cb341-31" aria-hidden="true" tabindex="-1"></a>plot_windspeed <span class="ot">&lt;-</span> <span class="fu">plot_pts</span>(daily_windspeed, date)</span>
<span id="cb341-32"><a href="#cb341-32" aria-hidden="true" tabindex="-1"></a>plot_windspeed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/windspeed-scatter-by-site-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Ellerslie South contains erroneous negative values, causing the plot to be diverted. Let’s filter out the invalid wind speed values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb342"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot for valid WindSpeed values</span></span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a>plot_windspeed <span class="ot">&lt;-</span> <span class="fu">plot_pts</span>(<span class="fu">filter</span>(daily_windspeed, WindSpeed <span class="sc">&gt;=</span> <span class="dv">0</span>) , date)</span>
<span id="cb342-3"><a href="#cb342-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-4"><a href="#cb342-4" aria-hidden="true" tabindex="-1"></a>plot_windspeed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-valid-wind-speed-vs-date-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Wind speed trends from 2016–2024 vary by site in Auckland. Ellerslie South and Glen Eden Central show the strongest positive correlations with time (R = 0.15, 0.14), while Westlake shows no trend (R = –0.016, p = 0.39). Henderson and Westlake shows a shift in site type in 2023.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb343"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot for WindSpeed versus WindDir</span></span>
<span id="cb343-2"><a href="#cb343-2" aria-hidden="true" tabindex="-1"></a>plot_windspeed <span class="ot">&lt;-</span> <span class="fu">plot_pts</span>(<span class="fu">filter</span>(daily_windspeed, WindSpeed <span class="sc">&gt;=</span> <span class="dv">0</span>), WindDir) <span class="sc">+</span></span>
<span id="cb343-3"><a href="#cb343-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb343-4"><a href="#cb343-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Distribution of Daily Wind Speed vs. Wind Direction by Site Types in Auckland (2016–2024)"</span>,</span>
<span id="cb343-5"><a href="#cb343-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Wind Direction (°)"</span>) </span>
<span id="cb343-6"><a href="#cb343-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-7"><a href="#cb343-7" aria-hidden="true" tabindex="-1"></a>plot_windspeed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-wind-speed-vs-wind-direction-site-type-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Wind speed shows varying correlations with wind direction across site types. Sunnyhills East exhibits the strongest positive relationship (R = 0.37), while Westlake shows a weak negative one (R = −0.11). Henderson Lincoln South displays no significant association.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb344"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot for WindSpeed versus AirTemp</span></span>
<span id="cb344-2"><a href="#cb344-2" aria-hidden="true" tabindex="-1"></a>plot_windspeed <span class="ot">&lt;-</span> <span class="fu">plot_pts</span>(daily_windspeed, AirTemp) <span class="sc">+</span></span>
<span id="cb344-3"><a href="#cb344-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb344-4"><a href="#cb344-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Distribution of Daily Wind Speed vs. Air Temperature by Site Types in Auckland (2016–2024)"</span>,</span>
<span id="cb344-5"><a href="#cb344-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Air Temperature (°C)"</span>) </span>
<span id="cb344-6"><a href="#cb344-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-7"><a href="#cb344-7" aria-hidden="true" tabindex="-1"></a>plot_windspeed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/display-plot-for-WindSpeed-vs-AirTemp-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Ellerslie South contains large negative invalid wind speed values and Sunnyhills East has large negative air temperature value of below -50 degree celsius. These values are causing the plot to be diverted towards them. Let’s remove them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb345"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot for WindSpeed versus AirTemp</span></span>
<span id="cb345-2"><a href="#cb345-2" aria-hidden="true" tabindex="-1"></a>plot_windspeed <span class="ot">&lt;-</span> <span class="fu">plot_pts</span>(<span class="fu">filter</span>(daily_windspeed, WindSpeed <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> AirTemp <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">5</span>), AirTemp) <span class="sc">+</span></span>
<span id="cb345-3"><a href="#cb345-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb345-4"><a href="#cb345-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Distribution of Daily Wind Speed vs. Air Temperature by Site Types in Auckland (2016–2024)"</span>,</span>
<span id="cb345-5"><a href="#cb345-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Air Temperature (°C)"</span>) </span>
<span id="cb345-6"><a href="#cb345-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-7"><a href="#cb345-7" aria-hidden="true" tabindex="-1"></a>plot_windspeed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/display-plot-for-WindSpeed-vs-AirTemp-for-valid-values-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
The strongest positive correlation between wind speed and air temperature is seen at Ellerslie South (R = 0.55), followed by Glen Eden Central (R = 0.48) and Westlake (R = 0.37). Henderson Lincoln South (R = 0.21) and Sunnyhills East (R = 0.14) show weaker correlations. Warmer temperatures tend to align with higher wind speeds across all sites, but the relationship is notably weaker in more suburban residential areas like Sunnyhills. Industrial sites like Ellerslie exhibit stronger associations, possibly reflecting localized urban heat and turbulence effects.

<details>
<summary>
Wind speed effects on pollutants in Auckland suburbs
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb346"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the missing AirTemp, WindDir, WindSpeed, AQI, air pollutant values using ARIMA approximation for sa2_name having at least 3 numeric values</span></span>
<span id="cb346-2"><a href="#cb346-2" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb346-3"><a href="#cb346-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, sa2_name, site_type, AQI, NO2, NO, PM10, PM2<span class="fl">.5</span>, SO2, WindSpeed, WindDir, AirTemp) <span class="sc">|&gt;</span></span>
<span id="cb346-4"><a href="#cb346-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb346-5"><a href="#cb346-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb346-6"><a href="#cb346-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.cols =</span> <span class="fu">c</span>(AQI, NO2, NO, PM10, <span class="st">`</span><span class="at">PM2.5</span><span class="st">`</span>, SO2, WindSpeed, WindDir, AirTemp),</span>
<span id="cb346-7"><a href="#cb346-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.fns =</span> <span class="sc">~</span> <span class="cf">if</span> (<span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(.x)) <span class="sc">&gt;=</span> <span class="dv">3</span>) <span class="fu">na_kalman</span>(.x, <span class="at">model =</span> <span class="st">"auto.arima"</span>) <span class="cf">else</span> .x)) <span class="sc">|&gt;</span></span>
<span id="cb346-8"><a href="#cb346-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb346-9"><a href="#cb346-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb346-10"><a href="#cb346-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Find daily average for each factor</span></span>
<span id="cb346-11"><a href="#cb346-11" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb346-12"><a href="#cb346-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date, sa2_name, site_type) <span class="sc">|&gt;</span></span>
<span id="cb346-13"><a href="#cb346-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb346-14"><a href="#cb346-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">AQI =</span> <span class="fu">mean</span>(AQI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb346-15"><a href="#cb346-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">NO2 =</span> <span class="fu">mean</span>(NO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb346-16"><a href="#cb346-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">NO =</span> <span class="fu">mean</span>(NO, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb346-17"><a href="#cb346-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">PM10 =</span> <span class="fu">mean</span>(PM10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb346-18"><a href="#cb346-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">PM2.5</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">PM2.5</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb346-19"><a href="#cb346-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">SO2 =</span> <span class="fu">mean</span>(SO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb346-20"><a href="#cb346-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">WindSpeed =</span> <span class="fu">mean</span>(WindSpeed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb346-21"><a href="#cb346-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">WindDir =</span> <span class="fu">mean</span>(WindDir, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb346-22"><a href="#cb346-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">AirTemp =</span> <span class="fu">mean</span>(AirTemp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb346-23"><a href="#cb346-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb346-24"><a href="#cb346-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb346-25"><a href="#cb346-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb346-26"><a href="#cb346-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert site_type to a factor with correct levels</span></span>
<span id="cb346-27"><a href="#cb346-27" aria-hidden="true" tabindex="-1"></a>  daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb346-28"><a href="#cb346-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_type =</span> <span class="fu">factor</span>(site_type, <span class="at">levels =</span> <span class="fu">unique</span>(daily_airdata<span class="sc">$</span>site_type)))</span>
<span id="cb346-29"><a href="#cb346-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb346-30"><a href="#cb346-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardized meteorological factors, air pollutants, and AQI for each site</span></span>
<span id="cb346-31"><a href="#cb346-31" aria-hidden="true" tabindex="-1"></a>standardized_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb346-32"><a href="#cb346-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name, site_type) <span class="sc">|&gt;</span></span>
<span id="cb346-33"><a href="#cb346-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb346-34"><a href="#cb346-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">AirTemp =</span> (AirTemp <span class="sc">-</span> <span class="fu">mean</span>(AirTemp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> (<span class="fu">sd</span>(AirTemp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb346-35"><a href="#cb346-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">WindDir =</span> (WindDir <span class="sc">-</span> <span class="fu">mean</span>(WindDir, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(WindDir, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb346-36"><a href="#cb346-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">WindSpeed =</span> (WindSpeed <span class="sc">-</span> <span class="fu">mean</span>(WindSpeed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(WindSpeed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb346-37"><a href="#cb346-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">AQI =</span> (AQI <span class="sc">-</span> <span class="fu">mean</span>(AQI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(AQI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb346-38"><a href="#cb346-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">NO2 =</span> (NO2 <span class="sc">-</span> <span class="fu">mean</span>(NO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(NO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb346-39"><a href="#cb346-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">NO =</span> (NO <span class="sc">-</span> <span class="fu">mean</span>(NO, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(NO, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb346-40"><a href="#cb346-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">PM10 =</span> (PM10 <span class="sc">-</span> <span class="fu">mean</span>(PM10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(PM10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb346-41"><a href="#cb346-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">PM2.5 =</span> (PM2<span class="fl">.5</span> <span class="sc">-</span> <span class="fu">mean</span>(PM2<span class="fl">.5</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(PM2<span class="fl">.5</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb346-42"><a href="#cb346-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">SO2 =</span> (SO2 <span class="sc">-</span> <span class="fu">mean</span>(SO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(SO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb346-43"><a href="#cb346-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb347"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb347-1"><a href="#cb347-1" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_pollutants <span class="ot">&lt;-</span> <span class="cf">function</span>(data, yvar, stat_var) {</span>
<span id="cb347-2"><a href="#cb347-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate 10th and 90th percentiles of WindSpeed </span></span>
<span id="cb347-3"><a href="#cb347-3" aria-hidden="true" tabindex="-1"></a>  quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(data<span class="sc">$</span>WindSpeed, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb347-4"><a href="#cb347-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb347-5"><a href="#cb347-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Categorizes wind speed into Low, Mid, and High using 10-90th percentiles</span></span>
<span id="cb347-6"><a href="#cb347-6" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb347-7"><a href="#cb347-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">color_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb347-8"><a href="#cb347-8" aria-hidden="true" tabindex="-1"></a>      WindSpeed <span class="sc">&lt;=</span> quantiles[<span class="dv">1</span>] <span class="sc">~</span> <span class="st">"#377eb8"</span>,</span>
<span id="cb347-9"><a href="#cb347-9" aria-hidden="true" tabindex="-1"></a>      WindSpeed <span class="sc">&gt;=</span> quantiles[<span class="dv">2</span>] <span class="sc">~</span> <span class="st">"#E24A33"</span>,</span>
<span id="cb347-10"><a href="#cb347-10" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"#A0AEB2"</span></span>
<span id="cb347-11"><a href="#cb347-11" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb347-12"><a href="#cb347-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb347-13"><a href="#cb347-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define a custom plotting function to examine the relationship between wind speed and a selected pollutant</span></span>
<span id="cb347-14"><a href="#cb347-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> WindSpeed, <span class="at">y =</span> .data[[yvar]])) <span class="sc">+</span></span>
<span id="cb347-15"><a href="#cb347-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color_group)) <span class="sc">+</span> <span class="co"># points colored by pollutant categories</span></span>
<span id="cb347-16"><a href="#cb347-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="co"># Add smooth GAM trend line</span></span>
<span id="cb347-17"><a href="#cb347-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_identity</span>(</span>
<span id="cb347-18"><a href="#cb347-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"WindSpeed Level"</span>,  <span class="co"># Title for the legend</span></span>
<span id="cb347-19"><a href="#cb347-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">guide =</span> <span class="st">"legend"</span>, </span>
<span id="cb347-20"><a href="#cb347-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>), <span class="co"># Labels for color groups</span></span>
<span id="cb347-21"><a href="#cb347-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"#377eb8"</span>, <span class="st">"#A0AEB2"</span>, <span class="st">"#E24A33"</span>) <span class="co"># Color codes matching the legend labels</span></span>
<span id="cb347-22"><a href="#cb347-22" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb347-23"><a href="#cb347-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>scientific) <span class="sc">+</span></span>
<span id="cb347-24"><a href="#cb347-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_cor</span>(</span>
<span id="cb347-25"><a href="#cb347-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">"pearson"</span>, <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb347-26"><a href="#cb347-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">label.x.npc =</span> <span class="st">"left"</span>, <span class="at">label.y.npc =</span> stat_var) <span class="sc">+</span></span>
<span id="cb347-27"><a href="#cb347-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> sa2_name, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span> <span class="co"># One panel per SA2 suburb with independent scales</span></span>
<span id="cb347-28"><a href="#cb347-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb347-29"><a href="#cb347-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb347-30"><a href="#cb347-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Relationship Between Daily Wind Speed and "</span>, yvar, <span class="st">" Concentration in Auckland (2016–2024)"</span>),</span>
<span id="cb347-31"><a href="#cb347-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"GAM smooth trend with Pearson correlation for each Site"</span>,</span>
<span id="cb347-32"><a href="#cb347-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Wind Speed (m/s)"</span>, <span class="at">y =</span> <span class="fu">paste</span>(yvar, <span class="st">" concentration (µg/m³)"</span>)</span>
<span id="cb347-33"><a href="#cb347-33" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb347-34"><a href="#cb347-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb347-35"><a href="#cb347-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb347-36"><a href="#cb347-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb347-37"><a href="#cb347-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb347-38"><a href="#cb347-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb347-39"><a href="#cb347-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb347-40"><a href="#cb347-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb347-41"><a href="#cb347-41" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb347-42"><a href="#cb347-42" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
AQI vs Wind Speed
</summary>
<p>Visually check for correlation between raw and standardized wind speed and air quality index (AQI) levels across sites. Explore whether AQI vary consistently with wind speed. Assess whether standardizing wind speed and AQI improves clarity of trends. Reduces distortion from wind speed outliers for better pattern detection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb348"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw wind speed vs AQI, "Puni" and "Queen Street" does not contain numeric wind speed values </span></span>
<span id="cb348-2"><a href="#cb348-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(daily_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>)))</span>
<span id="cb348-3"><a href="#cb348-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-4"><a href="#cb348-4" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_aqi <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(data, <span class="st">"AQI"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb348-5"><a href="#cb348-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Air Quality Index (AQI)"</span>)</span>
<span id="cb348-6"><a href="#cb348-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-7"><a href="#cb348-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb348-8"><a href="#cb348-8" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_aqi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-windspeed-vs-aqi-for-all-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>This plot includes invalid negative WindSpeed values at Ellerslie South, which may obscure meaningful patterns. Filtering for valid WindSpeed values will help reveal clearer and more accurate trends.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb349"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Limit the WindSpeed values of at least 0m/s</span></span>
<span id="cb349-2"><a href="#cb349-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(daily_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>)) <span class="sc">&amp;</span> WindSpeed <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb349-3"><a href="#cb349-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-4"><a href="#cb349-4" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_aqi <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(data, <span class="st">"AQI"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb349-5"><a href="#cb349-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb349-6"><a href="#cb349-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Restricted Daily Wind Speed and AQI Concentration at sites in Auckland (2016–2024)"</span>,</span>
<span id="cb349-7"><a href="#cb349-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Positive Wind Speed Values (m/s)"</span>,</span>
<span id="cb349-8"><a href="#cb349-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Air Quality Index (AQI)"</span>)</span>
<span id="cb349-9"><a href="#cb349-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-10"><a href="#cb349-10" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_aqi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/restrict-windspeed-vs-aqi-for-valid-windspeed-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Trends vary by site, Sunnyhills East shows moderate positive correlation, while others exhibit no relationships due to local influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb350"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot standardized wind speed vs AQI standardized</span></span>
<span id="cb350-2"><a href="#cb350-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(standardized_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>)))</span>
<span id="cb350-3"><a href="#cb350-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-4"><a href="#cb350-4" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_aqi <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(data, <span class="st">"AQI"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb350-5"><a href="#cb350-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span></span>
<span id="cb350-6"><a href="#cb350-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb350-7"><a href="#cb350-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Standardised Daily Wind Speed and AQI Concentration at sites in Auckland (2016–2024)"</span>,</span>
<span id="cb350-8"><a href="#cb350-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Wind Speed"</span>, </span>
<span id="cb350-9"><a href="#cb350-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized Air Quality Index (AQI)"</span>)</span>
<span id="cb350-10"><a href="#cb350-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-11"><a href="#cb350-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb350-12"><a href="#cb350-12" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_aqi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-windspeed-vs-aqi-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Large negative z values are diverting the plot towards them, let’s restrict the z values from -3 to 3.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb351"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot standardized wind speed vs AQI standardized</span></span>
<span id="cb351-2"><a href="#cb351-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(standardized_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>)) <span class="sc">&amp;</span> WindSpeed <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">3</span> <span class="sc">&amp;</span> WindSpeed <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">&amp;</span> AQI <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">3</span> <span class="sc">&amp;</span> AQI <span class="sc">&lt;=</span> <span class="dv">3</span>)</span>
<span id="cb351-3"><a href="#cb351-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-4"><a href="#cb351-4" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_aqi <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(data, <span class="st">"AQI"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb351-5"><a href="#cb351-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span></span>
<span id="cb351-6"><a href="#cb351-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb351-7"><a href="#cb351-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Standardised Daily Wind Speed and AQI Concentration at sites in Auckland (2016–2024)"</span>,</span>
<span id="cb351-8"><a href="#cb351-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Wind Speed (-3 to 3)"</span>, </span>
<span id="cb351-9"><a href="#cb351-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized Air Quality Index (AQI) (-3 to 3)"</span>)</span>
<span id="cb351-10"><a href="#cb351-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-11"><a href="#cb351-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb351-12"><a href="#cb351-12" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_aqi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-restricted-z-anomalies-of-windspeed-vs-aqi-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
Sunnyhills East and Henderson Lincoln South shows significant positive correlation between wind speed and AQI, suggesting significant pollutant dispersion. The rest of the sites exhibits a weak non-significant positive correlation, indicating no wind influence.
</details>
<details>
<summary>
NO vs Wind Speed
</summary>
<p>Visually check for correlation between raw and standardized wind speed and NO across sites. Explore whether NO vary consistently with wind speed. Assess whether standardizing wind speed and NO improves clarity of trends. Reduces distortion from wind speed outliers for better pattern detection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb352"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot, remove "Sunnyhills East", it does not have NO values, remove the WindSpeed values below 0</span></span>
<span id="cb352-2"><a href="#cb352-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(daily_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>)) <span class="sc">&amp;</span> WindSpeed <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb352-3"><a href="#cb352-3" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_no <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(data, <span class="st">"NO"</span>, <span class="st">"top"</span>)</span>
<span id="cb352-4"><a href="#cb352-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-5"><a href="#cb352-5" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_no</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/display-plot-for-valid-windspeed-vs-no-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>NO concentrations decrease as wind speed increases across all sites, with Westlake showing the strongest negative correlation (R = -0.56). High wind speeds correspond to lower NO levels (red points). Trends are consistent, but strength varies, likely due to site-specific meteorological influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb353"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot, remove "Sunnyhills East", it does not have NO values</span></span>
<span id="cb353-2"><a href="#cb353-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(standardized_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>)))</span>
<span id="cb353-3"><a href="#cb353-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-4"><a href="#cb353-4" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_no <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(data, <span class="st">"NO"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb353-5"><a href="#cb353-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span></span>
<span id="cb353-6"><a href="#cb353-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb353-7"><a href="#cb353-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Standardised Daily Wind Speed and NO Concentration at sites in Auckland (2016–2024)"</span>,</span>
<span id="cb353-8"><a href="#cb353-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Wind Speed"</span>, </span>
<span id="cb353-9"><a href="#cb353-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized Nitric Oxide (NO)"</span>)</span>
<span id="cb353-10"><a href="#cb353-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-11"><a href="#cb353-11" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_no</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-for-z-anomalies-of-windspeed-vs-no-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Large z values are diverting the plot towards them, let’s restrict the z values to -3 to 3.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb354"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot, remove "Sunnyhills East", it does not have NO values</span></span>
<span id="cb354-2"><a href="#cb354-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(standardized_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>)) <span class="sc">&amp;</span> WindSpeed <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">3</span> <span class="sc">&amp;</span> WindSpeed <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">&amp;</span> NO <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">3</span> <span class="sc">&amp;</span> NO <span class="sc">&lt;=</span> <span class="dv">3</span>)</span>
<span id="cb354-3"><a href="#cb354-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-4"><a href="#cb354-4" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_no <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(data, <span class="st">"NO"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb354-5"><a href="#cb354-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span></span>
<span id="cb354-6"><a href="#cb354-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb354-7"><a href="#cb354-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Standardised Daily Wind Speed and NO Concentration at sites in Auckland (2016–2024)"</span>,</span>
<span id="cb354-8"><a href="#cb354-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Wind Speed (-3 to 3)"</span>, </span>
<span id="cb354-9"><a href="#cb354-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized Nitric Oxide (NO, -3 to 3)"</span>)</span>
<span id="cb354-10"><a href="#cb354-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-11"><a href="#cb354-11" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_no</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-restricted-z-anomalies-of-windspeed-vs-no-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
NO concentration negatively correlates with wind speed at all sites (R = -0.41 to -0.52, p &lt; 2.2e-16). Higher wind speeds (red) reduce NO levels, while low winds (blue) increase concentration. Glen Eden and Westlake show the strongest correlations, indicating wind-driven pollutant dispersion patterns.
</details>
<details>
<summary>
NO2 versus WindSpeed
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb355"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot, remove "Sunnyhills East", it does not have NO2 values, remove the WindSpeed values below 0</span></span>
<span id="cb355-2"><a href="#cb355-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(daily_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>)) <span class="sc">&amp;</span> WindSpeed <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb355-3"><a href="#cb355-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-4"><a href="#cb355-4" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_no2 <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(data, <span class="st">"NO2"</span>, <span class="st">"top"</span>)</span>
<span id="cb355-5"><a href="#cb355-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-6"><a href="#cb355-6" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_no2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/display-plot-for-valid-windspeed-vs-no2-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Wind speed negatively correlates with NO2 levels—higher speeds lead to lower concentrations. Correlation strength varies across sites (R values), with differing statistical significance (p-values). Some sites show a stronger inverse relationship, indicating localized meteorological influences on NO2 dispersion and accumulation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb356"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot, remove "Sunnyhills East", it does not have NO2 values</span></span>
<span id="cb356-2"><a href="#cb356-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(daily_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>)), WindSpeed <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">3</span> <span class="sc">&amp;</span> WindSpeed <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">&amp;</span> NO2 <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">3</span> <span class="sc">&amp;</span> NO2 <span class="sc">&lt;=</span> <span class="dv">3</span>)</span>
<span id="cb356-3"><a href="#cb356-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-4"><a href="#cb356-4" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_no2 <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(data, <span class="st">"NO2"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb356-5"><a href="#cb356-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span></span>
<span id="cb356-6"><a href="#cb356-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb356-7"><a href="#cb356-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Standardised Daily Wind Speed and NO Concentration at sites in Auckland (2016–2024)"</span>,</span>
<span id="cb356-8"><a href="#cb356-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Wind Speed (-3 to 3)"</span>, </span>
<span id="cb356-9"><a href="#cb356-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized Nitrogen Dioxide (NO2, -3 to 3)"</span>)</span>
<span id="cb356-10"><a href="#cb356-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-11"><a href="#cb356-11" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_no2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-windspeed-vs-no2-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
Significant NO2 concentration positively correlates with wind speed (R = 0.62 and 0.47). Higher wind speeds (red) increase NO2 levels, while low winds (blue) decrease concentration. Ellerslie South and Westlake show the strongest correlations, indicating wind-driven pollutant dispersion patterns.
</details>
<details>
<summary>
PM10 versus WindSpeed
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb357"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb357-1"><a href="#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot, remove "Puni" and "Queen Street", they don't have PM10 values, remove the WindSpeed values below 0</span></span>
<span id="cb357-2"><a href="#cb357-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(daily_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>)) <span class="sc">&amp;</span> WindSpeed <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb357-3"><a href="#cb357-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb357-4"><a href="#cb357-4" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_pm10 <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(data, <span class="st">"PM10"</span>, <span class="st">"top"</span>)</span>
<span id="cb357-5"><a href="#cb357-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb357-6"><a href="#cb357-6" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_pm10</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/display-plot-for-valid-windspeed-vs-PM10-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>PM10 levels rise with wind speed across sites, strongest at Ellerslie South (R = 0.19). Low wind (blue) shows stable PM10, while high wind (red) increases PM10, likely due to dust resuspension. Henderson Lincoln South has the weakest significant correlation (R = 0.077).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb358"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot, remove "Puni" and "Queen Street", they don't have PM10 values</span></span>
<span id="cb358-2"><a href="#cb358-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(standardized_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>)))</span>
<span id="cb358-3"><a href="#cb358-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-4"><a href="#cb358-4" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_pm10 <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(data, <span class="st">"PM10"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb358-5"><a href="#cb358-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span></span>
<span id="cb358-6"><a href="#cb358-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb358-7"><a href="#cb358-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Standardised Daily Wind Speed and PM10 Concentration at sites in Auckland (2016–2024)"</span>,</span>
<span id="cb358-8"><a href="#cb358-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Wind Speed"</span>, </span>
<span id="cb358-9"><a href="#cb358-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized Particulate Matter (PM10)"</span>)</span>
<span id="cb358-10"><a href="#cb358-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-11"><a href="#cb358-11" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_pm10</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-windspeed-vs-PM10-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Restrict the z values to -3 to 3 to avoid plot diversion.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb359"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot, remove "Puni" and "Queen Street", they don't have PM10 values, restrict z anomaly from -3 to 3</span></span>
<span id="cb359-2"><a href="#cb359-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(standardized_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>)) <span class="sc">&amp;</span> WindSpeed <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">3</span> <span class="sc">&amp;</span> WindSpeed <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">&amp;</span> PM10 <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">3</span> <span class="sc">&amp;</span> PM10 <span class="sc">&lt;=</span> <span class="dv">3</span>)</span>
<span id="cb359-3"><a href="#cb359-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-4"><a href="#cb359-4" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_pm10 <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(data, <span class="st">"PM10"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb359-5"><a href="#cb359-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span></span>
<span id="cb359-6"><a href="#cb359-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb359-7"><a href="#cb359-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Standardised Daily Wind Speed and PM10 Concentration at sites in Auckland (2016–2024)"</span>,</span>
<span id="cb359-8"><a href="#cb359-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Wind Speed (-3 to 3)"</span>, </span>
<span id="cb359-9"><a href="#cb359-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized Particulate Matter (PM10, -3 to 3)"</span>)</span>
<span id="cb359-10"><a href="#cb359-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-11"><a href="#cb359-11" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_pm10</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-restricted-z-anomalies-of-windspeed-vs-PM10-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
This plot shows a weak positive correlation between standardized wind speed and PM10 concentration across five Auckland sites, indicated by low R-values. The “Low” wind speed category often shows higher PM10 variability, while “Medium” and “High” levels tend to be more consistent.
</details>
<details>
<summary>
PM2.5 versus WindSpeed
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb360"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot, select "Ellerslie South" and "Westlake", they have numeric WindSpeed and PM2.5 values, remove the WindSpeed values below 0</span></span>
<span id="cb360-2"><a href="#cb360-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ellerslie South"</span>, <span class="st">"Westlake"</span>))</span>
<span id="cb360-3"><a href="#cb360-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb360-4"><a href="#cb360-4" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_pm25 <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(data, <span class="st">"PM2.5"</span>, <span class="st">"top"</span>)</span>
<span id="cb360-5"><a href="#cb360-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb360-6"><a href="#cb360-6" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_pm25</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/display-plot-for-windspeed-vs-PM25-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>The invalid large negative windspeed values are diverting the whole plot towards them, let’s plot for valid wind speed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb361"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot, select "Ellerslie South" and "Westlake", they have numeric WindSpeed and PM2.5 values, remove the WindSpeed values below 0</span></span>
<span id="cb361-2"><a href="#cb361-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ellerslie South"</span>, <span class="st">"Westlake"</span>) <span class="sc">&amp;</span> WindSpeed <span class="sc">&gt;=</span><span class="dv">0</span>)</span>
<span id="cb361-3"><a href="#cb361-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb361-4"><a href="#cb361-4" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_pm25 <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(data, <span class="st">"PM2.5"</span>, <span class="st">"top"</span>)</span>
<span id="cb361-5"><a href="#cb361-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb361-6"><a href="#cb361-6" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_pm25</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/display-plot-for-valid-windspeed-vs-PM25-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Ellerslie South shows a slight negative correlation with PM2.5 decreasing as wind speed increases, then rising at higher speeds. Westlake exhibits a weak positive correlation, with PM2.5 concentrations generally increasing with wind speed, particularly at lower speeds, then stabilizing. Both sites show “Low” wind speeds associated with higher PM2.5.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb362"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot, select "Ellerslie South" and "Westlake", they have numeric WindSpeed and PM2.5 values, remove the WindSpeed values below 0</span></span>
<span id="cb362-2"><a href="#cb362-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(standardized_airdata, sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ellerslie South"</span>, <span class="st">"Westlake"</span>))</span>
<span id="cb362-3"><a href="#cb362-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-4"><a href="#cb362-4" aria-hidden="true" tabindex="-1"></a>plot_windspeed_pm25_1 <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(data, <span class="st">"PM2.5"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb362-5"><a href="#cb362-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span></span>
<span id="cb362-6"><a href="#cb362-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb362-7"><a href="#cb362-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">""</span>, <span class="at">subtitle =</span> <span class="st">"Z-anomaly"</span>,</span>
<span id="cb362-8"><a href="#cb362-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Wind Speed"</span>, <span class="at">y =</span> <span class="st">"Standardized PM2.5"</span>)</span>
<span id="cb362-9"><a href="#cb362-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-10"><a href="#cb362-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Large negative and positive z anomalies are diverting the whole plot towards them. Restrict z anomalies to -3 to 3</span></span>
<span id="cb362-11"><a href="#cb362-11" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(standardized_airdata, sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ellerslie South"</span>, <span class="st">"Westlake"</span>) <span class="sc">&amp;</span> WindSpeed <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">3</span> <span class="sc">&amp;</span> WindSpeed <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">&amp;</span> PM2<span class="fl">.5</span> <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">3</span> <span class="sc">&amp;</span> PM2<span class="fl">.5</span> <span class="sc">&lt;=</span> <span class="dv">3</span>)</span>
<span id="cb362-12"><a href="#cb362-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-13"><a href="#cb362-13" aria-hidden="true" tabindex="-1"></a>plot_windspeed_pm25_2 <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(data, <span class="st">"PM2.5"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb362-14"><a href="#cb362-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span></span>
<span id="cb362-15"><a href="#cb362-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb362-16"><a href="#cb362-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">""</span>, <span class="at">subtitle =</span> <span class="st">"Z-anomaly (-3 to 3)"</span>,</span>
<span id="cb362-17"><a href="#cb362-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Wind Speed (-3 to 3)"</span>, </span>
<span id="cb362-18"><a href="#cb362-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized PM2.5 (-3 to 3)"</span>)</span>
<span id="cb362-19"><a href="#cb362-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-20"><a href="#cb362-20" aria-hidden="true" tabindex="-1"></a>plot_windspeed_pm25_1 <span class="sc">/</span> plot_windspeed_pm25_2 <span class="sc">+</span></span>
<span id="cb362-21"><a href="#cb362-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">+</span> <span class="co"># Collect legend</span></span>
<span id="cb362-22"><a href="#cb362-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb362-23"><a href="#cb362-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Standardised Daily Wind Speed and PM2.5 Concentration at sites in Auckland (2016–2024)"</span>,</span>
<span id="cb362-24"><a href="#cb362-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"GAM smooth trend with Pearson correlation for each site"</span>,</span>
<span id="cb362-25"><a href="#cb362-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb362-26"><a href="#cb362-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb362-27"><a href="#cb362-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/display-plot-for-z-anomaly-of-windspeed-vs-PM25-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
Ellerslie South shows a curvilinear negative correlation between wind speed and PM2.5, while Westlake has a positive, more linear correlation. Wind speed levels (Low, Medium, High) are distributed across the standardized wind speed ranges at both sites.
</details>
<details>
<summary>
SO2 versus WindSpeed
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb363"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot, select "Ellerslie South", it is the only site recording SO2 values, remove the WindSpeed values below 0</span></span>
<span id="cb363-2"><a href="#cb363-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb363-3"><a href="#cb363-3" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_SO2_1 <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(data, <span class="st">"SO2"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb363-4"><a href="#cb363-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span></span>
<span id="cb363-5"><a href="#cb363-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">""</span>, <span class="at">subtitle =</span> <span class="st">"All values"</span>)</span>
<span id="cb363-6"><a href="#cb363-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-7"><a href="#cb363-7" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span> <span class="sc">&amp;</span> WindSpeed <span class="sc">&gt;=</span><span class="dv">0</span>)</span>
<span id="cb363-8"><a href="#cb363-8" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_SO2_2 <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(data, <span class="st">"SO2"</span>, <span class="st">"top"</span>) <span class="sc">+</span> </span>
<span id="cb363-9"><a href="#cb363-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span></span>
<span id="cb363-10"><a href="#cb363-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb363-11"><a href="#cb363-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">""</span>, <span class="at">subtitle =</span> <span class="st">"Restricted"</span>, <span class="at">x =</span> <span class="st">"WindSpeed &gt;= 0 (m/s)"</span>)</span>
<span id="cb363-12"><a href="#cb363-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-13"><a href="#cb363-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Large negative and positive z anomalies are diverting the whole plot towards them. Restrict z anomalies to -3 to 3</span></span>
<span id="cb363-14"><a href="#cb363-14" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(standardized_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb363-15"><a href="#cb363-15" aria-hidden="true" tabindex="-1"></a>plot_standardized_1 <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(data, <span class="st">"SO2"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb363-16"><a href="#cb363-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span></span>
<span id="cb363-17"><a href="#cb363-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb363-18"><a href="#cb363-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">""</span>, <span class="at">subtitle =</span> <span class="st">"Z-anomaly"</span>,</span>
<span id="cb363-19"><a href="#cb363-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Wind Speed"</span>, <span class="at">y =</span> <span class="st">"Standardized SO2"</span>)</span>
<span id="cb363-20"><a href="#cb363-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-21"><a href="#cb363-21" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(standardized_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span> <span class="sc">&amp;</span> WindSpeed <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">3</span> <span class="sc">&amp;</span> WindSpeed <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">&amp;</span> SO2 <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">3</span> <span class="sc">&amp;</span> SO2 <span class="sc">&lt;=</span> <span class="dv">3</span>)</span>
<span id="cb363-22"><a href="#cb363-22" aria-hidden="true" tabindex="-1"></a>plot_standardized_2 <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(data, <span class="st">"SO2"</span>, <span class="st">"top"</span>) <span class="sc">+</span> </span>
<span id="cb363-23"><a href="#cb363-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span></span>
<span id="cb363-24"><a href="#cb363-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb363-25"><a href="#cb363-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">""</span>, <span class="at">subtitle =</span> <span class="st">"Z-anomaly (-3 to 3)"</span>,</span>
<span id="cb363-26"><a href="#cb363-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Wind Speed (-3 to 3)"</span>, </span>
<span id="cb363-27"><a href="#cb363-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized SO2 (-3 to 3)"</span>)</span>
<span id="cb363-28"><a href="#cb363-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-29"><a href="#cb363-29" aria-hidden="true" tabindex="-1"></a>(plot_windspeed_vs_SO2_1 <span class="sc">+</span> plot_windspeed_vs_SO2_2) <span class="sc">/</span> (plot_standardized_1 <span class="sc">+</span> plot_standardized_2) <span class="sc">+</span> </span>
<span id="cb363-30"><a href="#cb363-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">+</span> <span class="co"># Collect legends</span></span>
<span id="cb363-31"><a href="#cb363-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb363-32"><a href="#cb363-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Raw and Standardised Daily Wind Speed and SO2 Concentration at sites in Auckland (2016–2024)"</span>,</span>
<span id="cb363-33"><a href="#cb363-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"GAM smooth trend with Pearson correlation for each site"</span>,</span>
<span id="cb363-34"><a href="#cb363-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb363-35"><a href="#cb363-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb363-36"><a href="#cb363-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/display-plot-for-valid-windspeed-vs-SO2-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
This plot shows an inverse relationship between wind speed and SO2 concentration. Restricting the data and using standardized values improves the linear correlation, revealing clear categories (low, medium, high) based on wind speed levels.
</details>
</details>
<details>
<summary>
Wind direction effects on pollution in Auckland
</summary>
<details>
<summary>
Define Functions to Plot Wind Direction versus Pollutants
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb364"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb364-1"><a href="#cb364-1" aria-hidden="true" tabindex="-1"></a>plot_winddir_vs_pollutants <span class="ot">&lt;-</span> <span class="cf">function</span>(data, yvar, stat_var) {</span>
<span id="cb364-2"><a href="#cb364-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate 10th and 90th percentiles of WindDir </span></span>
<span id="cb364-3"><a href="#cb364-3" aria-hidden="true" tabindex="-1"></a>  quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(data<span class="sc">$</span>WindDir, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb364-4"><a href="#cb364-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb364-5"><a href="#cb364-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Categorizes wind direction into Low, Mid, and High using 10-90th percentiles</span></span>
<span id="cb364-6"><a href="#cb364-6" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb364-7"><a href="#cb364-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">color_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb364-8"><a href="#cb364-8" aria-hidden="true" tabindex="-1"></a>      WindDir <span class="sc">&lt;=</span> quantiles[<span class="dv">1</span>] <span class="sc">~</span> <span class="st">"#377eb8"</span>,</span>
<span id="cb364-9"><a href="#cb364-9" aria-hidden="true" tabindex="-1"></a>      WindDir <span class="sc">&gt;=</span> quantiles[<span class="dv">2</span>] <span class="sc">~</span> <span class="st">"#E24A33"</span>,</span>
<span id="cb364-10"><a href="#cb364-10" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"#A0AEB2"</span></span>
<span id="cb364-11"><a href="#cb364-11" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb364-12"><a href="#cb364-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb364-13"><a href="#cb364-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define a custom plotting function to examine the relationship between wind direction and a selected pollutant</span></span>
<span id="cb364-14"><a href="#cb364-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> WindDir, <span class="at">y =</span> .data[[yvar]])) <span class="sc">+</span></span>
<span id="cb364-15"><a href="#cb364-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color_group), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="co"># points colored by pollutant categories</span></span>
<span id="cb364-16"><a href="#cb364-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="co"># Add smooth GAM trend line</span></span>
<span id="cb364-17"><a href="#cb364-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_identity</span>(</span>
<span id="cb364-18"><a href="#cb364-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"WindDir Level"</span>,  <span class="co"># Title for the legend</span></span>
<span id="cb364-19"><a href="#cb364-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">guide =</span> <span class="st">"legend"</span>, </span>
<span id="cb364-20"><a href="#cb364-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>), <span class="co"># Labels for color groups</span></span>
<span id="cb364-21"><a href="#cb364-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"#377eb8"</span>, <span class="st">"#A0AEB2"</span>, <span class="st">"#E24A33"</span>) <span class="co"># Color codes matching the legend labels</span></span>
<span id="cb364-22"><a href="#cb364-22" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb364-23"><a href="#cb364-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>scientific) <span class="sc">+</span></span>
<span id="cb364-24"><a href="#cb364-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_cor</span>(</span>
<span id="cb364-25"><a href="#cb364-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">"pearson"</span>, <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb364-26"><a href="#cb364-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">label.x.npc =</span> <span class="st">"left"</span>, <span class="at">label.y.npc =</span> stat_var) <span class="sc">+</span></span>
<span id="cb364-27"><a href="#cb364-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> sa2_name, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span> <span class="co"># One panel per SA2 suburb with independent scales</span></span>
<span id="cb364-28"><a href="#cb364-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb364-29"><a href="#cb364-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb364-30"><a href="#cb364-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Relationship Between Daily Wind Direction and "</span>, yvar, <span class="st">" Concentration in Auckland (2016–2024)"</span>),</span>
<span id="cb364-31"><a href="#cb364-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"GAM smooth trend with Pearson correlation for each Site"</span>,</span>
<span id="cb364-32"><a href="#cb364-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Wind Direction (degrees)"</span>, <span class="at">y =</span> <span class="fu">paste</span>(yvar, <span class="st">" concentration (µg/m³)"</span>)</span>
<span id="cb364-33"><a href="#cb364-33" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb364-34"><a href="#cb364-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb364-35"><a href="#cb364-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb364-36"><a href="#cb364-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb364-37"><a href="#cb364-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb364-38"><a href="#cb364-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb364-39"><a href="#cb364-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb364-40"><a href="#cb364-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb364-41"><a href="#cb364-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb364-42"><a href="#cb364-42" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb364-43"><a href="#cb364-43" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb365"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb365-1"><a href="#cb365-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to plot wind direction vs pollutants, categorized by site type</span></span>
<span id="cb365-2"><a href="#cb365-2" aria-hidden="true" tabindex="-1"></a>plot_winddir_pollutants_site <span class="ot">&lt;-</span> <span class="cf">function</span>(data, yvar, stat_var) {</span>
<span id="cb365-3"><a href="#cb365-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot wind direction versus AQI categorized by site_type</span></span>
<span id="cb365-4"><a href="#cb365-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> WindDir, <span class="at">y =</span> .data[[yvar]])) <span class="sc">+</span></span>
<span id="cb365-5"><a href="#cb365-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> site_type), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span> </span>
<span id="cb365-6"><a href="#cb365-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb365-7"><a href="#cb365-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"G"</span>) <span class="sc">+</span></span>
<span id="cb365-8"><a href="#cb365-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>scientific) <span class="sc">+</span></span>
<span id="cb365-9"><a href="#cb365-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_cor</span>(</span>
<span id="cb365-10"><a href="#cb365-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">"pearson"</span>, <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb365-11"><a href="#cb365-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">label.x.npc =</span> <span class="st">"left"</span>, <span class="at">label.y.npc =</span> stat_var) <span class="sc">+</span></span>
<span id="cb365-12"><a href="#cb365-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> sa2_name, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb365-13"><a href="#cb365-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb365-14"><a href="#cb365-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb365-15"><a href="#cb365-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Relationship Between Daily Wind Direction and "</span>, yvar, <span class="st">" in Auckland Categorized by Site Type (2016–2024)"</span>),</span>
<span id="cb365-16"><a href="#cb365-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"GAM smooth trend with Pearson correlation for each Site"</span>,</span>
<span id="cb365-17"><a href="#cb365-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Wind Direction (degrees)"</span>, <span class="at">y =</span> <span class="fu">paste</span>(yvar, <span class="st">" concentration (µg/m³)"</span>), <span class="at">color =</span> <span class="st">"Site Type"</span>) <span class="sc">+</span></span>
<span id="cb365-18"><a href="#cb365-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb365-19"><a href="#cb365-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb365-20"><a href="#cb365-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb365-21"><a href="#cb365-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb365-22"><a href="#cb365-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb365-23"><a href="#cb365-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb365-24"><a href="#cb365-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb365-25"><a href="#cb365-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb365-26"><a href="#cb365-26" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb365-27"><a href="#cb365-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<details>
<summary>
AQI vs WindDir
</summary>
<p>Visually check for correlation between raw wind direction and AQI levels across sites. Explore whether AQI vary consistently with wind direction. Assess whether standardizing wind direction and AQI improves clarity of trends. Reduces distortion from wind direction outliers for better pattern detection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb366"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw wind direction vs AQI for selected sites, "Puni" and "Queen Street" does not contain any numeric WindDir values</span></span>
<span id="cb366-2"><a href="#cb366-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(daily_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>)))</span>
<span id="cb366-3"><a href="#cb366-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb366-4"><a href="#cb366-4" aria-hidden="true" tabindex="-1"></a>plot_winddir_vs_aqi <span class="ot">&lt;-</span> <span class="fu">plot_winddir_vs_pollutants</span>(</span>
<span id="cb366-5"><a href="#cb366-5" aria-hidden="true" tabindex="-1"></a>  data, <span class="st">"AQI"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb366-6"><a href="#cb366-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Air Quality Index (AQI)"</span>)</span>
<span id="cb366-7"><a href="#cb366-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb366-8"><a href="#cb366-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb366-9"><a href="#cb366-9" aria-hidden="true" tabindex="-1"></a>plot_winddir_vs_aqi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-winddir-vs-aqi-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Glen Eden Central and Henderson Lincoln South show stronger correlations between wind direction and AQI (R = 0.5, 0.35), while Sunnyhills East has the weakest (R = 0.16). Medium wind levels generally exhibit more pronounced trends, suggesting site-specific meteorological influences on air pollution dispersion.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb367"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb367-1"><a href="#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot standardized wind direction vs AQI for selected sites, "Puni" and "Queen Street" does not contain any numeric WindDir values</span></span>
<span id="cb367-2"><a href="#cb367-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(standardized_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>)))</span>
<span id="cb367-3"><a href="#cb367-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb367-4"><a href="#cb367-4" aria-hidden="true" tabindex="-1"></a>plot_standardized <span class="ot">&lt;-</span> <span class="fu">plot_winddir_vs_pollutants</span>(</span>
<span id="cb367-5"><a href="#cb367-5" aria-hidden="true" tabindex="-1"></a>  data, <span class="st">"AQI"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb367-6"><a href="#cb367-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb367-7"><a href="#cb367-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Standardized Daily Wind Speed and AQI at sites in Auckland (2016–2024)"</span>,</span>
<span id="cb367-8"><a href="#cb367-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Wind Direction"</span>,</span>
<span id="cb367-9"><a href="#cb367-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized Air Quality Index (AQI)"</span>)</span>
<span id="cb367-10"><a href="#cb367-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb367-11"><a href="#cb367-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb367-12"><a href="#cb367-12" aria-hidden="true" tabindex="-1"></a>plot_standardized</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-winddir-vs-aqi-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Wind direction shows minimal correlation with AQI across all sites. Most Pearson R values are near zero, indicating no relationship. Wind direction categories display no clear trend. Statistical significance is absent (p &gt; 0.1), suggesting AQI is largely independent of wind variability.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb368"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb368-1"><a href="#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw wind direction vs AQI for selected sites, "Puni" and "Queen Street" does not contain any numeric WindDir values</span></span>
<span id="cb368-2"><a href="#cb368-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(daily_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>)))</span>
<span id="cb368-3"><a href="#cb368-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-4"><a href="#cb368-4" aria-hidden="true" tabindex="-1"></a>plot_winddir_aqi_site <span class="ot">&lt;-</span> <span class="fu">plot_winddir_pollutants_site</span>(</span>
<span id="cb368-5"><a href="#cb368-5" aria-hidden="true" tabindex="-1"></a>  data, <span class="st">"AQI"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb368-6"><a href="#cb368-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Air Quality Index (AQI)"</span>)</span>
<span id="cb368-7"><a href="#cb368-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-8"><a href="#cb368-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb368-9"><a href="#cb368-9" aria-hidden="true" tabindex="-1"></a>plot_winddir_aqi_site</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-winddir-vs-aqi-by-sitetype-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Wind direction shows no consistent AQI trend across sites. AQI variability across sites remains independent of wind direction levels, suggesting meteorological factors play a minor role in site-specific air quality.</p>
<details>
<summary>
NO versus WindDir
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb369"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb369-1"><a href="#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw wind direction vs NO for selected sites, "Puni" and "Queen Street" does not contain WindDir, "Sunnyhills East" does not contain NO</span></span>
<span id="cb369-2"><a href="#cb369-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(daily_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>)))</span>
<span id="cb369-3"><a href="#cb369-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-4"><a href="#cb369-4" aria-hidden="true" tabindex="-1"></a>plot_winddir_vs_no <span class="ot">&lt;-</span> <span class="fu">plot_winddir_vs_pollutants</span>(</span>
<span id="cb369-5"><a href="#cb369-5" aria-hidden="true" tabindex="-1"></a>  data, <span class="st">"NO"</span>, <span class="st">"top"</span>)</span>
<span id="cb369-6"><a href="#cb369-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-7"><a href="#cb369-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb369-8"><a href="#cb369-8" aria-hidden="true" tabindex="-1"></a>plot_winddir_vs_no</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-winddir-vs-NO-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>NO concentrations vary significantly by site and wind direction. Westlake and Ellerslie South show positive correlations, peaking with high winds. Henderson Lincoln South trends negatively, while Glen Eden Central is weakly negative. Wind intensity strongly influences NO levels across sites, shaping pollutant dispersion dynamics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb370"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot standardized NO vs wind direction for selected sites, "Puni" and "Queen Street" does not contain WindDir values, "Sunnyhills East" does not contain NO</span></span>
<span id="cb370-2"><a href="#cb370-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(standardized_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>)))</span>
<span id="cb370-3"><a href="#cb370-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-4"><a href="#cb370-4" aria-hidden="true" tabindex="-1"></a>plot_standardized <span class="ot">&lt;-</span> <span class="fu">plot_winddir_vs_pollutants</span>(</span>
<span id="cb370-5"><a href="#cb370-5" aria-hidden="true" tabindex="-1"></a>  data, <span class="st">"NO"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb370-6"><a href="#cb370-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span> </span>
<span id="cb370-7"><a href="#cb370-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb370-8"><a href="#cb370-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Standardized Daily Wind Direction and NO at sites in Auckland (2016–2024)"</span>,</span>
<span id="cb370-9"><a href="#cb370-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Wind Direction"</span>,</span>
<span id="cb370-10"><a href="#cb370-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized NO"</span>)</span>
<span id="cb370-11"><a href="#cb370-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-12"><a href="#cb370-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb370-13"><a href="#cb370-13" aria-hidden="true" tabindex="-1"></a>plot_standardized</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-no-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Pollutant correlations with wind direction are weak across sites, with p-values suggesting no statistical significance at Ellerslie South and Glen Eden Central. Trend patterns are mostly flat, indicating minimal directional effects. Westlake shows the highest correlation (R = 0.14). Categories show no clear separation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb371"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb371-1"><a href="#cb371-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw wind direction vs NO for selected sites, "Puni" and "Queen Street" does not contain WindDir, "Sunnyhills East" contains no NO</span></span>
<span id="cb371-2"><a href="#cb371-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(daily_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>)))</span>
<span id="cb371-3"><a href="#cb371-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-4"><a href="#cb371-4" aria-hidden="true" tabindex="-1"></a>plot_winddir_no_site <span class="ot">&lt;-</span> <span class="fu">plot_winddir_pollutants_site</span>(</span>
<span id="cb371-5"><a href="#cb371-5" aria-hidden="true" tabindex="-1"></a>  data, <span class="st">"NO"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb371-6"><a href="#cb371-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nitric Oxide (NO, (µg/m³)"</span>)</span>
<span id="cb371-7"><a href="#cb371-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-8"><a href="#cb371-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb371-9"><a href="#cb371-9" aria-hidden="true" tabindex="-1"></a>plot_winddir_no_site</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-winddir-vs-no-by-sitetype-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
Ellerslie South &amp; Westlake show a strong positive correlation, indicating NO levels increase with specific wind directions due to pollutant transport. Glen Eden Central exhibits a weak correlation, suggesting localized emissions are the primary driver. Henderson Lincoln South presents a negative correlation, where dilution reduces NO concentrations under certain wind patterns.
</details>
<details>
<summary>
NO2 versus WindDir
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb372"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb372-1"><a href="#cb372-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw NO2 vs wind direction for selected sites, "Puni" and "Queen Street" does not contain WindDir, "Sunnyhills East" does not contain NO2</span></span>
<span id="cb372-2"><a href="#cb372-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(daily_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>)))</span>
<span id="cb372-3"><a href="#cb372-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-4"><a href="#cb372-4" aria-hidden="true" tabindex="-1"></a>plot_no2_vs_winddir <span class="ot">&lt;-</span> <span class="fu">plot_winddir_vs_pollutants</span>(</span>
<span id="cb372-5"><a href="#cb372-5" aria-hidden="true" tabindex="-1"></a>  data, <span class="st">"NO2"</span>, <span class="st">"bottom"</span>)</span>
<span id="cb372-6"><a href="#cb372-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-7"><a href="#cb372-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb372-8"><a href="#cb372-8" aria-hidden="true" tabindex="-1"></a>plot_no2_vs_winddir</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-no2-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Westlake and Ellerslie show positive NO2-wind direction correlations, strongest at Westlake. Glen Eden and Henderson exhibit weaker negative correlations. GAM smoothing highlights distinct regional pollutant transport patterns across sites.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb373"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb373-1"><a href="#cb373-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot standardized NO2 vs wind direction for selected sites, "Puni" and "Queen Street" does not contain WindDir values, "Sunnyhills East" does not contain NO2</span></span>
<span id="cb373-2"><a href="#cb373-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(standardized_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>)))</span>
<span id="cb373-3"><a href="#cb373-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb373-4"><a href="#cb373-4" aria-hidden="true" tabindex="-1"></a>plot_standardized <span class="ot">&lt;-</span> <span class="fu">plot_winddir_vs_pollutants</span>(</span>
<span id="cb373-5"><a href="#cb373-5" aria-hidden="true" tabindex="-1"></a>  data, <span class="st">"NO2"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb373-6"><a href="#cb373-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span></span>
<span id="cb373-7"><a href="#cb373-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb373-8"><a href="#cb373-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Standardized Daily Wind Direction and NO2 at sites in Auckland (2016–2024)"</span>,</span>
<span id="cb373-9"><a href="#cb373-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Wind Direction"</span>,</span>
<span id="cb373-10"><a href="#cb373-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized NO2"</span>)</span>
<span id="cb373-11"><a href="#cb373-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb373-12"><a href="#cb373-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb373-13"><a href="#cb373-13" aria-hidden="true" tabindex="-1"></a>plot_standardized</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-no2-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Westlake shows the strongest positive correlation (R = 0.43), while Glen Eden Central and Henderson Lincoln South shows weak negative correlation (R = -0.13). Wind direction impacts NO2 levels differently across sites.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb374"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot restricted standardized NO2 vs wind direction for selected sites, "Puni" and "Queen Street" does not contain WindDir values, "Sunnyhills East" does not contain NO2</span></span>
<span id="cb374-2"><a href="#cb374-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(standardized_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>)) <span class="sc">&amp;</span> NO2 <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">3</span> <span class="sc">&amp;</span> NO2 <span class="sc">&lt;=</span> <span class="dv">3</span>)</span>
<span id="cb374-3"><a href="#cb374-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-4"><a href="#cb374-4" aria-hidden="true" tabindex="-1"></a>plot_standardized <span class="ot">&lt;-</span> <span class="fu">plot_winddir_vs_pollutants</span>(</span>
<span id="cb374-5"><a href="#cb374-5" aria-hidden="true" tabindex="-1"></a>  data, <span class="st">"NO2"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb374-6"><a href="#cb374-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span></span>
<span id="cb374-7"><a href="#cb374-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb374-8"><a href="#cb374-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Restricted Standardized Daily Wind Direction and NO2 at sites in Auckland (2016–2024)"</span>,</span>
<span id="cb374-9"><a href="#cb374-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Wind Direction"</span>,</span>
<span id="cb374-10"><a href="#cb374-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized NO2 (-3 to 3)"</span>)</span>
<span id="cb374-11"><a href="#cb374-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-12"><a href="#cb374-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb374-13"><a href="#cb374-13" aria-hidden="true" tabindex="-1"></a>plot_standardized</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-restricted-z-anomalies-of-no2-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Ellerslie South and Westlake show positive correlations, while Glen Eden Central and Henderson Lincoln South show negative correlations between standardized wind direction and NO2 levels. There has been a slight improvement in correlations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb375"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb375-1"><a href="#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw NO2 vs wind direction for selected sites, "Puni" and "Queen Street" does not contain WindDir, "Sunnyhills East" contains no NO2</span></span>
<span id="cb375-2"><a href="#cb375-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(daily_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>)))</span>
<span id="cb375-3"><a href="#cb375-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-4"><a href="#cb375-4" aria-hidden="true" tabindex="-1"></a>plot_winddir_no2_site <span class="ot">&lt;-</span> <span class="fu">plot_winddir_pollutants_site</span>(</span>
<span id="cb375-5"><a href="#cb375-5" aria-hidden="true" tabindex="-1"></a>  data, <span class="st">"NO2"</span>, <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb375-6"><a href="#cb375-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Nitrogen Dioxide (NO2, (µg/m³)"</span>)</span>
<span id="cb375-7"><a href="#cb375-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-8"><a href="#cb375-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb375-9"><a href="#cb375-9" aria-hidden="true" tabindex="-1"></a>plot_winddir_no2_site</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-no2-vs-winddir-by-sitetype-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
NO2 levels vary by site type and wind patterns. Industrial areas show strong increases, traffic sites moderate rises, while residential zones exhibit weaker trends due to dispersion. Wind-driven pollutant transport is evident.
</details>
<details>
<summary>
PM10 versus WindDir
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb376"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb376-1"><a href="#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw PM10 vs wind direction for selected sites, "Puni" and "Queen Street" does not contain WindDir</span></span>
<span id="cb376-2"><a href="#cb376-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(daily_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>)))</span>
<span id="cb376-3"><a href="#cb376-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-4"><a href="#cb376-4" aria-hidden="true" tabindex="-1"></a>plot_pm10_vs_winddir <span class="ot">&lt;-</span> <span class="fu">plot_winddir_vs_pollutants</span>(</span>
<span id="cb376-5"><a href="#cb376-5" aria-hidden="true" tabindex="-1"></a>  data, <span class="st">"PM10"</span>, <span class="st">"top"</span>)</span>
<span id="cb376-6"><a href="#cb376-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-7"><a href="#cb376-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb376-8"><a href="#cb376-8" aria-hidden="true" tabindex="-1"></a>plot_pm10_vs_winddir</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-pm10-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Ellerslie South and Westlake show stronger correlations (R = 0.18, 0.14) between wind direction and PM10 concentration, while Glen Eden Central, Henderson Lincoln South, and Sunnyhills East show weaker correlations (R = 0.077, 0.049, 0.072).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb377"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb377-1"><a href="#cb377-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot standardized PM10 vs wind direction for selected sites, "Puni" and "Queen Street" does not contain WindDir values</span></span>
<span id="cb377-2"><a href="#cb377-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(standardized_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>)))</span>
<span id="cb377-3"><a href="#cb377-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb377-4"><a href="#cb377-4" aria-hidden="true" tabindex="-1"></a>plot_standardized <span class="ot">&lt;-</span> <span class="fu">plot_winddir_vs_pollutants</span>(</span>
<span id="cb377-5"><a href="#cb377-5" aria-hidden="true" tabindex="-1"></a>  data, <span class="st">"PM10"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb377-6"><a href="#cb377-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span></span>
<span id="cb377-7"><a href="#cb377-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb377-8"><a href="#cb377-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Standardized Daily Wind Direction and PM10 at sites in Auckland (2016–2024)"</span>,</span>
<span id="cb377-9"><a href="#cb377-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Wind Direction"</span>,</span>
<span id="cb377-10"><a href="#cb377-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized PM10"</span>)</span>
<span id="cb377-11"><a href="#cb377-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb377-12"><a href="#cb377-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb377-13"><a href="#cb377-13" aria-hidden="true" tabindex="-1"></a>plot_standardized</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-pm10-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Ellerslie South shows the highest correlation (R = 0.18), while Sunnyhills East shows the lowest (R = 0.06). PM10 levels increase with high wind direction across all sites. There are some very large z anomalies like in “Westlake” causing the relationship to be weak.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb378"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb378-1"><a href="#cb378-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot restricted standardized PM10 vs wind direction for selected sites, "Puni" and "Queen Street" does not contain WindDir values</span></span>
<span id="cb378-2"><a href="#cb378-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(standardized_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>)) <span class="sc">&amp;</span> PM10 <span class="sc">&lt;=</span> <span class="dv">3</span>)</span>
<span id="cb378-3"><a href="#cb378-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-4"><a href="#cb378-4" aria-hidden="true" tabindex="-1"></a>plot_standardized <span class="ot">&lt;-</span> <span class="fu">plot_winddir_vs_pollutants</span>(</span>
<span id="cb378-5"><a href="#cb378-5" aria-hidden="true" tabindex="-1"></a>  data, <span class="st">"PM10"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb378-6"><a href="#cb378-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span></span>
<span id="cb378-7"><a href="#cb378-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb378-8"><a href="#cb378-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Restricted Standardized Daily Wind Direction and PM10 at sites in Auckland (2016–2024)"</span>,</span>
<span id="cb378-9"><a href="#cb378-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Wind Direction"</span>,</span>
<span id="cb378-10"><a href="#cb378-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized PM10 (&lt;= 3)"</span>)</span>
<span id="cb378-11"><a href="#cb378-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-12"><a href="#cb378-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb378-13"><a href="#cb378-13" aria-hidden="true" tabindex="-1"></a>plot_standardized</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-restricted-z-anomalies-of-pm10-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>There is very slight increase in correlations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb379"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw PM10 vs wind direction for selected sites, "Puni" and "Queen Street" does not contain WindDir</span></span>
<span id="cb379-2"><a href="#cb379-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(daily_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>)))</span>
<span id="cb379-3"><a href="#cb379-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb379-4"><a href="#cb379-4" aria-hidden="true" tabindex="-1"></a>plot_winddir_pm10_site <span class="ot">&lt;-</span> <span class="fu">plot_winddir_pollutants_site</span>(</span>
<span id="cb379-5"><a href="#cb379-5" aria-hidden="true" tabindex="-1"></a>  data, <span class="st">"PM10"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb379-6"><a href="#cb379-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Particulate Matter (PM10, (µg/m³)"</span>)</span>
<span id="cb379-7"><a href="#cb379-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb379-8"><a href="#cb379-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb379-9"><a href="#cb379-9" aria-hidden="true" tabindex="-1"></a>plot_winddir_pm10_site</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-pm10-vs-winddir-by-sitetype-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
Industrial sites show higher PM10 correlations with wind direction than residential sites. Trend consistency varies by site type.
</details>
<details>
<summary>
PM2.5 versus WindDir
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb380"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb380-1"><a href="#cb380-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw PM2.5 vs wind direction for selected sites, "Puni" and "Queen Street" does not contain WindDir. "Ellerslie South" and "Westlake" only contains PM2.5</span></span>
<span id="cb380-2"><a href="#cb380-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(daily_airdata, (sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ellerslie South"</span>, <span class="st">"Westlake"</span>)))</span>
<span id="cb380-3"><a href="#cb380-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-4"><a href="#cb380-4" aria-hidden="true" tabindex="-1"></a>plot_pm25_vs_winddir <span class="ot">&lt;-</span> <span class="fu">plot_winddir_vs_pollutants</span>(</span>
<span id="cb380-5"><a href="#cb380-5" aria-hidden="true" tabindex="-1"></a>  data, <span class="st">"PM2.5"</span>, <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb380-6"><a href="#cb380-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">""</span>, <span class="at">subtitle =</span> <span class="st">"Categorized by 10-90% Percentiles"</span>)</span>
<span id="cb380-7"><a href="#cb380-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-8"><a href="#cb380-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw PM2.5 vs wind direction for selected sites</span></span>
<span id="cb380-9"><a href="#cb380-9" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(daily_airdata, (sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ellerslie South"</span>, <span class="st">"Westlake"</span>)))</span>
<span id="cb380-10"><a href="#cb380-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-11"><a href="#cb380-11" aria-hidden="true" tabindex="-1"></a>plot_winddir_pm25_site <span class="ot">&lt;-</span> <span class="fu">plot_winddir_pollutants_site</span>(</span>
<span id="cb380-12"><a href="#cb380-12" aria-hidden="true" tabindex="-1"></a>  data, <span class="st">"PM2.5"</span>, <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb380-13"><a href="#cb380-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">""</span>, <span class="at">subtitle =</span> <span class="st">"Categorized by Site Type"</span>)</span>
<span id="cb380-14"><a href="#cb380-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-15"><a href="#cb380-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb380-16"><a href="#cb380-16" aria-hidden="true" tabindex="-1"></a>plot_pm25_vs_winddir <span class="sc">/</span> plot_winddir_pm25_site <span class="sc">+</span></span>
<span id="cb380-17"><a href="#cb380-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">+</span> <span class="co"># Collect legend</span></span>
<span id="cb380-18"><a href="#cb380-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb380-19"><a href="#cb380-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Daily Wind Direction and PM2.5 Concentration at sites in Auckland (2016–2024)"</span>,</span>
<span id="cb380-20"><a href="#cb380-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"GAM smooth trend with Pearson correlation for each site"</span>,</span>
<span id="cb380-21"><a href="#cb380-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb380-22"><a href="#cb380-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb380-23"><a href="#cb380-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-pm2.5-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>PM2.5 rises with wind direction at Ellerslie South but dips at 100° in Westlake. Categories: WindDir Level (Low, Medium, High) and Site Type (Residential, Industrial, Traffic). Pearson correlations are weak but significant.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb381"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb381-1"><a href="#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies, select "Ellerslie South" and "Westlake", they have numeric WindDir and PM2.5 values</span></span>
<span id="cb381-2"><a href="#cb381-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(standardized_airdata, sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ellerslie South"</span>, <span class="st">"Westlake"</span>))</span>
<span id="cb381-3"><a href="#cb381-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-4"><a href="#cb381-4" aria-hidden="true" tabindex="-1"></a>plot_winddir_pm25_1 <span class="ot">&lt;-</span> <span class="fu">plot_winddir_vs_pollutants</span>(data, <span class="st">"PM2.5"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb381-5"><a href="#cb381-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span></span>
<span id="cb381-6"><a href="#cb381-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb381-7"><a href="#cb381-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">""</span>, <span class="at">subtitle =</span> <span class="st">"Z-anomaly"</span>,</span>
<span id="cb381-8"><a href="#cb381-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Wind Direction"</span>, <span class="at">y =</span> <span class="st">"Standardized PM2.5"</span>)</span>
<span id="cb381-9"><a href="#cb381-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-10"><a href="#cb381-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies, restricted to &lt;= 3</span></span>
<span id="cb381-11"><a href="#cb381-11" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(standardized_airdata, sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ellerslie South"</span>, <span class="st">"Westlake"</span>) <span class="sc">&amp;</span> PM2<span class="fl">.5</span> <span class="sc">&lt;=</span> <span class="dv">3</span>)</span>
<span id="cb381-12"><a href="#cb381-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-13"><a href="#cb381-13" aria-hidden="true" tabindex="-1"></a>plot_winddir_pm25_2 <span class="ot">&lt;-</span> <span class="fu">plot_winddir_vs_pollutants</span>(data, <span class="st">"PM2.5"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb381-14"><a href="#cb381-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span></span>
<span id="cb381-15"><a href="#cb381-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb381-16"><a href="#cb381-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">""</span>, <span class="at">subtitle =</span> <span class="st">"Z-anomaly (&lt;= 3)"</span>,</span>
<span id="cb381-17"><a href="#cb381-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Wind Direction"</span>, </span>
<span id="cb381-18"><a href="#cb381-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized PM2.5 (&lt;= 3)"</span>)</span>
<span id="cb381-19"><a href="#cb381-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-20"><a href="#cb381-20" aria-hidden="true" tabindex="-1"></a>plot_winddir_pm25_1 <span class="sc">/</span> plot_winddir_pm25_2 <span class="sc">+</span></span>
<span id="cb381-21"><a href="#cb381-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">+</span> <span class="co"># Collect legend</span></span>
<span id="cb381-22"><a href="#cb381-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb381-23"><a href="#cb381-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Standardised Daily Wind Direction and PM2.5 Concentration at sites in Auckland (2016–2024)"</span>,</span>
<span id="cb381-24"><a href="#cb381-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"GAM smooth trend with Pearson correlation for each site"</span>,</span>
<span id="cb381-25"><a href="#cb381-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb381-26"><a href="#cb381-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb381-27"><a href="#cb381-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-pm25-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
Ellerslie South shows weak positive PM2.5-wind direction correlation (R = 0.18–0.19), similar to Westlake (R = 0.14–0.2). Both sites’ significance (p &lt; 2.2e-16) confirms trends across 2016–2024.
</details>
<details>
<summary>
SO2 versus WindDir
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb382"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb382-1"><a href="#cb382-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot, select "Ellerslie South", it is the only site recording SO2 values</span></span>
<span id="cb382-2"><a href="#cb382-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb382-3"><a href="#cb382-3" aria-hidden="true" tabindex="-1"></a>plot_so2_vs_winddir <span class="ot">&lt;-</span> <span class="fu">plot_winddir_vs_pollutants</span>(data, <span class="st">"SO2"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb382-4"><a href="#cb382-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">""</span>, <span class="at">subtitle =</span> <span class="st">"Categorized by 10-90% Percentiles"</span>)</span>
<span id="cb382-5"><a href="#cb382-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-6"><a href="#cb382-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot SO2 vs wind direction categorized by site type</span></span>
<span id="cb382-7"><a href="#cb382-7" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb382-8"><a href="#cb382-8" aria-hidden="true" tabindex="-1"></a>plot_winddir_so2_site <span class="ot">&lt;-</span> <span class="fu">plot_winddir_pollutants_site</span>(</span>
<span id="cb382-9"><a href="#cb382-9" aria-hidden="true" tabindex="-1"></a>  data, <span class="st">"SO2"</span>, <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb382-10"><a href="#cb382-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">""</span>, <span class="at">subtitle =</span> <span class="st">"Categorized by Site Type"</span>)</span>
<span id="cb382-11"><a href="#cb382-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-12"><a href="#cb382-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies</span></span>
<span id="cb382-13"><a href="#cb382-13" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(standardized_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb382-14"><a href="#cb382-14" aria-hidden="true" tabindex="-1"></a>plot_standardized_1 <span class="ot">&lt;-</span> <span class="fu">plot_winddir_vs_pollutants</span>(data, <span class="st">"SO2"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb382-15"><a href="#cb382-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span></span>
<span id="cb382-16"><a href="#cb382-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb382-17"><a href="#cb382-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Z-anomaly"</span>, <span class="at">subtitle =</span> <span class="st">"Categorized by 10-90% Percentiles"</span>,</span>
<span id="cb382-18"><a href="#cb382-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Wind Direction"</span>, <span class="at">y =</span> <span class="st">"Standardized SO2"</span>) </span>
<span id="cb382-19"><a href="#cb382-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-20"><a href="#cb382-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies restricted to &lt;= 3</span></span>
<span id="cb382-21"><a href="#cb382-21" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(standardized_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span> <span class="sc">&amp;</span> SO2 <span class="sc">&lt;=</span> <span class="dv">3</span>)</span>
<span id="cb382-22"><a href="#cb382-22" aria-hidden="true" tabindex="-1"></a>plot_standardized_2 <span class="ot">&lt;-</span> <span class="fu">plot_winddir_vs_pollutants</span>(data, <span class="st">"SO2"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb382-23"><a href="#cb382-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span></span>
<span id="cb382-24"><a href="#cb382-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb382-25"><a href="#cb382-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Z-anomalies (&lt;= 3)"</span>, <span class="at">subtitle =</span> <span class="st">"Categorized by 10-90% Percentiles"</span>,</span>
<span id="cb382-26"><a href="#cb382-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Wind Direction"</span>, <span class="at">y =</span> <span class="st">"Standardized SO2"</span>)</span>
<span id="cb382-27"><a href="#cb382-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-28"><a href="#cb382-28" aria-hidden="true" tabindex="-1"></a>(plot_so2_vs_winddir <span class="sc">+</span> plot_winddir_so2_site) <span class="sc">/</span> (plot_standardized_1  <span class="sc">+</span> plot_standardized_2) <span class="sc">+</span></span>
<span id="cb382-29"><a href="#cb382-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">+</span> <span class="co"># Collect legends</span></span>
<span id="cb382-30"><a href="#cb382-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb382-31"><a href="#cb382-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Raw and Standardised Daily Wind Speed and SO2 Concentration at sites in Auckland (2016–2024)"</span>,</span>
<span id="cb382-32"><a href="#cb382-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"GAM smooth trend with Pearson correlation for each site"</span>,</span>
<span id="cb382-33"><a href="#cb382-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb382-34"><a href="#cb382-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb382-35"><a href="#cb382-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-so2-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
SO2 concentration weakly correlates with wind direction. Categories include wind speed levels (low, medium, high) and site types (residential, industrial, NES). GAM smooth trends analyze relationships at Auckland sites (2016–2024).
</details>
</details></details></section>
<section id="weekly-and-monthly-pollutant-aqi-and-meteorological-factors-relationship-by-site" class="level3" data-number="5.5">
<h3 data-number="5.5" class="anchored" data-anchor-id="weekly-and-monthly-pollutant-aqi-and-meteorological-factors-relationship-by-site"><span class="header-section-number">5.5</span> Weekly and Monthly Pollutant, AQI and Meteorological Factors Relationship by Site</h3>
<p>This visualization explores the weekly and monthly average correlation between pollutants, AQI, and meteorological factors across various Auckland sites. Strong associations at urban sites (e.g., Queen Street) contrast with weaker links at rural locations, indicating differences in traffic emissions and environmental influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb383"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb383-1"><a href="#cb383-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new variable representing the week start date</span></span>
<span id="cb383-2"><a href="#cb383-2" aria-hidden="true" tabindex="-1"></a>weekly_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb383-3"><a href="#cb383-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">week_start =</span> <span class="fu">floor_date</span>(date, <span class="at">unit =</span> <span class="st">"week"</span>, <span class="at">week_start =</span> <span class="dv">1</span>))  <span class="co"># week starts on Monday</span></span>
<span id="cb383-4"><a href="#cb383-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb383-5"><a href="#cb383-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize totals by week</span></span>
<span id="cb383-6"><a href="#cb383-6" aria-hidden="true" tabindex="-1"></a>weekly_airdata <span class="ot">&lt;-</span> weekly_airdata <span class="sc">|&gt;</span></span>
<span id="cb383-7"><a href="#cb383-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name, site_type, week_start) <span class="sc">|&gt;</span></span>
<span id="cb383-8"><a href="#cb383-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb383-9"><a href="#cb383-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">NO =</span> <span class="fu">sum</span>(NO, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">NO2 =</span> <span class="fu">sum</span>(NO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-10"><a href="#cb383-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">PM2.5 =</span> <span class="fu">sum</span>(PM2<span class="fl">.5</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb383-11"><a href="#cb383-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">PM10 =</span> <span class="fu">sum</span>(PM10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-12"><a href="#cb383-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">SO2 =</span> <span class="fu">sum</span>(SO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb383-13"><a href="#cb383-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">AirTemp =</span> <span class="fu">sum</span>(AirTemp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-14"><a href="#cb383-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">WindSpeed =</span> <span class="fu">sum</span>(WindSpeed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-15"><a href="#cb383-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">WindDir =</span> <span class="fu">sum</span>(WindDir, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-16"><a href="#cb383-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">AQI =</span> <span class="fu">sum</span>(AQI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-17"><a href="#cb383-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb383-18"><a href="#cb383-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb383-19"><a href="#cb383-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by sites and z scores</span></span>
<span id="cb383-20"><a href="#cb383-20" aria-hidden="true" tabindex="-1"></a>  weekly_airdata <span class="ot">&lt;-</span> weekly_airdata <span class="sc">|&gt;</span></span>
<span id="cb383-21"><a href="#cb383-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(sa2_name, site_type) <span class="sc">|&gt;</span></span>
<span id="cb383-22"><a href="#cb383-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb383-23"><a href="#cb383-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">z_NO =</span> (NO <span class="sc">-</span> <span class="fu">mean</span>(NO, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(NO, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-24"><a href="#cb383-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">z_NO2 =</span> (NO2 <span class="sc">-</span> <span class="fu">mean</span>(NO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(NO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-25"><a href="#cb383-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">z_PM2.5 =</span> (PM2<span class="fl">.5</span> <span class="sc">-</span> <span class="fu">mean</span>(PM2<span class="fl">.5</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(PM2<span class="fl">.5</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-26"><a href="#cb383-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">z_PM10 =</span> (PM10 <span class="sc">-</span> <span class="fu">mean</span>(PM10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(PM10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-27"><a href="#cb383-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">z_SO2 =</span> (SO2 <span class="sc">-</span> <span class="fu">mean</span>(SO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(SO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-28"><a href="#cb383-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">z_AirTemp =</span> (AirTemp <span class="sc">-</span> <span class="fu">mean</span>(AirTemp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(AirTemp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-29"><a href="#cb383-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">z_WindSpeed =</span> (WindSpeed <span class="sc">-</span> <span class="fu">mean</span>(WindSpeed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(WindSpeed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-30"><a href="#cb383-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">z_WindDir =</span> (WindDir <span class="sc">-</span> <span class="fu">mean</span>(WindDir, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(WindDir, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-31"><a href="#cb383-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">z_AQI =</span> (AQI <span class="sc">-</span> <span class="fu">mean</span>(AQI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(AQI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>()</span>
<span id="cb383-32"><a href="#cb383-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb383-33"><a href="#cb383-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new variable representing the month start date</span></span>
<span id="cb383-34"><a href="#cb383-34" aria-hidden="true" tabindex="-1"></a>monthly_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb383-35"><a href="#cb383-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month_start =</span> <span class="fu">floor_date</span>(date, <span class="at">unit =</span> <span class="st">"month"</span>))</span>
<span id="cb383-36"><a href="#cb383-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb383-37"><a href="#cb383-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize total by month and site</span></span>
<span id="cb383-38"><a href="#cb383-38" aria-hidden="true" tabindex="-1"></a>monthly_airdata <span class="ot">&lt;-</span> monthly_airdata <span class="sc">|&gt;</span></span>
<span id="cb383-39"><a href="#cb383-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name, site_type, month_start) <span class="sc">|&gt;</span></span>
<span id="cb383-40"><a href="#cb383-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb383-41"><a href="#cb383-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">NO =</span> <span class="fu">sum</span>(NO, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">NO2 =</span> <span class="fu">sum</span>(NO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-42"><a href="#cb383-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">PM2.5 =</span> <span class="fu">sum</span>(PM2<span class="fl">.5</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb383-43"><a href="#cb383-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">PM10 =</span> <span class="fu">sum</span>(PM10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-44"><a href="#cb383-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">SO2 =</span> <span class="fu">sum</span>(SO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-45"><a href="#cb383-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">AirTemp =</span> <span class="fu">sum</span>(AirTemp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-46"><a href="#cb383-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">WindSpeed =</span> <span class="fu">sum</span>(WindSpeed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-47"><a href="#cb383-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">WindDir =</span> <span class="fu">sum</span>(WindDir, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-48"><a href="#cb383-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">AQI =</span> <span class="fu">sum</span>(AQI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-49"><a href="#cb383-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb383-50"><a href="#cb383-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb383-51"><a href="#cb383-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by sites and compute z-scores</span></span>
<span id="cb383-52"><a href="#cb383-52" aria-hidden="true" tabindex="-1"></a>monthly_airdata <span class="ot">&lt;-</span> monthly_airdata <span class="sc">|&gt;</span></span>
<span id="cb383-53"><a href="#cb383-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name, site_type) <span class="sc">|&gt;</span></span>
<span id="cb383-54"><a href="#cb383-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb383-55"><a href="#cb383-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">z_NO =</span> (NO <span class="sc">-</span> <span class="fu">mean</span>(NO, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(NO, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-56"><a href="#cb383-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">z_NO2 =</span> (NO2 <span class="sc">-</span> <span class="fu">mean</span>(NO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(NO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-57"><a href="#cb383-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">z_PM2.5 =</span> (PM2<span class="fl">.5</span> <span class="sc">-</span> <span class="fu">mean</span>(PM2<span class="fl">.5</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(PM2<span class="fl">.5</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-58"><a href="#cb383-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">z_PM10 =</span> (PM10 <span class="sc">-</span> <span class="fu">mean</span>(PM10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(PM10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-59"><a href="#cb383-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">z_SO2 =</span> (SO2 <span class="sc">-</span> <span class="fu">mean</span>(SO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(SO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-60"><a href="#cb383-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">z_AirTemp =</span> (AirTemp <span class="sc">-</span> <span class="fu">mean</span>(AirTemp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(AirTemp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-61"><a href="#cb383-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">z_WindSpeed =</span> (WindSpeed <span class="sc">-</span> <span class="fu">mean</span>(WindSpeed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(WindSpeed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-62"><a href="#cb383-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">z_WindDir =</span> (WindDir <span class="sc">-</span> <span class="fu">mean</span>(WindDir, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(WindDir, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb383-63"><a href="#cb383-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">z_AQI =</span> (AQI <span class="sc">-</span> <span class="fu">mean</span>(AQI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(AQI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb384"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb384-1"><a href="#cb384-1" aria-hidden="true" tabindex="-1"></a>plot_pollutants_z <span class="ot">&lt;-</span> <span class="cf">function</span>(data, xvar, yvar, title_var, <span class="at">x_pct =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">y_pct =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">x_ribbon_fill =</span> <span class="st">"#0072B2"</span>, <span class="at">y_ribbon_fill =</span> <span class="st">"#E69F00"</span>, <span class="at">ribbon_alpha =</span> <span class="fl">0.2</span>) {</span>
<span id="cb384-2"><a href="#cb384-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate percentile bounds and ranges per sa2_name</span></span>
<span id="cb384-3"><a href="#cb384-3" aria-hidden="true" tabindex="-1"></a>  ribbons <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb384-4"><a href="#cb384-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb384-5"><a href="#cb384-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb384-6"><a href="#cb384-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">x_low =</span> <span class="fu">quantile</span>(.data[[xvar]], <span class="at">probs =</span> x_pct[<span class="dv">1</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb384-7"><a href="#cb384-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">x_high =</span> <span class="fu">quantile</span>(.data[[xvar]], <span class="at">probs =</span> x_pct[<span class="dv">2</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb384-8"><a href="#cb384-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">y_low =</span> <span class="fu">quantile</span>(.data[[yvar]], <span class="at">probs =</span> y_pct[<span class="dv">1</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb384-9"><a href="#cb384-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">y_high =</span> <span class="fu">quantile</span>(.data[[yvar]], <span class="at">probs =</span> y_pct[<span class="dv">2</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb384-10"><a href="#cb384-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">x_min =</span> <span class="fu">min</span>(.data[[xvar]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb384-11"><a href="#cb384-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">x_max =</span> <span class="fu">max</span>(.data[[xvar]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb384-12"><a href="#cb384-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">y_min =</span> <span class="fu">min</span>(.data[[yvar]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb384-13"><a href="#cb384-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">y_max =</span> <span class="fu">max</span>(.data[[yvar]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb384-14"><a href="#cb384-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb384-15"><a href="#cb384-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb384-16"><a href="#cb384-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the plot</span></span>
<span id="cb384-17"><a href="#cb384-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> .data[[xvar]], <span class="at">y =</span> .data[[yvar]])) <span class="sc">+</span></span>
<span id="cb384-18"><a href="#cb384-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data =</span> ribbons, <span class="fu">aes</span>(<span class="at">xmin =</span> x_low, <span class="at">xmax =</span> x_high, <span class="at">ymin =</span> y_min, <span class="at">ymax =</span> y_max), <span class="at">fill =</span> x_ribbon_fill, <span class="at">alpha =</span> ribbon_alpha, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb384-19"><a href="#cb384-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data =</span> ribbons, <span class="fu">aes</span>(<span class="at">xmin =</span> x_min, <span class="at">xmax =</span> x_max, <span class="at">ymin =</span> y_low, <span class="at">ymax =</span> y_high), <span class="at">fill =</span> y_ribbon_fill, <span class="at">alpha =</span> ribbon_alpha, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb384-20"><a href="#cb384-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> site_type), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb384-21"><a href="#cb384-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"#4D4D4D"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb384-22"><a href="#cb384-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_cor</span>(<span class="at">method =</span> <span class="st">"pearson"</span>, <span class="at">label.x.npc =</span> <span class="st">"left"</span>, <span class="at">label.y.npc =</span> <span class="st">"bottom"</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">"#000000"</span>) <span class="sc">+</span></span>
<span id="cb384-23"><a href="#cb384-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> sa2_name, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb384-24"><a href="#cb384-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"D"</span>, <span class="at">name =</span> <span class="st">"Site Type"</span>) <span class="sc">+</span></span>
<span id="cb384-25"><a href="#cb384-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb384-26"><a href="#cb384-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(title_var, <span class="st">"Pollutant Relationship:"</span>, xvar, <span class="st">"vs"</span>, yvar), </span>
<span id="cb384-27"><a href="#cb384-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb384-28"><a href="#cb384-28" aria-hidden="true" tabindex="-1"></a>        xvar, <span class="st">" ("</span>, x_pct[<span class="dv">1</span>]<span class="sc">*</span><span class="dv">100</span>, <span class="st">"–"</span>, x_pct[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">100</span>, <span class="st">"th %) and "</span>, </span>
<span id="cb384-29"><a href="#cb384-29" aria-hidden="true" tabindex="-1"></a>        yvar, <span class="st">" ("</span>, y_pct[<span class="dv">1</span>]<span class="sc">*</span><span class="dv">100</span>, <span class="st">"–"</span>, y_pct[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">100</span>, <span class="st">"th %) percentile ribbons shown. "</span>,</span>
<span id="cb384-30"><a href="#cb384-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Loess trend line indicates overall relationship."</span>),</span>
<span id="cb384-31"><a href="#cb384-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">paste0</span>(title_var, <span class="st">" "</span>, xvar, <span class="st">" (µg/m³)"</span>),</span>
<span id="cb384-32"><a href="#cb384-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">paste0</span>(title_var, <span class="st">" "</span>, yvar, <span class="st">" (µg/m³)"</span>)</span>
<span id="cb384-33"><a href="#cb384-33" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb384-34"><a href="#cb384-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb384-35"><a href="#cb384-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb384-36"><a href="#cb384-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb384-37"><a href="#cb384-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb384-38"><a href="#cb384-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb384-39"><a href="#cb384-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb384-40"><a href="#cb384-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb384-41"><a href="#cb384-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb384-42"><a href="#cb384-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb384-43"><a href="#cb384-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb384-44"><a href="#cb384-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>)</span>
<span id="cb384-45"><a href="#cb384-45" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb384-46"><a href="#cb384-46" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
Weekly and monthly relationship of NO versus Factors
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb385"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb385-1"><a href="#cb385-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot weekly NO versus NO2 by site, remove sites not having data</span></span>
<span id="cb385-2"><a href="#cb385-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, sa2_name <span class="sc">!=</span> <span class="st">"Sunnyhills East"</span>)</span>
<span id="cb385-3"><a href="#cb385-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4"><a href="#cb385-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"NO"</span>, <span class="st">"NO2"</span>, <span class="st">"Weekly"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-weekly-no-vs-no2-group-by-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Ellerslie South, Queen Street, and Westlake show strong NO-NO2 correlations, while Puni is weakest. Site types influence pollutant relationships, highlighting variations in emissions and meteorological effects across locations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb386"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot monthly NO versus NO2 by site, remove sites not having data</span></span>
<span id="cb386-2"><a href="#cb386-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, sa2_name <span class="sc">!=</span> <span class="st">"Sunnyhills East"</span>)</span>
<span id="cb386-3"><a href="#cb386-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-4"><a href="#cb386-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"NO"</span>, <span class="st">"NO2"</span>, <span class="st">"Monthly"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-monthly-no-vs-no2-group-by-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>NO and NO2 show strong correlations across six sites, with varied strengths. Correlation significance varies, affecting pollutant interplay interpretations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb387"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb387-1"><a href="#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot weekly NO versus PM2.5 by site, remove sites not having data</span></span>
<span id="cb387-2"><a href="#cb387-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb387-3"><a href="#cb387-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-4"><a href="#cb387-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"NO"</span>, <span class="st">"PM2.5"</span>, <span class="st">"Weekly"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-weekly-no-vs-pm2.5-group-by-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Ellerslie South shows the highest NO-PM2.5 significant correlation (R = 0.57). Other sites have weaker correlations, highlighting location-specific influences on pollutant dynamics. Seasonal variations may affect these relationships.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb388"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot monthly NO versus PM2.5 by site, remove sites not having data</span></span>
<span id="cb388-2"><a href="#cb388-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb388-3"><a href="#cb388-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb388-4"><a href="#cb388-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"NO"</span>, <span class="st">"PM2.5"</span>, <span class="st">"Monthly"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-monthly-no-vs-pm2.5-group-by-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Traffic NES sites (Queen Street) show the widest NO variability, while residential NES sites (Puni) have stable quantiles. Industrial NES sites (Ellerslie South) exhibit strong correlations with NO and PM2.5 dispersion.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb389"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb389-1"><a href="#cb389-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot weekly NO versus PM10 by site, remove sites not having data</span></span>
<span id="cb389-2"><a href="#cb389-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sunnyhills East"</span>))</span>
<span id="cb389-3"><a href="#cb389-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb389-4"><a href="#cb389-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"NO"</span>, <span class="st">"PM10"</span>, <span class="st">"Weekly"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-weekly-no-vs-pm10-group-by-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Higher quantiles at traffic sites suggest stronger NO-PM10 correlation, while residential sites show broader dispersion. Outliers mainly occur at industrial and residential sites, highlighting localized emissions. Percentile ranges indicate seasonal variability across locations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb390"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb390-1"><a href="#cb390-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot monthly NO versus PM10 by site, remove sites not having data</span></span>
<span id="cb390-2"><a href="#cb390-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sunnyhills East"</span>))</span>
<span id="cb390-3"><a href="#cb390-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb390-4"><a href="#cb390-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"NO"</span>, <span class="st">"PM10"</span>, <span class="st">"Monthly"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-monthly-no-vs-pm10-group-by-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Traffic sites (Queen Street, Westlake) show widened NO 10-90th percentiles with high-end outliers. Residential sites (Glen Eden, Puni) exhibit tighter distributions and lower NO extremes. PM10 variability is stable, except broader quantile spreads at Henderson, Ellerslie. Westlake’s NO-PM10 correlation suggests traffic influence.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb391"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb391-1"><a href="#cb391-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot weekly and monthly NO versus SO2 by site, remove sites not having data</span></span>
<span id="cb391-2"><a href="#cb391-2" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb391-3"><a href="#cb391-3" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb391-4"><a href="#cb391-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb391-5"><a href="#cb391-5" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">plot_pollutants_z</span>(data1, <span class="st">"NO"</span>, <span class="st">"SO2"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Weekly"</span>, <span class="at">subtitle =</span> <span class="st">""</span>)</span>
<span id="cb391-6"><a href="#cb391-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb391-7"><a href="#cb391-7" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot_pollutants_z</span>(data2, <span class="st">"NO"</span>, <span class="st">"SO2"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monthly"</span>, <span class="at">subtitle =</span> <span class="st">""</span>)</span>
<span id="cb391-8"><a href="#cb391-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb391-9"><a href="#cb391-9" aria-hidden="true" tabindex="-1"></a>plot1 <span class="sc">+</span> plot2 <span class="sc">+</span></span>
<span id="cb391-10"><a href="#cb391-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb391-11"><a href="#cb391-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly and Monthly NO versus SO2 Pollutant Relationship"</span>,</span>
<span id="cb391-12"><a href="#cb391-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Vertical ribbon = 10–90th percentile for NO; Horizontal ribbon = 10–90th percentile for SO2"</span>,</span>
<span id="cb391-13"><a href="#cb391-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb391-14"><a href="#cb391-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb391-15"><a href="#cb391-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-weekly-and-monthly-no-vs-so2-group-by-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Industrial site (Ellerslie South) show higher NO-SO2 correlations with wider quantile spreads and more high-end outliers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb392"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb392-1"><a href="#cb392-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of weekly NO versus AQI by site, remove sites not having data</span></span>
<span id="cb392-2"><a href="#cb392-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sunnyhills East"</span>))</span>
<span id="cb392-3"><a href="#cb392-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb392-4"><a href="#cb392-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_NO"</span>, <span class="st">"z_AQI"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span></span>
<span id="cb392-5"><a href="#cb392-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb392-6"><a href="#cb392-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly NO versus AQI Relationship of Anomalies"</span>,</span>
<span id="cb392-7"><a href="#cb392-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly NO Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly AQI Anomaly"</span></span>
<span id="cb392-8"><a href="#cb392-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-weekly-no-vs-aqi-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Traffic NES sites show higher NO anomalies with wider AQI percentiles, indicating localized emissions. Residential NES sites have narrower quantiles, showing stable dispersion. IN Queen Street, outliers cluster in traffic zones, suggesting episodic pollution spikes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb393"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb393-1"><a href="#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of monthly NO versus AQI by site, remove sites not having data</span></span>
<span id="cb393-2"><a href="#cb393-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sunnyhills East"</span>))</span>
<span id="cb393-3"><a href="#cb393-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb393-4"><a href="#cb393-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_NO"</span>, <span class="st">"z_AQI"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span></span>
<span id="cb393-5"><a href="#cb393-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb393-6"><a href="#cb393-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly NO versus AQI Relationship of Anomalies"</span>,</span>
<span id="cb393-7"><a href="#cb393-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly NO Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly AQI Anomaly"</span></span>
<span id="cb393-8"><a href="#cb393-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-monthly-no-vs-AQI-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Traffic sites show higher NO anomaly quantiles, with Queen Street having the most extreme outliers. Residential sites exhibit narrower dispersions. Westlake shows notable AQI variability, indicating localized emission or meteorological influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb394"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb394-1"><a href="#cb394-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of weekly NO versus AirTemp by site, remove sites not having data</span></span>
<span id="cb394-2"><a href="#cb394-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb394-3"><a href="#cb394-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb394-4"><a href="#cb394-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_NO"</span>, <span class="st">"z_AirTemp"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span></span>
<span id="cb394-5"><a href="#cb394-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb394-6"><a href="#cb394-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly NO versus AirTemp Relationship of Anomalies"</span>,</span>
<span id="cb394-7"><a href="#cb394-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly NO Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly AirTemp Anomaly"</span></span>
<span id="cb394-8"><a href="#cb394-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-weekly-no-vs-airtemp-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Traffic sites show wider NO anomaly quantile ranges, with more extreme outliers. Residential sites have tighter distributions. Industrial sites exhibit moderate spread, with sequence of high outliers. NES sites vary by location.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb395"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb395-1"><a href="#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of monthly NO versus AirTemp by site, remove sites not having data</span></span>
<span id="cb395-2"><a href="#cb395-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb395-3"><a href="#cb395-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-4"><a href="#cb395-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_NO"</span>, <span class="st">"z_AirTemp"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span></span>
<span id="cb395-5"><a href="#cb395-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb395-6"><a href="#cb395-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Relationship of NO versus AirTemp Anomalies"</span>,</span>
<span id="cb395-7"><a href="#cb395-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly NO Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly AirTemp Anomaly"</span></span>
<span id="cb395-8"><a href="#cb395-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-monthly-no-vs-airtemp-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Residential sites show wider quantile spreads and more outliers. Queen Street and Westlake exhibit fewer outliers, reflecting more stable NO-air temperature anomaly relationships.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb396"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb396-1"><a href="#cb396-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of weekly NO versus WindSpeed by site, remove sites not having data</span></span>
<span id="cb396-2"><a href="#cb396-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb396-3"><a href="#cb396-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb396-4"><a href="#cb396-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_NO"</span>, <span class="st">"z_WindSpeed"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span></span>
<span id="cb396-5"><a href="#cb396-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb396-6"><a href="#cb396-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly NO versus WindSpeed Relationship of Anomalies"</span>,</span>
<span id="cb396-7"><a href="#cb396-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly NO Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly WindSpeed Anomaly"</span></span>
<span id="cb396-8"><a href="#cb396-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-weekly-no-vs-windspeed-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Traffic sites have narrower NO anomalies than residential ones. Industrial sites show greater dispersion. Outliers cluster at extreme wind speed deviations, particularly in residential areas. Correlations weaken at higher anomalies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb397"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb397-1"><a href="#cb397-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of monthly NO versus WindSpeed by site, remove sites not having data</span></span>
<span id="cb397-2"><a href="#cb397-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb397-3"><a href="#cb397-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb397-4"><a href="#cb397-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_NO"</span>, <span class="st">"z_WindSpeed"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span></span>
<span id="cb397-5"><a href="#cb397-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb397-6"><a href="#cb397-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Relationship of NO versus WindSpeed Anomalies"</span>,</span>
<span id="cb397-7"><a href="#cb397-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly NO Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly WindSpeed Anomaly"</span></span>
<span id="cb397-8"><a href="#cb397-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-monthly-no-vs-windspeed-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>NO anomalies 10-90th percentiles vary by site type. Traffic sites show tighter quantiles, while residential sites exhibit wider spreads. Outliers emerge in industrial and traffic sites, differing by correlation strength with wind speed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb398"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb398-1"><a href="#cb398-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of weekly NO versus WindDir by site, remove sites not having data</span></span>
<span id="cb398-2"><a href="#cb398-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb398-3"><a href="#cb398-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb398-4"><a href="#cb398-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_NO"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span></span>
<span id="cb398-5"><a href="#cb398-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb398-6"><a href="#cb398-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly Relationship of NO versus WindDir Anomalies"</span>,</span>
<span id="cb398-7"><a href="#cb398-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly NO Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly WindDir Anomaly"</span></span>
<span id="cb398-8"><a href="#cb398-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-weekly-no-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Ellerslie South (Residential, Industrial) has a broad quantile range with fewer outliers. Glen Eden Central (Residential) is similar but narrower. Westlake (Traffic) has the most outliers, while Henderson Lincoln South (Residential, Traffic) shows moderate dispersion.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb399"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb399-1"><a href="#cb399-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of monthly NO versus WindDir by site, remove sites not having data</span></span>
<span id="cb399-2"><a href="#cb399-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb399-3"><a href="#cb399-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb399-4"><a href="#cb399-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_NO"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span></span>
<span id="cb399-5"><a href="#cb399-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb399-6"><a href="#cb399-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Relationship of NO versus WindDir Anomalies"</span>,</span>
<span id="cb399-7"><a href="#cb399-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly NO Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly WindDir Anomaly"</span></span>
<span id="cb399-8"><a href="#cb399-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-monthly-no-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
Ellerslie South, Glen Eden Central, and Henderson Lincoln South show broad 10-90th percentile bands for NO and WindDir anomalies, with weak correlations. Westlake has narrower bands and stronger outlier sensitivity (R = 0.31, p = 0.002).
</details>
<details>
<summary>
Weekly and monthly relationship of NO2 versus Factors
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb400"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb400-1"><a href="#cb400-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot weekly NO2 versus PM2.5 by site, remove sites not having data</span></span>
<span id="cb400-2"><a href="#cb400-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb400-3"><a href="#cb400-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb400-4"><a href="#cb400-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"NO2"</span>, <span class="st">"PM2.5"</span>, <span class="st">"Weekly"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-weekly-no2-vs-pm2.5-group-by-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Residential sites show broader quantile ranges but fewer extreme outliers. Traffic sites exhibit tighter distributions with high-end NO2 values. Industrial sites reveal dispersed PM2.5 patterns, while the other sites maintain lower variability.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb401"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb401-1"><a href="#cb401-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot monthly NO2 versus PM2.5 by site, remove sites not having data</span></span>
<span id="cb401-2"><a href="#cb401-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb401-3"><a href="#cb401-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-4"><a href="#cb401-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"NO2"</span>, <span class="st">"PM2.5"</span>, <span class="st">"Monthly"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-monthly-no2-vs-pm2.5-group-by-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Residential sites (Ellerslie South, Puni) show tighter NO2-PM2.5 clustering with fewer outliers, while traffic sites (Queen Street, Westlake) have broader quantiles and more extreme outliers, indicating higher pollutant variability and emission influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb402"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb402-1"><a href="#cb402-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot weekly NO2 versus PM10 by site, remove sites not having data</span></span>
<span id="cb402-2"><a href="#cb402-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sunnyhills East"</span>))</span>
<span id="cb402-3"><a href="#cb402-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-4"><a href="#cb402-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"NO2"</span>, <span class="st">"PM10"</span>, <span class="st">"Weekly"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-weekly-no2-vs-pm10-group-by-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>PM10-NO2 quantiles vary by site type, with traffic sites showing higher pollutant levels. Industrial sites exhibit wider dispersion. Outliers occur at traffic-heavy locations, skewing trends. Residential sites display tighter pollutant distributions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb403"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb403-1"><a href="#cb403-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot monthly NO2 versus PM10 by site, remove sites not having data</span></span>
<span id="cb403-2"><a href="#cb403-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sunnyhills East"</span>))</span>
<span id="cb403-3"><a href="#cb403-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb403-4"><a href="#cb403-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"NO2"</span>, <span class="st">"PM10"</span>, <span class="st">"Monthly"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-monthly-no2-vs-pm10-group-by-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>High-quantile NO2 values vary by site type: traffic sites show extreme outliers, while residential sites exhibit stable trends. PM10 displays broader dispersion, with industrial sites showing elevated concentrations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb404"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot weekly and monthly NO2 versus SO2 by site, remove sites not having data</span></span>
<span id="cb404-2"><a href="#cb404-2" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb404-3"><a href="#cb404-3" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb404-4"><a href="#cb404-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-5"><a href="#cb404-5" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">plot_pollutants_z</span>(data1, <span class="st">"NO2"</span>, <span class="st">"SO2"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Weekly"</span>, <span class="at">subtitle =</span> <span class="st">""</span>)</span>
<span id="cb404-6"><a href="#cb404-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb404-7"><a href="#cb404-7" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot_pollutants_z</span>(data2, <span class="st">"NO2"</span>, <span class="st">"SO2"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monthly"</span>, <span class="at">subtitle =</span> <span class="st">""</span>)</span>
<span id="cb404-8"><a href="#cb404-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-9"><a href="#cb404-9" aria-hidden="true" tabindex="-1"></a>plot1 <span class="sc">+</span> plot2 <span class="sc">+</span></span>
<span id="cb404-10"><a href="#cb404-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb404-11"><a href="#cb404-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly and Monthly NO2 versus SO2 Pollutant Relationship"</span>,</span>
<span id="cb404-12"><a href="#cb404-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Vertical ribbon = 10–90th percentile for NO2; Horizontal ribbon = 10–90th percentile for SO2"</span>,</span>
<span id="cb404-13"><a href="#cb404-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb404-14"><a href="#cb404-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb404-15"><a href="#cb404-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-weekly-and-monthly-no2-vs-so2-group-by-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>NO2-SO2 correlations differ across weekly and monthly data. Ellerslie South being the industrial site show higher pollutant levels. Outliers above 90th percentiles skew trend interpretations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb405"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb405-1"><a href="#cb405-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of weekly NO2 versus AQI by site, remove sites not having data</span></span>
<span id="cb405-2"><a href="#cb405-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sunnyhills East"</span>))</span>
<span id="cb405-3"><a href="#cb405-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-4"><a href="#cb405-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_NO2"</span>, <span class="st">"z_AQI"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span></span>
<span id="cb405-5"><a href="#cb405-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb405-6"><a href="#cb405-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly Relationship of NO2 versus AQI Anomalies"</span>,</span>
<span id="cb405-7"><a href="#cb405-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly NO2 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly AQI Anomaly"</span></span>
<span id="cb405-8"><a href="#cb405-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-weekly-no2-vs-aqi-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Quantile trends vary by site type, with transport sites showing higher NO2 anomalies. Outliers influence correlations, especially extreme AQI shifts, impacting pollutant relationships across locations. Seasonal dispersion affects anomaly consistency.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb406"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of monthly NO2 versus AQI by site, remove sites not having data</span></span>
<span id="cb406-2"><a href="#cb406-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sunnyhills East"</span>))</span>
<span id="cb406-3"><a href="#cb406-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-4"><a href="#cb406-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_NO2"</span>, <span class="st">"z_AQI"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span></span>
<span id="cb406-5"><a href="#cb406-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb406-6"><a href="#cb406-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Relationship of NO2 versus AQI Anomalies"</span>,</span>
<span id="cb406-7"><a href="#cb406-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly NO2 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly AQI Anomaly"</span></span>
<span id="cb406-8"><a href="#cb406-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-monthly-no2-vs-aqi-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Residential sites show tighter NO2 anomaly distributions, while industrial sites exhibit broader variability. Traffic sites have high NO2 extremes. Outliers skew AQI correlations, particularly at Ellerslie South and Queen Street.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb407"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb407-1"><a href="#cb407-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot weekly Anomalies of NO2 versus AirTemp by site, remove sites not having data</span></span>
<span id="cb407-2"><a href="#cb407-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb407-3"><a href="#cb407-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb407-4"><a href="#cb407-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_NO2"</span>, <span class="st">"z_AirTemp"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span></span>
<span id="cb407-5"><a href="#cb407-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb407-6"><a href="#cb407-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly Relationship of NO2 versus AirTemp Anomalies"</span>,</span>
<span id="cb407-7"><a href="#cb407-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly NO2 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly AirTemp Anomaly"</span></span>
<span id="cb407-8"><a href="#cb407-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-weekly-anomalies-of-no2-vs-airtemp-group-by-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Residential-traffic sites show wider NO2 anomalies, while traffic sites have extreme outliers. Residential sites exhibit narrower quantile ranges. Strong correlations emerge in Ellerslie South and Henderson Lincoln South, highlighting site-specific variability.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb408"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb408-1"><a href="#cb408-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot monthly anomalies of NO2 versus AirTemp by site, remove sites not having data</span></span>
<span id="cb408-2"><a href="#cb408-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb408-3"><a href="#cb408-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb408-4"><a href="#cb408-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_NO2"</span>, <span class="st">"z_AirTemp"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span></span>
<span id="cb408-5"><a href="#cb408-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb408-6"><a href="#cb408-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Relationship of NO2 versus AirTemp Anomalies"</span>,</span>
<span id="cb408-7"><a href="#cb408-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly NO2 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly AirTemp Anomaly"</span></span>
<span id="cb408-8"><a href="#cb408-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-monthly-anomalies-of-no2-vs-airtemp-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Traffic sites show higher upper quantiles, residential sites have lower variability. Outliers are more frequent in traffic sites, diverging from expected seasonal trends. Temperature influences dispersion.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb409"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb409-1"><a href="#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot weekly anomalies of NO2 versus WindSpeed by site, remove sites not having data</span></span>
<span id="cb409-2"><a href="#cb409-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb409-3"><a href="#cb409-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-4"><a href="#cb409-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_NO2"</span>, <span class="st">"z_WindSpeed"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span></span>
<span id="cb409-5"><a href="#cb409-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb409-6"><a href="#cb409-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly Relationship of NO2 versus WindSpeed Anomalies"</span>,</span>
<span id="cb409-7"><a href="#cb409-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly NO2 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly WindSpeed Anomaly"</span></span>
<span id="cb409-8"><a href="#cb409-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-weekly-anomalies-of-no2-vs-windspeed-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Residential, Industrial, NES sites have tighter quantiles with fewer outliers, while Residential, Traffic, NES sites show wider quantiles and more outliers, highlighting variability in NO2 and wind speed anomalies across locations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb410"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb410-1"><a href="#cb410-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot monthly anomalies of NO2 versus WindSpeed by site, remove sites not having data</span></span>
<span id="cb410-2"><a href="#cb410-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb410-3"><a href="#cb410-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb410-4"><a href="#cb410-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_NO2"</span>, <span class="st">"z_WindSpeed"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span></span>
<span id="cb410-5"><a href="#cb410-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb410-6"><a href="#cb410-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Relationship of NO2 versus WindSpeed Anomalies"</span>,</span>
<span id="cb410-7"><a href="#cb410-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly NO2 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly WindSpeed Anomaly"</span></span>
<span id="cb410-8"><a href="#cb410-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-monthly-anomalies-of-no2-vs-windspeed-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>NO2 anomalies vary across site types. Traffic sites show higher outliers and stronger correlations with windspeed. Industrial sites have broader quantile ranges. Residential sites show moderate trends with dispersed anomalies and weaker correlations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb411"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb411-1"><a href="#cb411-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot weekly anomalies of NO2 versus WindDir by site, remove sites not having data</span></span>
<span id="cb411-2"><a href="#cb411-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb411-3"><a href="#cb411-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb411-4"><a href="#cb411-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_NO2"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span></span>
<span id="cb411-5"><a href="#cb411-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb411-6"><a href="#cb411-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly Relationship of NO2 versus WindDir Anomalies"</span>,</span>
<span id="cb411-7"><a href="#cb411-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly NO2 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly WindDir Anomaly"</span></span>
<span id="cb411-8"><a href="#cb411-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-weekly-anomalies-of-no2-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>NO2-WindDir anomalies vary by site type. Traffic sites show wider NO2 quantiles, industrial zones display moderate variability, and residential sites exhibit narrow quantiles. Outliers influence correlation strength, affecting site-specific pollutant trends.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb412"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb412-1"><a href="#cb412-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot monthly anomalies of NO2 versus WindDir by site, remove sites not having data</span></span>
<span id="cb412-2"><a href="#cb412-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb412-3"><a href="#cb412-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb412-4"><a href="#cb412-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_NO2"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span></span>
<span id="cb412-5"><a href="#cb412-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb412-6"><a href="#cb412-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Relationship of NO2 versus WindDir Anomalies"</span>,</span>
<span id="cb412-7"><a href="#cb412-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly NO2 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly WindDir Anomaly"</span></span>
<span id="cb412-8"><a href="#cb412-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-monthly-anomalies-of-no2-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
Quantiles reveal NO2 variability across site types, highlighting differences in pollution levels. Outliers—like extreme wind-direction anomalies—suggest localized influences. Traffic sites show wider variability, while residential sites exhibit more stable distributions.
</details>
<details>
<summary>
Weekly and monthly relationship of PM2.5 versus Factors
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb413"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb413-1"><a href="#cb413-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot weekly PM2.5 versus PM10 by site, remove sites not having data</span></span>
<span id="cb413-2"><a href="#cb413-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>)))</span>
<span id="cb413-3"><a href="#cb413-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb413-4"><a href="#cb413-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"PM2.5"</span>, <span class="st">"PM10"</span>, <span class="st">"Weekly"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-weekly-pm2.5-vs-pm10-group-by-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Queen Street has the highest PM2.5-PM10 correlation, with narrow quantile ranges. Westlake shows weak correlation and wider spread. Residential sites exhibit broader PM10 dispersion; traffic sites have tighter distributions but more high outliers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb414"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb414-1"><a href="#cb414-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot monthly PM2.5 versus PM10 by site, remove sites not having data</span></span>
<span id="cb414-2"><a href="#cb414-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>)))</span>
<span id="cb414-3"><a href="#cb414-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb414-4"><a href="#cb414-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"PM2.5"</span>, <span class="st">"PM10"</span>, <span class="st">"Monthly"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-monthly-pm2.5-vs-pm10-group-by-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Queen Street shows the strongest PM2.5–PM10 correlation (R=0.87) with fewer outliers. Puni and Ellerslie South have moderate correlations with wider quantile ranges. Westlake exhibits weak correlation and high variability, suggesting localized influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb415"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb415-1"><a href="#cb415-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot weekly and monthly PM2.5 versus SO2 by site, remove sites not having data</span></span>
<span id="cb415-2"><a href="#cb415-2" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb415-3"><a href="#cb415-3" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb415-4"><a href="#cb415-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb415-5"><a href="#cb415-5" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">plot_pollutants_z</span>(data1, <span class="st">"PM2.5"</span>, <span class="st">"SO2"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Weekly Total"</span>, <span class="at">subtitle =</span> <span class="st">""</span>)</span>
<span id="cb415-6"><a href="#cb415-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb415-7"><a href="#cb415-7" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot_pollutants_z</span>(data2, <span class="st">"PM2.5"</span>, <span class="st">"SO2"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monthly Total"</span>, <span class="at">subtitle =</span> <span class="st">""</span>)</span>
<span id="cb415-8"><a href="#cb415-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb415-9"><a href="#cb415-9" aria-hidden="true" tabindex="-1"></a>plot1 <span class="sc">+</span> plot2 <span class="sc">+</span></span>
<span id="cb415-10"><a href="#cb415-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb415-11"><a href="#cb415-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly and Monthly PM2.5 versus SO2 Pollutant Relationship"</span>,</span>
<span id="cb415-12"><a href="#cb415-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Vertical ribbon = 10–90th percentile for PM2.5; Horizontal ribbon = 10–90th percentile for SO2; Smooth Trendline LOESS Added to show overall Relationship"</span>,</span>
<span id="cb415-13"><a href="#cb415-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb415-14"><a href="#cb415-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb415-15"><a href="#cb415-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-weekly-and-monthly-pm2.5-vs-so2-group-by-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Weekly plot show lower PM2.5 and SO2 variability than monthly plot, with fewer extreme outliers. Weekly plot exhibit tighter dispersion, aligning with stricter air quality standards. Monthly data reveals stronger correlations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb416"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb416-1"><a href="#cb416-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of weekly PM2.5 versus AQI by site, remove sites not having data</span></span>
<span id="cb416-2"><a href="#cb416-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb416-3"><a href="#cb416-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb416-4"><a href="#cb416-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_PM2.5"</span>, <span class="st">"z_AQI"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span></span>
<span id="cb416-5"><a href="#cb416-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb416-6"><a href="#cb416-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly Relationship of PM2.5 versus AQI Anomalies"</span>,</span>
<span id="cb416-7"><a href="#cb416-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly PM2.5 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly AQI Anomaly"</span></span>
<span id="cb416-8"><a href="#cb416-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-weekly-pm2.5-vs-aqi-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Quantiles highlight pollutant variability across site types, with traffic sites showing higher PM2.5 levels. Outliers reveal extreme AQI anomalies, suggesting localized emission sources or meteorological influences impacting pollutant dispersion.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb417"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb417-1"><a href="#cb417-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of monthly PM2.5 versus AQI by site, remove sites not having data</span></span>
<span id="cb417-2"><a href="#cb417-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb417-3"><a href="#cb417-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-4"><a href="#cb417-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_PM2.5"</span>, <span class="st">"z_AQI"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span></span>
<span id="cb417-5"><a href="#cb417-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb417-6"><a href="#cb417-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Relationship of PM2.5 versus AQI Anomalies"</span>,</span>
<span id="cb417-7"><a href="#cb417-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly PM2.5 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly AQI Anomaly"</span></span>
<span id="cb417-8"><a href="#cb417-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-monthly-pm2.5-vs-aqi-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Traffic sites (Queen Street) show higher pollutant variability, with extreme outliers beyond residential and industrial ranges. Residential sites display consistent trends, but industrial sites exhibit wider quantile dispersion. Correlation varies across site types.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb418"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb418-1"><a href="#cb418-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of weekly PM2.5 versus AirTemp by site, remove sites not having data</span></span>
<span id="cb418-2"><a href="#cb418-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>, <span class="st">"Puni"</span>))</span>
<span id="cb418-3"><a href="#cb418-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb418-4"><a href="#cb418-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_PM2.5"</span>, <span class="st">"z_AirTemp"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span></span>
<span id="cb418-5"><a href="#cb418-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb418-6"><a href="#cb418-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly Relationship of PM2.5 versus AirTemp Anomalies"</span>,</span>
<span id="cb418-7"><a href="#cb418-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly PM2.5 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly AirTemp Anomaly"</span></span>
<span id="cb418-8"><a href="#cb418-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-weekly-pm2.5-vs-airtemp-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Ellerslie South shows wider PM2.5 quantile ranges and more outliers than Queen Street and Westlake. Westlake has the highest anomalies, while traffic sites display greater variability due to localized emission influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb419"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb419-1"><a href="#cb419-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of monthly PM2.5 versus AirTemp by site, remove sites not having data</span></span>
<span id="cb419-2"><a href="#cb419-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>, <span class="st">"Puni"</span>))</span>
<span id="cb419-3"><a href="#cb419-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-4"><a href="#cb419-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_PM2.5"</span>, <span class="st">"z_AirTemp"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span></span>
<span id="cb419-5"><a href="#cb419-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb419-6"><a href="#cb419-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Relationship of PM2.5 versus AirTemp Anomalies"</span>,</span>
<span id="cb419-7"><a href="#cb419-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly PM2.5 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly AirTemp Anomaly"</span></span>
<span id="cb419-8"><a href="#cb419-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-monthly-pm2.5-vs-airtemp-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>At Ellerslie South, lower PM2.5 quantiles correlate with lower temperatures. Queen Street has mid-range PM2.5 variations, with traffic influence. Westlake shows outliers in high PM2.5 quantiles, driven by meteorology and site-specific emissions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb420"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb420-1"><a href="#cb420-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of weekly PM2.5 versus WindSpeed by site, remove sites not having data</span></span>
<span id="cb420-2"><a href="#cb420-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ellerslie South"</span>, <span class="st">"Westlake"</span>))</span>
<span id="cb420-3"><a href="#cb420-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-4"><a href="#cb420-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_PM2.5"</span>, <span class="st">"z_WindSpeed"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span></span>
<span id="cb420-5"><a href="#cb420-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb420-6"><a href="#cb420-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly Relationship of PM2.5 versus WindSpeed Anomalies"</span>,</span>
<span id="cb420-7"><a href="#cb420-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly PM2.5 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly WindSpeed Anomaly"</span></span>
<span id="cb420-8"><a href="#cb420-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-weekly-pm2.5-vs-windspeed-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Residential sites show narrower PM2.5 quantile ranges, while traffic sites exhibit higher outliers. Westlake has more extreme PM2.5 anomalies, aligning with stronger correlations to wind speed. Ellerslie South shows weaker pollutant variability.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb421"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb421-1"><a href="#cb421-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of monthly PM2.5 versus WindSpeed by site, remove sites not having data</span></span>
<span id="cb421-2"><a href="#cb421-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ellerslie South"</span>, <span class="st">"Westlake"</span>))</span>
<span id="cb421-3"><a href="#cb421-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-4"><a href="#cb421-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_PM2.5"</span>, <span class="st">"z_WindSpeed"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span></span>
<span id="cb421-5"><a href="#cb421-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb421-6"><a href="#cb421-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Relationship of PM2.5 versus WindSpeed Anomalies"</span>,</span>
<span id="cb421-7"><a href="#cb421-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly PM2.5 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly WindSpeed Anomaly"</span></span>
<span id="cb421-8"><a href="#cb421-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-monthly-pm2.5-vs-windspeed-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Traffic sites show greater PM2.5 variability, with more outliers beyond the 90th percentile, while residential and industrial sites have fewer extreme values. Quantile ribbons suggest stronger pollutant dispersion differences due to localized emissions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb422"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb422-1"><a href="#cb422-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of weekly PM2.5 versus WindDir by site, remove sites not having data</span></span>
<span id="cb422-2"><a href="#cb422-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ellerslie South"</span>, <span class="st">"Westlake"</span>))</span>
<span id="cb422-3"><a href="#cb422-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-4"><a href="#cb422-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_PM2.5"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span></span>
<span id="cb422-5"><a href="#cb422-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb422-6"><a href="#cb422-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly Relationship of PM2.5 versus WindDir Anomalies"</span>,</span>
<span id="cb422-7"><a href="#cb422-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly PM2.5 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly WindDir Anomaly"</span></span>
<span id="cb422-8"><a href="#cb422-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-weekly-pm2.5-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Ellerslie South has more outliers than Westlake. Residential, Industrial, NES sites show more outliers than Traffic, NES sites. Quantiles reveal PM2.5 anomalies mostly between -1 and 2. Site type influences dispersion patterns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb423"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb423-1"><a href="#cb423-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of monthly PM2.5 versus WindDir by site, remove sites not having data</span></span>
<span id="cb423-2"><a href="#cb423-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ellerslie South"</span>, <span class="st">"Westlake"</span>))</span>
<span id="cb423-3"><a href="#cb423-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-4"><a href="#cb423-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_PM2.5"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span></span>
<span id="cb423-5"><a href="#cb423-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb423-6"><a href="#cb423-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Relationship of PM2.5 versus WindDir Anomalies"</span>,</span>
<span id="cb423-7"><a href="#cb423-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly PM2.5 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly WindDir Anomaly"</span></span>
<span id="cb423-8"><a href="#cb423-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-monthly-pm2.5-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
Ellerslie South shows more outliers than Westlake. Residential, industrial NES sites have greater data density within the 10-90th percentile range, while traffic NES sites exhibit higher extremes, influencing overall pollutant variability.
</details>
<details>
<summary>
Weekly and monthly relationship of PM10 versus Factors
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb424"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb424-1"><a href="#cb424-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot weekly and monthly PM10 versus SO2 by site, remove sites not having data</span></span>
<span id="cb424-2"><a href="#cb424-2" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb424-3"><a href="#cb424-3" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb424-4"><a href="#cb424-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-5"><a href="#cb424-5" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">plot_pollutants_z</span>(data1, <span class="st">"PM10"</span>, <span class="st">"SO2"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Weekly Total"</span>, <span class="at">subtitle =</span> <span class="st">""</span>)</span>
<span id="cb424-6"><a href="#cb424-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb424-7"><a href="#cb424-7" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot_pollutants_z</span>(data2, <span class="st">"PM10"</span>, <span class="st">"SO2"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monthly Total"</span>, <span class="at">subtitle =</span> <span class="st">""</span>)</span>
<span id="cb424-8"><a href="#cb424-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-9"><a href="#cb424-9" aria-hidden="true" tabindex="-1"></a>plot1 <span class="sc">+</span> plot2 <span class="sc">+</span></span>
<span id="cb424-10"><a href="#cb424-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb424-11"><a href="#cb424-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly and Monthly PM10 versus SO2 Pollutant Relationship"</span>,</span>
<span id="cb424-12"><a href="#cb424-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Vertical ribbon = 10–90th percentile for PM10; Horizontal ribbon = 10–90th percentile for SO2; Smooth Trendline LOESS Added to show overall Relationship"</span>,</span>
<span id="cb424-13"><a href="#cb424-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb424-14"><a href="#cb424-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb424-15"><a href="#cb424-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-weekly-and-monthly-pm10-vs-so2-group-by-sites-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Weekly plot show tighter PM10-SO2 quantile spreads, while monthly plot display wider variability. Outliers skew relationships, particularly in monthly data. Stronger R suggests monthly plot influences pollutant trends across quantiles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb425"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb425-1"><a href="#cb425-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of weekly PM10 versus AQI by site, remove sites not having data</span></span>
<span id="cb425-2"><a href="#cb425-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb425-3"><a href="#cb425-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb425-4"><a href="#cb425-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_PM10"</span>, <span class="st">"z_AQI"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span></span>
<span id="cb425-5"><a href="#cb425-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb425-6"><a href="#cb425-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly Relationship of PM10 versus AQI Anomalies"</span>,</span>
<span id="cb425-7"><a href="#cb425-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly PM10 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly AQI Anomaly"</span></span>
<span id="cb425-8"><a href="#cb425-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-weekly-pm10-vs-aqi-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Ellerslie South and Puni show lower PM10 variability, Queen Street has high outliers, and Westlake exhibits moderate spread. Traffic sites show stronger PM10-AQI correlation, highlighting localized emissions. All sites display distinct percentile patterns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb426"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb426-1"><a href="#cb426-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of monthly PM10 versus AQI by site, remove sites not having data</span></span>
<span id="cb426-2"><a href="#cb426-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb426-3"><a href="#cb426-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-4"><a href="#cb426-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_PM10"</span>, <span class="st">"z_AQI"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span></span>
<span id="cb426-5"><a href="#cb426-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb426-6"><a href="#cb426-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Relationship of PM10 versus AQI Anomalies"</span>,</span>
<span id="cb426-7"><a href="#cb426-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly PM10 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly AQI Anomaly"</span></span>
<span id="cb426-8"><a href="#cb426-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-monthly-pm10-vs-aqi-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Industrial and Residential sites (Ellerslie South, Puni) show lower PM10 variability, while traffic sites (Queen Street, Westlake) have wider quantile ranges, indicating greater pollutant extremes and localized emission influence.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb427"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb427-1"><a href="#cb427-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of weekly PM10 versus AirTemp by site, remove sites not having data</span></span>
<span id="cb427-2"><a href="#cb427-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>))</span>
<span id="cb427-3"><a href="#cb427-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-4"><a href="#cb427-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_PM10"</span>, <span class="st">"z_AirTemp"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span></span>
<span id="cb427-5"><a href="#cb427-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb427-6"><a href="#cb427-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly Relationship of PM10 versus AirTemp Anomalies"</span>,</span>
<span id="cb427-7"><a href="#cb427-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly PM10 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly AirTemp Anomaly"</span></span>
<span id="cb427-8"><a href="#cb427-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-weekly-pm10-vs-airtemp-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Queen Street’s traffic site shows stronger correlations, with outliers above the 90th percentile. Residential sites exhibit weaker trends and fewer extreme values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb428"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb428-1"><a href="#cb428-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of monthly PM10 versus AirTemp by site, remove sites not having data</span></span>
<span id="cb428-2"><a href="#cb428-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>))</span>
<span id="cb428-3"><a href="#cb428-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-4"><a href="#cb428-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_PM10"</span>, <span class="st">"z_AirTemp"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span></span>
<span id="cb428-5"><a href="#cb428-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb428-6"><a href="#cb428-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Relationship of PM10 versus AirTemp Anomalies"</span>,</span>
<span id="cb428-7"><a href="#cb428-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly PM10 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly AirTemp Anomaly"</span></span>
<span id="cb428-8"><a href="#cb428-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-monthly-pm10-vs-airtemp-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>High-quantile PM10 levels differ across site types, with traffic sites showing elevated values. Outliers appear mostly in industrial areas, while residential sites have narrower distributions, reflecting localized meteorological and emission influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb429"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb429-1"><a href="#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of weekly PM10 versus WindSpeed by site, remove sites not having data</span></span>
<span id="cb429-2"><a href="#cb429-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb429-3"><a href="#cb429-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb429-4"><a href="#cb429-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_PM10"</span>, <span class="st">"z_WindSpeed"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span></span>
<span id="cb429-5"><a href="#cb429-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb429-6"><a href="#cb429-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly Relationship of PM10 versus WindSpeed Anomalies"</span>,</span>
<span id="cb429-7"><a href="#cb429-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly PM10 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly WindSpeed Anomaly"</span></span>
<span id="cb429-8"><a href="#cb429-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-weekly-pm10-vs-windspeed-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Higher quantiles show stronger pollutant anomalies in traffic and industrial sites. Residential sites exhibit lower variability. Outliers often skew correlations, particularly near transport corridors, impacting trend clarity across different site categories.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb430"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb430-1"><a href="#cb430-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of monthly PM10 versus WindSpeed by site, remove sites not having data</span></span>
<span id="cb430-2"><a href="#cb430-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb430-3"><a href="#cb430-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-4"><a href="#cb430-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_PM10"</span>, <span class="st">"z_WindSpeed"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span></span>
<span id="cb430-5"><a href="#cb430-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb430-6"><a href="#cb430-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Relationship of PM10 versus WindSpeed Anomalies"</span>,</span>
<span id="cb430-7"><a href="#cb430-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly PM10 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly WindSpeed Anomaly"</span></span>
<span id="cb430-8"><a href="#cb430-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-monthly-pm10-vs-windspeed-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>PM10 quantiles vary by site type: Traffic sites show higher upper quantiles, while Residential sites have wider spread. Outliers emerge near transport corridors, influenced by meteorology and localized emissions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb431"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb431-1"><a href="#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of weekly PM10 versus WindDir by site, remove sites not having data</span></span>
<span id="cb431-2"><a href="#cb431-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb431-3"><a href="#cb431-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-4"><a href="#cb431-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_PM10"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span></span>
<span id="cb431-5"><a href="#cb431-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb431-6"><a href="#cb431-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly Relationship of PM10 versus WindDir Anomalies"</span>,</span>
<span id="cb431-7"><a href="#cb431-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly PM10 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly WindDir Anomaly"</span></span>
<span id="cb431-8"><a href="#cb431-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-weekly-pm10-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Residential sites show lower PM10 variability, while traffic and industrial sites exhibit higher outlier frequency. Higher quantiles in traffic sites indicate stronger pollutant dispersion effects. Industrial sites show localized anomalies with seasonal shifts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb432"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb432-1"><a href="#cb432-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of monthly PM10 versus WindDir by site, remove sites not having data</span></span>
<span id="cb432-2"><a href="#cb432-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb432-3"><a href="#cb432-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-4"><a href="#cb432-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_PM10"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span></span>
<span id="cb432-5"><a href="#cb432-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb432-6"><a href="#cb432-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Relationship of PM10 versus WindDir Anomalies"</span>,</span>
<span id="cb432-7"><a href="#cb432-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly PM10 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly WindDir Anomaly"</span></span>
<span id="cb432-8"><a href="#cb432-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-monthly-pm10-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
Residential-traffic sites show wider PM10 variability across quantiles, while industrial sites exhibit stable trends. Outliers in windy months significantly impact correlations, skewing dispersion patterns and masking seasonal pollutant dynamics.
</details>
<details>
<summary>
Weekly and monthly relationship of SO2 versus Factors
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb433"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb433-1"><a href="#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot weekly and monthly anomalies of SO2 versus AQI by site, remove sites not having data</span></span>
<span id="cb433-2"><a href="#cb433-2" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb433-3"><a href="#cb433-3" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb433-4"><a href="#cb433-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb433-5"><a href="#cb433-5" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">plot_pollutants_z</span>(data1, <span class="st">"z_SO2"</span>, <span class="st">"z_AQI"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Weekly Total"</span>, <span class="at">subtitle =</span> <span class="st">""</span>,</span>
<span id="cb433-6"><a href="#cb433-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly SO2 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly AQI Anomaly"</span>)</span>
<span id="cb433-7"><a href="#cb433-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb433-8"><a href="#cb433-8" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot_pollutants_z</span>(data2, <span class="st">"z_SO2"</span>, <span class="st">"z_AQI"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monthly Total"</span>, <span class="at">subtitle =</span> <span class="st">""</span>,</span>
<span id="cb433-9"><a href="#cb433-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly SO2 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly AQI Anomaly"</span>)</span>
<span id="cb433-10"><a href="#cb433-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb433-11"><a href="#cb433-11" aria-hidden="true" tabindex="-1"></a>plot1 <span class="sc">+</span> plot2 <span class="sc">+</span></span>
<span id="cb433-12"><a href="#cb433-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb433-13"><a href="#cb433-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly and Monthly Pollutant Relationship of SO2 versus AQI Anomalies"</span>,</span>
<span id="cb433-14"><a href="#cb433-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Vertical ribbon = 10–90th percentile for SO2; Horizontal ribbon = 10–90th percentile for AQI; Smooth Trendline LOESS Added to show overall Relationship"</span>,</span>
<span id="cb433-15"><a href="#cb433-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb433-16"><a href="#cb433-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb433-17"><a href="#cb433-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-weekly-and-monthly-anomalies-of-so2-vs-aqi-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Ellerslie South being an industrial site show higher SO2 quantiles with greater AQI variability. The weekly data exhibit distinct outliers affecting air quality trends. The monthly data display stable quantiles, with fewer extreme deviations across weekly and monthly scales.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb434"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb434-1"><a href="#cb434-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot weekly and monthly anomalies of SO2 versus AirTemp by site, remove sites not having data</span></span>
<span id="cb434-2"><a href="#cb434-2" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb434-3"><a href="#cb434-3" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb434-4"><a href="#cb434-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb434-5"><a href="#cb434-5" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">plot_pollutants_z</span>(data1, <span class="st">"z_SO2"</span>, <span class="st">"z_AirTemp"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Weekly Total"</span>, <span class="at">subtitle =</span> <span class="st">""</span>,</span>
<span id="cb434-6"><a href="#cb434-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly SO2 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly AirTemp Anomaly"</span>)</span>
<span id="cb434-7"><a href="#cb434-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb434-8"><a href="#cb434-8" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot_pollutants_z</span>(data2, <span class="st">"z_SO2"</span>, <span class="st">"z_AirTemp"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monthly Total"</span>, <span class="at">subtitle =</span> <span class="st">""</span>,</span>
<span id="cb434-9"><a href="#cb434-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly SO2 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly AirTemp Anomaly"</span>)</span>
<span id="cb434-10"><a href="#cb434-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb434-11"><a href="#cb434-11" aria-hidden="true" tabindex="-1"></a>plot1 <span class="sc">+</span> plot2 <span class="sc">+</span></span>
<span id="cb434-12"><a href="#cb434-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb434-13"><a href="#cb434-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly and Monthly Pollutant Relationship of SO2 versus AirTemp Anomalies"</span>,</span>
<span id="cb434-14"><a href="#cb434-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Vertical ribbon = 10–90th percentile for SO2; Horizontal ribbon = 10–90th percentile for AirTemp; Smooth Trendline LOESS Added to show overall Relationship"</span>,</span>
<span id="cb434-15"><a href="#cb434-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb434-16"><a href="#cb434-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb434-17"><a href="#cb434-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-weekly-and-monthly-anomalies-of-so2-vs-airtemp-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Higher SO2 anomalies align with industrial sites, skewing upper quantiles and shows moderate dispersion. Weekly plot exhibit lower variability, mostly within 10-90th percentiles. Outliers drive correlation shifts, especially in monthly trends.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb435"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb435-1"><a href="#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot weekly and monthly anomalies of SO2 versus WindSpeed by site, remove sites not having data</span></span>
<span id="cb435-2"><a href="#cb435-2" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb435-3"><a href="#cb435-3" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb435-4"><a href="#cb435-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-5"><a href="#cb435-5" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">plot_pollutants_z</span>(data1, <span class="st">"z_SO2"</span>, <span class="st">"z_WindSpeed"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Weekly Total"</span>, <span class="at">subtitle =</span> <span class="st">""</span>,</span>
<span id="cb435-6"><a href="#cb435-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly SO2 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly WindSpeed Anomaly"</span>)</span>
<span id="cb435-7"><a href="#cb435-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb435-8"><a href="#cb435-8" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot_pollutants_z</span>(data2, <span class="st">"z_SO2"</span>, <span class="st">"z_WindSpeed"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monthly Total"</span>, <span class="at">subtitle =</span> <span class="st">""</span>,</span>
<span id="cb435-9"><a href="#cb435-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly SO2 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly WindSpeed Anomaly"</span>)</span>
<span id="cb435-10"><a href="#cb435-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-11"><a href="#cb435-11" aria-hidden="true" tabindex="-1"></a>plot1 <span class="sc">+</span> plot2 <span class="sc">+</span></span>
<span id="cb435-12"><a href="#cb435-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb435-13"><a href="#cb435-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly and Monthly Pollutant Relationship of SO2 versus WindSpeed Anomalies"</span>,</span>
<span id="cb435-14"><a href="#cb435-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Vertical ribbon = 10–90th percentile for z_SO2; Horizontal ribbon = 10–90th percentile for z_WindSpeed; Smooth Trendline LOESS Added to show overall Relationship"</span>,</span>
<span id="cb435-15"><a href="#cb435-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb435-16"><a href="#cb435-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb435-17"><a href="#cb435-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-weekly-and-monthly-anomalies-of-so2-vs-windspeed-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Weekly SO2 anomalies have a tighter spread in the 10–90th percentile, while monthly trends show a smoother relationship. Weekly windspeed anomalies exhibit extreme outliers, whereas monthly totals present more stable variations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb436"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb436-1"><a href="#cb436-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot weekly and monthly anomalies of SO2 versus WindDir by site, remove sites not having data</span></span>
<span id="cb436-2"><a href="#cb436-2" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb436-3"><a href="#cb436-3" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb436-4"><a href="#cb436-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-5"><a href="#cb436-5" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">plot_pollutants_z</span>(data1, <span class="st">"z_SO2"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Weekly Total"</span>, <span class="at">subtitle =</span> <span class="st">""</span>,</span>
<span id="cb436-6"><a href="#cb436-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly SO2 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly WindDir Anomaly"</span>)</span>
<span id="cb436-7"><a href="#cb436-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb436-8"><a href="#cb436-8" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot_pollutants_z</span>(data2, <span class="st">"z_SO2"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monthly Total"</span>, <span class="at">subtitle =</span> <span class="st">""</span>,</span>
<span id="cb436-9"><a href="#cb436-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly SO2 Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly WindDir Anomaly"</span>)</span>
<span id="cb436-10"><a href="#cb436-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-11"><a href="#cb436-11" aria-hidden="true" tabindex="-1"></a>plot1 <span class="sc">+</span> plot2 <span class="sc">+</span></span>
<span id="cb436-12"><a href="#cb436-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb436-13"><a href="#cb436-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly and Monthly Pollutant Relationship of SO2 versus WindDir Anomalies"</span>,</span>
<span id="cb436-14"><a href="#cb436-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Vertical ribbon = 10–90th percentile for z_SO2; Horizontal ribbon = 10–90th percentile for z_WindDir; Smooth Trendline LOESS Added to show overall Relationship"</span>,</span>
<span id="cb436-15"><a href="#cb436-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb436-16"><a href="#cb436-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb436-17"><a href="#cb436-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-weekly-and-monthly-anomalies-of-so2-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
Weekly data captures short-term fluctuations, with more dispersed SO2 outliers. Monthly data smooths trends but retains variability. Quantile ranges remain stable, with weak correlations (R = 0.057, 0.034). Outlier impacts persist across timescales.
</details>
<details>
<summary>
Weekly and monthly relationship of AQI versus Factors
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb437"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb437-1"><a href="#cb437-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of weekly AQI versus AirTemp by site, remove sites not having data</span></span>
<span id="cb437-2"><a href="#cb437-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>))</span>
<span id="cb437-3"><a href="#cb437-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-4"><a href="#cb437-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_AQI"</span>, <span class="st">"z_AirTemp"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span></span>
<span id="cb437-5"><a href="#cb437-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb437-6"><a href="#cb437-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly Relationship of AQI versus AirTemp Anomalies"</span>,</span>
<span id="cb437-7"><a href="#cb437-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly AQI Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly AirTemp Anomaly"</span></span>
<span id="cb437-8"><a href="#cb437-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-weekly-aqi-vs-airtemp-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Traffic sites show concentrated outliers, while residential sites have wider quantile spreads. Queen Street has fewer extreme deviations, while Glen Eden and Henderson Lincoln show notable anomalies, affecting AQI-AirTemp correlations differently across locations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb438"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb438-1"><a href="#cb438-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of monthly AQI versus AirTemp by site, remove sites not having data</span></span>
<span id="cb438-2"><a href="#cb438-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>))</span>
<span id="cb438-3"><a href="#cb438-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb438-4"><a href="#cb438-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_AQI"</span>, <span class="st">"z_AirTemp"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span></span>
<span id="cb438-5"><a href="#cb438-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb438-6"><a href="#cb438-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Relationship of AQI versus AirTemp Anomalies"</span>,</span>
<span id="cb438-7"><a href="#cb438-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly AQI Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly AirTemp Anomaly"</span></span>
<span id="cb438-8"><a href="#cb438-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-monthly-aqi-vs-airtemp-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Higher AQI anomalies occur within 10-90th percentile bounds across sites. Trends show weak correlations with air temperature. Traffic sites show greater variability. Outliers cluster near extreme temperatures, differing by site type and season.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb439"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb439-1"><a href="#cb439-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of weekly AQI versus WindSpeed by site, remove sites not having data</span></span>
<span id="cb439-2"><a href="#cb439-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb439-3"><a href="#cb439-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb439-4"><a href="#cb439-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_AQI"</span>, <span class="st">"z_WindSpeed"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span></span>
<span id="cb439-5"><a href="#cb439-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb439-6"><a href="#cb439-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly Relationship of AQI versus WindSpeed Anomalies"</span>,</span>
<span id="cb439-7"><a href="#cb439-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly AQI Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly WindSpeed Anomaly"</span></span>
<span id="cb439-8"><a href="#cb439-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-weekly-aqi-vs-windspeed-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Residential sites show wider quantile ranges, while industrial and traffic sites exhibit tighter distributions. Outliers appear in all sites. Henderson Lincoln South shows a weak upward trend; others display minimal correlation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb440"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb440-1"><a href="#cb440-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of monthly AQI versus WindSpeed by site, remove sites not having data</span></span>
<span id="cb440-2"><a href="#cb440-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb440-3"><a href="#cb440-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb440-4"><a href="#cb440-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_AQI"</span>, <span class="st">"z_WindSpeed"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span></span>
<span id="cb440-5"><a href="#cb440-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb440-6"><a href="#cb440-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Relationship of AQI versus WindSpeed Anomalies"</span>,</span>
<span id="cb440-7"><a href="#cb440-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly AQI Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly WindSpeed Anomaly"</span></span>
<span id="cb440-8"><a href="#cb440-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-monthly-aqi-vs-windspeed-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Sunnyhills East shows the strongest positive wind-speed correlation. Henderson Lincoln South has mild positive association. Outliers exist in all sites. Glen Eden Central lacks strong trends, showing variability across quantiles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb441"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb441-1"><a href="#cb441-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of weekly AQI versus WindDir by site, remove sites not having data</span></span>
<span id="cb441-2"><a href="#cb441-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb441-3"><a href="#cb441-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb441-4"><a href="#cb441-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_AQI"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span></span>
<span id="cb441-5"><a href="#cb441-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb441-6"><a href="#cb441-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly Relationship of AQI versus WindDir Anomalies"</span>,</span>
<span id="cb441-7"><a href="#cb441-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly AQI Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly WindDir Anomaly"</span></span>
<span id="cb441-8"><a href="#cb441-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-weekly-aqi-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Ellerslie South, Glen Eden Central, and Henderson Lincoln South show high AQI anomalies. Sunnyhills East has low AQI outliers. Westlake (Traffic) also shows high anomalies. Correlations range from R = 0.17 to 0.62.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb442"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb442-1"><a href="#cb442-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of monthly AQI versus WindDir by site, remove sites not having data</span></span>
<span id="cb442-2"><a href="#cb442-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb442-3"><a href="#cb442-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-4"><a href="#cb442-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_AQI"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span></span>
<span id="cb442-5"><a href="#cb442-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb442-6"><a href="#cb442-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Relationship of AQI versus WindDir Anomalies"</span>,</span>
<span id="cb442-7"><a href="#cb442-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly AQI Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly WindDir Anomaly"</span></span>
<span id="cb442-8"><a href="#cb442-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-monthly-aqi-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
Higher pollutant quantiles align with traffic sites, showing distinct outliers. Residential locations exhibit lower variability. Industrial sites reveal moderate dispersions. Outliers skew NES-site trends, impacting correlation significance across wind-direction anomalies.
</details>
<details>
<summary>
Weekly and monthly relationship of air temperature (AirTemp) versus Factors
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb443"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb443-1"><a href="#cb443-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of weekly AirTemp versus WindSpeed by site, remove sites not having data</span></span>
<span id="cb443-2"><a href="#cb443-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb443-3"><a href="#cb443-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb443-4"><a href="#cb443-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_AirTemp"</span>, <span class="st">"z_WindSpeed"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span></span>
<span id="cb443-5"><a href="#cb443-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb443-6"><a href="#cb443-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly Relationship of AirTemp versus WindSpeed Anomalies"</span>,</span>
<span id="cb443-7"><a href="#cb443-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly AirTemp Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly WindSpeed Anomaly"</span></span>
<span id="cb443-8"><a href="#cb443-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-weekly-airtemp-vs-windspeed-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Quantile trends vary by site type: Industrial sites show wider dispersion, while traffic sites exhibit high peaks. Outliers cluster in residential sites, revealing localized emission effects on pollutant variability.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb444"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb444-1"><a href="#cb444-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of monthly AirTemp versus WindSpeed by site, remove sites not having data</span></span>
<span id="cb444-2"><a href="#cb444-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb444-3"><a href="#cb444-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb444-4"><a href="#cb444-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_AirTemp"</span>, <span class="st">"z_WindSpeed"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span></span>
<span id="cb444-5"><a href="#cb444-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb444-6"><a href="#cb444-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Relationship of AirTemp versus WindSpeed Anomalies"</span>,</span>
<span id="cb444-7"><a href="#cb444-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly AirTemp Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly WindSpeed Anomaly"</span></span>
<span id="cb444-8"><a href="#cb444-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-monthly-airtemp-vs-windspeed-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Traffic sites show greater variability across quantiles, with extreme outliers at low wind speeds. Residential sites exhibit consistent trends. Westlake has fewer anomalies, while Sunnyhills East has weaker correlations and wider percentile spreads.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb445"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb445-1"><a href="#cb445-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of weekly AirTemp versus WindDir by site, remove sites not having data</span></span>
<span id="cb445-2"><a href="#cb445-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb445-3"><a href="#cb445-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb445-4"><a href="#cb445-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_AirTemp"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span></span>
<span id="cb445-5"><a href="#cb445-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb445-6"><a href="#cb445-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly Relationship of AirTemp versus WindDir Anomalies"</span>,</span>
<span id="cb445-7"><a href="#cb445-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly AirTemp Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly WindDir Anomaly"</span></span>
<span id="cb445-8"><a href="#cb445-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-weekly-airtemp-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Quantiles reveal pollutant distributions; site types shape local variability. Outliers highlight anomalies—traffic sites show extreme peaks, while residential areas exhibit smoother trends. Comparing quantiles improves understanding of spatial and temporal pollutant dynamics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb446"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb446-1"><a href="#cb446-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of monthly AirTemp versus WindDir by site, remove sites not having data</span></span>
<span id="cb446-2"><a href="#cb446-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb446-3"><a href="#cb446-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-4"><a href="#cb446-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_AirTemp"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span></span>
<span id="cb446-5"><a href="#cb446-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb446-6"><a href="#cb446-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Relationship of AirTemp versus WindDir Anomalies"</span>,</span>
<span id="cb446-7"><a href="#cb446-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly AirTemp Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly WindDir Anomaly"</span></span>
<span id="cb446-8"><a href="#cb446-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-monthly-airtemp-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
Residential sites show smaller quantile spreads, while traffic sites display greater variability. Industrial locations exhibit distinct outliers. Quantiles highlight seasonal dispersion, with NES sites showing relatively stable patterns compared to traffic-related pollution spikes.
</details>
<details>
<summary>
Weekly and monthly relationship of wind speed (WindSpeed) versus wind direction (WindDir)
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb447"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb447-1"><a href="#cb447-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of weekly WindSpeed versus WindDir by site, remove sites not having data</span></span>
<span id="cb447-2"><a href="#cb447-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(weekly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb447-3"><a href="#cb447-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb447-4"><a href="#cb447-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_WindSpeed"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"Weekly"</span>) <span class="sc">+</span></span>
<span id="cb447-5"><a href="#cb447-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb447-6"><a href="#cb447-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Weekly Relationship of WindSpeed versus WindDir Anomalies"</span>,</span>
<span id="cb447-7"><a href="#cb447-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Weekly WindSpeed Anomaly"</span>, <span class="at">y =</span> <span class="st">"Weekly WindDir Anomaly"</span></span>
<span id="cb447-8"><a href="#cb447-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-weekly-windspeed-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Residential sites (purple, blue, green) have tighter quantile ribbons and outliers. Traffic sites (yellow) show wider ribbons with more variability. Outliers are more frequent in all sites, indicating localized meteorological influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb448"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb448-1"><a href="#cb448-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of monthly WindSpeed versus WindDir by site, remove sites not having data</span></span>
<span id="cb448-2"><a href="#cb448-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(monthly_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb448-3"><a href="#cb448-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-4"><a href="#cb448-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants_z</span>(data, <span class="st">"z_WindSpeed"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"Monthly"</span>) <span class="sc">+</span></span>
<span id="cb448-5"><a href="#cb448-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb448-6"><a href="#cb448-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Relationship of WindSpeed versus WindDir Anomalies"</span>,</span>
<span id="cb448-7"><a href="#cb448-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Monthly WindSpeed Anomaly"</span>, <span class="at">y =</span> <span class="st">"Monthly WindDir Anomaly"</span></span>
<span id="cb448-8"><a href="#cb448-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-monthly-windspeed-vs-winddir-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
Higher wind anomalies at residential-traffic sites show wider quantile spreads. Industrial zones exhibit tighter distributions but contain extreme outliers. Residential sites display moderate variation. Outliers dominate Ellerslie South and Westlake trends.
</details>
</section>
<section id="visualizing-seasonal-anomalies-and-trends-in-pollutants-aqi-and-meteorological-variables" class="level3" data-number="5.6">
<h3 data-number="5.6" class="anchored" data-anchor-id="visualizing-seasonal-anomalies-and-trends-in-pollutants-aqi-and-meteorological-variables"><span class="header-section-number">5.6</span> Visualizing Seasonal Anomalies and Trends in Pollutants, AQI, and Meteorological Variables</h3>
<p>This section analyzes seasonal patterns and anomalies in key air quality and meteorological variables across Auckland monitoring sites from 2016 to 2024. Pollutants (NO2, NO, PM10, PM2.5, SO2), meteorological factors (wind speed, wind direction, air temperature), and AQI are aggregated by season and year. Z-score normalization is used to detect anomalies, and categorized tiles and time-series plots reveal spatial and temporal patterns, including changes around the COVID-19 period.</p>
<details>
<summary>
Seasonal Air Quality Anomaly Detection and Heatmap Visualization
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb449"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb449-1"><a href="#cb449-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract year (last two digits) and numeric month from the date</span></span>
<span id="cb449-2"><a href="#cb449-2" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb449-3"><a href="#cb449-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">format</span>(date, <span class="st">"%y"</span>),</span>
<span id="cb449-4"><a href="#cb449-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">month =</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(date, <span class="st">"%m"</span>)))</span>
<span id="cb449-5"><a href="#cb449-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb449-6"><a href="#cb449-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign seasons based on month and create season-year identifier (e.g., "Wi22")</span></span>
<span id="cb449-7"><a href="#cb449-7" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb449-8"><a href="#cb449-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">season =</span> <span class="fu">case_when</span>(</span>
<span id="cb449-9"><a href="#cb449-9" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">~</span> <span class="st">"Su"</span>,</span>
<span id="cb449-10"><a href="#cb449-10" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">~</span> <span class="st">"Au"</span>,</span>
<span id="cb449-11"><a href="#cb449-11" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>) <span class="sc">~</span> <span class="st">"Wi"</span>,</span>
<span id="cb449-12"><a href="#cb449-12" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>) <span class="sc">~</span> <span class="st">"Sp"</span>),</span>
<span id="cb449-13"><a href="#cb449-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">season_year =</span> <span class="fu">paste0</span>(season, year))</span>
<span id="cb449-14"><a href="#cb449-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb449-15"><a href="#cb449-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Preserve chronological order of seasons for plotting</span></span>
<span id="cb449-16"><a href="#cb449-16" aria-hidden="true" tabindex="-1"></a>season_order <span class="ot">&lt;-</span> <span class="fu">unique</span>(daily_airdata<span class="sc">$</span>season_year)</span>
<span id="cb449-17"><a href="#cb449-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb449-18"><a href="#cb449-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert year and season_year to ordered factors</span></span>
<span id="cb449-19"><a href="#cb449-19" aria-hidden="true" tabindex="-1"></a>season_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb449-20"><a href="#cb449-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb449-21"><a href="#cb449-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">factor</span>(year),</span>
<span id="cb449-22"><a href="#cb449-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">season_year =</span> <span class="fu">factor</span>(season_year, <span class="at">levels =</span> season_order, <span class="at">ordered =</span> <span class="cn">TRUE</span>))</span>
<span id="cb449-23"><a href="#cb449-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb449-24"><a href="#cb449-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape data from wide to long format for selected variables</span></span>
<span id="cb449-25"><a href="#cb449-25" aria-hidden="true" tabindex="-1"></a>season_airdata_long <span class="ot">&lt;-</span> season_airdata <span class="sc">|&gt;</span></span>
<span id="cb449-26"><a href="#cb449-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb449-27"><a href="#cb449-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"NO2"</span>, <span class="st">"NO"</span>, <span class="st">"PM10"</span>, <span class="st">"PM2.5"</span>, <span class="st">"SO2"</span>, <span class="st">"AQI"</span>, <span class="st">"WindSpeed"</span>, <span class="st">"WindDir"</span>, <span class="st">"AirTemp"</span>),</span>
<span id="cb449-28"><a href="#cb449-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"variable"</span>,</span>
<span id="cb449-29"><a href="#cb449-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb449-30"><a href="#cb449-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb449-31"><a href="#cb449-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb449-32"><a href="#cb449-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate total concentration/values by season, site, and variable</span></span>
<span id="cb449-33"><a href="#cb449-33" aria-hidden="true" tabindex="-1"></a>season_airdata_long <span class="ot">&lt;-</span> season_airdata_long <span class="sc">|&gt;</span></span>
<span id="cb449-34"><a href="#cb449-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season_year, season, year, sa2_name, site_type, variable) <span class="sc">|&gt;</span></span>
<span id="cb449-35"><a href="#cb449-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">value =</span> <span class="fu">sum</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb449-36"><a href="#cb449-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb449-37"><a href="#cb449-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate z-scores (standardized values) for each variable across years per site</span></span>
<span id="cb449-38"><a href="#cb449-38" aria-hidden="true" tabindex="-1"></a>season_airdata_long <span class="ot">&lt;-</span> season_airdata_long <span class="sc">|&gt;</span></span>
<span id="cb449-39"><a href="#cb449-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name, site_type, variable) <span class="sc">|&gt;</span></span>
<span id="cb449-40"><a href="#cb449-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb449-41"><a href="#cb449-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">z_value =</span> (value <span class="sc">-</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>()</span>
<span id="cb449-42"><a href="#cb449-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb449-43"><a href="#cb449-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorize z-scores into descriptive levels</span></span>
<span id="cb449-44"><a href="#cb449-44" aria-hidden="true" tabindex="-1"></a>season_airdata_long <span class="ot">&lt;-</span> season_airdata_long <span class="sc">|&gt;</span></span>
<span id="cb449-45"><a href="#cb449-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cat_z_value =</span> <span class="fu">case_when</span>(</span>
<span id="cb449-46"><a href="#cb449-46" aria-hidden="true" tabindex="-1"></a>    z_value <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">~</span> <span class="st">"Low"</span>,</span>
<span id="cb449-47"><a href="#cb449-47" aria-hidden="true" tabindex="-1"></a>    z_value <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">&amp;</span> z_value <span class="sc">&lt;=</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Normal"</span>,</span>
<span id="cb449-48"><a href="#cb449-48" aria-hidden="true" tabindex="-1"></a>    z_value <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"High"</span>))</span>
<span id="cb449-49"><a href="#cb449-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb449-50"><a href="#cb449-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape data back to wide format with original values and z-scores</span></span>
<span id="cb449-51"><a href="#cb449-51" aria-hidden="true" tabindex="-1"></a>season_airdata_total <span class="ot">&lt;-</span> season_airdata_long <span class="sc">|&gt;</span></span>
<span id="cb449-52"><a href="#cb449-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb449-53"><a href="#cb449-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> variable,</span>
<span id="cb449-54"><a href="#cb449-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(value, z_value, cat_z_value)</span>
<span id="cb449-55"><a href="#cb449-55" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb449-56"><a href="#cb449-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb449-57"><a href="#cb449-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns: remove 'value_' prefix, replace 'z_value_' with 'z_', replace 'cat_z_value_' with 'cat_z_'</span></span>
<span id="cb449-58"><a href="#cb449-58" aria-hidden="true" tabindex="-1"></a>season_airdata_total <span class="ot">&lt;-</span> season_airdata_total <span class="sc">|&gt;</span></span>
<span id="cb449-59"><a href="#cb449-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">"^value_"</span>, <span class="st">""</span>, .x), <span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="st">"value_"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb449-60"><a href="#cb449-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">"^z_value_"</span>, <span class="st">"z_"</span>, .x), <span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="st">"z_value_"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb449-61"><a href="#cb449-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">"^cat_z_value_"</span>, <span class="st">"cat_z_"</span>, .x), <span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="st">"cat_z_value_"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb449-62"><a href="#cb449-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"cat_z_"</span>), as.factor))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb450"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb450-1"><a href="#cb450-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a tile map of seasonal air quality anomalies (z-score categories) by site and factor</span></span>
<span id="cb450-2"><a href="#cb450-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(season_airdata_long, <span class="fu">aes</span>(<span class="at">x =</span> season, <span class="at">y =</span> variable, <span class="at">fill =</span> cat_z_value)) <span class="sc">+</span></span>
<span id="cb450-3"><a href="#cb450-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb450-4"><a href="#cb450-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(</span>
<span id="cb450-5"><a href="#cb450-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">option =</span> <span class="st">"mako"</span>, <span class="at">name =</span> <span class="st">"Anomaly Level"</span>,</span>
<span id="cb450-6"><a href="#cb450-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">"grey80"</span>, <span class="co"># color for NA tiles</span></span>
<span id="cb450-7"><a href="#cb450-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.translate =</span> <span class="cn">TRUE</span>, <span class="co"># include NA in legend</span></span>
<span id="cb450-8"><a href="#cb450-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">ifelse</span>(<span class="fu">is.na</span>(x), <span class="st">"Missing"</span>, x)</span>
<span id="cb450-9"><a href="#cb450-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb450-10"><a href="#cb450-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> sa2_name) <span class="sc">+</span></span>
<span id="cb450-11"><a href="#cb450-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb450-12"><a href="#cb450-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Categorized Anomalies in Seasonal Air Quality"</span>,</span>
<span id="cb450-13"><a href="#cb450-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Factor Values classified by z-score deviations at multiple Auckland monitoring sites"</span>,</span>
<span id="cb450-14"><a href="#cb450-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Season"</span>, <span class="at">y =</span> <span class="st">"Factor"</span>, <span class="at">fill =</span> <span class="st">"Anomaly Level"</span>) <span class="sc">+</span></span>
<span id="cb450-15"><a href="#cb450-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb450-16"><a href="#cb450-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb450-17"><a href="#cb450-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb450-18"><a href="#cb450-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb450-19"><a href="#cb450-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb450-20"><a href="#cb450-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb450-21"><a href="#cb450-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb450-22"><a href="#cb450-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb450-23"><a href="#cb450-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb450-24"><a href="#cb450-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb450-25"><a href="#cb450-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb450-26"><a href="#cb450-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-seasonal-anomaly-tile-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
Seasonal air quality anomalies vary across Auckland sites. Henderson Lincoln South and Westlake shows NO2 and NO are high in winter while Puni in Autumn. PM2.5 is high in spring. Wind speed influences dispersion, affecting regional trends. Missing data skews some patterns.
</details>
<details>
<summary>
Visualizing Seasonal Trends and COVID-19 Impacts Across Monitoring Sites
</summary>
<p>This analysis explores seasonal trends in air quality and meteorological variables across Auckland from 2016–2024. It includes trend plots showing site-wise pollutant concentrations and post-COVID changes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb451"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb451-1"><a href="#cb451-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot seasonal total pollutant concentration across NZ monitoring sites (2016–2023)</span></span>
<span id="cb451-2"><a href="#cb451-2" aria-hidden="true" tabindex="-1"></a>plot_season <span class="ot">&lt;-</span> <span class="cf">function</span>(data, xvar, yvar, color_var) {</span>
<span id="cb451-3"><a href="#cb451-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> .data[[xvar]], <span class="at">y =</span> .data[[yvar]])) <span class="sc">+</span></span>
<span id="cb451-4"><a href="#cb451-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> .data[[color_var]]), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb451-5"><a href="#cb451-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> .data[[color_var]], <span class="at">color =</span> .data[[color_var]]), <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb451-6"><a href="#cb451-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">which</span>(<span class="fu">levels</span>(data<span class="sc">$</span>season_year) <span class="sc">==</span> <span class="st">"Au20"</span>), <span class="at">lty =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">lwd =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb451-7"><a href="#cb451-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> sa2_name, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb451-8"><a href="#cb451-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis_d</span>(<span class="at">name =</span> <span class="st">"Site Type"</span>, <span class="at">option =</span> <span class="st">"D"</span>, <span class="at">begin =</span> <span class="fl">0.1</span>, <span class="at">end =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb451-9"><a href="#cb451-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb451-10"><a href="#cb451-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb451-11"><a href="#cb451-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Seasonal Trends in "</span>, yvar, <span class="st">" Across Auckland Monitoring Sites (2016-2024)"</span>),</span>
<span id="cb451-12"><a href="#cb451-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Comparison of Pre- and Post-COVID-19 Periods with Site-Type Differentiation"</span>,</span>
<span id="cb451-13"><a href="#cb451-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Season Year"</span>, <span class="at">y =</span> <span class="fu">paste</span>(yvar, <span class="st">"(µg/m³)"</span>)</span>
<span id="cb451-14"><a href="#cb451-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb451-15"><a href="#cb451-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb451-16"><a href="#cb451-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb451-17"><a href="#cb451-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb451-18"><a href="#cb451-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb451-19"><a href="#cb451-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb451-20"><a href="#cb451-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb451-21"><a href="#cb451-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb451-22"><a href="#cb451-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb451-23"><a href="#cb451-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb451-24"><a href="#cb451-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb451-25"><a href="#cb451-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb452"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb452-1"><a href="#cb452-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot season_year versus NO, remove sites not having data</span></span>
<span id="cb452-2"><a href="#cb452-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, sa2_name <span class="sc">!=</span> <span class="st">"Sunnyhills East"</span>)</span>
<span id="cb452-3"><a href="#cb452-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-4"><a href="#cb452-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_season</span>(data, <span class="st">"season_year"</span>, <span class="st">"NO"</span>, <span class="st">"site_type"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-season-vs-no-group-by-site-and-covid-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Queen Street and Westlake show the highest NO levels with clear seasonal peaks, especially pre-2020. Puni exhibits the lowest concentrations. Most sites show a post-2020 decline, likely reflecting reduced traffic impacts on air pollution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb453"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb453-1"><a href="#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot season_year versus NO2, remove sites not having data</span></span>
<span id="cb453-2"><a href="#cb453-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, sa2_name <span class="sc">!=</span> <span class="st">"Sunnyhills East"</span>)</span>
<span id="cb453-3"><a href="#cb453-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-4"><a href="#cb453-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_season</span>(data, <span class="st">"season_year"</span>, <span class="st">"NO2"</span>, <span class="st">"site_type"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-season-vs-no2-group-by-site-and-covid-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>NO2 levels declined post-COVID across most sites, notably at Queen Street and Westlake (traffic-heavy areas), indicating reduced emissions. Residential and mixed-use sites showed more stable or fluctuating trends, suggesting varying local influences on NO2 concentrations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb454"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb454-1"><a href="#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot season_year versus PM2.5 by site, remove sites not having data</span></span>
<span id="cb454-2"><a href="#cb454-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>)))</span>
<span id="cb454-3"><a href="#cb454-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb454-4"><a href="#cb454-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_season</span>(data, <span class="st">"season_year"</span>, <span class="st">"PM2.5"</span>, <span class="st">"site_type"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-season-vs-pm25-group-by-site-and-covid-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Ellerslie South and Puni show decreasing PM2.5 trends post-2020, likely due to reduced traffic. Queen Street and Westlake exhibit fluctuating trends, suggesting localized meteorological or emission variations. Seasonal peaks persist, indicating consistent wintertime pollution influences across Auckland sites.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb455"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb455-1"><a href="#cb455-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot season_year versus PM10 by site and pre- and post- covid</span></span>
<span id="cb455-2"><a href="#cb455-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> season_airdata_total</span>
<span id="cb455-3"><a href="#cb455-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-4"><a href="#cb455-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_season</span>(data, <span class="st">"season_year"</span>, <span class="st">"PM10"</span>, <span class="st">"site_type"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-season-vs-pm10-group-by-site-and-covid-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>PM10 levels show seasonal trends across sites, with urban areas generally lower than industrial ones. Post-COVID-19, some sites exhibit reduced PM10, particularly near transport corridors. Variability is highest in industrial zones, reflecting localized emission sources.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb456"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb456-1"><a href="#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot season_year versus SO2 by site, remove sites not having data</span></span>
<span id="cb456-2"><a href="#cb456-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb456-3"><a href="#cb456-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_season</span>(data, <span class="st">"season_year"</span>, <span class="st">"SO2"</span>, <span class="st">"site_type"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-season-vs-so2-group-by-site-and-covid-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Seasonal SO2 levels in Ellerslie South from 2016-2024, showing fluctuations and a notable decrease post-COVID-19 (marked by a dashed line).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb457"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb457-1"><a href="#cb457-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot season_year versus WindSpeed by site, remove sites not having data</span></span>
<span id="cb457-2"><a href="#cb457-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>)))</span>
<span id="cb457-3"><a href="#cb457-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-4"><a href="#cb457-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_season</span>(data, <span class="st">"season_year"</span>, <span class="st">"WindSpeed"</span>, <span class="st">"site_type"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-season-vs-windspeed-group-by-site-and-covid-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Wind speeds vary across sites, with Sunnyhills East showing the lowest and Ellerslie South the highest. Pre-COVID trends were relatively stable, while post-COVID fluctuations increased. Seasonal differences highlight localized meteorological influences affecting dispersion and pollutant transport.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb458"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb458-1"><a href="#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot season_year versus WindDir by site, remove sites not having data</span></span>
<span id="cb458-2"><a href="#cb458-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>)))</span>
<span id="cb458-3"><a href="#cb458-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb458-4"><a href="#cb458-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_season</span>(data, <span class="st">"season_year"</span>, <span class="st">"WindDir"</span>, <span class="st">"site_type"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-season-vs-winddir-group-by-site-and-covid-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>WindDir trends vary across sites. Henderson Lincoln South shows steadier values, while Sunnyhills East exhibits more fluctuations. Post-COVID shifts are subtle but present, with Glen Eden Central showing the most consistent seasonal trend. WindDir levels differ by site type and location.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb459"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb459-1"><a href="#cb459-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot season_year versus AirTemp by site, remove sites not having data</span></span>
<span id="cb459-2"><a href="#cb459-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, sa2_name <span class="sc">!=</span> <span class="st">"Puni"</span>)</span>
<span id="cb459-3"><a href="#cb459-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-4"><a href="#cb459-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_season</span>(data, <span class="st">"season_year"</span>, <span class="st">"AirTemp"</span>, <span class="st">"site_type"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-season-vs-AirTemp-group-by-site-and-covid-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Traffic sites show higher summer temperatures, likely due to urban heat effects. Residential areas have steadier seasonal trends. Post-COVID-19 shifts appear minor, with overall warming patterns persisting. Meteorological influences dominate over emission changes in shaping long-term variability.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb460"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb460-1"><a href="#cb460-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot season_year versus AQI by site, remove sites not having data</span></span>
<span id="cb460-2"><a href="#cb460-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> season_airdata_total</span>
<span id="cb460-3"><a href="#cb460-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-4"><a href="#cb460-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_season</span>(data, <span class="st">"season_year"</span>, <span class="st">"AQI"</span>, <span class="st">"site_type"</span>) <span class="sc">+</span> </span>
<span id="cb460-5"><a href="#cb460-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>scientific)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-season-vs-AQI-group-by-site-and-covid-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
AQI trends vary across Auckland sites, with traffic sites showing consistently higher levels. Post-COVID-19, residential and NES sites exhibit stabilization, while industrial sites show fluctuations. Seasonal peaks align with Autumn and winter months, indicating meteorological influence on pollutant dispersion patterns.
</details>
<details>
<summary>
Refining Pollutant Anomalies Across Seasons and Quantiles
</summary>
<p>Quantile rectangles reveal PM2.5 and y-variable distributions, highlighting seasonal shifts. Z-anomalies standardize comparisons across differing units, exposing nuanced pollutant interactions. Seasonal categories refine dispersion insights, revealing variability in correlation strength. These techniques enhance pollutant trend interpretation across diverse environmental conditions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb461"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb461-1"><a href="#cb461-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot seasonal total pollutant concentration across NZ monitoring sites (2016–2023)</span></span>
<span id="cb461-2"><a href="#cb461-2" aria-hidden="true" tabindex="-1"></a>plot_pollutants <span class="ot">&lt;-</span> <span class="cf">function</span>(data, xvar, yvar, color_var) {</span>
<span id="cb461-3"><a href="#cb461-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute 10-90% quantiles by site (facet variable)</span></span>
<span id="cb461-4"><a href="#cb461-4" aria-hidden="true" tabindex="-1"></a>  quantile_bands <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb461-5"><a href="#cb461-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb461-6"><a href="#cb461-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb461-7"><a href="#cb461-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">q10_x =</span> <span class="fu">quantile</span>(.data[[xvar]], <span class="fl">0.10</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb461-8"><a href="#cb461-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">q90_x =</span> <span class="fu">quantile</span>(.data[[xvar]], <span class="fl">0.90</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb461-9"><a href="#cb461-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">q10_y =</span> <span class="fu">quantile</span>(.data[[yvar]], <span class="fl">0.10</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb461-10"><a href="#cb461-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">q90_y =</span> <span class="fu">quantile</span>(.data[[yvar]], <span class="fl">0.90</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb461-11"><a href="#cb461-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb461-12"><a href="#cb461-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb461-13"><a href="#cb461-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-14"><a href="#cb461-14" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> .data[[xvar]], <span class="at">y =</span> .data[[yvar]])) <span class="sc">+</span></span>
<span id="cb461-15"><a href="#cb461-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Vertical bands for x-variable quantiles</span></span>
<span id="cb461-16"><a href="#cb461-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data =</span> quantile_bands, </span>
<span id="cb461-17"><a href="#cb461-17" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">xmin =</span> q10_x, <span class="at">xmax =</span> q90_x, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>), <span class="at">fill =</span> <span class="st">"#FEE08B"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb461-18"><a href="#cb461-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Horizontal bands for y-variable quantiles</span></span>
<span id="cb461-19"><a href="#cb461-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data =</span> quantile_bands,</span>
<span id="cb461-20"><a href="#cb461-20" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">xmax =</span> <span class="cn">Inf</span>, <span class="at">ymin =</span> q10_y, <span class="at">ymax =</span> q90_y), <span class="at">fill =</span> <span class="st">"#88CCAA"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb461-21"><a href="#cb461-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> .data[[color_var]]), <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb461-22"><a href="#cb461-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"#4D4D4D"</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb461-23"><a href="#cb461-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_cor</span>(<span class="at">method =</span> <span class="st">"pearson"</span>, <span class="at">label.x.npc =</span> <span class="st">"left"</span>, <span class="at">label.y.npc =</span> <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb461-24"><a href="#cb461-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> sa2_name, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb461-25"><a href="#cb461-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"D"</span>) <span class="sc">+</span></span>
<span id="cb461-26"><a href="#cb461-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb461-27"><a href="#cb461-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb461-28"><a href="#cb461-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Seasonal Co-variation of "</span>, xvar, <span class="st">" and "</span>, yvar, <span class="st">" Across Monitoring Sites in New Zealand (2016–2024)"</span>), </span>
<span id="cb461-29"><a href="#cb461-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Loess trendlines and 10–90 percentile bands reveal spatial and seasonal variability in air pollutant relationships"</span>,</span>
<span id="cb461-30"><a href="#cb461-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">paste</span>(xvar, <span class="st">"(µg/m³)"</span>), <span class="at">y =</span> <span class="fu">paste</span>(yvar, <span class="st">"(µg/m³)"</span>),</span>
<span id="cb461-31"><a href="#cb461-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"Season"</span>) <span class="sc">+</span></span>
<span id="cb461-32"><a href="#cb461-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb461-33"><a href="#cb461-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb461-34"><a href="#cb461-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb461-35"><a href="#cb461-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb461-36"><a href="#cb461-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb461-37"><a href="#cb461-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb461-38"><a href="#cb461-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb461-39"><a href="#cb461-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb461-40"><a href="#cb461-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb461-41"><a href="#cb461-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb461-42"><a href="#cb461-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb461-43"><a href="#cb461-43" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb462"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb462-1"><a href="#cb462-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot PM2.5 versus NO by site, remove sites not having data</span></span>
<span id="cb462-2"><a href="#cb462-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>)))</span>
<span id="cb462-3"><a href="#cb462-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb462-4"><a href="#cb462-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"PM2.5"</span>, <span class="st">"NO"</span>, <span class="st">"season"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-pm2.5-vs-no-group-by-season-categories-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Percentile rectangles and outliers demonstrate varying PM2.5-NO distributions across sites. Winter often shows higher concentrations and stronger correlations, likely due to heating, while summer may be lower. A general positive trend exists, but its strength and seasonal/spatial patterns differ due to unique factors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb463"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb463-1"><a href="#cb463-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot PM2.5 versus NO2 by site, remove sites not having data</span></span>
<span id="cb463-2"><a href="#cb463-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>)))</span>
<span id="cb463-3"><a href="#cb463-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb463-4"><a href="#cb463-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"PM2.5"</span>, <span class="st">"NO2"</span>, <span class="st">"season"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-pm2.5-vs-no2-group-by-z-anomaly-categories-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Ellerslie South shows strong PM2.5-NO2 co-variation (R = 0.63). Puni, Queen Street, and Westlake show weaker non-significant correlations. Outliers occur across all seasons, with winter and summer displaying higher variability. Trends are generally stable, with percentile bands capturing seasonal dispersion.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb464"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb464-1"><a href="#cb464-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot PM2.5 versus PM10 by site, remove sites not having data</span></span>
<span id="cb464-2"><a href="#cb464-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>)))</span>
<span id="cb464-3"><a href="#cb464-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb464-4"><a href="#cb464-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"PM2.5"</span>, <span class="st">"PM10"</span>, <span class="st">"season"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-pm2.5-vs-pm10-group-by-season-categories-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Queen Street shows the strongest significant PM2.5-PM10 correlation (R = 0.91). Ellerslie South, Puni and Westlake has moderate and weak non-significant relationships. Outliers appear in winter. Percentiles widen in summer. Trendlines indicate increased dispersion in urban sites.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb465"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb465-1"><a href="#cb465-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot PM2.5 versus SO2 by site, remove sites not having data</span></span>
<span id="cb465-2"><a href="#cb465-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb465-3"><a href="#cb465-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb465-4"><a href="#cb465-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"PM2.5"</span>, <span class="st">"SO2"</span>, <span class="st">"season"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-pm2.5-vs-so2-group-by-season-categories-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>PM2.5 and SO2 show moderate seasonal non-significant correlation (R = 0.34), with stronger co-variation in winter due to combustion sources. Loess trends highlight localized emission influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb466"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb466-1"><a href="#cb466-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot PM2.5 versus AQI by site, remove sites not having data</span></span>
<span id="cb466-2"><a href="#cb466-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>)))</span>
<span id="cb466-3"><a href="#cb466-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb466-4"><a href="#cb466-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"PM2.5"</span>, <span class="st">"AQI"</span>, <span class="st">"season"</span>) <span class="sc">+</span> </span>
<span id="cb466-5"><a href="#cb466-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Air Quality Index"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-pm2.5-vs-AQI-group-by-season-categories-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>The scales are differently measured, let’s plot z-anomalies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb467"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb467-1"><a href="#cb467-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomalies of PM2.5 versus z-anomalies of AQI by site, remove sites not having data</span></span>
<span id="cb467-2"><a href="#cb467-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>)))</span>
<span id="cb467-3"><a href="#cb467-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb467-4"><a href="#cb467-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_PM2.5"</span>, <span class="st">"z_AQI"</span>, <span class="st">"season"</span>) <span class="sc">+</span> </span>
<span id="cb467-5"><a href="#cb467-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb467-6"><a href="#cb467-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of PM2.5 and AQI Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb467-7"><a href="#cb467-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PM2.5 Anomalies"</span>, <span class="at">y =</span> <span class="st">"Air Quality Index Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-pm2.5-vs-AQI-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>PM2.5 strongly influences AQI, with higher concentrations correlating to worsening air quality. Seasonal fluctuations impact PM2.5 levels, driving AQI variability. Outliers reveal extreme pollution events. Trends indicate varied pollutant dynamics across sites.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb468"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb468-1"><a href="#cb468-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomaly of PM2.5 versus z-anomaly of AirTemp by site, remove sites not having data</span></span>
<span id="cb468-2"><a href="#cb468-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>, <span class="st">"Puni"</span>)))</span>
<span id="cb468-3"><a href="#cb468-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb468-4"><a href="#cb468-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_PM2.5"</span>, <span class="st">"z_AirTemp"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb468-5"><a href="#cb468-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb468-6"><a href="#cb468-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of PM2.5 and AirTemp Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb468-7"><a href="#cb468-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PM2.5 Anomalies"</span>, <span class="at">y =</span> <span class="st">"Air Temperature Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-pm2.5-vs-AirTemp-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Queen Street, Ellerslie South, and Westlake shows no significant correlation, suggesting local meteorological or emission influences disrupt expected temperature-pollution dynamics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb469"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb469-1"><a href="#cb469-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomaly of PM2.5 versus z-anomaly of WindSpeed by site, remove sites not having data</span></span>
<span id="cb469-2"><a href="#cb469-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ellerslie South"</span>, <span class="st">"Westlake"</span>))</span>
<span id="cb469-3"><a href="#cb469-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb469-4"><a href="#cb469-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_PM2.5"</span>, <span class="st">"z_WindSpeed"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb469-5"><a href="#cb469-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb469-6"><a href="#cb469-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of PM2.5 and WindSpeed Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb469-7"><a href="#cb469-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PM2.5 Anomalies"</span>, <span class="at">y =</span> <span class="st">"Wind Speed Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-pm2.5-vs-WindSpeed-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Ellerslie South shows a mild downward PM2.5 trend, with winter peaks and occasional outliers in spring. Westlake has a more stable trend, with winter spikes and a few high outliers. Seasonal variations are more pronounced at Ellerslie South, especially in colder months.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb470"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb470-1"><a href="#cb470-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomaly of PM2.5 versus z-anomaly of WindDir by site, remove sites not having data</span></span>
<span id="cb470-2"><a href="#cb470-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ellerslie South"</span>, <span class="st">"Westlake"</span>))</span>
<span id="cb470-3"><a href="#cb470-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-4"><a href="#cb470-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_PM2.5"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb470-5"><a href="#cb470-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb470-6"><a href="#cb470-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of PM2.5 and WindDir Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb470-7"><a href="#cb470-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PM2.5 Anomalies"</span>, <span class="at">y =</span> <span class="st">"Wind Direction Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-pm2.5-vs-WindDir-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Ellerslie South has more extreme wind anomalies. Both sites show a positive PM2.5 non-significant correlation. Winter data is widely scattered, while summer points scatter in middle 80% of data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb471"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb471-1"><a href="#cb471-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot PM10 versus NO by site, remove sites not having data</span></span>
<span id="cb471-2"><a href="#cb471-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sunnyhills East"</span>))</span>
<span id="cb471-3"><a href="#cb471-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb471-4"><a href="#cb471-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"PM10"</span>, <span class="st">"NO"</span>, <span class="st">"season"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-pm10-vs-NO-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Quantiles highlight seasonal PM10 and NO variability, with winter peaks across sites. Westlake shows moderate significant positive correlation and the rest shows no relation. Outliers are present in all seasons, notably high NO levels at Ellerslie South and Westlake, and elevated PM10 at Queen Street, indicating localized emissions or meteorological influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb472"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb472-1"><a href="#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot PM10 versus NO2 by site, remove sites not having data</span></span>
<span id="cb472-2"><a href="#cb472-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sunnyhills East"</span>))</span>
<span id="cb472-3"><a href="#cb472-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-4"><a href="#cb472-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"PM10"</span>, <span class="st">"NO2"</span>, <span class="st">"season"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-pm10-vs-NO2-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Westlake shows significant positive correlation while the rest shows no relation. Queen Street shows the highest NO2 levels. Outliers deviates from expected seasonal trends, suggesting local meteorological or emission influences disrupting pollutant relationships. Variability across sites highlights dispersion and emission dynamics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb473"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb473-1"><a href="#cb473-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot PM10 versus PM2.5 by site, remove sites not having data</span></span>
<span id="cb473-2"><a href="#cb473-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sunnyhills East"</span>, <span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>))</span>
<span id="cb473-3"><a href="#cb473-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-4"><a href="#cb473-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"PM10"</span>, <span class="st">"PM2.5"</span>, <span class="st">"season"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-pm10-vs-pm2.5-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Queen Street shows the strongest significant PM10-PM2.5 correlation (R = 0.91), with minimal outliers. Ellerslie South has wider quantile spread. Puni and Westlake shows scattered outliers, indicating site-specific influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb474"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb474-1"><a href="#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot PM10 versus SO2 by site, remove sites not having data</span></span>
<span id="cb474-2"><a href="#cb474-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb474-3"><a href="#cb474-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb474-4"><a href="#cb474-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"PM10"</span>, <span class="st">"SO2"</span>, <span class="st">"season"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-pm10-vs-so2-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>The plot highlights pollutant dispersion, seasonal variability, and extreme deviations. Outliers suggest localized influences, while quantile bands indicate distribution consistency.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb475"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb475-1"><a href="#cb475-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot PM10 versus AQI by site, remove sites not having data</span></span>
<span id="cb475-2"><a href="#cb475-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> season_airdata_total</span>
<span id="cb475-3"><a href="#cb475-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb475-4"><a href="#cb475-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"PM10"</span>, <span class="st">"AQI"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb475-5"><a href="#cb475-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Air Quality Index"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-pm10-vs-aqi-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Quantiles differ across sites, with Queen Street showing higher AQI values. Outliers are prominent in winter, indicating seasonal variability. Moderate correlations (R = 0.39–0.61, p &lt; 0.05) suggest site-specific pollutant interactions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb476"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb476-1"><a href="#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomaly of PM10 versus z-anomaly of AQI by site, remove sites not having data</span></span>
<span id="cb476-2"><a href="#cb476-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> season_airdata_total</span>
<span id="cb476-3"><a href="#cb476-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb476-4"><a href="#cb476-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_PM10"</span>, <span class="st">"z_AQI"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb476-5"><a href="#cb476-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb476-6"><a href="#cb476-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of PM10 and AQI Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb476-7"><a href="#cb476-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PM10 Anomalies"</span>, <span class="at">y =</span> <span class="st">"Air Quality Index Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-pm10-vs-AQI-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>10-90 percentile bands show seasonal co-variation. Outliers, points beyond these bands, highlight extreme pollutant events. Glen Eden Central exhibits more outliers, suggesting localized influences, while Queen Street’s tighter spread shows stronger pollutant correlation and fewer anomalies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb477"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb477-1"><a href="#cb477-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomaly of PM10 versus z-anomaly of AirTemp by site, remove sites not having data</span></span>
<span id="cb477-2"><a href="#cb477-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, sa2_name <span class="sc">!=</span> <span class="st">"Puni"</span>)</span>
<span id="cb477-3"><a href="#cb477-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-4"><a href="#cb477-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_PM10"</span>, <span class="st">"z_AirTemp"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb477-5"><a href="#cb477-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb477-6"><a href="#cb477-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of PM10 and AirTemp Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb477-7"><a href="#cb477-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PM10 Anomalies"</span>, <span class="at">y =</span> <span class="st">"Air Temperature Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-pm10-vs-AirTemp-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Quantiles, shown as shaded 10-90 percentile bands, highlight central pollutant trends across seasons. Outliers fall outside these bands, revealing extreme anomalies. All sites show no relationship at 0.001 significance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb478"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb478-1"><a href="#cb478-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomaly of PM10 versus z-anomaly of WindSpeed by site, remove sites not having data</span></span>
<span id="cb478-2"><a href="#cb478-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb478-3"><a href="#cb478-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-4"><a href="#cb478-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_PM10"</span>, <span class="st">"z_WindSpeed"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb478-5"><a href="#cb478-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb478-6"><a href="#cb478-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of PM10 and WindSpeed Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb478-7"><a href="#cb478-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PM10 Anomalies"</span>, <span class="at">y =</span> <span class="st">"Wind Speed Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-pm10-vs-WindSpeed-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Quantiles highlight seasonal PM10-wind speed trends; 10-90 percentile bands show typical variability. Outliers exist beyond these bands, indicating unusual pollutant dynamics or meteorological influences. Weak non-significant correlations across sites suggest site-specific factors drive fluctuations rather than broad co-variation trends.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb479"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb479-1"><a href="#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomaly of PM10 versus z-anomaly of WindDir by site, remove sites not having data</span></span>
<span id="cb479-2"><a href="#cb479-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb479-3"><a href="#cb479-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-4"><a href="#cb479-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_PM10"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb479-5"><a href="#cb479-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb479-6"><a href="#cb479-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of PM10 and WindDir Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb479-7"><a href="#cb479-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PM10 Anomalies"</span>, <span class="at">y =</span> <span class="st">"Wind Direction Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-pm10-vs-WindDir-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>The plot’s 10-90 percentile bands highlight seasonal PM10 and wind direction patterns. Outliers exceed these bands, showing extreme variations. PM10 dispersion increases with wind shifts, driven by site-specific factors. Most data clusters within the middle 80%, with non-significant correlations indicating no clear relationship.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb480"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb480-1"><a href="#cb480-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot NO versus NO2 by site, remove sites not having data</span></span>
<span id="cb480-2"><a href="#cb480-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, sa2_name <span class="sc">!=</span> <span class="st">"Sunnyhills East"</span>)</span>
<span id="cb480-3"><a href="#cb480-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4"><a href="#cb480-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"NO"</span>, <span class="st">"NO2"</span>, <span class="st">"season"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-no-vs-no2-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Queen Street shows the strongest NO-NO2 correlation (R = 0.93). Summer typically has lower NO2 across sites. Outliers mostly appear in winter, summer, and spring. Puni exhibits weaker correlations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb481"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb481-1"><a href="#cb481-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot NO versus SO2 by site, remove sites not having data</span></span>
<span id="cb481-2"><a href="#cb481-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb481-3"><a href="#cb481-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb481-4"><a href="#cb481-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"NO"</span>, <span class="st">"SO2"</span>, <span class="st">"season"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-no-vs-so2-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Outliers are mostly in spring and winter and quantiles show higher SO2, lower in spring and summer. NO trends follow.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb482"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb482-1"><a href="#cb482-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot NO versus AQI by site, remove sites not having data</span></span>
<span id="cb482-2"><a href="#cb482-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, sa2_name <span class="sc">!=</span> <span class="st">"Sunnyhills East"</span>)</span>
<span id="cb482-3"><a href="#cb482-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb482-4"><a href="#cb482-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"NO"</span>, <span class="st">"AQI"</span>, <span class="st">"season"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-no-vs-AQI-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>All sites show summer-Autumn-Winter outliers; Puni sees Autumn extremes. Loess trends indicate variable NO-AQI relationships, with 10-90 percentile bands capturing seasonal dispersion patterns across sites. Correlation strength varies with only Queen Street showing significance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb483"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb483-1"><a href="#cb483-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomaly of NO versus z-anomaly of AQI by site, remove sites not having data</span></span>
<span id="cb483-2"><a href="#cb483-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, sa2_name <span class="sc">!=</span> <span class="st">"Sunnyhills East"</span>)</span>
<span id="cb483-3"><a href="#cb483-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-4"><a href="#cb483-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_NO"</span>, <span class="st">"z_AQI"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb483-5"><a href="#cb483-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb483-6"><a href="#cb483-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of NO and AQI Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb483-7"><a href="#cb483-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"NO Anomalies"</span>, <span class="at">y =</span> <span class="st">"Air Quality Index Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-no-vs-aqi-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>High NO anomalies in Puni and displays inverse trends. Outliers cluster in high AQI events, mostly during colder months.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb484"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb484-1"><a href="#cb484-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomaly of NO versus z-anomaly of AirTemp by site, remove sites not having data</span></span>
<span id="cb484-2"><a href="#cb484-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb484-3"><a href="#cb484-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb484-4"><a href="#cb484-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_NO"</span>, <span class="st">"z_AirTemp"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb484-5"><a href="#cb484-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb484-6"><a href="#cb484-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of NO and AirTemp Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb484-7"><a href="#cb484-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"NO Anomalies"</span>, <span class="at">y =</span> <span class="st">"Air Temperature Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-no-vs-airtemp-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>The 10–90% quantile bands align well with seasonal clustering—Winter (Wi) and Autumn (Au) dominate lower NO anomalies, while Summer (Su) outliers extend beyond the upper quantile, indicating potential emission spikes or meteorological influences during warmer periods.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb485"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb485-1"><a href="#cb485-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomaly of NO versus z-anomaly of WindSpeed by site, remove sites not having data</span></span>
<span id="cb485-2"><a href="#cb485-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb485-3"><a href="#cb485-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb485-4"><a href="#cb485-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_NO"</span>, <span class="st">"z_WindSpeed"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb485-5"><a href="#cb485-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb485-6"><a href="#cb485-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of NO and WindSpeed Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb485-7"><a href="#cb485-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"NO Anomalies"</span>, <span class="at">y =</span> <span class="st">"Wind Speed Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-no-vs-windspeed-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>In all sites, most seasonal anomalies cluster within the 10–90% quantile bands, highlighting typical variability. Winter and spring often shows outliers with higher NO anomalies, especially in Ellerslie South, Westlake, and Glen Eden Central. Summer outliers exhibit lower NO, in all sites.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb486"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb486-1"><a href="#cb486-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomaly of NO versus z-anomaly of WindDir by site, remove sites not having data</span></span>
<span id="cb486-2"><a href="#cb486-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb486-3"><a href="#cb486-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb486-4"><a href="#cb486-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_NO"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb486-5"><a href="#cb486-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb486-6"><a href="#cb486-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of NO and WindDir Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb486-7"><a href="#cb486-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"NO Anomalies"</span>, <span class="at">y =</span> <span class="st">"Wind Direction Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-no-vs-winddir-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Winter and spring show broader NO anomaly distributions with more outliers, in all sites. Winter dominate higher quantiles in Westlake, suggesting seasonal shifts in pollutant-wind relationships.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb487"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb487-1"><a href="#cb487-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot NO2 versus AQI by site, remove sites not having data</span></span>
<span id="cb487-2"><a href="#cb487-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, sa2_name <span class="sc">!=</span> <span class="st">"Sunnyhills East"</span>)</span>
<span id="cb487-3"><a href="#cb487-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb487-4"><a href="#cb487-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"NO2"</span>, <span class="st">"AQI"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb487-5"><a href="#cb487-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Air Quality Index (AQI)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-no2-vs-AQI-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Quantiles reveal seasonal NO2-AQI variability across sites. Outliers are frequent, with autumn and winter showing extreme AQI spikes. Summer and spring exhibit more stability within quantile bands. Trends suggest localized meteorological effects influencing seasonal dispersion and pollutant concentration anomalies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb488"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb488-1"><a href="#cb488-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomaly of NO2 versus z-anomaly of AQI by site, remove sites not having data</span></span>
<span id="cb488-2"><a href="#cb488-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, sa2_name <span class="sc">!=</span> <span class="st">"Sunnyhills East"</span>)</span>
<span id="cb488-3"><a href="#cb488-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-4"><a href="#cb488-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_NO2"</span>, <span class="st">"z_AQI"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb488-5"><a href="#cb488-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb488-6"><a href="#cb488-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of NO2 and AQI Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb488-7"><a href="#cb488-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"NO2 Anomalies"</span>, <span class="at">y =</span> <span class="st">"Air Quality Index Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-no2-vs-aqi-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>NO2 anomalies show higher significant correlations in urban sites like Queen Street. Winter exhibits stronger deviations, with 10-90 percentiles revealing pollutant dispersion. Outliers cluster in transitional seasons, suggesting meteorological shifts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb489"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb489-1"><a href="#cb489-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomaly of NO2 versus z-anomaly of AirTemp by site, remove sites not having data</span></span>
<span id="cb489-2"><a href="#cb489-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb489-3"><a href="#cb489-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-4"><a href="#cb489-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_NO2"</span>, <span class="st">"z_AirTemp"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb489-5"><a href="#cb489-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb489-6"><a href="#cb489-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of NO2 and AirTemp Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb489-7"><a href="#cb489-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"NO2 Anomalies"</span>, <span class="at">y =</span> <span class="st">"Air Temperature Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-no2-vs-AirTemp-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>NO2 anomalies vary by season, with tighter quantile spreads in summer and broader in winter. Outliers are more frequent in colder months, reflecting stagnant conditions. Percentile bands highlight site-specific dispersion, with Ellerslie South being the only one showing significant correlation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb490"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb490-1"><a href="#cb490-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomaly of NO2 versus z-anomaly of WindSpeed by site, remove sites not having data</span></span>
<span id="cb490-2"><a href="#cb490-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb490-3"><a href="#cb490-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-4"><a href="#cb490-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_NO2"</span>, <span class="st">"z_WindSpeed"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb490-5"><a href="#cb490-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb490-6"><a href="#cb490-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of NO2 and WindSpeed Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb490-7"><a href="#cb490-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"NO2 Anomalies"</span>, <span class="at">y =</span> <span class="st">"Wind Speed Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-no2-vs-windspeed-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>NO2 anomalies fluctuate seasonally, with wind speed modifying dispersion. Winter shows higher pollution persistence, while summer disperses more efficiently. Outliers highlight localized emissions. Quantile bands indicate pollutant variability—narrower ranges show stability, wider ones reflect extreme events or seasonal influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb491"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb491-1"><a href="#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomaly of NO2 versus z-anomaly of WindDir by site, remove sites not having data</span></span>
<span id="cb491-2"><a href="#cb491-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Sunnyhills East"</span>))</span>
<span id="cb491-3"><a href="#cb491-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-4"><a href="#cb491-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_NO2"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb491-5"><a href="#cb491-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb491-6"><a href="#cb491-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of NO2 and WindDir Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb491-7"><a href="#cb491-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"NO2 Anomalies"</span>, <span class="at">y =</span> <span class="st">"Wind Direction Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-no2-vs-winddir-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>NO2 anomalies show seasonal trends, with spring and winter extremes. Quantiles highlight dispersion: upper bands reveal peak pollution periods, while outliers signal localized events. Westlake’s strong correlation suggests wind-driven influence, unlike the rest with weak association. Seasonal cycles shape pollutant variability.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb492"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb492-1"><a href="#cb492-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomaly of SO2 versus z-anomaly of AQI by site, remove sites not having data</span></span>
<span id="cb492-2"><a href="#cb492-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb492-3"><a href="#cb492-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb492-4"><a href="#cb492-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_SO2"</span>, <span class="st">"z_AQI"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb492-5"><a href="#cb492-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb492-6"><a href="#cb492-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of SO2 and AQI Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb492-7"><a href="#cb492-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"SO2 Anomalies"</span>, <span class="at">y =</span> <span class="st">"Air Quality Index Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-so2-vs-aqi-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Winter outliers skew SO2-AQI correlation. Summer shows stable trends. Median SO2 anomaly aligns with AQI variability. 10-90 quantiles reveal seasonal dispersion.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb493"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb493-1"><a href="#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomaly of SO2 versus z-anomaly of AirTemp by site, remove sites not having data</span></span>
<span id="cb493-2"><a href="#cb493-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb493-3"><a href="#cb493-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb493-4"><a href="#cb493-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_SO2"</span>, <span class="st">"z_AirTemp"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb493-5"><a href="#cb493-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb493-6"><a href="#cb493-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of SO2 and AirTemp Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb493-7"><a href="#cb493-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"SO2 Anomalies"</span>, <span class="at">y =</span> <span class="st">"Air Temperature Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-so2-vs-airtemp-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Quantiles reveal seasonal pollutant variability; Summer and Spring shows lower SO2 dispersion. Outliers persist across seasons, highlighting irregular pollutant-temperature relationships.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb494"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb494-1"><a href="#cb494-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomaly of SO2 versus z-anomaly of WindSpeed by site, remove sites not having data</span></span>
<span id="cb494-2"><a href="#cb494-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb494-3"><a href="#cb494-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb494-4"><a href="#cb494-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_SO2"</span>, <span class="st">"z_WindSpeed"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb494-5"><a href="#cb494-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb494-6"><a href="#cb494-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of SO2 and WindSpeed Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb494-7"><a href="#cb494-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"SO2 Anomalies"</span>, <span class="at">y =</span> <span class="st">"Wind Speed Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-so2-vs-windspeed-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Autumn is more consistent while Spring, winter, and summer quantiles exhibit more outliers, indicating seasonal variability and dispersion differences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb495"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb495-1"><a href="#cb495-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomaly of SO2 versus z-anomaly of WindDir by site, remove sites not having data</span></span>
<span id="cb495-2"><a href="#cb495-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>)</span>
<span id="cb495-3"><a href="#cb495-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb495-4"><a href="#cb495-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_SO2"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb495-5"><a href="#cb495-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb495-6"><a href="#cb495-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of SO2 and WindDir Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb495-7"><a href="#cb495-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"SO2 Anomalies"</span>, <span class="at">y =</span> <span class="st">"Wind Direction Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-so2-vs-winddir-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Spring and summer show more outliers, while autumn and winter are more consistent. Quantiles highlight seasonal variability in SO2 and WindDir anomalies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb496"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb496-1"><a href="#cb496-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomaly of AirTemp versus z-anomaly of WindSpeed by site, remove sites not having data</span></span>
<span id="cb496-2"><a href="#cb496-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb496-3"><a href="#cb496-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb496-4"><a href="#cb496-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_AirTemp"</span>, <span class="st">"z_WindSpeed"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb496-5"><a href="#cb496-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb496-6"><a href="#cb496-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of AirTemp and WindSpeed Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb496-7"><a href="#cb496-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"AirTemp Anomalies"</span>, <span class="at">y =</span> <span class="st">"Wind Speed Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-airtemp-vs-windspeed-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>In all sites, 10–90 percentile bands show seasonal variability, with higher dispersion in winter. Outliers cluster in summer, linked to peak wind events. Ellerslie South and Glen Eden Central show strong seasonal co-variation, while Westlake exhibits consistent percentile spread across seasons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb497"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb497-1"><a href="#cb497-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomaly of AirTemp versus z-anomaly of WindDir by site, remove sites not having data</span></span>
<span id="cb497-2"><a href="#cb497-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb497-3"><a href="#cb497-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb497-4"><a href="#cb497-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_AirTemp"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb497-5"><a href="#cb497-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb497-6"><a href="#cb497-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of AirTemp and WindDir Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb497-7"><a href="#cb497-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"AirTemp Anomalies"</span>, <span class="at">y =</span> <span class="st">"Wind Direction Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-airtemp-vs-winddir-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Quantiles highlight pollutant distribution shifts across seasons—winter shows broader variability, summer has tighter ranges. Outliers reveal extreme deviations from seasonal trends, often linked to meteorological or localized emissions. Percentile bands capture season-specific dispersion, enhancing interpretation of pollutant anomalies and site-specific influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb498"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb498-1"><a href="#cb498-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot z-anomaly of WindSpeed versus z-anomaly of WindDir by site, remove sites not having data</span></span>
<span id="cb498-2"><a href="#cb498-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(season_airdata_total, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb498-3"><a href="#cb498-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb498-4"><a href="#cb498-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pollutants</span>(data, <span class="st">"z_WindSpeed"</span>, <span class="st">"z_WindDir"</span>, <span class="st">"season"</span>) <span class="sc">+</span></span>
<span id="cb498-5"><a href="#cb498-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb498-6"><a href="#cb498-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Co-variation of Anomalies of WindSpeed and WindDir Across Monitoring Sites in New Zealand (2016–2024)"</span>, </span>
<span id="cb498-7"><a href="#cb498-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Wind Speed Anomalies"</span>, <span class="at">y =</span> <span class="st">"Wind Direction Anomalies"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-z-anomalies-of-windspeed-vs-winddir-group-by-season-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>Quantiles shift across seasons, with wider dispersion in summer and tighter clustering in winter. Outliers appear in all sites, indicating localized influences. Seasonal variations affect pollutant trends, emphasizing meteorological and site-specific emissions.</p>
</details></section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>