<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vishal Goundar">
<meta name="dcterms.date" content="2025-05-22">

<title>Traffic Density and Air Quality: Comparing Urban and Rural Auckland</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="air-quality_files/libs/clipboard/clipboard.min.js"></script>
<script src="air-quality_files/libs/quarto-html/quarto.js"></script>
<script src="air-quality_files/libs/quarto-html/popper.min.js"></script>
<script src="air-quality_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="air-quality_files/libs/quarto-html/anchor.min.js"></script>
<link href="air-quality_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="air-quality_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="air-quality_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="air-quality_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="air-quality_files/libs/bootstrap/bootstrap-32162a2fca7cb0439643f2faaab1edf3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="air-quality_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="air-quality_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="air-quality_files/libs/plotly-binding-4.10.4/plotly.js"></script>

<script src="air-quality_files/libs/typedarray-0.1/typedarray.min.js"></script>

<script src="air-quality_files/libs/jquery-3.5.1/jquery.min.js"></script>

<link href="air-quality_files/libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="air-quality_files/libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<link href="air-quality_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">

<script src="air-quality_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>



<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract"><span class="header-section-number">1</span> Abstract</a></li>
  <li><a href="#data-from-lawa-on-air-quality" id="toc-data-from-lawa-on-air-quality" class="nav-link" data-scroll-target="#data-from-lawa-on-air-quality"><span class="header-section-number">2</span> Data from LAWA on Air Quality</a>
  <ul class="collapse">
  <li><a href="#load-lawa-file" id="toc-load-lawa-file" class="nav-link" data-scroll-target="#load-lawa-file"><span class="header-section-number">2.1</span> Load LAWA file</a></li>
  <li><a href="#air-pollutant-concentration-trends-20162023" id="toc-air-pollutant-concentration-trends-20162023" class="nav-link" data-scroll-target="#air-pollutant-concentration-trends-20162023"><span class="header-section-number">2.2</span> Air Pollutant Concentration Trends (2016–2023)</a></li>
  <li><a href="#daily-trends-in-pm10-and-pm2.5-by-town" id="toc-daily-trends-in-pm10-and-pm2.5-by-town" class="nav-link" data-scroll-target="#daily-trends-in-pm10-and-pm2.5-by-town"><span class="header-section-number">2.3</span> Daily Trends in PM10 and PM2.5 by Town</a></li>
  </ul></li>
  <li><a href="#spatial-plot-of-pollutant-concentration-across-nz-20162023" id="toc-spatial-plot-of-pollutant-concentration-across-nz-20162023" class="nav-link" data-scroll-target="#spatial-plot-of-pollutant-concentration-across-nz-20162023"><span class="header-section-number">3</span> Spatial Plot of Pollutant Concentration Across NZ (2016–2023)</a>
  <ul class="collapse">
  <li><a href="#yearly-total-concentrations-of-pm10-and-pm2.5-at-nz-monitoring-sites" id="toc-yearly-total-concentrations-of-pm10-and-pm2.5-at-nz-monitoring-sites" class="nav-link" data-scroll-target="#yearly-total-concentrations-of-pm10-and-pm2.5-at-nz-monitoring-sites"><span class="header-section-number">3.1</span> Yearly Total Concentrations of PM10 and PM2.5 at NZ Monitoring Sites</a></li>
  </ul></li>
  <li><a href="#load-2018-population-data-and-regional-map-data-from-stats-nz" id="toc-load-2018-population-data-and-regional-map-data-from-stats-nz" class="nav-link" data-scroll-target="#load-2018-population-data-and-regional-map-data-from-stats-nz"><span class="header-section-number">4</span> Load 2018 population data and regional map data from Stats NZ</a>
  <ul class="collapse">
  <li><a href="#spatial-join-of-datasets-population-and-region" id="toc-spatial-join-of-datasets-population-and-region" class="nav-link" data-scroll-target="#spatial-join-of-datasets-population-and-region"><span class="header-section-number">4.1</span> Spatial join of datasets: population and region</a></li>
  <li><a href="#normalize-pollutant-concentration-by-2018-population-and-plot-concentration-per-capita-trends-for-eac-site-type." id="toc-normalize-pollutant-concentration-by-2018-population-and-plot-concentration-per-capita-trends-for-eac-site-type." class="nav-link" data-scroll-target="#normalize-pollutant-concentration-by-2018-population-and-plot-concentration-per-capita-trends-for-eac-site-type."><span class="header-section-number">4.2</span> Normalize pollutant concentration by 2018 population and plot concentration per capita trends for eac site type.</a></li>
  <li><a href="#seasonal-trends-in-pollutant-concentration-by-site-type" id="toc-seasonal-trends-in-pollutant-concentration-by-site-type" class="nav-link" data-scroll-target="#seasonal-trends-in-pollutant-concentration-by-site-type"><span class="header-section-number">4.3</span> Seasonal Trends in Pollutant Concentration by Site Type</a></li>
  <li><a href="#regional-trends-in-seasonal-per-capita-pollutant-concentration-20162023" id="toc-regional-trends-in-seasonal-per-capita-pollutant-concentration-20162023" class="nav-link" data-scroll-target="#regional-trends-in-seasonal-per-capita-pollutant-concentration-20162023"><span class="header-section-number">4.4</span> Regional Trends in Seasonal Per Capita Pollutant Concentration (2016–2023)</a></li>
  <li><a href="#comparing-total-and-per-capita-air-pollutant-concentrations-for-2018" id="toc-comparing-total-and-per-capita-air-pollutant-concentrations-for-2018" class="nav-link" data-scroll-target="#comparing-total-and-per-capita-air-pollutant-concentrations-for-2018"><span class="header-section-number">4.5</span> Comparing Total and Per Capita Air Pollutant Concentrations for 2018</a></li>
  <li><a href="#interactive-map-of-2018-particulate-matter-concentrations-by-sa2-region" id="toc-interactive-map-of-2018-particulate-matter-concentrations-by-sa2-region" class="nav-link" data-scroll-target="#interactive-map-of-2018-particulate-matter-concentrations-by-sa2-region"><span class="header-section-number">4.6</span> Interactive Map of 2018 Particulate Matter Concentrations by SA2 Region</a></li>
  <li><a href="#standardizing-daily-air-pollutant-concentrations-for-cross-regional-analysis" id="toc-standardizing-daily-air-pollutant-concentrations-for-cross-regional-analysis" class="nav-link" data-scroll-target="#standardizing-daily-air-pollutant-concentrations-for-cross-regional-analysis"><span class="header-section-number">4.7</span> Standardizing Daily Air Pollutant Concentrations for Cross-Regional Analysis</a></li>
  <li><a href="#seasonal-aggregation-and-visualization-of-air-quality-data-20162023" id="toc-seasonal-aggregation-and-visualization-of-air-quality-data-20162023" class="nav-link" data-scroll-target="#seasonal-aggregation-and-visualization-of-air-quality-data-20162023"><span class="header-section-number">4.8</span> Seasonal Aggregation and Visualization of Air Quality Data (2016–2023)</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Traffic Density and Air Quality: Comparing Urban and Rural Auckland</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Vishal Goundar </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 22, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="abstract" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="abstract"><span class="header-section-number">1</span> Abstract</h2>
<p>This report analyzes the relationship between traffic density and air quality in urban and rural areas of Auckland, specifically focusing on Patumahoe and Queen Street. Using various air quality metrics and traffic data, we explore trends, correlations, and thresholds for air pollutants.</p>
<details>
<summary>
Data Import and Cleaning
</summary>
</details></section>
<section id="data-from-lawa-on-air-quality" class="level2 tabset" data-number="2">
<h2 class="tabset anchored" data-number="2" data-anchor-id="data-from-lawa-on-air-quality"><span class="header-section-number">2</span> Data from LAWA on Air Quality</h2>
<section id="load-lawa-file" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="load-lawa-file"><span class="header-section-number">2.1</span> Load LAWA file</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a list of all sheet names in the provided Excel file to understand the structure of the data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>sheet_names <span class="ot">&lt;-</span> <span class="fu">excel_sheets</span>(<span class="st">"data/lawa/lawa_airqualitydownloaddata_2016-2023.xlsx"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>sheet_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Dataset Notices"    "Monitoring dataset" "Ten-year trends"   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Skip the first 7 rows while loading the air quality data from the "Monitoring dataset" sheet</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/lawa/lawa_airqualitydownloaddata_2016-2023.xlsx"</span>, <span class="at">sheet =</span> <span class="st">"Monitoring dataset"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the loaded data to inspect its structure</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 232,293
Columns: 12
$ Region         &lt;chr&gt; "Auckland region", "Auckland region", "Auckland region"…
$ Agency         &lt;chr&gt; "Auckland Council", "Auckland Council", "Auckland Counc…
$ `LAWA Site ID` &lt;chr&gt; "LAWA-100059", "LAWA-100059", "LAWA-100059", "LAWA-1000…
$ `Site Name`    &lt;chr&gt; "Glen Eden", "Glen Eden", "Glen Eden", "Glen Eden", "Gl…
$ `Site ID`      &lt;chr&gt; "67", "67", "67", "67", "67", "67", "67", "67", "67", "…
$ Latitude       &lt;chr&gt; "-36.922142811073", "-36.922142811073", "-36.9221428110…
$ Longitude      &lt;chr&gt; "174.652000900011", "174.652000900011", "174.6520009000…
$ Town           &lt;chr&gt; "Glen Eden", "Glen Eden", "Glen Eden", "Glen Eden", "Gl…
$ `Site Type`    &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Resi…
$ Indicator      &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM10",…
$ `Sample Date`  &lt;dttm&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-0…
$ Concentration  &lt;dbl&gt; 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2, 10.…</code></pre>
</div>
</div>
<ul>
<li>The dataset contains 232,293 observations across 12 columns, detailing air quality measurements in Auckland. It includes site locations, pollutant indicators, concentrations, agencies, and timestamps, primarily tracking pollutant levels in residential areas.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean column names to ensure consistency and remove spaces or special characters</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>(airdata)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the structure of the cleaned data</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [232,293 × 12] (S3: tbl_df/tbl/data.frame)
 $ region       : chr [1:232293] "Auckland region" "Auckland region" "Auckland region" "Auckland region" ...
 $ agency       : chr [1:232293] "Auckland Council" "Auckland Council" "Auckland Council" "Auckland Council" ...
 $ lawa_site_id : chr [1:232293] "LAWA-100059" "LAWA-100059" "LAWA-100059" "LAWA-100059" ...
 $ site_name    : chr [1:232293] "Glen Eden" "Glen Eden" "Glen Eden" "Glen Eden" ...
 $ site_id      : chr [1:232293] "67" "67" "67" "67" ...
 $ latitude     : chr [1:232293] "-36.922142811073" "-36.922142811073" "-36.922142811073" "-36.922142811073" ...
 $ longitude    : chr [1:232293] "174.652000900011" "174.652000900011" "174.652000900011" "174.652000900011" ...
 $ town         : chr [1:232293] "Glen Eden" "Glen Eden" "Glen Eden" "Glen Eden" ...
 $ site_type    : chr [1:232293] "Residential, NES site" "Residential, NES site" "Residential, NES site" "Residential, NES site" ...
 $ indicator    : chr [1:232293] "PM10" "PM10" "PM10" "PM10" ...
 $ sample_date  : POSIXct[1:232293], format: "2016-01-01" "2016-01-02" ...
 $ concentration: num [1:232293] 11.1 10.6 4.7 6.9 13.2 11.1 15.2 10.7 15.2 10.6 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the column for date to a more user-friendly name</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">date =</span> sample_date)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the updated data</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 232,293
Columns: 12
$ region        &lt;chr&gt; "Auckland region", "Auckland region", "Auckland region",…
$ agency        &lt;chr&gt; "Auckland Council", "Auckland Council", "Auckland Counci…
$ lawa_site_id  &lt;chr&gt; "LAWA-100059", "LAWA-100059", "LAWA-100059", "LAWA-10005…
$ site_name     &lt;chr&gt; "Glen Eden", "Glen Eden", "Glen Eden", "Glen Eden", "Gle…
$ site_id       &lt;chr&gt; "67", "67", "67", "67", "67", "67", "67", "67", "67", "6…
$ latitude      &lt;chr&gt; "-36.922142811073", "-36.922142811073", "-36.92214281107…
$ longitude     &lt;chr&gt; "174.652000900011", "174.652000900011", "174.65200090001…
$ town          &lt;chr&gt; "Glen Eden", "Glen Eden", "Glen Eden", "Glen Eden", "Gle…
$ site_type     &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Resid…
$ indicator     &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", …
$ date          &lt;dttm&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01…
$ concentration &lt;dbl&gt; 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2, 10.6…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a 'year' column for further analysis based on the date</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="fu">as.numeric</span>(longitude),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="fu">as.numeric</span>(latitude),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a 'year' column</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">format</span>(date, <span class="st">"%Y"</span>))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of the modified dataset</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    region             agency          lawa_site_id        site_name        
 Length:232293      Length:232293      Length:232293      Length:232293     
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
                                                                            
   site_id             latitude        longitude         town          
 Length:232293      Min.   :-46.43   Min.   :168.3   Length:232293     
 Class :character   1st Qu.:-43.38   1st Qu.:172.6   Class :character  
 Mode  :character   Median :-40.95   Median :174.8   Mode  :character  
                    Mean   :-40.54   Mean   :174.0                     
                    3rd Qu.:-37.78   3rd Qu.:175.7                     
                    Max.   :-35.73   Max.   :178.0                     
                    NA's   :717      NA's   :717                       
  site_type          indicator              date                       
 Length:232293      Length:232293      Min.   :2016-01-01 00:00:00.00  
 Class :character   Class :character   1st Qu.:2018-04-28 00:00:00.00  
 Mode  :character   Mode  :character   Median :2020-04-07 00:00:00.00  
                                       Mean   :2020-03-08 17:45:54.02  
                                       3rd Qu.:2022-02-10 01:00:00.00  
                                       Max.   :2023-12-31 01:00:00.00  
                                                                       
 concentration         year          
 Min.   : -5.568   Length:232293     
 1st Qu.:  6.404   Class :character  
 Median : 10.493   Mode  :character  
 Mean   : 12.661                     
 3rd Qu.: 16.100                     
 Max.   :202.800                     
                                     </code></pre>
</div>
</div>
<ul>
<li>There are 232,293 data observations describing air quality sites, locations, pollutants, dates, and concentration values. 717 missing longitude, and latitude values. Contration of pollutants range from -5.568µg/m³ to 202.8µg/m³.</li>
</ul>
</section>
<section id="air-pollutant-concentration-trends-20162023" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="air-pollutant-concentration-trends-20162023"><span class="header-section-number">2.2</span> Air Pollutant Concentration Trends (2016–2023)</h3>
<p>The boxplots below illustrate yearly trends in pollutant concentrations across New Zealand, highlighting differences in distribution and scale between pollutant types, with and without y-axis restriction.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="air-quality_files/figure-html/visualize-lawa-concentration-distribution-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Air Pollutant Concentration in NZ (2016–2023)</figcaption>
</figure>
</div>
</div>
</div>
<p>PM10 levels are higher, with medians often below 15µg/m³ and frequent extreme outliers (~200µg/m³), suggesting episodic spikes from dust, construction, or fires. PM2.5 shows narrower IQRs and fewer outliers (&lt;90µg/m³), indicating more consistent levels. Though lower in concentration, PM2.5 poses greater long-term health risks due to deeper lung penetration and possible cumulative effects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview observations with invalid concentration</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(concentration <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="fu">is.na</span>(concentration))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  `concentration &lt; 0` `is.na(concentration)`      n
  &lt;lgl&gt;               &lt;lgl&gt;                   &lt;int&gt;
1 FALSE               FALSE                  232186
2 TRUE                FALSE                     107</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 107 observations with negative concentration. None of the concentrations are missing.</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace negative concentration values with NA</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">concentration =</span> <span class="fu">ifelse</span>(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    concentration <span class="sc">&lt;</span> <span class="dv">0</span> , <span class="cn">NA</span>, concentration))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the format of the date column</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the observations with missing longitude and latitude</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(longitude), <span class="fu">is.na</span>(latitude)) <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(town, site_name, latitude, longitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
  town    site_name           latitude longitude     n
  &lt;chr&gt;   &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
1 Rotorua Rotorua at Moses Rd       NA        NA   717</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 717 missing coordinates in town: Rotorua at site_name: Rotorua at Moses Rd</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter Rotorua and count all site_name, longitude, and latitude</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(town <span class="sc">==</span> <span class="st">"Rotorua"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(region, site_name, latitude, longitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  region               site_name            latitude longitude     n
  &lt;chr&gt;                &lt;chr&gt;                   &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
1 Bay of Plenty region Rotorua at Edmund Rd    -38.1      176.  5428
2 Bay of Plenty region Rotorua at Moses Rd      NA         NA    717</code></pre>
</div>
</div>
<p>717 values of latitude and longitude missing for town Rotorua at site_name: Rotorua at Moses Rd. From <a href="https://www.google.com/maps/place/Edmund+Road,+Rotorua+3015/@-38.1365744,176.2093362,16z/data=!4m15!1m8!3m7!1s0x6d6c26fd8a529507:0x880fa5106b1fb10!2sEdmund+Road,+Rotorua+3015!3b1!8m2!3d-38.136431!4d176.214529!16s%2Fg%2F1tdxw6g1!3m5!1s0x6d6c26fd8a529507:0x880fa5106b1fb10!8m2!3d-38.136431!4d176.214529!16s%2Fg%2F1tdxw6g1?entry=ttu&amp;g_ep=EgoyMDI1MDUwNS4wIKXMDSoJLDEwMjExNDUzSAFQAw%3D%3D">Google Maps</a>, These coordinates roughly point to latitude: -38.1482, longitude: 176.2273</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill in missing coordinates for Rotorua at Moses Rd site name with approximate central coordinates from Google Map</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="fu">if_else</span>(</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>      site_name <span class="sc">==</span> <span class="st">"Rotorua at Moses Rd"</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(latitude),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span><span class="fl">38.1482</span>, latitude),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="fu">if_else</span>(</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>      site_name <span class="sc">==</span> <span class="st">"Rotorua at Moses Rd"</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(longitude),</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>      <span class="fl">176.2273</span>, longitude))</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the updated coordinates</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(town <span class="sc">==</span> <span class="st">"Rotorua"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(site_name, latitude, longitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  site_name            latitude longitude     n
  &lt;chr&gt;                   &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
1 Rotorua at Edmund Rd    -38.1      176.  5428
2 Rotorua at Moses Rd     -38.1      176.   717</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify site names with multiple locations</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>repeating_site <span class="ot">&lt;-</span> airdata <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(site_name, longitude, latitude) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(site_name) <span class="sc">%&gt;%</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(site_name)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(repeating_site)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> chr [1:18] "Anzac Square" "Geraldine" "Glen Eden" "Hampstead" "Henderson" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 18 site_name with different longitude and latitude at least once.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview coordinates for Geraldine</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(site_name <span class="sc">==</span> <span class="st">"Geraldine"</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(longitude, latitude), <span class="sc">~</span><span class="fu">format</span>(.x, <span class="at">digits =</span> <span class="dv">16</span>))) <span class="sc">|&gt;</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(longitude, latitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  longitude         latitude          
  &lt;chr&gt;             &lt;chr&gt;             
1 171.2414809999840 -44.10018100044980
2 171.2414809999841 -44.10018100044984</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The difference is in the precision in the 14th decimal places</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview locations for site_name: Anzac Square</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(site_name <span class="sc">==</span> <span class="st">"Anzac Square"</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(longitude, latitude), <span class="sc">~</span><span class="fu">format</span>(.x, <span class="at">digits =</span> <span class="dv">16</span>))) <span class="sc">|&gt;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(longitude, latitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  longitude         latitude          
  &lt;chr&gt;             &lt;chr&gt;             
1 171.2496629996010 -44.40448300080550
2 171.2496629996013 -44.40448300080546</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The difference is in the precision in the 13th and 14th decimal places</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace longitude and latitude with the maximum values for repeating sites</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="fu">max</span>(longitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="fu">max</span>(latitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure only repeating sites were modified</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(site_name, longitude, latitude) <span class="sc">|&gt;</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(site_name) <span class="sc">|&gt;</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 2
# ℹ 2 variables: site_name &lt;chr&gt;, n &lt;int&gt;</code></pre>
</div>
</div>
</section>
<section id="daily-trends-in-pm10-and-pm2.5-by-town" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="daily-trends-in-pm10-and-pm2.5-by-town"><span class="header-section-number">2.3</span> Daily Trends in PM10 and PM2.5 by Town</h3>
<p>This plot highlights daily trends in particulate matter (PM10 and PM2.5) across New Zealand towns from 2016 to 2023, showing peak values and differences in spatial pollution patterns.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 13
Columns: 5
$ date      &lt;date&gt; 2016-04-02, 2016-04-02, 2017-04-01, 2018-03-31, 2019-04-06,…
$ indicator &lt;chr&gt; "PM10", "PM2.5", "PM10", "PM10", "PM10", "PM10", "PM2.5", "P…
$ site_name &lt;chr&gt; "Arrowtown", "Plunket AQ", "Central Dunedin", "Alexandra at …
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Industria…
$ n         &lt;int&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 232,280
Columns: 10
$ date       &lt;date&gt; 2016-01-01, 2016-01-01, 2016-01-01, 2016-01-01, 2016-01-01…
$ year       &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2016", "20…
$ indicator  &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM…
$ site_name  &lt;chr&gt; "126 Hautapu Street", "34 Maata Street", "Anzac Square", "A…
$ site_type  &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Resident…
$ town       &lt;chr&gt; "Taihape", "Taumarunui", "Timaru", "Arrowtown", "Awatoto", …
$ latitude   &lt;dbl&gt; -39.67780, -38.88618, -44.40448, -44.94857, -39.54589, -38.…
$ longitude  &lt;dbl&gt; 175.8008, 175.2710, 171.2497, 168.8457, 176.9191, 175.8584,…
$ mean_conc  &lt;dbl&gt; 8.45400, 10.57200, 16.07100, 7.70000, 29.09000, 6.19802, 10…
$ total_conc &lt;dbl&gt; 8.45400, 10.57200, 16.07100, 7.70000, 29.09000, 6.19802, 10…</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-daily-pollutant-trends-by-town-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Daily PM10 and PM2.5 concentrations by town (2016–2023)</figcaption>
</figure>
</div>
</div>
</div>
<p>Both PM10 and PM2.5 concentrations exhibit noticeable winter peaks (June–August) across multiple years, likely due to increased heating emissions and meteorological conditions. Summer months tend to have lower pollutant levels, reflecting improved dispersion and reduced combustion-based emissions. Occasional extreme peaks, mostly during winter months exceeding 100 µg/m³ (PM10) and 50 µg/m³ (PM2.5) indicate episodes of significantly poor air quality. Milton, Arrowtown, Timaru, Central Lower Hutt, and Tokoroa frequently experience PM10 spikes, while Rotorua, Kaiapoi, and Tokoroa see more PM2.5 surges, likely influenced by industry, transport, or topography. Pollutant levels fluctuate due to wind speed, temperature inversions, and precipitation, while seasonal trends are shaped by emissions from traffic, industrial activities, and wood burning.</p>
</section>
</section>
<section id="spatial-plot-of-pollutant-concentration-across-nz-20162023" class="level2 tabset" data-number="3">
<h2 class="tabset anchored" data-number="3" data-anchor-id="spatial-plot-of-pollutant-concentration-across-nz-20162023"><span class="header-section-number">3</span> Spatial Plot of Pollutant Concentration Across NZ (2016–2023)</h2>
<p>This map shows average PM10 and PM2.5 concentrations at monitoring sites across New Zealand, projected using NZTM2000. Higher values are observed in densely populated urban regions.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 103
Columns: 6
$ town      &lt;chr&gt; "Alexandra", "Arrowtown", "Ashburton", "Ashburton", "Aucklan…
$ site_name &lt;chr&gt; "Alexandra at 5 Ventry Street", "Arrowtown", "Hampstead", "H…
$ longitude &lt;dbl&gt; 169.3903, 168.8457, 171.7552, 171.7552, 174.7657, 174.7657, …
$ latitude  &lt;dbl&gt; -45.25485, -44.94857, -43.91224, -43.91224, -36.84743, -36.8…
$ indicator &lt;chr&gt; "PM10", "PM10", "PM10", "PM2.5", "PM10", "PM2.5", "PM10", "P…
$ mean_conc &lt;dbl&gt; 14.788923, 16.990257, 15.981660, 8.663412, 17.300244, 7.1823…</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  indicator   min   max     n
  &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
1 PM10       4.69  30.9    66
2 PM2.5      4.69  30.9    37</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 103
Columns: 5
$ town      &lt;chr&gt; "Alexandra", "Arrowtown", "Ashburton", "Ashburton", "Aucklan…
$ site_name &lt;chr&gt; "Alexandra at 5 Ventry Street", "Arrowtown", "Hampstead", "H…
$ indicator &lt;chr&gt; "PM10", "PM10", "PM10", "PM2.5", "PM10", "PM2.5", "PM10", "P…
$ mean_conc &lt;dbl&gt; 14.788923, 16.990257, 15.981660, 8.663412, 17.300244, 7.1823…
$ geometry  &lt;POINT [m]&gt; POINT (1316769 4982397), POINT (1272287 5014362), POIN…</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="air-quality_files/figure-html/Spatially-plot-average-pollutant-level-over-all-years-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Spatial distribution of average PM10 and PM2.5 concentrations (2016–2023)</figcaption>
</figure>
</div>
</div>
</div>
<p>PM10 and PM2.5 spatial distributions across New Zealand show differing average pollutant concentration patterns. PM10 concentrations exhibit broader regional variability, with high levels in Timaru, Arrowtown, Gore. PM2.5 concentrations appear more localized, clustering around major urban centers. The color gradient further emphasizes intensity differences, with PM10 displaying a more dispersed pattern.</p>
<section id="yearly-total-concentrations-of-pm10-and-pm2.5-at-nz-monitoring-sites" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="yearly-total-concentrations-of-pm10-and-pm2.5-at-nz-monitoring-sites"><span class="header-section-number">3.1</span> Yearly Total Concentrations of PM10 and PM2.5 at NZ Monitoring Sites</h3>
<p>This plot compares annual total pollutant concentrations at air quality sites across New Zealand from 2016 to 2023. Towns with the lowest and highest yearly values are labelled.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
   57.44  2993.20  4073.38  4148.35  5185.62 10859.53 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 32
Columns: 6
$ year       &lt;chr&gt; "2016", "2016", "2016", "2016", "2017", "2017", "2017", "20…
$ town       &lt;chr&gt; "Blenheim", "Nelson Centre/North", "Timaru", "Timaru", "Ble…
$ indicator  &lt;chr&gt; "PM2.5", "PM10", "PM10", "PM2.5", "PM2.5", "PM10", "PM2.5",…
$ latitude   &lt;dbl&gt; -41.52664, -41.28196, -44.40448, -44.40448, -41.52664, -41.…
$ longitude  &lt;dbl&gt; 173.9561, 173.2908, 171.2497, 171.2497, 173.9561, 173.2908,…
$ total_conc &lt;dbl&gt; 57.4400, 1644.5000, 8578.9230, 4666.7880, 5220.9400, 1919.5…</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-yearly-total-concentrations-at-nz-sites-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Boxplots of yearly total PM10 and PM2.5 concentrations across NZ sites (2016–2023)</figcaption>
</figure>
</div>
</div>
</div>
<p>Locations such as Timaru, Invercargill, and Mount Maunganui frequently appear with higher PM10 values, suggesting regional emissions from transport, industry, or meteorological conditions. Lower PM10 levels are recorded at Nelson Centre/North, Stoke, Gisborne, and Christchurch, indicating relatively better air quality in these areas.</p>
<p>Timaru, Blenheim, Tokoroa, and Kaiapoi consistently report elevated PM2.5 levels, emphasizing finer particulate pollution concerns, possibly linked to combustion sources. Sites like Blenheim, Nelson South, Hamilton, Te Kuiti, Patumahoe, Christchurch, Napier, and Awatoto exhibit lower PM2.5 concentrations, suggesting fewer major emission sources or better pollutant dispersion.</p>
<p>Seasonal influences (e.g., winter heating emissions) could explain peaks in both PM10 and PM2.5. Site-specific pollutant sources (e.g., traffic, industry, and wood burning) contribute to long-term trends.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add last two digits of year in column year</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>dailyairdata <span class="ot">&lt;-</span> dailyairdata <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">format</span>(date, <span class="st">"%y"</span>),</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">month =</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(date, <span class="st">"%m"</span>)))</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate pollutant concentrations per season per year</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>dailyairdata <span class="ot">&lt;-</span> dailyairdata <span class="sc">|&gt;</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">season =</span> <span class="fu">case_when</span>(</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">~</span> <span class="st">"Sum"</span>,</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">~</span> <span class="st">"Aut"</span>,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>) <span class="sc">~</span> <span class="st">"Win"</span>,</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>) <span class="sc">~</span> <span class="st">"Spr"</span>),</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">season_year =</span> <span class="fu">paste0</span>(season, <span class="st">"_"</span>, year))</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>season_order <span class="ot">&lt;-</span> <span class="fu">unique</span>(dailyairdata<span class="sc">$</span>season_year)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>seasonairdata <span class="ot">&lt;-</span> dailyairdata <span class="sc">|&gt;</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">season_year =</span> <span class="fu">factor</span>(season_year, <span class="at">levels =</span> season_order, <span class="at">ordered =</span> <span class="cn">TRUE</span>))</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>seasonairdata <span class="ot">&lt;-</span> seasonairdata <span class="sc">|&gt;</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season_year, town, indicator) <span class="sc">|&gt;</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_conc =</span> <span class="fu">sum</span>(total_conc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(seasonairdata<span class="sc">$</span>total_conc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    8.0   624.5  1025.2  1189.8  1399.4 12305.8 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seasonal total concentration range from 7.1µg/m³ to 31168.9µg/m³, so using log scale is valid.</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter town with the seasonal lowest and highest concentration of pollutants</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>text_label <span class="ot">&lt;-</span> seasonairdata <span class="sc">|&gt;</span> </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season_year, indicator) <span class="sc">|&gt;</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(total_conc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="fu">min</span>(total_conc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">max</span>(total_conc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">|&gt;</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(text_label)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 128
Columns: 4
$ season_year &lt;ord&gt; Sum_16, Sum_16, Sum_16, Sum_16, Aut_16, Aut_16, Aut_16, Au…
$ town        &lt;chr&gt; "Blenheim", "Christchurch", "Christchurch", "Nelson Centre…
$ indicator   &lt;chr&gt; "PM2.5", "PM10", "PM2.5", "PM10", "PM10", "PM2.5", "PM10",…
$ total_conc  &lt;dbl&gt; 57.440, 3136.030, 1147.860, 159.000, 3125.592, 1403.090, 2…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot seasonal total pollutant concentration across NZ monitoring sites (2016–2023), using boxplots, with towns labelled at the annual minimum and maximum concentration levels</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>plot_season <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> seasonairdata, <span class="fu">aes</span>(<span class="at">x =</span> season_year, <span class="at">y =</span> total_conc)) <span class="sc">+</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> town), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> text_label,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> season_year, <span class="at">y =</span> total_conc, <span class="at">label =</span> town), <span class="at">font_face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">nudge_y =</span> <span class="fl">0.1</span>, <span class="at">check_overlap =</span> <span class="cn">TRUE</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> indicator, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>scientific) <span class="sc">+</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Total Pollutant Concentrations across Monitoring Multiple Sites in New Zealand (2016-2023)"</span>,</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Seasonal total PM10 and PM2.5 concentrations, with towns labelled at annual extremes"</span>,</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Season Year"</span>,</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Seasonal Pollutant Concentration (µg/m³)"</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>plot_season</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-seasonal-total-concentration-for-each-year-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_season, <span class="at">width=</span><span class="dv">12</span>, <span class="at">height=</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The plots compare seasonal PM10 and PM2.5 concentrations across New Zealand sites from 2016 to 2023. PM10 levels (top) are consistently higher, spanning a wider dynamic range (10¹–10⁴ µg/m³), while PM2.5 (bottom) shows lower concentrations (10¹–10³ µg/m³). PM10 peaks occur more frequently in Mount Maunganui, Masterton, and Christchurch, whereas PM2.5 peaks persistently appear in Christchurch, Masterton, and Timaru. Both pollutants show seasonal fluctuations, with distinct high values in winter and lower values in summer. Town label annotations mark annual extremes, aiding temporal-spatial interpretation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect subgroup of longitude, latitude, site_type, and town</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>airdata_group <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(longitude, latitude, site_type, town)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 69
Columns: 4
$ longitude &lt;dbl&gt; 174.6520, 174.6284, 174.6284, 174.8904, 174.8640, 174.8156, …
$ latitude  &lt;dbl&gt; -36.92214, -36.86800, -36.86800, -36.90548, -37.20450, -36.9…
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, Traffic, NES site", "…
$ town      &lt;chr&gt; "Glen Eden", "Henderson", "Henderson", "Pakuranga", "Patumah…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 69 data observations.</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create label dataset of coordinates, and town</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>label_text <span class="ot">&lt;-</span> airdata_group <span class="sc">|&gt;</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(latitude, longitude, town)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(label_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 67
Columns: 3
$ latitude  &lt;dbl&gt; -36.92214, -36.86800, -36.90548, -37.20450, -36.90456, -36.8…
$ longitude &lt;dbl&gt; 174.6520, 174.6284, 174.8904, 174.8640, 174.8156, 174.7657, …
$ town      &lt;chr&gt; "Glen Eden", "Henderson", "Pakuranga", "Patumahoe", "Penrose…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a static map of spatial distribution of site types</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> airdata_group) <span class="sc">+</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">color =</span> site_type), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> label_text, <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">label =</span> town)) <span class="sc">+</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"turbo"</span>) <span class="sc">+</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Spatial Distribution of Air Quality Monitoring Site Type in New Zealand (2016–2023)"</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Monitoring site locations grouped by type"</span>,</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>, <span class="at">color =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"gray80"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>),</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>plot1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/Static-plot-of-lawa-site-types-monitoring-locations-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot1, <span class="at">width=</span><span class="dv">12</span>, <span class="at">height=</span><span class="dv">6</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Save RAM</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(airdata_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Residential monitoring sites are widespread across New Zealand, with dense clusters in the south, particularly Invercargill, Dunedin, and Christchurch. Industrial sites are more concentrated, notably around Christchurch and Wellington. Mixed-use sites, combining residential, traffic, and industrial classifications, are predominantly urban, appearing frequently in Wellington and Auckland. Coastal monitoring locations are dispersed along the shorelines, with a stronger presence in Wellington and Taupo regions. These distributions highlight the influence of urbanization and industrial activity on air quality monitoring priorities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by date, indicator, site_name, site_type, comput sum of concentrations</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>dailyairdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date, indicator, site_name, site_type) <span class="sc">|&gt;</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_conc =</span> <span class="fu">sum</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dailyairdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 232,280
Columns: 5
$ date       &lt;date&gt; 2016-01-01, 2016-01-01, 2016-01-01, 2016-01-01, 2016-01-01…
$ indicator  &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM…
$ site_name  &lt;chr&gt; "126 Hautapu Street", "34 Maata Street", "Anzac Square", "A…
$ site_type  &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Resident…
$ total_conc &lt;dbl&gt; 8.45400, 10.57200, 16.07100, 7.70000, 29.09000, 6.19802, 10…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a plot of PM2.5 and PM10 concentration versus date faceted by site_type</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dailyairdata, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> total_conc, <span class="at">color =</span> indicator)) <span class="sc">+</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># geom_text_repel(data = label_text, aes(x = longitude, y = latitude, label = town)) +</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"PM10"</span> <span class="ot">=</span> <span class="st">"#0072B2"</span>, <span class="st">"PM2.5"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>)) <span class="sc">+</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> site_type, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span> </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Daily PM2.5 and PM10 Concentration versus Date at Site Types in New Zealand (2016–2023)"</span>,</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Pollutant Concentration grouped by Monitoring site locations type"</span>,</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Daily total concentration (µg/m³)"</span>,</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Indicator"</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot1, <span class="at">width=</span><span class="dv">12</span>, <span class="at">height =</span> <span class="fl">5.5</span>)</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>plot1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot_site-types-of-concentration-versus-date-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot restricted by y axis for more than 25</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> plot1 <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="cn">NA</span>)) <span class="sc">+</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Pollutant Concentration Restricted for at least 25µg/m³"</span>,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>plot2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot_site-types-of-concentration-versus-date-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot2, <span class="at">width=</span><span class="dv">12</span>, <span class="at">height =</span> <span class="fl">5.5</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Save RAM</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(dailyairdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Across all site types, PM10 concentrations (blue) consistently exceed PM2.5 (orange), with clear seasonal peaks—particularly in winter—indicating heightened pollution likely from domestic wood burning. Residential and NES-designated sites show the most pronounced PM10 spikes, often surpassing 100 µg/m³, highlighting the impact of household heating in colder months. Industrial, NES sites also record frequent peaks above 75 µg/m³, while Industrial, Coastal, NES sites exhibit more moderate values, likely moderated by coastal airflow. Mixed-use sites like Residential, Traffic, Industrial, Coastal, NES show moderate variability, suggesting influence from multiple emission sources. Traffic-related sites generally maintain lower concentrations, possibly due to vehicle emission controls. Residential, Industrial data is only available for 2023 but already shows elevated levels, underscoring potential local sources. Overall, the long-term data from 2016 to 2023—except for a few newer sites—demonstrates New Zealand’s comprehensive air quality monitoring network and the influence of seasonal and site-type-specific factors on particulate pollution levels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute scalar medians (as single value)</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>median16_pm25 <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(indicator <span class="sc">==</span> <span class="st">"PM2.5"</span>, year <span class="sc">==</span> <span class="dv">2016</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">median_val =</span> <span class="fu">median</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(median_val)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute scaler medians (as single value)</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>median16_pm10 <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(indicator <span class="sc">==</span> <span class="st">"PM10"</span>, year <span class="sc">==</span> <span class="dv">2016</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">median_val =</span> <span class="fu">median</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(median_val)</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a new column using scalar values properly</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>normalize_airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">baseline =</span> <span class="fu">case_when</span>(</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>    indicator <span class="sc">==</span> <span class="st">"PM2.5"</span> <span class="sc">~</span> median16_pm25,</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>    indicator <span class="sc">==</span> <span class="st">"PM10"</span>  <span class="sc">~</span> median16_pm10,</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span>  <span class="co"># fallback for other indicators</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute normalized concentration values relative to the 2016 baseline</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>normalize_airdata <span class="ot">&lt;-</span> normalize_airdata <span class="sc">|&gt;</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">normalized_concentration =</span> concentration <span class="sc">/</span> baseline)</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly select 6 towns from the dataset for visualization</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">13</span>) <span class="co"># For reproducibility</span></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>townlist <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">unique</span>(airdata<span class="sc">$</span>town), <span class="dv">10</span>)</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the dataset to include only the selected towns</span></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>normalize_filtered <span class="ot">&lt;-</span> normalize_airdata <span class="sc">|&gt;</span></span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(town <span class="sc">%in%</span> townlist) <span class="sc">|&gt;</span></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">town_indicator =</span> <span class="fu">paste0</span>(town, <span class="st">"_"</span>, indicator))</span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a faceted plot to visualize pollutant trends, highlighting differences across towns</span></span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">filter</span>(normalize_filtered), <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y =</span> normalized_concentration)) <span class="sc">+</span></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> indicator), <span class="at">lwd=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> town_indicator, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"turbo"</span>) <span class="sc">+</span></span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Normalized Air Pollutant Concentrations Across Selected New Zealand Towns (2016–2023)"</span>,</span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"PM2.5 and PM10 Levels Adjusted to 2016 Median Concentration for Comparative Analysis"</span>,</span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Normalized Pollutant Concentration (Relative to 2016 Median)"</span>,</span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend =</span> <span class="st">"Pollutant Type"</span></span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a>   <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a>   <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a>   <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a>   <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a>   <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a>plot1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/normalized-pollution-trends-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot1, <span class="at">width=</span><span class="dv">12</span>, <span class="at">height=</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Compared to the 2016 median concentration, PM2.5 and PM10 levels show varied trends across locations. Auckland City Centre and Rotorua exhibit sharp PM2.5 spikes around 2020, while Cromwell and Timaru experience periodic peaks in both pollutants. Other towns display stable or fluctuating patterns, with some decreasing trends in PM2.5. These changes indicate local factors affecting air quality, including urban emissions, seasonal variations, and regulatory impacts on pollutant concentrations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(region, site_type, site_name, site_id, latitude, longitude, town) <span class="sc">|&gt;</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  region          site_type     site_name site_id latitude longitude town      n
  &lt;chr&gt;           &lt;chr&gt;         &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;int&gt;
1 Auckland region Residential,… Penrose   7          -36.9      175. Penr…  5466
2 Auckland region Residential,… Glen Eden 67         -36.9      175. Glen…  2827
3 Auckland region Residential,… Henderson 5          -36.9      175. Hend…   361
4 Auckland region Residential,… Pakuranga 1          -36.9      175. Paku…  2876
5 Auckland region Residential,… Patumahoe 2          -37.2      175. Patu…  5390
6 Auckland region Residential,… Queen St… 9          -36.8      175. Quee…   460</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the list of unique town from the airdata</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>town_list <span class="ot">&lt;-</span> <span class="fu">unique</span>(airdata<span class="sc">$</span>town)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the list to ensure valid sampling</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(town_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> chr [1:56] "Glen Eden" "Henderson" "Pakuranga" "Patumahoe" "Penrose" ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly select 10 town from the list (seeded for reproducibility)</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">13</span>)  </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>random_town <span class="ot">&lt;-</span> <span class="fu">sample</span>(town_list, <span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the randomly selected towns</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>random_town</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Auckland City Centre" "Cromwell"             "Morrinsville"        
 [4] "Napier"               "Pakuranga"            "Patumahoe"           
 [7] "Rotorua"              "Stoke"                "Taihape"             
[10] "Timaru"              </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by region and filter airdata for the 10 randomly selected towns </span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>airdata_random_town <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(town <span class="sc">%in%</span> random_town) <span class="sc">|&gt;</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Count number of distinct town, date, indicator</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>airdata_random_town <span class="sc">|&gt;</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(town, date, indicator) <span class="sc">|&gt;</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  town    date       indicator     n
  &lt;chr&gt;   &lt;date&gt;     &lt;chr&gt;     &lt;int&gt;
1 Rotorua 2023-01-01 PM10          2
2 Rotorua 2023-01-01 PM2.5         2
3 Rotorua 2023-01-02 PM10          2
4 Rotorua 2023-01-02 PM2.5         2
5 Rotorua 2023-01-03 PM10          2
6 Rotorua 2023-01-03 PM2.5         2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate total concentration for each town by date and indicator to prepare for plotting</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>airdata_random_town <span class="ot">&lt;-</span> airdata_random_town <span class="sc">|&gt;</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(town, date, indicator) <span class="sc">|&gt;</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_conc =</span> <span class="fu">sum</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the aggregated data</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata_random_town)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 34,897
Columns: 4
$ town       &lt;chr&gt; "Auckland City Centre", "Auckland City Centre", "Auckland C…
$ date       &lt;date&gt; 2017-03-04, 2017-03-05, 2017-03-06, 2017-03-07, 2017-03-08…
$ indicator  &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM…
$ total_conc &lt;dbl&gt; 11.5, 15.4, 14.7, 13.4, 8.2, 11.4, 20.3, 18.2, 20.7, 19.5, …</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the summary of total_conc of randomly selected town</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>airdata_random_town <span class="sc">|&gt;</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     town                date             indicator           total_conc     
 Length:34897       Min.   :2016-01-01   Length:34897       Min.   :  0.000  
 Class :character   1st Qu.:2018-02-13   Class :character   1st Qu.:  6.828  
 Mode  :character   Median :2020-01-19   Mode  :character   Median : 10.851  
                    Mean   :2020-01-14                      Mean   : 14.220  
                    3rd Qu.:2021-12-05                      3rd Qu.: 16.723  
                    Max.   :2023-12-31                      Max.   :159.579  </code></pre>
</div>
</div>
<ul>
<li>Total_conc range from 0 to 159.579 from 1 January 2016 to 31 December 2023.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace zero's with 1e-05, since log works on positive values</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>airdata_random_town <span class="ot">&lt;-</span> airdata_random_town <span class="sc">|&gt;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_conc =</span> <span class="fu">ifelse</span>(</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>      total_conc <span class="sc">==</span> <span class="dv">0</span>, <span class="fl">1e-05</span>, total_conc))</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(airdata_random_town<span class="sc">$</span>total_conc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
  0.00001   6.82817  10.85118  14.21979  16.72300 159.57900 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Colorblind-friendly palette (Okabe-Ito)</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>colorblind_palette <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#999999"</span>, <span class="st">"#E69F00"</span>, <span class="st">"#440154"</span>, <span class="st">"#F0E442"</span>, <span class="st">"#009E73"</span>, <span class="st">"#D55E00"</span>, <span class="st">"#35b779"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#000000"</span>, <span class="st">"#660099"</span>, <span class="st">"#CC79A7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a reusable function to plot airdata concentration trends by selected town, indicator, and date. This function uses faceted plots with colorblind-friendly palettes for better accessibility</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>plot_selected_conc <span class="ot">&lt;-</span> <span class="cf">function</span>(data, title, subtitle, x_label, y_label, sum_var) {</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the plot using ggplot2</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> {{ sum_var }}, <span class="at">color =</span> indicator)) <span class="sc">+</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colorblind_palette) <span class="sc">+</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> town, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> title,</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> subtitle,</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> x_label,</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> y_label,</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"Indicator"</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>), <span class="co"># Center the main title</span></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot log-scaled airdata trends for 10 randomly selected towns using the custom plot function. The plot will show daily PM10 and PM2.5 concentrations across towns, scaled logarithmically.</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>plot_random_log <span class="ot">&lt;-</span> <span class="fu">plot_selected_conc</span>(</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> airdata_random_town,</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Air Pollutant Concentration Trends in 10 Random Town (2016-2023)"</span>,</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">subtitle =</span> <span class="st">"Log-scaled daily PM10, and PM2.5 concentration by indicatior"</span>,</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_label =</span> <span class="st">"Month-Year"</span>,</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_label =</span> <span class="st">"Daily Concentration (log scale)"</span>,</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">sum_var =</span> total_conc</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2016-01-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2023-12-31"</span>), <span class="at">by =</span> <span class="st">"6 months"</span>),</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">date_labels =</span> <span class="st">"%b %y"</span> <span class="co"># Format date for better readability</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_scientific</span>()) <span class="co"># Use log scale for concentration</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_random_log, <span class="at">width=</span><span class="dv">12</span>, <span class="at">height=</span><span class="fl">5.5</span>)</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>plot_random_log</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/log-plot-lawa-concentration-trends-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save RAM</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(airdata_random_town)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Auckland City Centre maintains stable PM10 and PM2.5 concentrations, with occasional peaks, while Napier and Timaru exhibit frequent spikes, likely driven by seasonal factors. Cromwell shows a distinct PM10 seasonal pattern, whereas Taihape experiences frequent PM2.5 drops in 2023. Stoke’s PM10 sharply declines in 2023. Morrinsville, Pakuranga, Patumahoe, and Rotorua display relatively stable air quality with minor variations, contrasting Napier and Timaru’s fluctuations. PM10 and PM2.5 concentrations generally follow similar trends, though PM2.5 sometimes exhibits sharper changes, reflecting different emission sources or meteorological influences. Seasonality plays a crucial role in shaping air pollution patterns across these towns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(site_name <span class="sc">%in%</span> town)) <span class="sc">|&gt;</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(site_name, town)  <span class="sc">|&gt;</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [51 × 3] (S3: tbl_df/tbl/data.frame)
 $ site_name: chr [1:51] "126 Hautapu Street" "34 Maata Street" "Alexandra at 5 Ventry Street" "Anzac Square" ...
 $ town     : chr [1:51] "Taihape" "Taumarunui" "Alexandra" "Timaru" ...
 $ n        : int [1:51] 3072 3466 2333 5829 4782 5272 5177 2864 2675 2783 ...</code></pre>
</div>
</div>
<p>51 site_name are not same as 51 town.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview multiple groups of coordinates and region</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(longitude, latitude, region) <span class="sc">|&gt;</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  longitude latitude region                   n
      &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;                &lt;int&gt;
1      176.    -38.1 Bay of Plenty region   717
2      177.    -39.6 Hawke's Bay region    5336
3      177.    -39.5 Hawke's Bay region    3748
4      177.    -39.5 Hawke's Bay region    4782
5      177.    -38.0 Bay of Plenty region  2203
6      178.    -38.7 Gisborne region       3071</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the word region in region column then trim white space</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">str_trim</span>(<span class="fu">str_remove</span>(region, <span class="fu">regex</span>(<span class="st">"region"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))))</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(airdata<span class="sc">$</span>region, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "West Coast" "West Coast" "West Coast"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>official_nz_regions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Northland"</span>, <span class="st">"Auckland"</span>, <span class="st">"Waikato"</span>, <span class="st">"Bay of Plenty"</span>, <span class="st">"Gisborne"</span>, <span class="st">"Hawke's Bay"</span>, <span class="st">"Taranaki"</span>, <span class="st">"Manawatu-Whanganui"</span>, <span class="st">"Wellington"</span>, <span class="st">"Tasman"</span>, <span class="st">"Nelson"</span>, <span class="st">"Marlborough"</span>, <span class="st">"West Coast"</span>, <span class="st">"Canterbury"</span>, <span class="st">"Otago"</span>, <span class="st">"Southland"</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview regions in airdata not in the official list of NZ regions</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(region <span class="sc">%in%</span> official_nz_regions)) <span class="sc">|&gt;</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  region                 n
  &lt;chr&gt;              &lt;int&gt;
1 Manawatū-Whanganui  6538</code></pre>
</div>
</div>
<p>We need to clean Manawatu-Whanganui region. It has bar on top of u in Manawatu.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean region name Manawatu-Whanganui</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span> </span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">ifelse</span>(region <span class="sc">==</span> <span class="st">"Manawatū-Whanganui"</span>, <span class="st">"Manawatu-Whanganui"</span>, region))</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute total concentration of groups of coordinates and region</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>region_airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="fu">round</span>(longitude, <span class="dv">5</span>), </span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="fu">round</span>(latitude, <span class="dv">5</span>),</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_conc =</span> <span class="fu">sum</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(region_airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [232,293 × 4] (S3: tbl_df/tbl/data.frame)
 $ region    : chr [1:232293] "Auckland" "Auckland" "Auckland" "Auckland" ...
 $ longitude : num [1:232293] 175 175 175 175 175 ...
 $ latitude  : num [1:232293] -36.9 -36.9 -36.9 -36.9 -36.9 ...
 $ total_conc: num [1:232293] 318149 318149 318149 318149 318149 ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count location coordinates </span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>region_airdata <span class="sc">|&gt;</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">"Wellington"</span>) <span class="sc">|&gt;</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(longitude, latitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  longitude latitude     n
      &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
1      175.    -41.3  5666
2      175.    -41.2  2892
3      175.    -41.3  5776
4      175.    -41.1  2897
5      176.    -41.0  5663
6      176.    -41.0  4388</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect coordinates and region for labelling</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>label_text <span class="ot">&lt;-</span> region_airdata <span class="sc">|&gt;</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, total_conc) <span class="sc">|&gt;</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="fu">min</span>(longitude), <span class="at">latitude =</span> <span class="fu">min</span>(latitude),</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(label_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [15 × 4] (S3: tbl_df/tbl/data.frame)
 $ region    : chr [1:15] "Auckland" "Bay of Plenty" "Canterbury" "Gisborne" ...
 $ total_conc: num [1:15] 318149 317754 643087 47055 166544 ...
 $ longitude : num [1:15] 175 176 171 178 177 ...
 $ latitude  : num [1:15] -37.2 -38.1 -44.7 -38.7 -39.6 ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Get New Zealand map</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>nz_map <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">country =</span> <span class="st">"New Zealand"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot monitoring sites locatioms colored total concentration by region</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> nz_map) <span class="sc">+</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">fill =</span> <span class="st">"gray95"</span>, <span class="at">color =</span> <span class="st">"gray80"</span>) <span class="sc">+</span>  <span class="co"># Basemap</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> region_airdata, </span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">color =</span> total_conc), <span class="at">size =</span> <span class="dv">5</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> label_text, <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">label =</span> region, <span class="at">color =</span> total_conc),</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">box.padding =</span> <span class="fl">0.3</span>, <span class="at">segment.color =</span> <span class="st">"grey30"</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">trans =</span> <span class="st">"log10"</span>,</span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_scientific</span>()) <span class="sc">+</span></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">165</span>, <span class="dv">180</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">48</span>, <span class="sc">-</span><span class="dv">34</span>)) <span class="sc">+</span> <span class="co"># Add coord_sf to zoom in to nz</span></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Total Region Pollutant concentrations from Monitoring Sites locations in New Zealand"</span>,</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Longitude"</span>,</span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Latitude"</span>,</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Total Pollutant</span><span class="sc">\n</span><span class="st">Concentration (µg/m³)"</span></span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span>  <span class="co"># Add title</span></span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>) <span class="sc">+</span>  <span class="co"># Adds scale bar</span></span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tl"</span>, <span class="at">which_north =</span> <span class="st">"true"</span>, <span class="at">style =</span> <span class="fu">north_arrow_fancy_orienteering</span>())</span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Save map as PDF</span></span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot, <span class="at">width=</span><span class="dv">12</span>, <span class="at">height=</span><span class="dv">6</span>)</span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a>plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/map-lawa-total-concentration-by-region-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save RAM</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(region_airdata)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(nz_map)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Areas such as Auckland and Canterbury exhibit higher overall pollution levels, likely due to urban density, traffic emissions, and industrial activities. The more rural regions like Gisbourne appear in cooler colors, indicating lower concentrations.</p>
</section>
</section>
<section id="load-2018-population-data-and-regional-map-data-from-stats-nz" class="level2 tabset" data-number="4">
<h2 class="tabset anchored" data-number="4" data-anchor-id="load-2018-population-data-and-regional-map-data-from-stats-nz"><span class="header-section-number">4</span> Load 2018 population data and regional map data from Stats NZ</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the spatial data (GeoPackage) for SA2 regions</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>sa2_nz <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/SA2_nz.gpkg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `SA2_NZ' from data source 
  `C:\Users\vishal\Documents\Earthsci705\projectfile\project\data\SA2_NZ.gpkg' 
  using driver `GPKG'
Simple feature collection with 2151 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 1089970 ymin: 4747987 xmax: 2470102 ymax: 6194308
Projected CRS: NZGD2000 / New Zealand Transverse Mercator 2000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the spatial data structure</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(sa2_nz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,151
Columns: 4
$ SA2_Name &lt;chr&gt; "North Cape", "Rangaunu Harbour", "Karikari Peninsula", "Tang…
$ SA2_ID   &lt;int&gt; 100100, 100200, 100400, 100500, 102100, 102200, 102300, 10240…
$ Pop2018  &lt;int&gt; 1660, 2410, 1300, 1180, 1290, 2200, 1290, 1550, 900, 1760, 11…
$ geom     &lt;MULTIPOLYGON [m]&gt; MULTIPOLYGON (((1596201 615..., MULTIPOLYGON (((…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The SA2_NZ layer was read from a GeoPackage file using the GPKG driver. It contains 2,151 features with three attribute fields and multipolygon geometries in the NZGD2000 Transverse Mercator projection.</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load regional map data from [regions](https://datafinder.stats.govt.nz/layer/104254-regional-council-2020-generalised/)</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load a shape file of regions</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>regions <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/statsnz-regional-council-2020-generalised-SHP/regional-council-2020-generalised.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `regional-council-2020-generalised' from data source 
  `C:\Users\vishal\Documents\Earthsci705\projectfile\project\data\statsnz-regional-council-2020-generalised-SHP\regional-council-2020-generalised.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 17 features and 6 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 1067061 ymin: 4701317 xmax: 2523320 ymax: 6242140
Projected CRS: NZGD2000 / New Zealand Transverse Mercator 2000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(regions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 17
Columns: 7
$ REGC2020_V &lt;chr&gt; "02", "03", "04", "05", "06", "07", "08", "09", "12", "13",…
$ REGC2020_1 &lt;chr&gt; "Auckland Region", "Waikato Region", "Bay of Plenty Region"…
$ REGC2020_2 &lt;chr&gt; "Auckland Region", "Waikato Region", "Bay of Plenty Region"…
$ LAND_AREA_ &lt;dbl&gt; 4941.0723, 23900.3640, 12071.8091, 8385.3265, 14138.0113, 7…
$ AREA_SQ_KM &lt;dbl&gt; 16156.206, 34888.831, 21883.748, 13989.051, 21444.166, 1269…
$ SHAPE_Leng &lt;dbl&gt; 660973.5, 1268419.5, 1093733.7, 695917.9, 928783.7, 564431.…
$ geometry   &lt;MULTIPOLYGON [m]&gt; MULTIPOLYGON (((1745493 600..., MULTIPOLYGON (…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The regional-council-2020-generalised layer, read from an ESRI Shapefile, contains 17 multipolygon features representing New Zealand's regional councils. It includes six attribute fields and uses the NZGD2000 Transverse Mercator projected coordinate system for spatial reference.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="spatial-join-of-datasets-population-and-region" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="spatial-join-of-datasets-population-and-region"><span class="header-section-number">4.1</span> Spatial join of datasets: population and region</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find values from regions columns which does not match</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(regions) <span class="sc">|&gt;</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(REGC2020_1 <span class="sc">!=</span> REGC2020_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  REGC2020_V                REGC2020_1                REGC2020_2 LAND_AREA_
1         08 Manawatū-Whanganui Region Manawatu-Whanganui Region   22220.58
  AREA_SQ_KM SHAPE_Leng                       geometry
1   25322.14    1176349 MULTIPOLYGON (((1823327 573...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The two columns are different for Manawatu, which has a bar on top in one and the REGC2020_2 does not. Let's select REGC2020_2.</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure both layers are in same CRS</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(sa2_nz)<span class="sc">$</span>epsg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2193</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(regions)<span class="sc">$</span>epsg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2193</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># They are same, both sa2_nz and regions datasets are in crs of epsg:2193</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform a spatial join to assign each SA2 to a region</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>sa2_nz <span class="ot">&lt;-</span> <span class="fu">st_join</span>(sa2_nz, regions[, <span class="fu">c</span>(<span class="st">"REGC2020_2"</span>, <span class="st">"geometry"</span>)]) </span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview column names of sa2_nz</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sa2_nz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SA2_Name"   "SA2_ID"     "Pop2018"    "REGC2020_2" "geom"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 5 columns of SA2_Name, SA2_ID, Pop2018, REGC2020_2, and geom </span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Count added regions</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="fu">st_drop_geometry</span>(sa2_nz) <span class="sc">|&gt;</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(REGC2020_2) <span class="sc">|&gt;</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   17 obs. of  1 variable:
 $ REGC2020_2: chr  "Northland Region" "Auckland Region" "Bay of Plenty Region" "Taranaki Region" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The column contains 17 distinct regions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform the coordinate reference system (CRS) of sa2_nz to WGS84</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>sa2_nz <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(sa2_nz, <span class="at">crs =</span> <span class="dv">4326</span>)  </span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(sa2_nz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,332
Columns: 5
$ SA2_Name   &lt;chr&gt; "North Cape", "Rangaunu Harbour", "Karikari Peninsula", "Ta…
$ SA2_ID     &lt;int&gt; 100100, 100200, 100400, 100500, 102100, 102200, 102300, 102…
$ Pop2018    &lt;int&gt; 1660, 2410, 1300, 1180, 1290, 2200, 1290, 1550, 900, 1760, …
$ REGC2020_2 &lt;chr&gt; "Northland Region", "Northland Region", "Northland Region",…
$ geom       &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((172.9585 -3..., MULTIPOLYGON (…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This dataset includes 2,332 rows with SA2 names, IDs, 2018 population data, regional council names, and multipolygon geometries, representing spatial boundaries for statistical areas across New Zealand.</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check class of geom</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(sa2_nz<span class="sc">$</span>geom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sfc_MULTIPOLYGON" "sfc"             </code></pre>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The geom column in sa2_nz is of class sfc_MULTIPOLYGON, meaning it stores spatial features as multipolygons using the simple features (sf) framework for geospatial vector data in R.</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean column names of sa2_nz </span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>sa2_nz <span class="ot">&lt;-</span> sa2_nz <span class="sc">|&gt;</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="co"># View column names of sa2_nz</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sa2_nz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sa2_name"   "sa2_id"     "pop2018"    "regc2020_2" "geom"      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview names of geographical units</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_drop_geometry</span>(sa2_nz) <span class="sc">|&gt;</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   2151 obs. of  1 variable:
 $ sa2_name: chr  "North Cape" "Rangaunu Harbour" "Karikari Peninsula" "Tangonge" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 2151 distinct sa2_name in the dataset sa2_nz</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="co"># View distinct region in sa2_nz</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(sa2_nz) <span class="sc">|&gt;</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(regc2020_2) <span class="sc">|&gt;</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 17
Columns: 1
$ regc2020_2 &lt;chr&gt; "Northland Region", "Auckland Region", "Bay of Plenty Regio…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 17 distinct region in the sa2_nz dataset</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename region column and remove region from values</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>sa2_nz <span class="ot">&lt;-</span> sa2_nz <span class="sc">|&gt;</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">region =</span> regc2020_2) <span class="sc">|&gt;</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">str_trim</span>(<span class="fu">str_remove</span>(region, <span class="fu">regex</span>(<span class="st">"region"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))))</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(sa2_nz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,332
Columns: 5
$ sa2_name &lt;chr&gt; "North Cape", "Rangaunu Harbour", "Karikari Peninsula", "Tang…
$ sa2_id   &lt;int&gt; 100100, 100200, 100400, 100500, 102100, 102200, 102300, 10240…
$ pop2018  &lt;int&gt; 1660, 2410, 1300, 1180, 1290, 2200, 1290, 1550, 900, 1760, 11…
$ region   &lt;chr&gt; "Northland", "Northland", "Northland", "Northland", "Northlan…
$ geom     &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((172.9585 -3..., MULTIPOLYGON (((…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate centroids of geometry polygons</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>sa2_centroids <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(sa2_nz)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview first few rows</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(sa2_centroids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,332
Columns: 5
$ sa2_name &lt;chr&gt; "North Cape", "Rangaunu Harbour", "Karikari Peninsula", "Tang…
$ sa2_id   &lt;int&gt; 100100, 100200, 100400, 100500, 102100, 102200, 102300, 10240…
$ pop2018  &lt;int&gt; 1660, 2410, 1300, 1180, 1290, 2200, 1290, 1550, 900, 1760, 11…
$ region   &lt;chr&gt; "Northland", "Northland", "Northland", "Northland", "Northlan…
$ geom     &lt;POINT [°]&gt; POINT (172.9301 -34.61058), POINT (173.1995 -34.9607), …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sa2_centroids has 2332 rows with 5 columns, geom column is of point type</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract longitude and latitude from centroids</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>sa2_centroids <span class="ot">&lt;-</span> sa2_centroids <span class="sc">|&gt;</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="fu">st_coordinates</span>(geom)[, <span class="dv">1</span>],</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="fu">st_coordinates</span>(geom)[, <span class="dv">2</span>])</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(sa2_centroids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,332
Columns: 7
$ sa2_name  &lt;chr&gt; "North Cape", "Rangaunu Harbour", "Karikari Peninsula", "Tan…
$ sa2_id    &lt;int&gt; 100100, 100200, 100400, 100500, 102100, 102200, 102300, 1024…
$ pop2018   &lt;int&gt; 1660, 2410, 1300, 1180, 1290, 2200, 1290, 1550, 900, 1760, 1…
$ region    &lt;chr&gt; "Northland", "Northland", "Northland", "Northland", "Northla…
$ geom      &lt;POINT [°]&gt; POINT (172.9301 -34.61058), POINT (173.1995 -34.9607),…
$ longitude &lt;dbl&gt; 172.9301, 173.1995, 173.3659, 173.1831, 173.4844, 173.8903, …
$ latitude  &lt;dbl&gt; -34.61058, -34.96070, -34.92885, -35.15506, -35.46800, -35.1…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now there are two more columns of longitude and latitude of double type</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by region and slice minimum location and preserve geometry</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>label_text <span class="ot">&lt;-</span> sa2_centroids <span class="sc">|&gt;</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(<span class="at">order_by =</span> longitude <span class="sc">+</span> latitude, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> <span class="co"># Sum ensures SW-most</span></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(region, longitude, latitude)</span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(label_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 17
Columns: 4
$ region    &lt;chr&gt; "Area Outside", "Auckland", "Bay of Plenty", "Canterbury", "…
$ longitude &lt;dbl&gt; -176.5269, 174.7283, 175.9479, 169.2815, 176.7677, 176.3104,…
$ latitude  &lt;dbl&gt; -43.93630, -37.25538, -39.05760, -44.94244, -38.45032, -40.5…
$ geom      &lt;POINT [°]&gt; POINT (-176.5269 -43.9363), POINT (174.7283 -37.25538)…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Label_text contains 17 rows of regions with minimum longitude, minimum latitude, geometry column of point type</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview class</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(label_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The object label_text is a spatial data frame of class sf, meaning it contains geospatial features along with attribute data, making it compatible with tidyverse and spatial analysis functions.</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check coordinate reference system are same</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(sa2_nz) <span class="sc">==</span> <span class="fu">st_crs</span>(label_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Classes of datasets: sa2_nz and label_text are same</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group and merge SA2 polygons by region to get region-level boundaries and region total population</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>region_boundaries <span class="ot">&lt;-</span> sa2_nz <span class="sc">|&gt;</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop =</span> <span class="fu">sum</span>(pop2018),</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">geometry =</span> <span class="fu">st_union</span>(geom), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a glimpse</span></span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(region_boundaries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 17
Columns: 3
$ region    &lt;chr&gt; "Area Outside", "Auckland", "Bay of Plenty", "Canterbury", "…
$ total_pop &lt;int&gt; 690, 1667670, 350600, 641650, 57340, 181840, 273240, 60040, …
$ geometry  &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-176.5709 -..., MULTIPOLYGON ((…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The region_boundaries dataset contains 17 regions with total population and multipolygon geometries. It uses the WGS 84 geodetic coordinate system and covers New Zealand's full extent, making it suitable for spatial analysis and regional population visualization.</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot region population with both SA2 polygons and region boundaries</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>plot_spatial <span class="ot">&lt;-</span> <span class="cf">function</span>(data, fill_var) {</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data) <span class="sc">+</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> {{ fill_var }}), <span class="at">color =</span> <span class="st">"#999999"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span>  <span class="co"># SA2 polygons</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text_repel</span>(</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> label_text,</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">label =</span> region),</span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>,</span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">12</span>  <span class="co"># Ensures reproducible label placement</span></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">165</span>, <span class="dv">180</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">48</span>, <span class="sc">-</span><span class="dv">34</span>)) <span class="sc">+</span></span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis_c</span>(</span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">option =</span> <span class="st">"turbo"</span>, </span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_scientific</span>()</span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>,</span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">"Population (2018)"</span></span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_north_arrow</span>(</span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">location =</span> <span class="st">"tl"</span>, <span class="at">which_north =</span> <span class="st">"true"</span>,</span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="fu">north_arrow_fancy_orienteering</span>())</span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb134-28"><a href="#cb134-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-29"><a href="#cb134-29" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">plot_spatial</span>(sa2_nz, pop2018) <span class="sc">+</span></span>
<span id="cb134-30"><a href="#cb134-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"SA2 Population"</span>) </span>
<span id="cb134-31"><a href="#cb134-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-32"><a href="#cb134-32" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot_spatial</span>(region_boundaries, total_pop) <span class="sc">+</span> </span>
<span id="cb134-33"><a href="#cb134-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Region Population"</span>) </span>
<span id="cb134-34"><a href="#cb134-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-35"><a href="#cb134-35" aria-hidden="true" tabindex="-1"></a>combined_plot <span class="ot">&lt;-</span> plot1 <span class="sc">+</span> plot2 <span class="sc">+</span></span>
<span id="cb134-36"><a href="#cb134-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb134-37"><a href="#cb134-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span><span class="st">"Spatial Distribution of the 2018 Population in SA2 Areas (Left) and Regions (Right) of New Zealand"</span>,</span>
<span id="cb134-38"><a href="#cb134-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"A comparison of population patterns across fine-scale SA2 areas and broader regional boundaries"</span>,</span>
<span id="cb134-39"><a href="#cb134-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb134-40"><a href="#cb134-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb134-41"><a href="#cb134-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb134-42"><a href="#cb134-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>)  <span class="co"># Forces legend to bottom</span></span>
<span id="cb134-43"><a href="#cb134-43" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb134-44"><a href="#cb134-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the plot</span></span>
<span id="cb134-45"><a href="#cb134-45" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, combined_plot, <span class="at">width =</span> <span class="dv">13</span>, <span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb134-46"><a href="#cb134-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-47"><a href="#cb134-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Save RAM</span></span>
<span id="cb134-48"><a href="#cb134-48" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(region_boundaries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These maps compare population distribution in New Zealand at different scales. The SA2 Population map (left) provides detailed insights, highlighting densely populated urban clusters, while the Region Population map (right) aggregates data, emphasizing regional total population concentration. Auckland appears dominant in both maps, though the finer SA2 breakdown reveals local density patterns. The left map’s scale (0–6,000) captures variations within cities, whereas the right map (400,000–1.6 million) focuses on broader regional totals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Explore sa2_nz</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(sa2_nz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sa2_nz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sa2_name" "sa2_id"   "pop2018"  "region"   "geom"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The sa2_nz object is a simple features (sf) spatial data frame containing five columns: sa2_name, sa2_id, pop2018, region, and geom. It includes 2018 population data and multipolygon geometries for each SA2 area in New Zealand.</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Explore airdata</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "region"        "agency"        "lawa_site_id"  "site_name"    
 [5] "site_id"       "latitude"      "longitude"     "town"         
 [9] "site_type"     "indicator"     "date"          "concentration"
[13] "year"         </code></pre>
</div>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The airdata object is a tibble data frame containing air quality data, including region, site details, location, pollutant indicators, concentration values, and corresponding dates and years for analysis.</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert airdata data.frame to sf</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert columns "longitude" and "latitude" to WGS84 (EPSG:4326)</span></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(airdata, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata<span class="sc">$</span>geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sfc_POINT of length 232293; first list element:  'XY' num [1:2] 174.7 -36.9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The geometry column in airdata now contains 232,293 spatial point features in WGS84 coordinates, each representing air monitoring locations with longitude and latitude, starting near Auckland at (174.7, -36.9).</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview region not in airdata region</span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(sa2_nz) <span class="sc">|&gt;</span></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(region <span class="sc">%in%</span> airdata<span class="sc">$</span>region)) <span class="sc">|&gt;</span></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(region) <span class="sc">|&gt;</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        region  n
1 Area Outside  1
2     Taranaki 65</code></pre>
</div>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The region: Area Outside and Taranaki are not in airdata</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Count region, town, site_name</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(airdata) <span class="sc">|&gt;</span></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(region, town, site_name) <span class="sc">|&gt;</span></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 67
Columns: 3
$ region    &lt;chr&gt; "Auckland", "Auckland", "Auckland", "Auckland", "Auckland", …
$ town      &lt;chr&gt; "Glen Eden", "Henderson", "Pakuranga", "Patumahoe", "Penrose…
$ site_name &lt;chr&gt; "Glen Eden", "Henderson", "Pakuranga", "Patumahoe", "Penrose…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 67 distinct region, town, and site_name</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview matching CRS</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(sa2_centroids)<span class="sc">$</span>epsg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4326</code></pre>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(airdata)<span class="sc">$</span>epsg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4326</code></pre>
</div>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Both datasets have same crs epsg of 4326</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview summary</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(sa2_centroids<span class="sc">$</span>geom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sfc_POINT of length 2332; first list element:  'XY' num [1:2] 172.9 -34.6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(airdata<span class="sc">$</span>geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sfc_POINT of length 232293; first list element:  'XY' num [1:2] 174.7 -36.9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sa2_centroids has 2,332 points; airdata has 232,293 points. Both are sfc_POINT with XY coordinates in WGS84.</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview sa2_name in region Waikato</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(sa2_centroids) <span class="sc">|&gt;</span></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">"Waikato"</span>) <span class="sc">|&gt;</span></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 264
Columns: 1
$ sa2_name &lt;chr&gt; "National Park", "Tangiwai", "Tahuroa", "Richmond Downs-Wardv…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co">#There are 264 distinct sa2_name in region: Waikato</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview site_name for region Waikato in airdata</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(airdata) <span class="sc">|&gt;</span></span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">"Waikato"</span>) <span class="sc">|&gt;</span></span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(site_name) <span class="sc">|&gt;</span></span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8
Columns: 1
$ site_name &lt;chr&gt; "Billah Street", "Bloodbank", "Bowling Club", "Claudelands",…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 8 site_name in region: Waikato</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform a spatial join of airdata and sa2_centroids to assign each SA2 to a region</span></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>airdata_with_sa2 <span class="ot">&lt;-</span> <span class="fu">st_join</span>(airdata, sa2_centroids[, <span class="fu">c</span>(<span class="st">"region"</span>, <span class="st">"sa2_name"</span>, <span class="st">"pop2018"</span>, <span class="st">"geom"</span>)], <span class="at">join =</span> st_nearest_feature)</span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview column names </span></span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(airdata_with_sa2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "region.x"      "agency"        "lawa_site_id"  "site_name"    
 [5] "site_id"       "town"          "site_type"     "indicator"    
 [9] "date"          "concentration" "year"          "geometry"     
[13] "region.y"      "sa2_name"      "pop2018"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove columns not needed</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>airdata_with_sa2 <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>region.y, <span class="sc">-</span>town, <span class="sc">-</span>site_id, <span class="sc">-</span>agency, <span class="sc">-</span>site_name) <span class="sc">|&gt;</span></span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">region =</span> region.x)</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(airdata_with_sa2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "region"        "lawa_site_id"  "site_type"     "indicator"    
 [5] "date"          "concentration" "year"          "geometry"     
 [9] "sa2_name"      "pop2018"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save RAM, remove data not needed</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(airdata)</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(sa2_centroids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview summary of concentration</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(airdata_with_sa2<span class="sc">$</span>concentration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
   0.00    6.41   10.50   12.67   16.10  202.80     107 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Concentration ranges from 0 to 202.8, with mean 12.67, median 10.5, and 107 missing values (NA's).</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Use ARIMA imputation to approximate the missing concentration values.</span></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>airdata_with_sa2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(airdata_with_sa2) <span class="sc">|&gt;</span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">arima_concentration =</span> <span class="fu">na_kalman</span>(concentration, <span class="at">model =</span> <span class="st">"auto.arima"</span>))  <span class="co"># ARIMA imputation</span></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(airdata_with_sa2<span class="sc">$</span>arima_concentration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  0.000   6.407  10.494  12.664  16.100 202.800 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All the 107 missing values are now computed using ARIMA and ranges from 0 to 202.8 with a mean of 12.664 and median of 10.494</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="normalize-pollutant-concentration-by-2018-population-and-plot-concentration-per-capita-trends-for-eac-site-type." class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="normalize-pollutant-concentration-by-2018-population-and-plot-concentration-per-capita-trends-for-eac-site-type."><span class="header-section-number">4.2</span> Normalize pollutant concentration by 2018 population and plot concentration per capita trends for eac site type.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute total daily pollutant concentrations</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_type_indicator =</span> <span class="fu">paste0</span>(site_type, <span class="st">"_"</span>, indicator)) <span class="sc">|&gt;</span></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, site_type_indicator, site_type, indicator, date, sa2_name, pop2018) <span class="sc">|&gt;</span></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_conc =</span> <span class="fu">sum</span>(arima_concentration),</span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary statistics</span></span>
<span id="cb172-11"><a href="#cb172-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata<span class="sc">$</span>total_conc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00    6.40   10.47   12.87   16.16  202.80 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># total_conc ranges from 0 to 202.8, with mean 12.87, median 10.47.</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate daily concentration per pop2018 </span></span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">conc_per_capita =</span> total_conc <span class="sc">/</span> pop2018 )</span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the new column</span></span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata<span class="sc">$</span>conc_per_capita)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
0.000000 0.002628 0.004437 0.007249 0.007542 0.486536 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co"># conc_per_pop18 ranges from 0 to 0.486536 with a mean of 0.007249 and a median of 0.004437</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define function for pollutant trends. This function takes a data frame and plot labels as inputs, and returns a line chart with customised colours for indicators.</span></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(daily_airdata, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> conc_per_capita)) <span class="sc">+</span></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"#999999"</span>) <span class="sc">+</span></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"linear"</span>), <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"gam"</span>), <span class="at">method =</span> <span class="st">"gam"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> site_type_indicator, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Trend"</span>,  <span class="co"># Legend title</span></span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"linear"</span> <span class="ot">=</span> <span class="st">"#CC79A7"</span>, <span class="st">"gam"</span> <span class="ot">=</span> <span class="st">"#56B4E9"</span>)</span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb176-14"><a href="#cb176-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb176-15"><a href="#cb176-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Daily Pollutant Concentration Per Capita Trends by Site Type and Indicator"</span>,</span>
<span id="cb176-16"><a href="#cb176-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Concentration per 2018 population with trend lines (ARIMA-smoothed)"</span>,</span>
<span id="cb176-17"><a href="#cb176-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb176-18"><a href="#cb176-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">expression</span>(<span class="st">"Concentration (µg/m"</span><span class="sc">^</span><span class="dv">3</span><span class="sc">*</span><span class="st">") per capita"</span>)</span>
<span id="cb176-19"><a href="#cb176-19" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb176-20"><a href="#cb176-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb176-21"><a href="#cb176-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb176-22"><a href="#cb176-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb176-23"><a href="#cb176-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb176-24"><a href="#cb176-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb176-25"><a href="#cb176-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb176-26"><a href="#cb176-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb176-27"><a href="#cb176-27" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/calculate-conc-per-pop2018-and-plot-pollution-trends-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, p, <span class="at">width =</span> <span class="dv">12</span>, <span class="at">height =</span> <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The plots show daily pollutant concentration per capita trends across various site types and indicators from 2016 to 2024. All panels display point clouds with overlaid smoothed trend lines: blue (GAM) and purple (linear). Trends vary by pollutant and site type—some panels (e.g., “Residential_PM2.5”) show clear seasonal peaks, while others (e.g., “Traffic, NES site_PM10”) reveal flatter trends. Linear and GAM lines often diverge, indicating non-linearity. High variability and density patterns are especially notable in traffic and industrial sites, suggesting persistent emissions across time.</p>
</section>
<section id="seasonal-trends-in-pollutant-concentration-by-site-type" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="seasonal-trends-in-pollutant-concentration-by-site-type"><span class="header-section-number">4.3</span> Seasonal Trends in Pollutant Concentration by Site Type</h3>
<p>Visualizing pollutant concentration per capita across seasons and site types, highlighting PM10 and PM2.5 variations, seasonal peaks, and site-specific dispersion dynamics from 2016 to 2023.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate daily air quality data into seasonal trends</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>seasondata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(date, <span class="st">"%y"</span>)),</span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">season =</span> <span class="fu">case_when</span>(</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">month</span>(date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">~</span> <span class="st">"Sum"</span>, <span class="co"># Summer</span></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">month</span>(date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">~</span> <span class="st">"Aut"</span>, <span class="co"># Autumn</span></span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">month</span>(date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>) <span class="sc">~</span> <span class="st">"Win"</span>, <span class="co"># Winter</span></span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">month</span>(date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>) <span class="sc">~</span> <span class="st">"Spr"</span>, <span class="co"># Spring</span></span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span>),</span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">season =</span> <span class="fu">factor</span>(season, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Sum"</span>, <span class="st">"Aut"</span>, <span class="st">"Win"</span>, <span class="st">"Spr"</span>)),</span>
<span id="cb178-12"><a href="#cb178-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">season_year =</span> <span class="fu">paste0</span>(season, year),</span>
<span id="cb178-13"><a href="#cb178-13" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Use this to sort by season-year properly</span></span>
<span id="cb178-14"><a href="#cb178-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">season_year =</span> <span class="fu">factor</span>(season_year, </span>
<span id="cb178-15"><a href="#cb178-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="fu">unique</span>(season_year[<span class="fu">order</span>(year, season)])))</span>
<span id="cb178-16"><a href="#cb178-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-17"><a href="#cb178-17" aria-hidden="true" tabindex="-1"></a>sitedata <span class="ot">&lt;-</span> seasondata <span class="sc">|&gt;</span></span>
<span id="cb178-18"><a href="#cb178-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season_year, year, site_type, indicator) <span class="sc">|&gt;</span></span>
<span id="cb178-19"><a href="#cb178-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb178-20"><a href="#cb178-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_conc_per_capita =</span> <span class="fu">sum</span>(conc_per_capita, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb178-21"><a href="#cb178-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb178-22"><a href="#cb178-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-23"><a href="#cb178-23" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(seasondata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 228,625
Columns: 12
$ region              &lt;chr&gt; "Auckland", "Auckland", "Auckland", "Auckland", "A…
$ site_type_indicator &lt;chr&gt; "Residential, Industrial, NES site_PM10", "Residen…
$ site_type           &lt;chr&gt; "Residential, Industrial, NES site", "Residential,…
$ indicator           &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "P…
$ date                &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-06, 2016-01-23, 2…
$ sa2_name            &lt;chr&gt; "Ellerslie South", "Ellerslie South", "Ellerslie S…
$ pop2018             &lt;int&gt; 2720, 2720, 2720, 2720, 2720, 2720, 2720, 2720, 27…
$ total_conc          &lt;dbl&gt; 15.8, 11.2, 11.9, 8.7, 9.8, 9.1, 14.1, 6.8, 8.9, 7…
$ conc_per_capita     &lt;dbl&gt; 0.005808824, 0.004117647, 0.004375000, 0.003198529…
$ year                &lt;dbl&gt; 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16…
$ season              &lt;fct&gt; Sum, Sum, Sum, Sum, Sum, Sum, Sum, Sum, Sum, Sum, …
$ season_year         &lt;fct&gt; Sum16, Sum16, Sum16, Sum16, Sum16, Sum16, Sum16, S…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the heatmap of seasondata</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sitedata, <span class="fu">aes</span>(<span class="at">x =</span> season_year, <span class="at">y =</span> site_type, <span class="at">fill =</span> total_conc_per_capita)) <span class="sc">+</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"grey90"</span>) <span class="sc">+</span></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> indicator) <span class="sc">+</span></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"C"</span>,</span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"Total Concentration</span><span class="sc">\n</span><span class="st">(per capita, 2018 pop)"</span>) <span class="sc">+</span></span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Heatmap of Seasonal Pollutant Concentration Per Capita (2016-2023)"</span>,</span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Summed by site type and season, normalized by 2018 population"</span>,</span>
<span id="cb180-10"><a href="#cb180-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Season-Year"</span>, <span class="at">y =</span> <span class="st">"Site Type"</span>) <span class="sc">+</span></span>
<span id="cb180-11"><a href="#cb180-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb180-12"><a href="#cb180-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb180-13"><a href="#cb180-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb180-14"><a href="#cb180-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb180-15"><a href="#cb180-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb180-16"><a href="#cb180-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb180-17"><a href="#cb180-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb180-18"><a href="#cb180-18" aria-hidden="true" tabindex="-1"></a>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/seasonal-pollution-by-site-type-heatmap-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, p2, <span class="at">width =</span> <span class="dv">12</span>, <span class="at">height =</span> <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The heatmap shows PM10 concentrations generally higher than PM2.5 across most site types and seasons from 2016–2023. PM10 peaks prominently at “Residential, NES site” and “Residential, Traffic, Industrial, Coastal, NES site”, reaching values above 30. PM2.5 values remain mostly below 10, with modest elevations at residential sites. Missing data patterns differ slightly between the two pollutants, notably in residential-industrial combinations.</p>
</section>
<section id="regional-trends-in-seasonal-per-capita-pollutant-concentration-20162023" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="regional-trends-in-seasonal-per-capita-pollutant-concentration-20162023"><span class="header-section-number">4.4</span> Regional Trends in Seasonal Per Capita Pollutant Concentration (2016–2023)</h3>
<p>This heatmap shows seasonal per capita pollutant concentrations across regions (2016–2023), helping identify spatial and temporal pollution trends.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate seasonal data to region</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>regiondata <span class="ot">&lt;-</span> seasondata <span class="sc">|&gt;</span></span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, season_year, year, indicator) <span class="sc">|&gt;</span></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_conc_per_capita =</span> <span class="fu">sum</span>(conc_per_capita, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(regiondata<span class="sc">$</span>total_conc_per_capita)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
 0.003854  0.516080  1.029960  1.991850  2.228748 19.300111 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This shows the summary statistics of a dataset, indicating a right-skewed distribution with a mean (1.99) higher than the median (1.03) and a maximum value of 19.3.</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the heatmap</span></span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(regiondata, <span class="fu">aes</span>(<span class="at">x =</span> season_year, <span class="at">y =</span> region, <span class="at">fill =</span> total_conc_per_capita)) <span class="sc">+</span></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"grey90"</span>) <span class="sc">+</span></span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add lockdown marker (assuming x-axis is a factor or character)</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">which</span>(<span class="fu">levels</span>(<span class="fu">factor</span>(regiondata<span class="sc">$</span>season_year)) <span class="sc">==</span> <span class="st">"Aut20"</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#E69F00"</span>, <span class="at">lwd =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> indicator) <span class="sc">+</span></span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_continuous_sequential</span>(</span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"Mint"</span>, <span class="at">name =</span> <span class="st">"Total Concentration</span><span class="sc">\n</span><span class="st">(per capita, 2018 pop)"</span>, <span class="at">rev =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Air Pollution per Capita Across NZ Regions (2016–2023)"</span>,</span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Summed pollutant concentrations by region and season (normalized by 2018 population), with COVID-19 lockdown marked (in orange)"</span>,</span>
<span id="cb184-14"><a href="#cb184-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Season-Year"</span>, <span class="at">y =</span> <span class="st">"Region"</span>) <span class="sc">+</span></span>
<span id="cb184-15"><a href="#cb184-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb184-16"><a href="#cb184-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb184-17"><a href="#cb184-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb184-18"><a href="#cb184-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb184-19"><a href="#cb184-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb184-20"><a href="#cb184-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb184-21"><a href="#cb184-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-22"><a href="#cb184-22" aria-hidden="true" tabindex="-1"></a>p1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/seasonal-pollution-by-region-heatmap-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, p1, <span class="at">width =</span> <span class="dv">12</span>, <span class="at">height =</span> <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The PM10 plot shows consistently higher concentrations across regions, while PM2.5 exhibits more variability with lower overall levels. Seasonal patterns are evident in both, but PM10 peaks are more pronounced. COVID-19 lockdowns affected both pollutants, with sharper declines in PM2.5. Regional disparities are stronger in PM10, highlighting differences in pollution dynamics and sources. The PM2.5 plot has more white spaces, indicating lower concentrations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata_with_sa2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 232,293
Columns: 11
$ region              &lt;chr&gt; "Auckland", "Auckland", "Auckland", "Auckland", "A…
$ lawa_site_id        &lt;chr&gt; "LAWA-100059", "LAWA-100059", "LAWA-100059", "LAWA…
$ site_type           &lt;chr&gt; "Residential, NES site", "Residential, NES site", …
$ indicator           &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "P…
$ date                &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2…
$ concentration       &lt;dbl&gt; 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2…
$ year                &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2…
$ geometry            &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -3…
$ sa2_name            &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Ed…
$ pop2018             &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 37…
$ arima_concentration &lt;dbl&gt; 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview repeating geometry last few rows</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sa2_name, geometry, pop2018) <span class="sc">|&gt;</span></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            sa2_name                   geometry pop2018    n
61        Washington POINT (173.2735 -41.27823)    2990 5066
62     Waterloo West POINT (174.9209 -41.21261)    2370 2892
63          Westlake POINT (174.7489 -36.78031)    3120 5493
64 Whangarei Central POINT (174.3242 -35.72673)    1000 5524
65            Winton POINT (168.3235 -46.14758)    2400 1379
66    Woolston South POINT (172.6813 -43.55716)     530 5809</code></pre>
</div>
</div>
</section>
<section id="comparing-total-and-per-capita-air-pollutant-concentrations-for-2018" class="level3" data-number="4.5">
<h3 data-number="4.5" class="anchored" data-anchor-id="comparing-total-and-per-capita-air-pollutant-concentrations-for-2018"><span class="header-section-number">4.5</span> Comparing Total and Per Capita Air Pollutant Concentrations for 2018</h3>
<p>To ensure consistency, we focus on 2018—the year for which both pollutant and population data are available. We aggregate total pollutant concentrations by SA2 regions and compute per capita values using 2018 population figures. Spatial visualisations then highlight the distribution of PM2.5 and PM10 levels across New Zealand, both in total and per person.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter 2018 data and summarise total pollutant concentration by SA2, indicator, and population</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>airdata_group <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2018</span>) <span class="sc">|&gt;</span></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name, geometry, indicator, pop2018) <span class="sc">|&gt;</span></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_conc18 =</span> <span class="fu">sum</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Display structure of the summarised dataset (86 rows x 5 columns)</span></span>
<span id="cb190-10"><a href="#cb190-10" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 86
Columns: 5
$ sa2_name     &lt;chr&gt; "Alexandra South", "Allandale", "Arrowtown", "Bird Area",…
$ geometry     &lt;POINT [°]&gt; POINT (169.3903 -45.25485), POINT (176.9812 -37.960…
$ indicator    &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM2.5", …
$ pop2018      &lt;int&gt; 2710, 2610, 2970, 2310, 2940, 2230, 2230, 2210, 3220, 322…
$ total_conc18 &lt;dbl&gt; 5114.2000, 4258.1750, 6292.2000, 3976.0280, 3072.2500, 50…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate per capita pollutant concentration for each SA2</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>airdata_group <span class="ot">&lt;-</span> airdata_group <span class="sc">|&gt;</span></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">conc_per_capita18 =</span> total_conc18 <span class="sc">/</span> pop2018)</span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure airdata_group is an sf (spatial features) object</span></span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a>airdata_group <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(airdata_group)</span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarise distribution of per capita concentrations</span></span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(airdata_group<span class="sc">$</span>conc_per_capita18)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
 0.07344  1.19984  1.72504  2.15444  2.47601 11.94561 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Per capita PM10 concentration ranges from 0.07 to 11.95, with a median of 1.73 and a mean of 2.15.</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare label data: unique combinations of SA2, indicator, concentration values, and geometry</span></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>label_text <span class="ot">&lt;-</span> airdata_group <span class="sc">|&gt;</span></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sa2_name, indicator, total_conc18, conc_per_capita18, geometry) <span class="sc">|&gt;</span></span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>n)</span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Confirm label_text is a dataframe</span></span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(label_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert label_text to an sf object for spatial operations</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>label_text <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(label_text)</span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract longitude and latitude from geometry column for text placement</span></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>label_text<span class="sc">$</span>longitude <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(label_text)[, <span class="dv">1</span>]</span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>label_text<span class="sc">$</span>latitude  <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(label_text)[, <span class="dv">2</span>]</span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarise longitude range — confirms spatial extent within New Zealand</span></span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(label_text<span class="sc">$</span>longitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  168.4   172.6   174.8   174.0   175.7   177.0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarise latitude range — confirms coverage from South to North Island</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(label_text<span class="sc">$</span>latitude) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 -46.43  -43.38  -40.95  -40.49  -37.67  -35.73 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a reusable function to map pollutant concentrations by SA2</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="cf">function</span>(indicator_var, color_var) {</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> sa2_nz) <span class="sc">+</span></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span>  <span class="co"># base map</span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> airdata_group <span class="sc">|&gt;</span> <span class="fu">filter</span>(indicator <span class="sc">==</span> {{indicator_var}}), <span class="fu">aes</span>(<span class="at">color =</span> {{ color_var }}), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text_repel</span>(<span class="at">data =</span> label_text <span class="sc">|&gt;</span> <span class="fu">filter</span>(indicator <span class="sc">==</span> {{indicator_var}}), <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">label =</span> sa2_name), <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">labels =</span>  scales<span class="sc">::</span><span class="fu">label_scientific</span>()) <span class="sc">+</span> </span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">165</span>, <span class="dv">180</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">48</span>, <span class="sc">-</span><span class="dv">34</span>)) <span class="sc">+</span> <span class="co"># Add coord_sf to zoom in to nz</span></span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb200-11"><a href="#cb200-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Longitude"</span>,</span>
<span id="cb200-12"><a href="#cb200-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Latitude"</span>) <span class="sc">+</span></span>
<span id="cb200-13"><a href="#cb200-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb200-14"><a href="#cb200-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb200-15"><a href="#cb200-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb200-16"><a href="#cb200-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb200-17"><a href="#cb200-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.legend =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb200-18"><a href="#cb200-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb200-19"><a href="#cb200-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb200-20"><a href="#cb200-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_north_arrow</span>(</span>
<span id="cb200-21"><a href="#cb200-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">location =</span> <span class="st">"tl"</span>, <span class="at">which_north =</span> <span class="st">"true"</span>,</span>
<span id="cb200-22"><a href="#cb200-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="fu">north_arrow_fancy_orienteering</span>())</span>
<span id="cb200-23"><a href="#cb200-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb200-24"><a href="#cb200-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-25"><a href="#cb200-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Create spatial plots for PM10 and PM2.5 total concentrations (2018)</span></span>
<span id="cb200-26"><a href="#cb200-26" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">plot</span>(<span class="st">"PM10"</span>, total_conc18) <span class="sc">+</span></span>
<span id="cb200-27"><a href="#cb200-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total PM10"</span>, <span class="at">color =</span> <span class="st">"Total (µg/m³)"</span>)</span>
<span id="cb200-28"><a href="#cb200-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-29"><a href="#cb200-29" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot</span>(<span class="st">"PM2.5"</span>, total_conc18) <span class="sc">+</span> </span>
<span id="cb200-30"><a href="#cb200-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total PM2.5"</span>, <span class="at">color =</span> <span class="st">"Total (µg/m³)"</span>)</span>
<span id="cb200-31"><a href="#cb200-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-32"><a href="#cb200-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine plots into one figure with title and subtitle</span></span>
<span id="cb200-33"><a href="#cb200-33" aria-hidden="true" tabindex="-1"></a>combined_plot <span class="ot">&lt;-</span> plot1 <span class="sc">+</span> plot2 <span class="sc">+</span></span>
<span id="cb200-34"><a href="#cb200-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb200-35"><a href="#cb200-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Total PM2.5 and PM10 Concentration Across New Zealand for the Year Ending 2018"</span>,</span>
<span id="cb200-36"><a href="#cb200-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Spatial distribution of cumulative pollutant concentrations by SA2 region"</span>) <span class="sc">&amp;</span></span>
<span id="cb200-37"><a href="#cb200-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb200-38"><a href="#cb200-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb200-39"><a href="#cb200-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb200-40"><a href="#cb200-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-41"><a href="#cb200-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb200-42"><a href="#cb200-42" aria-hidden="true" tabindex="-1"></a>combined_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/aggregate-and-map-pollution-2018-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, combined_plot, <span class="at">width=</span><span class="dv">12</span>, <span class="at">height=</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Air pollution varies across New Zealand, with PM10 and PM2.5 showing distinct spatial patterns. PM10 concentrations, which include coarse and fine particles, are more widespread, while PM2.5—primarily from combustion sources—forms hotspots in urban areas. Regions like Meeanee–Awatoto and Mayfair appear prominently in both datasets, while Ruakaka and Mount Maunganui Central show pollutant-specific trends. The broader spread of PM10 suggests diverse sources, including road dust, whereas PM2.5 aligns with industrial and traffic emissions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create map of per capita PM10 concentrations for 2018</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">plot</span>(<span class="st">"PM10"</span>, conc_per_capita18) <span class="sc">+</span></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"PM10 Per Capita"</span>, <span class="at">color =</span> <span class="st">"Per Capita (µg/m³)"</span>) <span class="sc">+</span> <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>) </span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create map of per capita PM2.5 concentrations for 2018</span></span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot</span>(<span class="st">"PM2.5"</span>, conc_per_capita18) <span class="sc">+</span></span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"PM2.5 Per Capita"</span>, <span class="at">color =</span> <span class="st">"Per Capita (µg/m³)"</span>) <span class="sc">+</span> </span>
<span id="cb202-8"><a href="#cb202-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>) </span>
<span id="cb202-9"><a href="#cb202-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-10"><a href="#cb202-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine both plots with shared title and styling</span></span>
<span id="cb202-11"><a href="#cb202-11" aria-hidden="true" tabindex="-1"></a>per_capita18_plot <span class="ot">&lt;-</span> plot1 <span class="sc">+</span> plot2 <span class="sc">+</span></span>
<span id="cb202-12"><a href="#cb202-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb202-13"><a href="#cb202-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Geospatial Distribution of Air Pollutants Per Capita (2018)"</span>,</span>
<span id="cb202-14"><a href="#cb202-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Comparison of PM10 and PM2.5 concentrations across SA2 regions"</span>) <span class="sc">&amp;</span></span>
<span id="cb202-15"><a href="#cb202-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb202-16"><a href="#cb202-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb202-17"><a href="#cb202-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb202-18"><a href="#cb202-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-19"><a href="#cb202-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot</span></span>
<span id="cb202-20"><a href="#cb202-20" aria-hidden="true" tabindex="-1"></a>per_capita18_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/map-per-capita-pollutants-2018-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, per_capita18_plot, <span class="at">width=</span><span class="dv">12</span>, <span class="at">height=</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Air quality varies across New Zealand, with PM10 and PM2.5 concentrations showing distinct patterns. PM10 levels are higher in Whangarei Central, Gore Main, Taihape and Parkside, while PM2.5 hotspots include Whangarai Central, Kuripuni, Redwoodtown East, and Mount Maunganui Central. PM10 appears more widespread, whereas PM2.5 is more localized in urban areas. These differences matter—PM2.5 particles penetrate deeper into lungs, posing greater health risks. Understanding these trends helps highlight potential environmental influences, such as traffic patterns or meteorological conditions.</p>
</section>
<section id="interactive-map-of-2018-particulate-matter-concentrations-by-sa2-region" class="level3" data-number="4.6">
<h3 data-number="4.6" class="anchored" data-anchor-id="interactive-map-of-2018-particulate-matter-concentrations-by-sa2-region"><span class="header-section-number">4.6</span> Interactive Map of 2018 Particulate Matter Concentrations by SA2 Region</h3>
<p>To enhance spatial interpretation, we created an interactive map showing PM10 and PM2.5 concentrations across New Zealand for 2018. Marker size represents total pollutant concentration (µg/m³), while color intensity indicates per capita exposure (µg/m³/person). This visualization allows users to explore regional air quality disparities in both absolute and population-adjusted terms.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(label_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 86
Columns: 7
$ sa2_name          &lt;chr&gt; "Alexandra South", "Allandale", "Arrowtown", "Bird A…
$ indicator         &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM2…
$ total_conc18      &lt;dbl&gt; 5114.2000, 4258.1750, 6292.2000, 3976.0280, 3072.250…
$ conc_per_capita18 &lt;dbl&gt; 1.8871587, 1.6314847, 2.1185859, 1.7212243, 1.044983…
$ geometry          &lt;POINT [°]&gt; POINT (169.3903 -45.25485), POINT (176.9812 -3…
$ longitude         &lt;dbl&gt; 169.3903, 176.9812, 168.8457, 176.0912, 176.1355, 17…
$ latitude          &lt;dbl&gt; -45.25485, -37.96075, -44.94857, -38.69189, -37.6835…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Plotly map: marker size = total concentration, color = per capita concentration</span></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>interactive_map18 <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(</span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> label_text, <span class="at">type =</span> <span class="st">'scattermapbox'</span>, <span class="at">mode =</span> <span class="st">'markers'</span>,</span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">lat =</span> <span class="sc">~</span>latitude, <span class="at">lon =</span> <span class="sc">~</span>longitude,</span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="cn">NULL</span>, <span class="at">showlegend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="sc">~</span><span class="fu">paste0</span>(<span class="st">"SA2: "</span>, sa2_name,</span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"</span><span class="sc">\n</span><span class="st">Indicator: "</span>, indicator,</span>
<span id="cb206-8"><a href="#cb206-8" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"</span><span class="sc">\n</span><span class="st">Total Concentration: "</span>, total_conc18,</span>
<span id="cb206-9"><a href="#cb206-9" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"</span><span class="sc">\n</span><span class="st">Concentration Per Capita: "</span>, conc_per_capita18),</span>
<span id="cb206-10"><a href="#cb206-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">marker =</span> <span class="fu">list</span>(</span>
<span id="cb206-11"><a href="#cb206-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="sc">~</span>scales<span class="sc">::</span><span class="fu">rescale</span>(total_conc18, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">20</span>)),</span>
<span id="cb206-12"><a href="#cb206-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="sc">~</span>conc_per_capita18, <span class="at">colorscale =</span> <span class="st">'Plasma'</span>,</span>
<span id="cb206-13"><a href="#cb206-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">opacity =</span> <span class="fl">0.8</span>, <span class="at">showscale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb206-14"><a href="#cb206-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">colorbar =</span> <span class="fu">list</span>(</span>
<span id="cb206-15"><a href="#cb206-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Per Capita Conc. (µg/m³/person)"</span>,</span>
<span id="cb206-16"><a href="#cb206-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fl">0.95</span>, <span class="at">xanchor =</span> <span class="st">"left"</span>, <span class="at">len =</span> <span class="fl">0.75</span>)</span>
<span id="cb206-17"><a href="#cb206-17" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">|&gt;</span></span>
<span id="cb206-18"><a href="#cb206-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb206-19"><a href="#cb206-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">list</span>(</span>
<span id="cb206-20"><a href="#cb206-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="fu">paste0</span>(</span>
<span id="cb206-21"><a href="#cb206-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;b&gt;Unified Map of Particulate Matter Concentrations (2018)&lt;/b&gt;&lt;br&gt;"</span>,</span>
<span id="cb206-22"><a href="#cb206-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;span style='font-size:18px;'&gt;Marker Size: Total Concentration (µg/m³),</span></span>
<span id="cb206-23"><a href="#cb206-23" aria-hidden="true" tabindex="-1"></a><span class="st">        Color: Per Capita (µg/m³/person)&lt;/span&gt;"</span>), <span class="at">x =</span> <span class="fl">0.5</span>),</span>
<span id="cb206-24"><a href="#cb206-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapbox =</span> <span class="fu">list</span>(</span>
<span id="cb206-25"><a href="#cb206-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="st">"open-street-map"</span>, <span class="at">zoom =</span> <span class="dv">5</span>,</span>
<span id="cb206-26"><a href="#cb206-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">center =</span> <span class="fu">list</span>(</span>
<span id="cb206-27"><a href="#cb206-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">lat =</span> <span class="fu">median</span>(label_text<span class="sc">$</span>latitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb206-28"><a href="#cb206-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">lon =</span> <span class="fu">median</span>(label_text<span class="sc">$</span>longitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb206-29"><a href="#cb206-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb206-30"><a href="#cb206-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-31"><a href="#cb206-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb206-32"><a href="#cb206-32" aria-hidden="true" tabindex="-1"></a>interactive_map18</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-82c4bd43dd41803d32d7" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-82c4bd43dd41803d32d7">{"x":{"visdat":{"41e04f10354d":["function () ","plotlyVisDat"],"41e033c81e71":["function () ","data"]},"cur_data":"41e033c81e71","attrs":{"41e04f10354d":{"mode":"markers","lat":{},"lon":{},"showlegend":false,"text":{},"marker":{"size":{},"color":{},"colorscale":"Plasma","opacity":0.80000000000000004,"showscale":true,"colorbar":{"title":"Per Capita Conc. (µg/m³/person)","x":0.94999999999999996,"xanchor":"left","len":0.75}},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scattermapbox"},"41e033c81e71":{"mode":"markers","lat":{},"lon":{},"showlegend":false,"text":{},"marker":{"size":{},"color":{},"colorscale":"Plasma","opacity":0.80000000000000004,"showscale":true,"colorbar":{"title":"Per Capita Conc. (µg/m³/person)","x":0.94999999999999996,"xanchor":"left","len":0.75}},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scattermapbox","x":{},"y":{},"_bbox":[168.36991681000001,-46.431928390000003,176.98120116999999,-35.726732210000002],"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":{"text":"<b>Unified Map of Particulate Matter Concentrations (2018)<\/b><br><span style='font-size:18px;'>Marker Size: Total Concentration (µg/m³),<br />        Color: Per Capita (µg/m³/person)<\/span>","x":0.5},"mapbox":{"style":"open-street-map","zoom":5,"center":{"lat":-40.95230652,"lon":174.76880900000003}},"xaxis":{"title":"x"},"yaxis":{"title":"y"},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"mode":"markers","lat":[-45.254852,-37.960750580000003,-44.948571270000002,-38.691894929999997,-37.683528899999999,-40.959198239999999,-40.959198239999999,-45.86909824,-37.777543180000002,-37.777543180000002,-45.190852329999998,-45.045879059999997,-41.121542999999974,-36.904558461006303,-36.904558461006303,-44.100181000449801,-44.100181000449801,-36.922142811073002,-46.106208889999998,-43.912238001285893,-43.912238001285893,-36.8680004511356,-41.267711429999999,-41.267711429999999,-43.384643000579501,-43.384643000579501,-40.95230652,-40.95230652,-43.307540001188499,-43.307540001188499,-41.314170019999999,-38.135818479999998,-38.135818479999998,-39.500164509999998,-39.638873269999998,-39.638873269999998,-39.545889350000003,-39.545889350000003,-37.807709979999998,-46.121327919999999,-37.649612619999999,-37.669638999999997,-37.670021060000003,-37.662139889999999,-37.662139889999999,-37.6434195,-37.6541,-37.66057215,-44.404483000805463,-44.404483000805463,-37.204503610808089,-37.204503610808089,-38.05712209,-36.847430000000003,-36.847430000000003,-41.526639879999998,-41.526639879999998,-42.114231930000003,-41.3395984,-35.894313879999999,-41.281961500000001,-45.871813070000002,-43.511257001057103,-43.511257001057103,-38.221616740000002,-38.221616740000002,-46.431928390000003,-36.905483750710502,-41.295116849999999,-39.677799999999998,-38.886175000000001,-38.33779552,-37.140490550000003,-41.293621999999971,-41.293621999999971,-44.732601001408,-44.732601001408,-41.278229529999997,-41.278229529999997,-41.212606999999899,-36.780305250869901,-36.780305250869901,-35.726732210000002,-35.726732210000002,-43.55715800095718,-43.55715800095718],"lon":[169.390333,176.98120116999999,168.84573717000001,176.09117495000001,176.13549805,175.65321069999999,175.65321069999999,170.51770311000001,175.28715905000001,175.28715905000001,169.32131981000001,169.21000461,175.07034500000009,174.815563500351,174.815563500351,171.24148099998411,171.24148099998411,174.6520009000113,168.93967924,171.7552360004602,171.7552360004602,174.6284,174.95375106,174.95375106,172.65199100072721,172.65199100072721,175.64661441999999,175.64661441999999,172.59526499979901,172.59526499979901,173.23720159999999,176.21420287999999,176.21420287999999,176.89701746,176.85880198000001,176.85880198000001,176.91912704000001,176.91912704000001,175.28036621000001,169.96150159999999,175.53579672000001,176.17971600000001,176.18357850000001,176.1873932,176.1873932,176.1850786,176.1859,176.1691179,171.2496629996013,171.2496629996013,174.86401940002824,174.86401940002824,175.77192840999999,174.76570000000001,174.76570000000001,173.95608203,173.95608203,171.86288712000001,173.18316353,174.45716173,173.29078544999999,170.35672382000001,172.63370500048501,172.63370500048501,175.85843044000001,175.85843044000001,168.36991681000001,174.8904,173.24237590000001,175.80083999999999,175.27104600000001,175.16533762,175.54629323,174.77191800000003,174.77191800000003,171.04992999942601,171.04992999942601,173.27352647999999,173.27352647999999,174.92087600000002,174.74890449976101,174.74890449976101,174.32424642999999,174.32424642999999,172.68127600047541,172.68127600047541],"showlegend":false,"text":["SA2: Alexandra South<br />Indicator: PM10<br />Total Concentration: 5114.2<br />Concentration Per Capita: 1.88715867158672","SA2: Allandale<br />Indicator: PM10<br />Total Concentration: 4258.175<br />Concentration Per Capita: 1.6314846743295","SA2: Arrowtown<br />Indicator: PM10<br />Total Concentration: 6292.2<br />Concentration Per Capita: 2.11858585858586","SA2: Bird Area<br />Indicator: PM10<br />Total Concentration: 3976.02802<br />Concentration Per Capita: 1.72122425108225","SA2: Brookfield East<br />Indicator: PM10<br />Total Concentration: 3072.25<br />Concentration Per Capita: 1.04498299319728","SA2: Cameron and Soldiers Park<br />Indicator: PM10<br />Total Concentration: 5087.39<br />Concentration Per Capita: 2.28134080717489","SA2: Cameron and Soldiers Park<br />Indicator: PM2.5<br />Total Concentration: 3605.64<br />Concentration Per Capita: 1.61687892376682","SA2: Campus South<br />Indicator: PM10<br />Total Concentration: 5350.4<br />Concentration Per Capita: 2.42099547511312","SA2: Claudelands<br />Indicator: PM10<br />Total Concentration: 4195.91194<br />Concentration Per Capita: 1.30307824223602","SA2: Claudelands<br />Indicator: PM2.5<br />Total Concentration: 844.20908<br />Concentration Per Capita: 0.262176732919255","SA2: Clyde<br />Indicator: PM10<br />Total Concentration: 3365<br />Concentration Per Capita: 2.85169491525424","SA2: Cromwell East<br />Indicator: PM10<br />Total Concentration: 3185.2<br />Concentration Per Capita: 1.19744360902256","SA2: Ebdentown<br />Indicator: PM10<br />Total Concentration: 3746.11<br />Concentration Per Capita: 1.45763035019455","SA2: Ellerslie South<br />Indicator: PM10<br />Total Concentration: 5166.8<br />Concentration Per Capita: 1.89955882352941","SA2: Ellerslie South<br />Indicator: PM2.5<br />Total Concentration: 2284.3<br />Concentration Per Capita: 0.839816176470588","SA2: Geraldine<br />Indicator: PM10<br />Total Concentration: 5851.876<br />Concentration Per Capita: 2.12795490909091","SA2: Geraldine<br />Indicator: PM2.5<br />Total Concentration: 3512.952<br />Concentration Per Capita: 1.27743709090909","SA2: Glen Eden Central<br />Indicator: PM10<br />Total Concentration: 4166.3<br />Concentration Per Capita: 1.09928759894459","SA2: Gore Main<br />Indicator: PM10<br />Total Concentration: 6811.45<br />Concentration Per Capita: 5.36334645669291","SA2: Hampstead<br />Indicator: PM10<br />Total Concentration: 5844.644<br />Concentration Per Capita: 1.93531258278146","SA2: Hampstead<br />Indicator: PM2.5<br />Total Concentration: 3269.338<br />Concentration Per Capita: 1.08256225165563","SA2: Henderson Lincoln South<br />Indicator: PM10<br />Total Concentration: 4138.8<br />Concentration Per Capita: 1.53288888888889","SA2: Homedale East<br />Indicator: PM10<br />Total Concentration: 3962.13<br />Concentration Per Capita: 1.25781904761905","SA2: Homedale East<br />Indicator: PM2.5<br />Total Concentration: 2074.36<br />Concentration Per Capita: 0.658526984126984","SA2: Kaiapoi Central<br />Indicator: PM10<br />Total Concentration: 5986.641<br />Concentration Per Capita: 2.69668513513514","SA2: Kaiapoi Central<br />Indicator: PM2.5<br />Total Concentration: 3622.129<br />Concentration Per Capita: 1.63158963963964","SA2: Kuripuni<br />Indicator: PM10<br />Total Concentration: 5048.94<br />Concentration Per Capita: 2.96996470588235","SA2: Kuripuni<br />Indicator: PM2.5<br />Total Concentration: 3473.11<br />Concentration Per Capita: 2.04300588235294","SA2: Lilybrook<br />Indicator: PM10<br />Total Concentration: 5648.284<br />Concentration Per Capita: 1.85189639344262","SA2: Lilybrook<br />Indicator: PM2.5<br />Total Concentration: 2595.197<br />Concentration Per Capita: 0.850884262295082","SA2: Maitlands<br />Indicator: PM10<br />Total Concentration: 164.5<br />Concentration Per Capita: 0.0734375","SA2: Mangakakahi West<br />Indicator: PM10<br />Total Concentration: 4718.263<br />Concentration Per Capita: 2.12534369369369","SA2: Mangakakahi West<br />Indicator: PM2.5<br />Total Concentration: 3255.47<br />Concentration Per Capita: 1.46642792792793","SA2: Marewa West<br />Indicator: PM10<br />Total Concentration: 4637.09<br />Concentration Per Capita: 2.60510674157303","SA2: Mayfair<br />Indicator: PM10<br />Total Concentration: 4889.56<br />Concentration Per Capita: 1.59269055374593","SA2: Mayfair<br />Indicator: PM2.5<br />Total Concentration: 3141.9<br />Concentration Per Capita: 1.02342019543974","SA2: Meeanee-Awatoto<br />Indicator: PM10<br />Total Concentration: 7065.12<br />Concentration Per Capita: 2.6966106870229","SA2: Meeanee-Awatoto<br />Indicator: PM2.5<br />Total Concentration: 2194.1<br />Concentration Per Capita: 0.837442748091603","SA2: Melville North<br />Indicator: PM10<br />Total Concentration: 4386.86012<br />Concentration Per Capita: 1.48204733783784","SA2: Milton<br />Indicator: PM10<br />Total Concentration: 4561.1<br />Concentration Per Capita: 2.07322727272727","SA2: Morrinsville East<br />Indicator: PM10<br />Total Concentration: 1808.20755<br />Concentration Per Capita: 0.366033917004049","SA2: Mount Maunganui Central<br />Indicator: PM10<br />Total Concentration: 2132.39<br />Concentration Per Capita: 5.92330555555556","SA2: Mount Maunganui Central<br />Indicator: PM10<br />Total Concentration: 2605.434<br />Concentration Per Capita: 7.23731666666667","SA2: Mount Maunganui Central<br />Indicator: PM10<br />Total Concentration: 3495.916<br />Concentration Per Capita: 9.71087777777778","SA2: Mount Maunganui Central<br />Indicator: PM2.5<br />Total Concentration: 1071.3<br />Concentration Per Capita: 2.97583333333333","SA2: Mount Maunganui North<br />Indicator: PM10<br />Total Concentration: 283.985<br />Concentration Per Capita: 0.0816048850574713","SA2: Mount Maunganui South<br />Indicator: PM10<br />Total Concentration: 1870.28<br />Concentration Per Capita: 0.617254125412541","SA2: Otumoetai North<br />Indicator: PM10<br />Total Concentration: 1689.915<br />Concentration Per Capita: 0.384946469248292","SA2: Parkside<br />Indicator: PM10<br />Total Concentration: 7360.756<br />Concentration Per Capita: 3.00439020408163","SA2: Parkside<br />Indicator: PM2.5<br />Total Concentration: 4035.274<br />Concentration Per Capita: 1.6470506122449","SA2: Puni<br />Indicator: PM10<br />Total Concentration: 4349.3<br />Concentration Per Capita: 2.63593939393939","SA2: Puni<br />Indicator: PM2.5<br />Total Concentration: 1593.9<br />Concentration Per Capita: 0.966","SA2: Putaruru<br />Indicator: PM10<br />Total Concentration: 4001.48685<br />Concentration Per Capita: 0.899210528089888","SA2: Queen Street<br />Indicator: PM10<br />Total Concentration: 5694.6<br />Concentration Per Capita: 2.33385245901639","SA2: Queen Street<br />Indicator: PM2.5<br />Total Concentration: 2338.4<br />Concentration Per Capita: 0.958360655737705","SA2: Redwoodtown East<br />Indicator: PM10<br />Total Concentration: 6961.5<br />Concentration Per Capita: 2.47740213523132","SA2: Redwoodtown East<br />Indicator: PM2.5<br />Total Concentration: 4824.63<br />Concentration Per Capita: 1.71695017793594","SA2: Reefton<br />Indicator: PM10<br />Total Concentration: 3052.12<br />Concentration Per Capita: 3.24693617021277","SA2: Richmond Central (Tasman District)<br />Indicator: PM10<br />Total Concentration: 6785<br />Concentration Per Capita: 3.55235602094241","SA2: Ruakaka<br />Indicator: PM10<br />Total Concentration: 4529.304913<br />Concentration Per Capita: 1.70274620789474","SA2: Rutherford<br />Indicator: PM10<br />Total Concentration: 1536<br />Concentration Per Capita: 0.575280898876405","SA2: Seddon Park<br />Indicator: PM10<br />Total Concentration: 6277.3<br />Concentration Per Capita: 2.14242320819113","SA2: St Albans North<br />Indicator: PM10<br />Total Concentration: 6369.855<br />Concentration Per Capita: 2.85643721973094","SA2: St Albans North<br />Indicator: PM2.5<br />Total Concentration: 2831.497<br />Concentration Per Capita: 1.26972959641256","SA2: Stanley Park<br />Indicator: PM10<br />Total Concentration: 4925.84208<br />Concentration Per Capita: 2.12320779310345","SA2: Stanley Park<br />Indicator: PM2.5<br />Total Concentration: 2860.82443<br />Concentration Per Capita: 1.23311397844828","SA2: Strathern<br />Indicator: PM10<br />Total Concentration: 7473.85<br />Concentration Per Capita: 3.2924449339207","SA2: Sunnyhills East<br />Indicator: PM10<br />Total Concentration: 4646.5<br />Concentration Per Capita: 1.29790502793296","SA2: Tahuna Hills<br />Indicator: PM10<br />Total Concentration: 6508.66<br />Concentration Per Capita: 2.20632542372881","SA2: Taihape<br />Indicator: PM10<br />Total Concentration: 6242.098<br />Concentration Per Capita: 3.54664659090909","SA2: Taumarunui Central<br />Indicator: PM10<br />Total Concentration: 3806.652<br />Concentration Per Capita: 2.47185194805195","SA2: Te Kuiti West<br />Indicator: PM10<br />Total Concentration: 4835.51358<br />Concentration Per Capita: 1.79758869144981","SA2: Thames Central<br />Indicator: PM10<br />Total Concentration: 1974.37152<br />Concentration Per Capita: 1.82812177777778","SA2: Vivian West<br />Indicator: PM10<br />Total Concentration: 4538.48<br />Concentration Per Capita: 1.20704255319149","SA2: Vivian West<br />Indicator: PM2.5<br />Total Concentration: 1953.25<br />Concentration Per Capita: 0.519481382978723","SA2: Waimate East<br />Indicator: PM10<br />Total Concentration: 4929.26<br />Concentration Per Capita: 2.95165269461078","SA2: Waimate East<br />Indicator: PM2.5<br />Total Concentration: 2771.666<br />Concentration Per Capita: 1.65968023952096","SA2: Washington<br />Indicator: PM10<br />Total Concentration: 6054.34<br />Concentration Per Capita: 2.02486287625418","SA2: Washington<br />Indicator: PM2.5<br />Total Concentration: 3374.6<br />Concentration Per Capita: 1.12862876254181","SA2: Waterloo West<br />Indicator: PM10<br />Total Concentration: 4097.37<br />Concentration Per Capita: 1.72884810126582","SA2: Westlake<br />Indicator: PM10<br />Total Concentration: 5038<br />Concentration Per Capita: 1.61474358974359","SA2: Westlake<br />Indicator: PM2.5<br />Total Concentration: 2360.5<br />Concentration Per Capita: 0.756570512820513","SA2: Whangarei Central<br />Indicator: PM10<br />Total Concentration: 4836.034552<br />Concentration Per Capita: 4.836034552","SA2: Whangarei Central<br />Indicator: PM2.5<br />Total Concentration: 2247.491037<br />Concentration Per Capita: 2.247491037","SA2: Woolston South<br />Indicator: PM10<br />Total Concentration: 6331.171<br />Concentration Per Capita: 11.9456056603774","SA2: Woolston South<br />Indicator: PM2.5<br />Total Concentration: 2487.357<br />Concentration Per Capita: 4.69312641509434"],"marker":{"color":[1.8871586715867159,1.6314846743295019,2.1185858585858584,1.7212242510822511,1.0449829931972789,2.281340807174888,1.6168789237668162,2.4209954751131222,1.3030782422360248,0.26217673291925464,2.8516949152542375,1.1974436090225564,1.4576303501945527,1.8995588235294119,0.83981617647058826,2.1279549090909091,1.2774370909090909,1.0992875989445912,5.3633464566929137,1.935312582781457,1.0825622516556292,1.532888888888889,1.2578190476190476,0.65852698412698418,2.6966851351351351,1.6315896396396397,2.9699647058823526,2.0430058823529413,1.8518963934426229,0.85088426229508196,0.073437500000000003,2.1253436936936936,1.4664279279279278,2.6051067415730338,1.5926905537459284,1.0234201954397395,2.6966106870229005,0.83744274809160302,1.482047337837838,2.0732272727272729,0.36603391700404858,5.9233055555555554,7.2373166666666675,9.7108777777777782,2.9758333333333331,0.081604885057471266,0.61725412541254121,0.38494646924829157,3.0043902040816328,1.647050612244898,2.635939393939394,0.96600000000000008,0.89921052808988755,2.3338524590163936,0.9583606557377049,2.4774021352313169,1.7169501779359431,3.2469361702127659,3.5523560209424083,1.7027462078947369,0.57528089887640455,2.1424232081911265,2.8564372197309416,1.2697295964125559,2.1232077931034485,1.2331139784482759,3.2924449339207049,1.2979050279329609,2.2063254237288135,3.546646590909091,2.4718519480519481,1.797588691449814,1.8281217777777776,1.2070425531914892,0.51948138297872337,2.9516526946107784,1.6596802395209582,2.0248628762541805,1.1286287625418059,1.7288481012658228,1.6147435897435898,0.7565705128205128,4.8360345520000001,2.2474910369999996,11.945605660377359,4.6931264150943397],"size":[16.126085082804899,14.72072072072072,18.060046378952983,14.257510755402327,12.773748691744135,16.082070225122617,13.649432576084056,16.51386238174393,14.618501409838084,9.1159007244146188,13.254365983295369,12.959182417041188,13.880046789386196,16.212440230663464,11.48014529335714,17.337152003940158,13.497263641773891,14.569886515216812,18.912516160807733,17.325278991976031,13.097314535492213,14.524738861868702,14.23469391943196,11.135479899033431,17.558400131338626,13.676503109031582,16.018945597077714,13.431853721603151,17.002908329742041,11.990555110919576,8,15.476062303761621,13.074546984341971,15.342797923207947,15.757286215600566,12.888095384678529,19.328974532619178,11.332060990375341,14.931987309405077,15.218042644010755,10.698528679020706,11.230749656262184,12.007361530095015,13.46929508095795,9.4887233474932788,8.1961624494654099,10.800435059204991,10.504323913891112,19.814329865172688,14.354776826940835,14.870323626587863,10.346692934392252,14.299307352910997,17.078946828377351,11.568963040489237,19.158858174803505,15.650688501713558,12.74070060949332,18.869092326951098,15.165843605245335,10.251636602433869,18.035584559502553,18.187535143343798,12.378496583143509,15.816851698167415,12.426644388351907,20,15.358246629317245,18.415415871452318,17.977792279751277,13.979440579531694,15.668556432514517,10.971325526893636,15.180906646965871,10.936649633688358,15.822463009706746,12.280270065053664,17.669543803484579,13.27012661864598,14.456721869933714,16.000985039709413,11.605245336452626,15.669411729360339,11.419714809661597,18.124026349812226,11.813510640481027],"colorscale":"Plasma","opacity":0.80000000000000004,"showscale":true,"colorbar":{"title":"Per Capita Conc. (µg/m³/person)","x":0.94999999999999996,"xanchor":"left","len":0.75},"line":{"color":"rgba(31,119,180,1)"}},"type":"scattermapbox","line":{"color":"rgba(31,119,180,1)"},"frame":null},{"mode":"markers","lat":[-45.254852,-37.960750580000003,-44.948571270000002,-38.691894929999997,-37.683528899999999,-40.959198239999999,-40.959198239999999,-45.86909824,-37.777543180000002,-37.777543180000002,-45.190852329999998,-45.045879059999997,-41.121542999999974,-36.904558461006303,-36.904558461006303,-44.100181000449801,-44.100181000449801,-36.922142811073002,-46.106208889999998,-43.912238001285893,-43.912238001285893,-36.8680004511356,-41.267711429999999,-41.267711429999999,-43.384643000579501,-43.384643000579501,-40.95230652,-40.95230652,-43.307540001188499,-43.307540001188499,-41.314170019999999,-38.135818479999998,-38.135818479999998,-39.500164509999998,-39.638873269999998,-39.638873269999998,-39.545889350000003,-39.545889350000003,-37.807709979999998,-46.121327919999999,-37.649612619999999,-37.669638999999997,-37.670021060000003,-37.662139889999999,-37.662139889999999,-37.6434195,-37.6541,-37.66057215,-44.404483000805463,-44.404483000805463,-37.204503610808089,-37.204503610808089,-38.05712209,-36.847430000000003,-36.847430000000003,-41.526639879999998,-41.526639879999998,-42.114231930000003,-41.3395984,-35.894313879999999,-41.281961500000001,-45.871813070000002,-43.511257001057103,-43.511257001057103,-38.221616740000002,-38.221616740000002,-46.431928390000003,-36.905483750710502,-41.295116849999999,-39.677799999999998,-38.886175000000001,-38.33779552,-37.140490550000003,-41.293621999999971,-41.293621999999971,-44.732601001408,-44.732601001408,-41.278229529999997,-41.278229529999997,-41.212606999999899,-36.780305250869901,-36.780305250869901,-35.726732210000002,-35.726732210000002,-43.55715800095718,-43.55715800095718],"lon":[169.390333,176.98120116999999,168.84573717000001,176.09117495000001,176.13549805,175.65321069999999,175.65321069999999,170.51770311000001,175.28715905000001,175.28715905000001,169.32131981000001,169.21000461,175.07034500000009,174.815563500351,174.815563500351,171.24148099998411,171.24148099998411,174.6520009000113,168.93967924,171.7552360004602,171.7552360004602,174.6284,174.95375106,174.95375106,172.65199100072721,172.65199100072721,175.64661441999999,175.64661441999999,172.59526499979901,172.59526499979901,173.23720159999999,176.21420287999999,176.21420287999999,176.89701746,176.85880198000001,176.85880198000001,176.91912704000001,176.91912704000001,175.28036621000001,169.96150159999999,175.53579672000001,176.17971600000001,176.18357850000001,176.1873932,176.1873932,176.1850786,176.1859,176.1691179,171.2496629996013,171.2496629996013,174.86401940002824,174.86401940002824,175.77192840999999,174.76570000000001,174.76570000000001,173.95608203,173.95608203,171.86288712000001,173.18316353,174.45716173,173.29078544999999,170.35672382000001,172.63370500048501,172.63370500048501,175.85843044000001,175.85843044000001,168.36991681000001,174.8904,173.24237590000001,175.80083999999999,175.27104600000001,175.16533762,175.54629323,174.77191800000003,174.77191800000003,171.04992999942601,171.04992999942601,173.27352647999999,173.27352647999999,174.92087600000002,174.74890449976101,174.74890449976101,174.32424642999999,174.32424642999999,172.68127600047541,172.68127600047541],"showlegend":false,"text":["SA2: Alexandra South<br />Indicator: PM10<br />Total Concentration: 5114.2<br />Concentration Per Capita: 1.88715867158672","SA2: Allandale<br />Indicator: PM10<br />Total Concentration: 4258.175<br />Concentration Per Capita: 1.6314846743295","SA2: Arrowtown<br />Indicator: PM10<br />Total Concentration: 6292.2<br />Concentration Per Capita: 2.11858585858586","SA2: Bird Area<br />Indicator: PM10<br />Total Concentration: 3976.02802<br />Concentration Per Capita: 1.72122425108225","SA2: Brookfield East<br />Indicator: PM10<br />Total Concentration: 3072.25<br />Concentration Per Capita: 1.04498299319728","SA2: Cameron and Soldiers Park<br />Indicator: PM10<br />Total Concentration: 5087.39<br />Concentration Per Capita: 2.28134080717489","SA2: Cameron and Soldiers Park<br />Indicator: PM2.5<br />Total Concentration: 3605.64<br />Concentration Per Capita: 1.61687892376682","SA2: Campus South<br />Indicator: PM10<br />Total Concentration: 5350.4<br />Concentration Per Capita: 2.42099547511312","SA2: Claudelands<br />Indicator: PM10<br />Total Concentration: 4195.91194<br />Concentration Per Capita: 1.30307824223602","SA2: Claudelands<br />Indicator: PM2.5<br />Total Concentration: 844.20908<br />Concentration Per Capita: 0.262176732919255","SA2: Clyde<br />Indicator: PM10<br />Total Concentration: 3365<br />Concentration Per Capita: 2.85169491525424","SA2: Cromwell East<br />Indicator: PM10<br />Total Concentration: 3185.2<br />Concentration Per Capita: 1.19744360902256","SA2: Ebdentown<br />Indicator: PM10<br />Total Concentration: 3746.11<br />Concentration Per Capita: 1.45763035019455","SA2: Ellerslie South<br />Indicator: PM10<br />Total Concentration: 5166.8<br />Concentration Per Capita: 1.89955882352941","SA2: Ellerslie South<br />Indicator: PM2.5<br />Total Concentration: 2284.3<br />Concentration Per Capita: 0.839816176470588","SA2: Geraldine<br />Indicator: PM10<br />Total Concentration: 5851.876<br />Concentration Per Capita: 2.12795490909091","SA2: Geraldine<br />Indicator: PM2.5<br />Total Concentration: 3512.952<br />Concentration Per Capita: 1.27743709090909","SA2: Glen Eden Central<br />Indicator: PM10<br />Total Concentration: 4166.3<br />Concentration Per Capita: 1.09928759894459","SA2: Gore Main<br />Indicator: PM10<br />Total Concentration: 6811.45<br />Concentration Per Capita: 5.36334645669291","SA2: Hampstead<br />Indicator: PM10<br />Total Concentration: 5844.644<br />Concentration Per Capita: 1.93531258278146","SA2: Hampstead<br />Indicator: PM2.5<br />Total Concentration: 3269.338<br />Concentration Per Capita: 1.08256225165563","SA2: Henderson Lincoln South<br />Indicator: PM10<br />Total Concentration: 4138.8<br />Concentration Per Capita: 1.53288888888889","SA2: Homedale East<br />Indicator: PM10<br />Total Concentration: 3962.13<br />Concentration Per Capita: 1.25781904761905","SA2: Homedale East<br />Indicator: PM2.5<br />Total Concentration: 2074.36<br />Concentration Per Capita: 0.658526984126984","SA2: Kaiapoi Central<br />Indicator: PM10<br />Total Concentration: 5986.641<br />Concentration Per Capita: 2.69668513513514","SA2: Kaiapoi Central<br />Indicator: PM2.5<br />Total Concentration: 3622.129<br />Concentration Per Capita: 1.63158963963964","SA2: Kuripuni<br />Indicator: PM10<br />Total Concentration: 5048.94<br />Concentration Per Capita: 2.96996470588235","SA2: Kuripuni<br />Indicator: PM2.5<br />Total Concentration: 3473.11<br />Concentration Per Capita: 2.04300588235294","SA2: Lilybrook<br />Indicator: PM10<br />Total Concentration: 5648.284<br />Concentration Per Capita: 1.85189639344262","SA2: Lilybrook<br />Indicator: PM2.5<br />Total Concentration: 2595.197<br />Concentration Per Capita: 0.850884262295082","SA2: Maitlands<br />Indicator: PM10<br />Total Concentration: 164.5<br />Concentration Per Capita: 0.0734375","SA2: Mangakakahi West<br />Indicator: PM10<br />Total Concentration: 4718.263<br />Concentration Per Capita: 2.12534369369369","SA2: Mangakakahi West<br />Indicator: PM2.5<br />Total Concentration: 3255.47<br />Concentration Per Capita: 1.46642792792793","SA2: Marewa West<br />Indicator: PM10<br />Total Concentration: 4637.09<br />Concentration Per Capita: 2.60510674157303","SA2: Mayfair<br />Indicator: PM10<br />Total Concentration: 4889.56<br />Concentration Per Capita: 1.59269055374593","SA2: Mayfair<br />Indicator: PM2.5<br />Total Concentration: 3141.9<br />Concentration Per Capita: 1.02342019543974","SA2: Meeanee-Awatoto<br />Indicator: PM10<br />Total Concentration: 7065.12<br />Concentration Per Capita: 2.6966106870229","SA2: Meeanee-Awatoto<br />Indicator: PM2.5<br />Total Concentration: 2194.1<br />Concentration Per Capita: 0.837442748091603","SA2: Melville North<br />Indicator: PM10<br />Total Concentration: 4386.86012<br />Concentration Per Capita: 1.48204733783784","SA2: Milton<br />Indicator: PM10<br />Total Concentration: 4561.1<br />Concentration Per Capita: 2.07322727272727","SA2: Morrinsville East<br />Indicator: PM10<br />Total Concentration: 1808.20755<br />Concentration Per Capita: 0.366033917004049","SA2: Mount Maunganui Central<br />Indicator: PM10<br />Total Concentration: 2132.39<br />Concentration Per Capita: 5.92330555555556","SA2: Mount Maunganui Central<br />Indicator: PM10<br />Total Concentration: 2605.434<br />Concentration Per Capita: 7.23731666666667","SA2: Mount Maunganui Central<br />Indicator: PM10<br />Total Concentration: 3495.916<br />Concentration Per Capita: 9.71087777777778","SA2: Mount Maunganui Central<br />Indicator: PM2.5<br />Total Concentration: 1071.3<br />Concentration Per Capita: 2.97583333333333","SA2: Mount Maunganui North<br />Indicator: PM10<br />Total Concentration: 283.985<br />Concentration Per Capita: 0.0816048850574713","SA2: Mount Maunganui South<br />Indicator: PM10<br />Total Concentration: 1870.28<br />Concentration Per Capita: 0.617254125412541","SA2: Otumoetai North<br />Indicator: PM10<br />Total Concentration: 1689.915<br />Concentration Per Capita: 0.384946469248292","SA2: Parkside<br />Indicator: PM10<br />Total Concentration: 7360.756<br />Concentration Per Capita: 3.00439020408163","SA2: Parkside<br />Indicator: PM2.5<br />Total Concentration: 4035.274<br />Concentration Per Capita: 1.6470506122449","SA2: Puni<br />Indicator: PM10<br />Total Concentration: 4349.3<br />Concentration Per Capita: 2.63593939393939","SA2: Puni<br />Indicator: PM2.5<br />Total Concentration: 1593.9<br />Concentration Per Capita: 0.966","SA2: Putaruru<br />Indicator: PM10<br />Total Concentration: 4001.48685<br />Concentration Per Capita: 0.899210528089888","SA2: Queen Street<br />Indicator: PM10<br />Total Concentration: 5694.6<br />Concentration Per Capita: 2.33385245901639","SA2: Queen Street<br />Indicator: PM2.5<br />Total Concentration: 2338.4<br />Concentration Per Capita: 0.958360655737705","SA2: Redwoodtown East<br />Indicator: PM10<br />Total Concentration: 6961.5<br />Concentration Per Capita: 2.47740213523132","SA2: Redwoodtown East<br />Indicator: PM2.5<br />Total Concentration: 4824.63<br />Concentration Per Capita: 1.71695017793594","SA2: Reefton<br />Indicator: PM10<br />Total Concentration: 3052.12<br />Concentration Per Capita: 3.24693617021277","SA2: Richmond Central (Tasman District)<br />Indicator: PM10<br />Total Concentration: 6785<br />Concentration Per Capita: 3.55235602094241","SA2: Ruakaka<br />Indicator: PM10<br />Total Concentration: 4529.304913<br />Concentration Per Capita: 1.70274620789474","SA2: Rutherford<br />Indicator: PM10<br />Total Concentration: 1536<br />Concentration Per Capita: 0.575280898876405","SA2: Seddon Park<br />Indicator: PM10<br />Total Concentration: 6277.3<br />Concentration Per Capita: 2.14242320819113","SA2: St Albans North<br />Indicator: PM10<br />Total Concentration: 6369.855<br />Concentration Per Capita: 2.85643721973094","SA2: St Albans North<br />Indicator: PM2.5<br />Total Concentration: 2831.497<br />Concentration Per Capita: 1.26972959641256","SA2: Stanley Park<br />Indicator: PM10<br />Total Concentration: 4925.84208<br />Concentration Per Capita: 2.12320779310345","SA2: Stanley Park<br />Indicator: PM2.5<br />Total Concentration: 2860.82443<br />Concentration Per Capita: 1.23311397844828","SA2: Strathern<br />Indicator: PM10<br />Total Concentration: 7473.85<br />Concentration Per Capita: 3.2924449339207","SA2: Sunnyhills East<br />Indicator: PM10<br />Total Concentration: 4646.5<br />Concentration Per Capita: 1.29790502793296","SA2: Tahuna Hills<br />Indicator: PM10<br />Total Concentration: 6508.66<br />Concentration Per Capita: 2.20632542372881","SA2: Taihape<br />Indicator: PM10<br />Total Concentration: 6242.098<br />Concentration Per Capita: 3.54664659090909","SA2: Taumarunui Central<br />Indicator: PM10<br />Total Concentration: 3806.652<br />Concentration Per Capita: 2.47185194805195","SA2: Te Kuiti West<br />Indicator: PM10<br />Total Concentration: 4835.51358<br />Concentration Per Capita: 1.79758869144981","SA2: Thames Central<br />Indicator: PM10<br />Total Concentration: 1974.37152<br />Concentration Per Capita: 1.82812177777778","SA2: Vivian West<br />Indicator: PM10<br />Total Concentration: 4538.48<br />Concentration Per Capita: 1.20704255319149","SA2: Vivian West<br />Indicator: PM2.5<br />Total Concentration: 1953.25<br />Concentration Per Capita: 0.519481382978723","SA2: Waimate East<br />Indicator: PM10<br />Total Concentration: 4929.26<br />Concentration Per Capita: 2.95165269461078","SA2: Waimate East<br />Indicator: PM2.5<br />Total Concentration: 2771.666<br />Concentration Per Capita: 1.65968023952096","SA2: Washington<br />Indicator: PM10<br />Total Concentration: 6054.34<br />Concentration Per Capita: 2.02486287625418","SA2: Washington<br />Indicator: PM2.5<br />Total Concentration: 3374.6<br />Concentration Per Capita: 1.12862876254181","SA2: Waterloo West<br />Indicator: PM10<br />Total Concentration: 4097.37<br />Concentration Per Capita: 1.72884810126582","SA2: Westlake<br />Indicator: PM10<br />Total Concentration: 5038<br />Concentration Per Capita: 1.61474358974359","SA2: Westlake<br />Indicator: PM2.5<br />Total Concentration: 2360.5<br />Concentration Per Capita: 0.756570512820513","SA2: Whangarei Central<br />Indicator: PM10<br />Total Concentration: 4836.034552<br />Concentration Per Capita: 4.836034552","SA2: Whangarei Central<br />Indicator: PM2.5<br />Total Concentration: 2247.491037<br />Concentration Per Capita: 2.247491037","SA2: Woolston South<br />Indicator: PM10<br />Total Concentration: 6331.171<br />Concentration Per Capita: 11.9456056603774","SA2: Woolston South<br />Indicator: PM2.5<br />Total Concentration: 2487.357<br />Concentration Per Capita: 4.69312641509434"],"marker":{"color":[1.8871586715867159,1.6314846743295019,2.1185858585858584,1.7212242510822511,1.0449829931972789,2.281340807174888,1.6168789237668162,2.4209954751131222,1.3030782422360248,0.26217673291925464,2.8516949152542375,1.1974436090225564,1.4576303501945527,1.8995588235294119,0.83981617647058826,2.1279549090909091,1.2774370909090909,1.0992875989445912,5.3633464566929137,1.935312582781457,1.0825622516556292,1.532888888888889,1.2578190476190476,0.65852698412698418,2.6966851351351351,1.6315896396396397,2.9699647058823526,2.0430058823529413,1.8518963934426229,0.85088426229508196,0.073437500000000003,2.1253436936936936,1.4664279279279278,2.6051067415730338,1.5926905537459284,1.0234201954397395,2.6966106870229005,0.83744274809160302,1.482047337837838,2.0732272727272729,0.36603391700404858,5.9233055555555554,7.2373166666666675,9.7108777777777782,2.9758333333333331,0.081604885057471266,0.61725412541254121,0.38494646924829157,3.0043902040816328,1.647050612244898,2.635939393939394,0.96600000000000008,0.89921052808988755,2.3338524590163936,0.9583606557377049,2.4774021352313169,1.7169501779359431,3.2469361702127659,3.5523560209424083,1.7027462078947369,0.57528089887640455,2.1424232081911265,2.8564372197309416,1.2697295964125559,2.1232077931034485,1.2331139784482759,3.2924449339207049,1.2979050279329609,2.2063254237288135,3.546646590909091,2.4718519480519481,1.797588691449814,1.8281217777777776,1.2070425531914892,0.51948138297872337,2.9516526946107784,1.6596802395209582,2.0248628762541805,1.1286287625418059,1.7288481012658228,1.6147435897435898,0.7565705128205128,4.8360345520000001,2.2474910369999996,11.945605660377359,4.6931264150943397],"size":[16.126085082804899,14.72072072072072,18.060046378952983,14.257510755402327,12.773748691744135,16.082070225122617,13.649432576084056,16.51386238174393,14.618501409838084,9.1159007244146188,13.254365983295369,12.959182417041188,13.880046789386196,16.212440230663464,11.48014529335714,17.337152003940158,13.497263641773891,14.569886515216812,18.912516160807733,17.325278991976031,13.097314535492213,14.524738861868702,14.23469391943196,11.135479899033431,17.558400131338626,13.676503109031582,16.018945597077714,13.431853721603151,17.002908329742041,11.990555110919576,8,15.476062303761621,13.074546984341971,15.342797923207947,15.757286215600566,12.888095384678529,19.328974532619178,11.332060990375341,14.931987309405077,15.218042644010755,10.698528679020706,11.230749656262184,12.007361530095015,13.46929508095795,9.4887233474932788,8.1961624494654099,10.800435059204991,10.504323913891112,19.814329865172688,14.354776826940835,14.870323626587863,10.346692934392252,14.299307352910997,17.078946828377351,11.568963040489237,19.158858174803505,15.650688501713558,12.74070060949332,18.869092326951098,15.165843605245335,10.251636602433869,18.035584559502553,18.187535143343798,12.378496583143509,15.816851698167415,12.426644388351907,20,15.358246629317245,18.415415871452318,17.977792279751277,13.979440579531694,15.668556432514517,10.971325526893636,15.180906646965871,10.936649633688358,15.822463009706746,12.280270065053664,17.669543803484579,13.27012661864598,14.456721869933714,16.000985039709413,11.605245336452626,15.669411729360339,11.419714809661597,18.124026349812226,11.813510640481027],"colorscale":"Plasma","opacity":0.80000000000000004,"showscale":true,"colorbar":{"title":"Per Capita Conc. (µg/m³/person)","x":0.94999999999999996,"xanchor":"left","len":0.75},"line":{"color":"rgba(255,127,14,1)"}},"type":"scattermapbox","_bbox":[168.36991681000001,-46.431928390000003,176.98120116999999,-35.726732210000002],"line":{"color":"rgba(255,127,14,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>htmlwidgets<span class="sc">::</span><span class="fu">saveWidget</span>(interactive_map18, <span class="st">"dist.html"</span>, <span class="at">selfcontained =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>New Zealand’s air quality varies significantly across regions, with particulate matter (PM) concentrations reflecting both human activity and environmental conditions. This map highlights total and per capita PM levels, revealing how pollution impacts individuals versus overall atmospheric load. The deep red zones indicate areas where residents experience heightened exposure, often influenced by traffic, industry, or natural events. Future analyses could explore seasonal changes, meteorological influences, and links to traffic congestion.</p>
</section>
<section id="standardizing-daily-air-pollutant-concentrations-for-cross-regional-analysis" class="level3" data-number="4.7">
<h3 data-number="4.7" class="anchored" data-anchor-id="standardizing-daily-air-pollutant-concentrations-for-cross-regional-analysis"><span class="header-section-number">4.7</span> Standardizing Daily Air Pollutant Concentrations for Cross-Regional Analysis</h3>
<p>To enable consistent comparisons across regions, we first removed duplicate entries by aggregating pollutant data by SA2, region, date, and indicator. We then calculated total daily concentrations and standardized them using z-scores. This normalization allows us to detect anomalies and analyze trends over time on a common scale, regardless of differences in baseline pollution levels across regions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Check for duplicate pollutant entries recorded on the same day, in the same location, for the same indicator</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(airdata_with_sa2) <span class="sc">|&gt;</span></span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sa2_name, region, date, indicator) <span class="sc">|&gt;</span></span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,972
Columns: 5
$ sa2_name  &lt;chr&gt; "Alexandra South", "Alexandra South", "Alexandra South", "Al…
$ region    &lt;chr&gt; "Otago", "Otago", "Otago", "Otago", "Otago", "Otago", "Otago…
$ date      &lt;date&gt; 2018-03-31, 2019-04-06, 2020-04-04, 2021-04-03, 2016-04-02,…
$ indicator &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM1…
$ n         &lt;int&gt; 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="co"># → Some SA2 regions record pollutant levels multiple times per day per indicator.</span></span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine duplicates by summing concentration values across SA2 name, region, date, and indicator. This step ensures cleaner trend lines for time-series analysis</span></span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(airdata_with_sa2) <span class="sc">|&gt;</span></span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">region_indicator =</span> <span class="fu">paste</span>(region, indicator, <span class="at">sep =</span> <span class="st">" - "</span>)) <span class="sc">|&gt;</span></span>
<span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name, region, date, indicator, region_indicator) <span class="sc">|&gt;</span></span>
<span id="cb210-7"><a href="#cb210-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb210-8"><a href="#cb210-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">region_concentration =</span> <span class="fu">sum</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb210-9"><a href="#cb210-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb210-10"><a href="#cb210-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb210-11"><a href="#cb210-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-12"><a href="#cb210-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Confirm that aggregation at the region-date-indicator level has resolved duplicates</span></span>
<span id="cb210-13"><a href="#cb210-13" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb210-14"><a href="#cb210-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(region, date, indicator) <span class="sc">|&gt;</span></span>
<span id="cb210-15"><a href="#cb210-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb210-16"><a href="#cb210-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 45,633
Columns: 4
$ region    &lt;chr&gt; "Auckland", "Auckland", "Auckland", "Auckland", "Auckland", …
$ date      &lt;date&gt; 2016-01-01, 2016-01-01, 2016-01-02, 2016-01-02, 2016-01-03,…
$ indicator &lt;chr&gt; "PM10", "PM2.5", "PM10", "PM2.5", "PM10", "PM2.5", "PM10", "…
$ n         &lt;int&gt; 6, 3, 6, 3, 5, 2, 5, 2, 5, 2, 6, 3, 5, 2, 5, 2, 5, 2, 5, 2, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Further aggregate by region, date, and indicator to prepare for regional trend analysis</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="ot">&lt;-</span> daily_airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, date, indicator, region_indicator) <span class="sc">|&gt;</span></span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">region_concentration =</span> <span class="fu">sum</span>(region_concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean pollutant concentration for each region and indicator combination</span></span>
<span id="cb212-9"><a href="#cb212-9" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="ot">&lt;-</span> daily_airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb212-10"><a href="#cb212-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, indicator) <span class="sc">|&gt;</span></span>
<span id="cb212-11"><a href="#cb212-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">grp_mean =</span> <span class="fu">mean</span>(region_concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb212-12"><a href="#cb212-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb212-13"><a href="#cb212-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-14"><a href="#cb212-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute standardized concentrations (z-scores) to enable cross-region comparison on a uniform scale</span></span>
<span id="cb212-15"><a href="#cb212-15" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="ot">&lt;-</span> daily_airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb212-16"><a href="#cb212-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, indicator) <span class="sc">|&gt;</span></span>
<span id="cb212-17"><a href="#cb212-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb212-18"><a href="#cb212-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_concentration =</span> (region_concentration <span class="sc">-</span> <span class="fu">mean</span>(region_concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(region_concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb212-19"><a href="#cb212-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb212-20"><a href="#cb212-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb212-21"><a href="#cb212-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-22"><a href="#cb212-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of standardized concentration values</span></span>
<span id="cb212-23"><a href="#cb212-23" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata_with_sa2<span class="sc">$</span>sd_concentration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-2.5671 -0.6715 -0.2570  0.0000  0.4410  7.9976 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="co"># → Standardized concentration ranges from -2.57 to 7.99, with a median of -0.26 and a mean of 0.</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of raw regional concentrations</span></span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata_with_sa2<span class="sc">$</span>region_concentration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00   10.37   22.88   40.62   51.67  549.98 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># → Regional concentration ranges from 0 to 549.98 µg/m³, with a median of 22.88 and a mean of 40.62.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to randomly select a fixed number of regions, filter the dataset accordingly, and replace zero concentrations with a small positive value to avoid log/scale issues</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>prepare_selected_airdata <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">n_regions =</span> <span class="dv">5</span>, <span class="at">seed =</span> <span class="dv">123</span>) {</span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed) <span class="co"># Ensure reproducibility</span></span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Randomly sample 'n_regions' unique region names</span></span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a>  selected_regions <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">unique</span>(data<span class="sc">$</span>region), <span class="at">size =</span> n_regions)</span>
<span id="cb217-7"><a href="#cb217-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb217-8"><a href="#cb217-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter to selected regions and replace zero concentration values</span></span>
<span id="cb217-9"><a href="#cb217-9" aria-hidden="true" tabindex="-1"></a>  data_filtered <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb217-10"><a href="#cb217-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(region <span class="sc">%in%</span> selected_regions) <span class="sc">|&gt;</span></span>
<span id="cb217-11"><a href="#cb217-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb217-12"><a href="#cb217-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">region_concentration =</span> <span class="fu">ifelse</span>(region_concentration <span class="sc">==</span> <span class="dv">0</span>, <span class="fl">1e-05</span>, region_concentration)</span>
<span id="cb217-13"><a href="#cb217-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb217-14"><a href="#cb217-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb217-15"><a href="#cb217-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb217-16"><a href="#cb217-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb217-17"><a href="#cb217-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data_filtered,</span>
<span id="cb217-18"><a href="#cb217-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">selected_regions =</span> selected_regions</span>
<span id="cb217-19"><a href="#cb217-19" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb217-20"><a href="#cb217-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply function to filter dataset and get selected regions</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">prepare_selected_airdata</span>(daily_airdata_with_sa2, <span class="dv">6</span>)</span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a>daily_airdata_selected <span class="ot">&lt;-</span> result<span class="sc">$</span>data</span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>selected_regions <span class="ot">&lt;-</span> result<span class="sc">$</span>selected_regions</span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-6"><a href="#cb218-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview column names and selected regions</span></span>
<span id="cb218-7"><a href="#cb218-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(daily_airdata_selected)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "region"               "date"                 "indicator"           
[4] "region_indicator"     "region_concentration" "grp_mean"            
[7] "sd_concentration"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>selected_regions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "West Coast"         "Canterbury"         "Wellington"        
[4] "Otago"              "Bay of Plenty"      "Manawatu-Whanganui"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a faceted line plot showing log-scale air pollutant concentration trends by region. This visualizes pollutant concentrations across selected regions from 2016 to 2023</span></span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>plot_log_by_region <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> daily_airdata_selected, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> region_concentration, <span class="at">color =</span> indicator)) <span class="sc">+</span></span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> region)) <span class="sc">+</span></span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"PM10"</span> <span class="ot">=</span> <span class="st">"#0072B2"</span>, <span class="st">"PM2.5"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>)) <span class="sc">+</span></span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Log-Scale Trends in Air Pollutant Concentration in Selected Regions (2016-2023)"</span>,</span>
<span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Log-transformed trends in PM2.5 and PM10 concentration"</span>,</span>
<span id="cb222-8"><a href="#cb222-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Month-Year"</span>,</span>
<span id="cb222-9"><a href="#cb222-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Total Pollutant Concentration (log scale)"</span>,</span>
<span id="cb222-10"><a href="#cb222-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Pollutant Type"</span>) <span class="sc">+</span></span>
<span id="cb222-11"><a href="#cb222-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb222-12"><a href="#cb222-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb222-13"><a href="#cb222-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb222-14"><a href="#cb222-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb222-15"><a href="#cb222-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>), <span class="co"># Center the main title</span></span>
<span id="cb222-16"><a href="#cb222-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb222-17"><a href="#cb222-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> <span class="co"># Center the subtitle</span></span>
<span id="cb222-18"><a href="#cb222-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> region, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb222-19"><a href="#cb222-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb222-20"><a href="#cb222-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2016-01-01"</span>),</span>
<span id="cb222-21"><a href="#cb222-21" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">as.Date</span>(<span class="st">"2023-12-31"</span>), <span class="at">by =</span> <span class="st">"6 months"</span>), <span class="co"># tick every 6 months</span></span>
<span id="cb222-22"><a href="#cb222-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">"%b %y"</span>) <span class="sc">+</span></span>
<span id="cb222-23"><a href="#cb222-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_scientific</span>()) <span class="co"># Apply log10 scale</span></span>
<span id="cb222-24"><a href="#cb222-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-25"><a href="#cb222-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb222-26"><a href="#cb222-26" aria-hidden="true" tabindex="-1"></a>plot_log_by_region</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-log-concentration-by-region-facets-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_log_by_region, <span class="at">width=</span><span class="dv">12</span>, <span class="at">height=</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Air pollution trends across New Zealand regions reveal intriguing variations. Canterbury’s pronounced seasonal fluctuations hint at climatic influences, while Otago’s cyclical peaks suggest recurring pollution sources. Bay of Plenty and Wellington maintain relatively stable pollutant levels, contrasting with the West Coast’s dramatic drops, possibly due to extreme weather events or data gaps. The use of log scales provides clarity in detecting subtle changes over time, distinguishing PM2.5 and PM10 trends.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to compute specified quantiles (e.g., thresholds) for a numeric column in a dataframe</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>compute_quantiles <span class="ot">&lt;-</span> <span class="cf">function</span>(data, column, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>)) {</span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>  column_data <span class="ot">&lt;-</span> data[[<span class="fu">deparse</span>(<span class="fu">substitute</span>(column))]]</span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quantile</span>(column_data, <span class="at">probs =</span> probs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute moderate and extreme anomaly thresholds (5th, 10th, 90th, 95th percentiles)</span></span>
<span id="cb224-8"><a href="#cb224-8" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">compute_quantiles</span>(daily_airdata_selected, sd_concentration)</span>
<span id="cb224-9"><a href="#cb224-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(quantiles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        5%        10%        90%        95% 
-1.1614523 -0.9735578  1.3185504  1.9748788 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with both threshold lines in new colors</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>plot_region_zanomaly <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> daily_airdata_selected, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> sd_concentration, <span class="at">color =</span> indicator)) <span class="sc">+</span></span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> region)) <span class="sc">+</span></span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"PM10"</span> <span class="ot">=</span> <span class="st">"#0072B2"</span>, <span class="st">"PM2.5"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>)) <span class="sc">+</span></span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb226-6"><a href="#cb226-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 10th–90th percentile range</span></span>
<span id="cb226-7"><a href="#cb226-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="st">"10%"</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#009E73"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span>  <span class="co"># Bluish green</span></span>
<span id="cb226-8"><a href="#cb226-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="st">"90%"</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#009E73"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb226-9"><a href="#cb226-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-10"><a href="#cb226-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 5th–95th percentile range</span></span>
<span id="cb226-11"><a href="#cb226-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="st">"5%"</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span>  <span class="co"># Reddish purple</span></span>
<span id="cb226-12"><a href="#cb226-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="st">"95%"</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb226-13"><a href="#cb226-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-14"><a href="#cb226-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> region, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb226-15"><a href="#cb226-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb226-16"><a href="#cb226-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2016-01-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2023-12-31"</span>), <span class="at">by =</span> <span class="st">"6 months"</span>),</span>
<span id="cb226-17"><a href="#cb226-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">"%b %y"</span></span>
<span id="cb226-18"><a href="#cb226-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb226-19"><a href="#cb226-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb226-20"><a href="#cb226-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb226-21"><a href="#cb226-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Standardized PM2.5 and PM10 Trends by Region (2016–2023)"</span>,</span>
<span id="cb226-22"><a href="#cb226-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Z-score trends with 10th/90th (green) and 5th/95th (purple) percentiles marking moderate and extreme anomalies"</span>,</span>
<span id="cb226-23"><a href="#cb226-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date (Month–Year)"</span>,</span>
<span id="cb226-24"><a href="#cb226-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized Concentration (Z-score)"</span>,</span>
<span id="cb226-25"><a href="#cb226-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Pollutant"</span></span>
<span id="cb226-26"><a href="#cb226-26" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb226-27"><a href="#cb226-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb226-28"><a href="#cb226-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>), </span>
<span id="cb226-29"><a href="#cb226-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb226-30"><a href="#cb226-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb226-31"><a href="#cb226-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb226-32"><a href="#cb226-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb226-33"><a href="#cb226-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb226-34"><a href="#cb226-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb226-35"><a href="#cb226-35" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb226-36"><a href="#cb226-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-37"><a href="#cb226-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot</span></span>
<span id="cb226-38"><a href="#cb226-38" aria-hidden="true" tabindex="-1"></a>plot_region_zanomaly</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/zscore-threshold-lines-by-region-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_region_zanomaly, <span class="at">width =</span> <span class="dv">12</span>, <span class="at">height =</span> <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Regional air quality trends reveal striking differences in pollutant behavior, particularly in extreme cases. Canterbury exhibits persistently high PM2.5 and PM10 levels, frequently exceeding the 90th and 95th percentiles, indicating prolonged pollution events. In contrast, Bay of Plenty and Wellington experience volatile PM2.5 concentrations, with frequent spikes surpassing upper quantiles. Otago and West Coast display seasonal PM10 peaks, reflecting meteorological influences rather than urban emissions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign pollution category based on standardized concentration thresholds</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorize each day's standardized concentration as "good", "typical", or "bad", based on 10th and 90th percentile z-score thresholds computed earlier</span></span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>daily_airdata_selected <span class="ot">&lt;-</span> daily_airdata_selected <span class="sc">|&gt;</span></span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pollution_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>    sd_concentration <span class="sc">&lt;</span> quantiles[<span class="st">"10%"</span>] <span class="sc">~</span> <span class="st">"good"</span>,<span class="co"># below 10th</span></span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>    sd_concentration <span class="sc">&gt;</span> quantiles[<span class="st">"90%"</span>] <span class="sc">~</span> <span class="st">"bad"</span>, <span class="co"># above 90th</span></span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"typical"</span>)) <span class="co"># between 10th and 90th</span></span>
<span id="cb228-8"><a href="#cb228-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-9"><a href="#cb228-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a faceted column plot showing daily standardized concentrations. Fill color reflects pollution category: good (green), typical (grey), bad (orange)</span></span>
<span id="cb228-10"><a href="#cb228-10" aria-hidden="true" tabindex="-1"></a>plot_zscore_pollution_categories <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> daily_airdata_selected, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> sd_concentration, <span class="at">fill =</span> pollution_category)) <span class="sc">+</span></span>
<span id="cb228-11"><a href="#cb228-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> <span class="co"># stack columns side by side</span></span>
<span id="cb228-12"><a href="#cb228-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> region_indicator, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span>  </span>
<span id="cb228-13"><a href="#cb228-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"good"</span> <span class="ot">=</span> <span class="st">"#1b9e77"</span>, <span class="st">"typical"</span> <span class="ot">=</span> <span class="st">"#999999"</span>, <span class="st">"bad"</span> <span class="ot">=</span> <span class="st">"#d95f02"</span>)) <span class="sc">+</span></span>
<span id="cb228-14"><a href="#cb228-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(</span>
<span id="cb228-15"><a href="#cb228-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.Date</span>(<span class="st">"2016-01-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2023-12-31"</span>), <span class="at">by =</span> <span class="st">"6 months"</span>), <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">date_format</span>(<span class="st">"%b%y"</span>)) <span class="sc">+</span></span>
<span id="cb228-16"><a href="#cb228-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb228-17"><a href="#cb228-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb228-18"><a href="#cb228-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Categorized Standardized Daily Air Pollution Levels by Region (2016–2023)"</span>,</span>
<span id="cb228-19"><a href="#cb228-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Z-score scaled concentrations colored by pollution severity based on 10th/90th percentile cutoffs"</span>,</span>
<span id="cb228-20"><a href="#cb228-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Month–Year"</span>, </span>
<span id="cb228-21"><a href="#cb228-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Daily Standardized Concentration"</span>, </span>
<span id="cb228-22"><a href="#cb228-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Pollution Category"</span>) <span class="sc">+</span></span>
<span id="cb228-23"><a href="#cb228-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb228-24"><a href="#cb228-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb228-25"><a href="#cb228-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb228-26"><a href="#cb228-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb228-27"><a href="#cb228-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb228-28"><a href="#cb228-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb228-29"><a href="#cb228-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>), </span>
<span id="cb228-30"><a href="#cb228-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb228-31"><a href="#cb228-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-32"><a href="#cb228-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb228-33"><a href="#cb228-33" aria-hidden="true" tabindex="-1"></a>plot_zscore_pollution_categories</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-daily-zscore-pollution-categories-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_zscore_pollution_categories, <span class="at">width=</span><span class="dv">12</span>, <span class="at">height=</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Across the regions of New Zealand depicted, a common thread of seasonal air pollution emerges, with particulate matter (PM10 and PM2.5) concentrations generally peaking during the colder winter months. Canterbury stands out with a seemingly higher frequency of “Bad” air quality days, especially for PM2.5, suggesting potential issues with pollutant trapping. Bay of Plenty also exhibits a clear seasonal pattern with notable “Bad” days. In contrast, Wellington appears to enjoy relatively better air quality with less pronounced seasonal variation and fewer instances of “Bad” pollution. Otago and the West Coast, for which only PM10 data is shown, also display seasonal trends but seem to experience fewer severe pollution episodes than Canterbury. These regional differences likely stem from a combination of factors including heating practices, local industrial activity, topography, and prevailing weather patterns.</p>
</section>
<section id="seasonal-aggregation-and-visualization-of-air-quality-data-20162023" class="level3" data-number="4.8">
<h3 data-number="4.8" class="anchored" data-anchor-id="seasonal-aggregation-and-visualization-of-air-quality-data-20162023"><span class="header-section-number">4.8</span> Seasonal Aggregation and Visualization of Air Quality Data (2016–2023)</h3>
<p>This section defines seasonal categories, computes total and seasonal pollutant concentrations by region, and calculates z-score anomalies. It then visualizes seasonal trends in PM2.5 and PM10 concentrations across selected New Zealand regions from 2016 to 2023 using a log-scaled line plot, highlighting temporal and spatial variations in air quality.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to classify dates into custom seasons</span></span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>get_season <span class="ot">&lt;-</span> <span class="cf">function</span>(date) {</span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>  month <span class="ot">&lt;-</span> <span class="fu">month</span>(date)</span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">case_when</span>(</span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>)  <span class="sc">~</span> <span class="st">"Sum"</span>, <span class="co"># Summer: Dec–Feb</span></span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)   <span class="sc">~</span> <span class="st">"Aut"</span>, <span class="co"># Autumn: Mar–May</span></span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>)   <span class="sc">~</span> <span class="st">"Win"</span>, <span class="co"># Winter: Jun–Aug</span></span>
<span id="cb230-8"><a href="#cb230-8" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>) <span class="sc">~</span> <span class="st">"Spr"</span> <span class="co"># Spring: Sep–Nov</span></span>
<span id="cb230-9"><a href="#cb230-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb230-10"><a href="#cb230-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb230-11"><a href="#cb230-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-12"><a href="#cb230-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract 'season' and 'year' from the date column</span></span>
<span id="cb230-13"><a href="#cb230-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Factorize 'season' for ordered plotting</span></span>
<span id="cb230-14"><a href="#cb230-14" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(airdata_with_sa2) <span class="sc">|&gt;</span></span>
<span id="cb230-15"><a href="#cb230-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb230-16"><a href="#cb230-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">season =</span> <span class="fu">get_season</span>(date),</span>
<span id="cb230-17"><a href="#cb230-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">season =</span> <span class="fu">factor</span>(season, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Sum"</span>, <span class="st">"Aut"</span>, <span class="st">"Win"</span>, <span class="st">"Spr"</span>)),</span>
<span id="cb230-18"><a href="#cb230-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">format</span>(date, <span class="st">"%y"</span>) </span>
<span id="cb230-19"><a href="#cb230-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb230-20"><a href="#cb230-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, season, year, indicator) <span class="sc">|&gt;</span></span>
<span id="cb230-21"><a href="#cb230-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb230-22"><a href="#cb230-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">region_concentration =</span> <span class="fu">sum</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb230-23"><a href="#cb230-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb230-24"><a href="#cb230-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb230-25"><a href="#cb230-25" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata_with_sa2<span class="sc">$</span>region_concentration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
   12.41   996.64  2055.98  3535.07  4758.89 21558.90 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Region concentration ranges 12.41–21558.9, median 2055.98, mean 3535.07, skewed right distribution.</span></span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize distribution of season and year</span></span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata_with_sa2<span class="sc">$</span>season)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sum Aut Win Spr 
210 204 209 209 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">as.integer</span>(daily_airdata_with_sa2<span class="sc">$</span>year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  16.00   18.00   20.00   19.65   22.00   23.00 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Season column shows balanced seasonal distribution. Year column spans from 2016 to 2023 with median year 2020.</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute seasonal mean, standard deviation, and z-anomaly by region and indicator</span></span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="ot">&lt;-</span> daily_airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, season, indicator) <span class="sc">|&gt;</span></span>
<span id="cb236-6"><a href="#cb236-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb236-7"><a href="#cb236-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">seasonal_mean =</span> <span class="fu">mean</span>(region_concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb236-8"><a href="#cb236-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">seasonal_sd =</span> <span class="fu">sd</span>(region_concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb236-9"><a href="#cb236-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_concentration =</span> (region_concentration <span class="sc">-</span> seasonal_mean) <span class="sc">/</span> seasonal_sd</span>
<span id="cb236-10"><a href="#cb236-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb236-11"><a href="#cb236-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb236-12"><a href="#cb236-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-13"><a href="#cb236-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize seasonal statistics</span></span>
<span id="cb236-14"><a href="#cb236-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata_with_sa2<span class="sc">$</span>seasonal_mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  204.8  1050.3  2058.5  3535.1  4867.2 17998.3 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata_with_sa2<span class="sc">$</span>seasonal_sd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   41.8   207.7   401.1   713.8   710.3  5301.0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seasonal mean ranges from 204.8 to 17998.3 with mean 3535.1; seasonal SD ranges 41.8–5301, mean 713.8.</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata_with_sa2<span class="sc">$</span>sd_concentration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-2.40171 -0.68939  0.06305  0.00000  0.70890  2.19547 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SD concentration ranges from -2.402 to 2.195, mean approximately zero.</span></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate ordered season-year combinations for time-series plotting</span></span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique sorted years from the data</span></span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(daily_airdata_with_sa2<span class="sc">$</span>year))</span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define ordered season labels</span></span>
<span id="cb242-8"><a href="#cb242-8" aria-hidden="true" tabindex="-1"></a>season_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Sum"</span>, <span class="st">"Aut"</span>, <span class="st">"Win"</span>, <span class="st">"Spr"</span>)</span>
<span id="cb242-9"><a href="#cb242-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-10"><a href="#cb242-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate ordered levels like "Sum16", "Aut16", ..., "Spr23"</span></span>
<span id="cb242-11"><a href="#cb242-11" aria-hidden="true" tabindex="-1"></a>season_year_levels <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">outer</span>(season_order, years, paste0))</span>
<span id="cb242-12"><a href="#cb242-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-13"><a href="#cb242-13" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(season_year_levels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> chr [1:32] "Sum16" "Aut16" "Win16" "Spr16" "Sum17" "Aut17" "Win17" "Spr17" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and factorize 'season_year'</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="ot">&lt;-</span> daily_airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">season_year =</span> <span class="fu">paste0</span>(season, year),</span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">season_year =</span> <span class="fu">factor</span>(season_year, <span class="at">levels =</span> season_year_levels),</span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">region_indicator =</span> <span class="fu">paste0</span>(region, <span class="st">"_"</span>, indicator)</span>
<span id="cb244-7"><a href="#cb244-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb244-8"><a href="#cb244-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-9"><a href="#cb244-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview distinct levels</span></span>
<span id="cb244-10"><a href="#cb244-10" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(daily_airdata_with_sa2<span class="sc">$</span>season_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Factor w/ 32 levels "Sum16","Aut16",..: 1 1 5 5 9 9 13 13 17 17 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define plotting function for seasonal trends</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, y_var) {</span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> season_year, <span class="at">y =</span> {{y_var}}, <span class="at">color =</span> indicator)) <span class="sc">+</span></span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> indicator)) <span class="sc">+</span></span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"PM10"</span> <span class="ot">=</span> <span class="st">"#0072B2"</span>, <span class="st">"PM2.5"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>)) <span class="sc">+</span></span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Season_Year"</span>, <span class="at">color =</span> <span class="st">"Indicator"</span>) <span class="sc">+</span></span>
<span id="cb246-9"><a href="#cb246-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb246-10"><a href="#cb246-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb246-11"><a href="#cb246-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb246-12"><a href="#cb246-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb246-13"><a href="#cb246-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb246-14"><a href="#cb246-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb246-15"><a href="#cb246-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select a random sample of 5 regions for detailed visualization (seed ensures reproducibility)</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">prepare_selected_airdata</span>(daily_airdata_with_sa2, <span class="at">n_regions =</span> <span class="dv">6</span>, <span class="at">seed =</span> <span class="dv">1234</span>)</span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a>daily_airdata_selected <span class="ot">&lt;-</span> result<span class="sc">$</span>data</span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a>selected_regions <span class="ot">&lt;-</span> result<span class="sc">$</span>selected_regions</span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect selected data and regions</span></span>
<span id="cb247-7"><a href="#cb247-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(daily_airdata_selected)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "region"               "season"               "year"                
 [4] "indicator"            "region_concentration" "seasonal_mean"       
 [7] "seasonal_sd"          "sd_concentration"     "season_year"         
[10] "region_indicator"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a>selected_regions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Tasman"             "Otago"              "Manawatu-Whanganui"
[4] "Hawke's Bay"        "Northland"          "West Coast"        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate seasonal trend plot for selected regions and indicators</span></span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>seasonal_concentration_plot <span class="ot">&lt;-</span> <span class="fu">plot</span>(daily_airdata_selected, region_concentration) <span class="sc">+</span></span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> region, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Air Pollution Trends in Selected New Zealand Regions (2016–2023)"</span>,</span>
<span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Log-scaled seasonal average concentrations of PM2.5 and PM10 across five randomly selected regions"</span>,</span>
<span id="cb251-7"><a href="#cb251-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Seasonal Concentration (µg/m³, log scale)"</span>) <span class="sc">+</span></span>
<span id="cb251-8"><a href="#cb251-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>scientific)</span>
<span id="cb251-9"><a href="#cb251-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-10"><a href="#cb251-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb251-11"><a href="#cb251-11" aria-hidden="true" tabindex="-1"></a>seasonal_concentration_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-seasonal-concentration-selected-regions-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, seasonal_concentration_plot, <span class="at">width=</span><span class="dv">12</span>, <span class="at">height=</span><span class="fl">5.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>PM10 concentrations consistently exceed PM2.5 across all regions, indicating coarser particulate dominance. Seasonal variations show PM2.5 stability, whereas PM10 fluctuates significantly, especially in Otago and Manawatu-Whanganui. West Coast exhibits the lowest pollution levels. While Hawke’s Bay and Northland show occasional peaks, Tasman maintains relative consistency. Overall, PM10 trends exhibit greater variability, suggesting stronger environmental or anthropogenic influences on coarse particulates.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>