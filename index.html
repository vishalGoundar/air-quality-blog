<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vishal Goundar">
<meta name="dcterms.date" content="2025-05-28">

<title>Traffic Density and Air Quality: Comparing Urban and Rural Auckland</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="air-quality_files/libs/clipboard/clipboard.min.js"></script>
<script src="air-quality_files/libs/quarto-html/quarto.js"></script>
<script src="air-quality_files/libs/quarto-html/popper.min.js"></script>
<script src="air-quality_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="air-quality_files/libs/quarto-html/anchor.min.js"></script>
<link href="air-quality_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="air-quality_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="air-quality_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="air-quality_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="air-quality_files/libs/bootstrap/bootstrap-32162a2fca7cb0439643f2faaab1edf3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="air-quality_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="air-quality_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="air-quality_files/libs/plotly-binding-4.10.4/plotly.js"></script>

<script src="air-quality_files/libs/typedarray-0.1/typedarray.min.js"></script>

<script src="air-quality_files/libs/jquery-3.5.1/jquery.min.js"></script>

<link href="air-quality_files/libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="air-quality_files/libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<link href="air-quality_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">

<script src="air-quality_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>



<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract"><span class="header-section-number">1</span> Abstract</a></li>
  <li><a href="#data-from-lawa-on-air-quality" id="toc-data-from-lawa-on-air-quality" class="nav-link" data-scroll-target="#data-from-lawa-on-air-quality"><span class="header-section-number">2</span> Data from LAWA on Air Quality</a>
  <ul class="collapse">
  <li><a href="#load-lawa-file" id="toc-load-lawa-file" class="nav-link" data-scroll-target="#load-lawa-file"><span class="header-section-number">2.1</span> Load LAWA file</a></li>
  <li><a href="#air-pollutant-concentration-trends-20162023" id="toc-air-pollutant-concentration-trends-20162023" class="nav-link" data-scroll-target="#air-pollutant-concentration-trends-20162023"><span class="header-section-number">2.2</span> Air Pollutant Concentration Trends (2016–2023)</a></li>
  <li><a href="#daily-trends-in-pm10-and-pm2.5-by-town" id="toc-daily-trends-in-pm10-and-pm2.5-by-town" class="nav-link" data-scroll-target="#daily-trends-in-pm10-and-pm2.5-by-town"><span class="header-section-number">2.3</span> Daily Trends in PM10 and PM2.5 by Town</a></li>
  </ul></li>
  <li><a href="#spatial-plot-of-pollutant-concentration-across-nz-20162023" id="toc-spatial-plot-of-pollutant-concentration-across-nz-20162023" class="nav-link" data-scroll-target="#spatial-plot-of-pollutant-concentration-across-nz-20162023"><span class="header-section-number">3</span> Spatial Plot of Pollutant Concentration Across NZ (2016–2023)</a>
  <ul class="collapse">
  <li><a href="#yearly-total-concentrations-of-pm10-and-pm2.5-at-nz-monitoring-sites" id="toc-yearly-total-concentrations-of-pm10-and-pm2.5-at-nz-monitoring-sites" class="nav-link" data-scroll-target="#yearly-total-concentrations-of-pm10-and-pm2.5-at-nz-monitoring-sites"><span class="header-section-number">3.1</span> Yearly Total Concentrations of PM10 and PM2.5 at NZ Monitoring Sites</a></li>
  </ul></li>
  <li><a href="#load-2018-population-data-and-regional-map-data-from-stats-nz" id="toc-load-2018-population-data-and-regional-map-data-from-stats-nz" class="nav-link" data-scroll-target="#load-2018-population-data-and-regional-map-data-from-stats-nz"><span class="header-section-number">4</span> Load 2018 population data and regional map data from Stats NZ</a>
  <ul class="collapse">
  <li><a href="#spatial-join-of-datasets-population-and-region" id="toc-spatial-join-of-datasets-population-and-region" class="nav-link" data-scroll-target="#spatial-join-of-datasets-population-and-region"><span class="header-section-number">4.1</span> Spatial join of datasets: population and region</a></li>
  <li><a href="#normalize-pollutant-concentration-by-2018-population-and-plot-concentration-per-capita-trends-for-eac-site-type." id="toc-normalize-pollutant-concentration-by-2018-population-and-plot-concentration-per-capita-trends-for-eac-site-type." class="nav-link" data-scroll-target="#normalize-pollutant-concentration-by-2018-population-and-plot-concentration-per-capita-trends-for-eac-site-type."><span class="header-section-number">4.2</span> Normalize pollutant concentration by 2018 population and plot concentration per capita trends for eac site type.</a></li>
  <li><a href="#seasonal-trends-in-pollutant-concentration-by-site-type" id="toc-seasonal-trends-in-pollutant-concentration-by-site-type" class="nav-link" data-scroll-target="#seasonal-trends-in-pollutant-concentration-by-site-type"><span class="header-section-number">4.3</span> Seasonal Trends in Pollutant Concentration by Site Type</a></li>
  <li><a href="#regional-trends-in-seasonal-per-capita-pollutant-concentration-20162023" id="toc-regional-trends-in-seasonal-per-capita-pollutant-concentration-20162023" class="nav-link" data-scroll-target="#regional-trends-in-seasonal-per-capita-pollutant-concentration-20162023"><span class="header-section-number">4.4</span> Regional Trends in Seasonal Per Capita Pollutant Concentration (2016–2023)</a></li>
  <li><a href="#comparing-total-and-per-capita-air-pollutant-concentrations-for-2018" id="toc-comparing-total-and-per-capita-air-pollutant-concentrations-for-2018" class="nav-link" data-scroll-target="#comparing-total-and-per-capita-air-pollutant-concentrations-for-2018"><span class="header-section-number">4.5</span> Comparing Total and Per Capita Air Pollutant Concentrations for 2018</a></li>
  <li><a href="#interactive-map-of-2018-particulate-matter-concentrations-by-sa2-region" id="toc-interactive-map-of-2018-particulate-matter-concentrations-by-sa2-region" class="nav-link" data-scroll-target="#interactive-map-of-2018-particulate-matter-concentrations-by-sa2-region"><span class="header-section-number">4.6</span> Interactive Map of 2018 Particulate Matter Concentrations by SA2 Region</a></li>
  <li><a href="#standardizing-daily-air-pollutant-concentrations-for-cross-regional-analysis" id="toc-standardizing-daily-air-pollutant-concentrations-for-cross-regional-analysis" class="nav-link" data-scroll-target="#standardizing-daily-air-pollutant-concentrations-for-cross-regional-analysis"><span class="header-section-number">4.7</span> Standardizing Daily Air Pollutant Concentrations for Cross-Regional Analysis</a></li>
  <li><a href="#seasonal-aggregation-and-visualization-of-air-quality-data-20162023" id="toc-seasonal-aggregation-and-visualization-of-air-quality-data-20162023" class="nav-link" data-scroll-target="#seasonal-aggregation-and-visualization-of-air-quality-data-20162023"><span class="header-section-number">4.8</span> Seasonal Aggregation and Visualization of Air Quality Data (2016–2023)</a></li>
  </ul></li>
  <li><a href="#sa2-level-air-quality-insights-for-auckland-20162023" id="toc-sa2-level-air-quality-insights-for-auckland-20162023" class="nav-link" data-scroll-target="#sa2-level-air-quality-insights-for-auckland-20162023"><span class="header-section-number">5</span> SA2-Level Air Quality Insights for Auckland (2016–2023)</a>
  <ul class="collapse">
  <li><a href="#integrating-and-enriching-air-quality-data-across-auckland-sa2-areas" id="toc-integrating-and-enriching-air-quality-data-across-auckland-sa2-areas" class="nav-link" data-scroll-target="#integrating-and-enriching-air-quality-data-across-auckland-sa2-areas"><span class="header-section-number">5.1</span> Integrating and Enriching Air Quality Data Across Auckland SA2 Areas</a></li>
  <li><a href="#air-quality-index-vs-pollutant-concentrations-across-auckland-suburbs" id="toc-air-quality-index-vs-pollutant-concentrations-across-auckland-suburbs" class="nav-link" data-scroll-target="#air-quality-index-vs-pollutant-concentrations-across-auckland-suburbs"><span class="header-section-number">5.2</span> Air Quality Index vs Pollutant Concentrations Across Auckland Suburbs</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Traffic Density and Air Quality: Comparing Urban and Rural Auckland</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Vishal Goundar </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 28, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="abstract" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="abstract"><span class="header-section-number">1</span> Abstract</h2>
<p>This report analyzes the relationship between traffic density and air quality in urban and rural areas of Auckland, specifically focusing on Patumahoe and Queen Street. Using various air quality metrics and traffic data, we explore trends, correlations, and thresholds for air pollutants.</p>
<details>
<summary>
Data Import and Cleaning
</summary>
</details></section>
<section id="data-from-lawa-on-air-quality" class="level2 tabset" data-number="2">
<h2 class="tabset anchored" data-number="2" data-anchor-id="data-from-lawa-on-air-quality"><span class="header-section-number">2</span> Data from LAWA on Air Quality</h2>
<details>
<summary>
Click to expand: Load LAWA Air Quality Data
</summary>
<section id="load-lawa-file" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="load-lawa-file"><span class="header-section-number">2.1</span> Load LAWA file</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a list of all sheet names in the provided Excel file to understand the structure of the data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>sheet_names <span class="ot">&lt;-</span> <span class="fu">excel_sheets</span>(<span class="st">"data/lawa/lawa_airqualitydownloaddata_2016-2023.xlsx"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>sheet_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Dataset Notices"    "Monitoring dataset" "Ten-year trends"   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Skip the first 7 rows while loading the air quality data from the "Monitoring dataset" sheet</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/lawa/lawa_airqualitydownloaddata_2016-2023.xlsx"</span>, <span class="at">sheet =</span> <span class="st">"Monitoring dataset"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the loaded data to inspect its structure</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 232,293
Columns: 12
$ Region         &lt;chr&gt; "Auckland region", "Auckland region", "Auckland region"…
$ Agency         &lt;chr&gt; "Auckland Council", "Auckland Council", "Auckland Counc…
$ `LAWA Site ID` &lt;chr&gt; "LAWA-100059", "LAWA-100059", "LAWA-100059", "LAWA-1000…
$ `Site Name`    &lt;chr&gt; "Glen Eden", "Glen Eden", "Glen Eden", "Glen Eden", "Gl…
$ `Site ID`      &lt;chr&gt; "67", "67", "67", "67", "67", "67", "67", "67", "67", "…
$ Latitude       &lt;chr&gt; "-36.922142811073", "-36.922142811073", "-36.9221428110…
$ Longitude      &lt;chr&gt; "174.652000900011", "174.652000900011", "174.6520009000…
$ Town           &lt;chr&gt; "Glen Eden", "Glen Eden", "Glen Eden", "Glen Eden", "Gl…
$ `Site Type`    &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Resi…
$ Indicator      &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM10",…
$ `Sample Date`  &lt;dttm&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-0…
$ Concentration  &lt;dbl&gt; 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2, 10.…</code></pre>
</div>
</div>
<ul>
<li>The dataset contains 232,293 observations across 12 columns, detailing air quality measurements in Auckland. It includes site locations, pollutant indicators, concentrations, agencies, and timestamps, primarily tracking pollutant levels in residential areas.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean column names to ensure consistency and remove spaces or special characters</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>(airdata)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the structure of the cleaned data</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [232,293 × 12] (S3: tbl_df/tbl/data.frame)
 $ region       : chr [1:232293] "Auckland region" "Auckland region" "Auckland region" "Auckland region" ...
 $ agency       : chr [1:232293] "Auckland Council" "Auckland Council" "Auckland Council" "Auckland Council" ...
 $ lawa_site_id : chr [1:232293] "LAWA-100059" "LAWA-100059" "LAWA-100059" "LAWA-100059" ...
 $ site_name    : chr [1:232293] "Glen Eden" "Glen Eden" "Glen Eden" "Glen Eden" ...
 $ site_id      : chr [1:232293] "67" "67" "67" "67" ...
 $ latitude     : chr [1:232293] "-36.922142811073" "-36.922142811073" "-36.922142811073" "-36.922142811073" ...
 $ longitude    : chr [1:232293] "174.652000900011" "174.652000900011" "174.652000900011" "174.652000900011" ...
 $ town         : chr [1:232293] "Glen Eden" "Glen Eden" "Glen Eden" "Glen Eden" ...
 $ site_type    : chr [1:232293] "Residential, NES site" "Residential, NES site" "Residential, NES site" "Residential, NES site" ...
 $ indicator    : chr [1:232293] "PM10" "PM10" "PM10" "PM10" ...
 $ sample_date  : POSIXct[1:232293], format: "2016-01-01" "2016-01-02" ...
 $ concentration: num [1:232293] 11.1 10.6 4.7 6.9 13.2 11.1 15.2 10.7 15.2 10.6 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the column for date to a more user-friendly name</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">date =</span> sample_date)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the updated data</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 232,293
Columns: 12
$ region        &lt;chr&gt; "Auckland region", "Auckland region", "Auckland region",…
$ agency        &lt;chr&gt; "Auckland Council", "Auckland Council", "Auckland Counci…
$ lawa_site_id  &lt;chr&gt; "LAWA-100059", "LAWA-100059", "LAWA-100059", "LAWA-10005…
$ site_name     &lt;chr&gt; "Glen Eden", "Glen Eden", "Glen Eden", "Glen Eden", "Gle…
$ site_id       &lt;chr&gt; "67", "67", "67", "67", "67", "67", "67", "67", "67", "6…
$ latitude      &lt;chr&gt; "-36.922142811073", "-36.922142811073", "-36.92214281107…
$ longitude     &lt;chr&gt; "174.652000900011", "174.652000900011", "174.65200090001…
$ town          &lt;chr&gt; "Glen Eden", "Glen Eden", "Glen Eden", "Glen Eden", "Gle…
$ site_type     &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Resid…
$ indicator     &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", …
$ date          &lt;dttm&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01…
$ concentration &lt;dbl&gt; 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2, 10.6…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a 'year' column for further analysis based on the date</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="fu">as.numeric</span>(longitude),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="fu">as.numeric</span>(latitude),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a 'year' column</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">format</span>(date, <span class="st">"%Y"</span>))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of the modified dataset</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    region             agency          lawa_site_id        site_name        
 Length:232293      Length:232293      Length:232293      Length:232293     
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
                                                                            
   site_id             latitude        longitude         town          
 Length:232293      Min.   :-46.43   Min.   :168.3   Length:232293     
 Class :character   1st Qu.:-43.38   1st Qu.:172.6   Class :character  
 Mode  :character   Median :-40.95   Median :174.8   Mode  :character  
                    Mean   :-40.54   Mean   :174.0                     
                    3rd Qu.:-37.78   3rd Qu.:175.7                     
                    Max.   :-35.73   Max.   :178.0                     
                    NA's   :717      NA's   :717                       
  site_type          indicator              date                       
 Length:232293      Length:232293      Min.   :2016-01-01 00:00:00.00  
 Class :character   Class :character   1st Qu.:2018-04-28 00:00:00.00  
 Mode  :character   Mode  :character   Median :2020-04-07 00:00:00.00  
                                       Mean   :2020-03-08 17:45:54.02  
                                       3rd Qu.:2022-02-10 01:00:00.00  
                                       Max.   :2023-12-31 01:00:00.00  
                                                                       
 concentration         year          
 Min.   : -5.568   Length:232293     
 1st Qu.:  6.404   Class :character  
 Median : 10.493   Mode  :character  
 Mean   : 12.661                     
 3rd Qu.: 16.100                     
 Max.   :202.800                     
                                     </code></pre>
</div>
</div>
<ul>
<li>There are 232,293 data observations describing air quality sites, locations, pollutants, dates, and concentration values. 717 missing longitude, and latitude values. Contration of pollutants range from -5.568µg/m³ to 202.8µg/m³.</li>
</ul>
</section></details>
</section>
<section id="air-pollutant-concentration-trends-20162023" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="air-pollutant-concentration-trends-20162023"><span class="header-section-number">2.2</span> Air Pollutant Concentration Trends (2016–2023)</h3>
<p>The boxplots below illustrate yearly trends in pollutant concentrations across New Zealand, highlighting differences in distribution and scale between pollutant types, with and without y-axis restriction.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="air-quality_files/figure-html/visualize-lawa-concentration-distribution-1.png" class="img-fluid figure-img" width="1344"></p>
<figcaption>Air Pollutant Concentration in NZ (2016–2023)</figcaption>
</figure>
</div>
</div>
</div>
<p>PM10 levels are higher, with medians often below 15µg/m³ and frequent extreme outliers (~200µg/m³), suggesting episodic spikes from dust, construction, or fires. PM2.5 shows narrower IQRs and fewer outliers (&lt;90µg/m³), indicating more consistent levels. Though lower in concentration, PM2.5 poses greater long-term health risks due to deeper lung penetration and possible cumulative effects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview observations with invalid concentration</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(concentration <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="fu">is.na</span>(concentration))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  `concentration &lt; 0` `is.na(concentration)`      n
  &lt;lgl&gt;               &lt;lgl&gt;                   &lt;int&gt;
1 FALSE               FALSE                  232186
2 TRUE                FALSE                     107</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 107 observations with negative concentration. None of the concentrations are missing.</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace negative concentration values with NA</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">concentration =</span> <span class="fu">ifelse</span>(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    concentration <span class="sc">&lt;</span> <span class="dv">0</span> , <span class="cn">NA</span>, concentration))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the format of the date column</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the observations with missing longitude and latitude</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(longitude), <span class="fu">is.na</span>(latitude)) <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(town, site_name, latitude, longitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
  town    site_name           latitude longitude     n
  &lt;chr&gt;   &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
1 Rotorua Rotorua at Moses Rd       NA        NA   717</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 717 missing coordinates in town: Rotorua at site_name: Rotorua at Moses Rd</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter Rotorua and count all site_name, longitude, and latitude</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(town <span class="sc">==</span> <span class="st">"Rotorua"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(region, site_name, latitude, longitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  region               site_name            latitude longitude     n
  &lt;chr&gt;                &lt;chr&gt;                   &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
1 Bay of Plenty region Rotorua at Edmund Rd    -38.1      176.  5428
2 Bay of Plenty region Rotorua at Moses Rd      NA         NA    717</code></pre>
</div>
</div>
<p>717 values of latitude and longitude missing for town Rotorua at site_name: Rotorua at Moses Rd. From <a href="https://www.google.com/maps/place/Edmund+Road,+Rotorua+3015/@-38.1365744,176.2093362,16z/data=!4m15!1m8!3m7!1s0x6d6c26fd8a529507:0x880fa5106b1fb10!2sEdmund+Road,+Rotorua+3015!3b1!8m2!3d-38.136431!4d176.214529!16s%2Fg%2F1tdxw6g1!3m5!1s0x6d6c26fd8a529507:0x880fa5106b1fb10!8m2!3d-38.136431!4d176.214529!16s%2Fg%2F1tdxw6g1?entry=ttu&amp;g_ep=EgoyMDI1MDUwNS4wIKXMDSoJLDEwMjExNDUzSAFQAw%3D%3D">Google Maps</a>, These coordinates roughly point to latitude: -38.1482, longitude: 176.2273</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill in missing coordinates for Rotorua at Moses Rd site name with approximate central coordinates from Google Map</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="fu">if_else</span>(</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>      site_name <span class="sc">==</span> <span class="st">"Rotorua at Moses Rd"</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(latitude),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span><span class="fl">38.1482</span>, latitude),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="fu">if_else</span>(</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>      site_name <span class="sc">==</span> <span class="st">"Rotorua at Moses Rd"</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(longitude),</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>      <span class="fl">176.2273</span>, longitude))</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the updated coordinates</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(town <span class="sc">==</span> <span class="st">"Rotorua"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(site_name, latitude, longitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  site_name            latitude longitude     n
  &lt;chr&gt;                   &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
1 Rotorua at Edmund Rd    -38.1      176.  5428
2 Rotorua at Moses Rd     -38.1      176.   717</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify site names with multiple locations</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>repeating_site <span class="ot">&lt;-</span> airdata <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(site_name, longitude, latitude) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(site_name) <span class="sc">%&gt;%</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(site_name)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(repeating_site)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> chr [1:18] "Anzac Square" "Geraldine" "Glen Eden" "Hampstead" "Henderson" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 18 site_name with different longitude and latitude at least once.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview coordinates for Geraldine</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(site_name <span class="sc">==</span> <span class="st">"Geraldine"</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(longitude, latitude), <span class="sc">~</span><span class="fu">format</span>(.x, <span class="at">digits =</span> <span class="dv">16</span>))) <span class="sc">|&gt;</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(longitude, latitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  longitude         latitude          
  &lt;chr&gt;             &lt;chr&gt;             
1 171.2414809999840 -44.10018100044980
2 171.2414809999841 -44.10018100044984</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The difference is in the precision in the 14th decimal places</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview locations for site_name: Anzac Square</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(site_name <span class="sc">==</span> <span class="st">"Anzac Square"</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(longitude, latitude), <span class="sc">~</span><span class="fu">format</span>(.x, <span class="at">digits =</span> <span class="dv">16</span>))) <span class="sc">|&gt;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(longitude, latitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  longitude         latitude          
  &lt;chr&gt;             &lt;chr&gt;             
1 171.2496629996010 -44.40448300080550
2 171.2496629996013 -44.40448300080546</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The difference is in the precision in the 13th and 14th decimal places</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace longitude and latitude with the maximum values for repeating sites</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="fu">max</span>(longitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="fu">max</span>(latitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure only repeating sites were modified</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(site_name, longitude, latitude) <span class="sc">|&gt;</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(site_name) <span class="sc">|&gt;</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 2
# ℹ 2 variables: site_name &lt;chr&gt;, n &lt;int&gt;</code></pre>
</div>
</div>
</section>
<section id="daily-trends-in-pm10-and-pm2.5-by-town" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="daily-trends-in-pm10-and-pm2.5-by-town"><span class="header-section-number">2.3</span> Daily Trends in PM10 and PM2.5 by Town</h3>
<p>This plot highlights daily trends in particulate matter (PM10 and PM2.5) across New Zealand towns from 2016 to 2023, showing peak values and differences in spatial pollution patterns.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 13
Columns: 5
$ date      &lt;date&gt; 2016-04-02, 2016-04-02, 2017-04-01, 2018-03-31, 2019-04-06,…
$ indicator &lt;chr&gt; "PM10", "PM2.5", "PM10", "PM10", "PM10", "PM10", "PM2.5", "P…
$ site_name &lt;chr&gt; "Arrowtown", "Plunket AQ", "Central Dunedin", "Alexandra at …
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Industria…
$ n         &lt;int&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 232,280
Columns: 10
$ date       &lt;date&gt; 2016-01-01, 2016-01-01, 2016-01-01, 2016-01-01, 2016-01-01…
$ year       &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2016", "20…
$ indicator  &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM…
$ site_name  &lt;chr&gt; "126 Hautapu Street", "34 Maata Street", "Anzac Square", "A…
$ site_type  &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Resident…
$ town       &lt;chr&gt; "Taihape", "Taumarunui", "Timaru", "Arrowtown", "Awatoto", …
$ latitude   &lt;dbl&gt; -39.67780, -38.88618, -44.40448, -44.94857, -39.54589, -38.…
$ longitude  &lt;dbl&gt; 175.8008, 175.2710, 171.2497, 168.8457, 176.9191, 175.8584,…
$ mean_conc  &lt;dbl&gt; 8.45400, 10.57200, 16.07100, 7.70000, 29.09000, 6.19802, 10…
$ total_conc &lt;dbl&gt; 8.45400, 10.57200, 16.07100, 7.70000, 29.09000, 6.19802, 10…</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-daily-pollutant-trends-by-town-1.png" class="img-fluid figure-img" width="1344"></p>
<figcaption>Daily PM10 and PM2.5 concentrations by town (2016–2023)</figcaption>
</figure>
</div>
</div>
</div>
<p>Both PM10 and PM2.5 concentrations exhibit noticeable winter peaks (June–August) across multiple years, likely due to increased heating emissions and meteorological conditions. Summer months tend to have lower pollutant levels, reflecting improved dispersion and reduced combustion-based emissions. Occasional extreme peaks, mostly during winter months exceeding 100 µg/m³ (PM10) and 50 µg/m³ (PM2.5) indicate episodes of significantly poor air quality. Milton, Arrowtown, Timaru, Central Lower Hutt, and Tokoroa frequently experience PM10 spikes, while Rotorua, Kaiapoi, and Tokoroa see more PM2.5 surges, likely influenced by industry, transport, or topography. Pollutant levels fluctuate due to wind speed, temperature inversions, and precipitation, while seasonal trends are shaped by emissions from traffic, industrial activities, and wood burning.</p>
</section>

<section id="spatial-plot-of-pollutant-concentration-across-nz-20162023" class="level2 tabset" data-number="3">
<h2 class="tabset anchored" data-number="3" data-anchor-id="spatial-plot-of-pollutant-concentration-across-nz-20162023"><span class="header-section-number">3</span> Spatial Plot of Pollutant Concentration Across NZ (2016–2023)</h2>
<p>This map shows average PM10 and PM2.5 concentrations at monitoring sites across New Zealand, projected using NZTM2000. Higher values are observed in densely populated urban regions.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 103
Columns: 6
$ town      &lt;chr&gt; "Alexandra", "Arrowtown", "Ashburton", "Ashburton", "Aucklan…
$ site_name &lt;chr&gt; "Alexandra at 5 Ventry Street", "Arrowtown", "Hampstead", "H…
$ longitude &lt;dbl&gt; 169.3903, 168.8457, 171.7552, 171.7552, 174.7657, 174.7657, …
$ latitude  &lt;dbl&gt; -45.25485, -44.94857, -43.91224, -43.91224, -36.84743, -36.8…
$ indicator &lt;chr&gt; "PM10", "PM10", "PM10", "PM2.5", "PM10", "PM2.5", "PM10", "P…
$ mean_conc &lt;dbl&gt; 14.788923, 16.990257, 15.981660, 8.663412, 17.300244, 7.1823…</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  indicator   min   max     n
  &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
1 PM10       4.69  30.9    66
2 PM2.5      4.69  30.9    37</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 103
Columns: 5
$ town      &lt;chr&gt; "Alexandra", "Arrowtown", "Ashburton", "Ashburton", "Aucklan…
$ site_name &lt;chr&gt; "Alexandra at 5 Ventry Street", "Arrowtown", "Hampstead", "H…
$ indicator &lt;chr&gt; "PM10", "PM10", "PM10", "PM2.5", "PM10", "PM2.5", "PM10", "P…
$ mean_conc &lt;dbl&gt; 14.788923, 16.990257, 15.981660, 8.663412, 17.300244, 7.1823…
$ geometry  &lt;POINT [m]&gt; POINT (1316769 4982397), POINT (1272287 5014362), POIN…</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="air-quality_files/figure-html/Spatially-plot-average-pollutant-level-over-all-years-1.png" class="img-fluid figure-img" width="1344"></p>
<figcaption>Spatial distribution of average PM10 and PM2.5 concentrations (2016–2023)</figcaption>
</figure>
</div>
</div>
</div>
<p>PM10 and PM2.5 spatial distributions across New Zealand show differing average pollutant concentration patterns. PM10 concentrations exhibit broader regional variability, with high levels in Timaru, Arrowtown, Gore. PM2.5 concentrations appear more localized, clustering around major urban centers. The color gradient further emphasizes intensity differences, with PM10 displaying a more dispersed pattern.</p>
<section id="yearly-total-concentrations-of-pm10-and-pm2.5-at-nz-monitoring-sites" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="yearly-total-concentrations-of-pm10-and-pm2.5-at-nz-monitoring-sites"><span class="header-section-number">3.1</span> Yearly Total Concentrations of PM10 and PM2.5 at NZ Monitoring Sites</h3>
<p>This plot compares annual total pollutant concentrations at air quality sites across New Zealand from 2016 to 2023. Towns with the lowest and highest yearly values are labelled.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
   57.44  2993.20  4073.38  4148.35  5185.62 10859.53 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 32
Columns: 6
$ year       &lt;chr&gt; "2016", "2016", "2016", "2016", "2017", "2017", "2017", "20…
$ town       &lt;chr&gt; "Blenheim", "Nelson Centre/North", "Timaru", "Timaru", "Ble…
$ indicator  &lt;chr&gt; "PM2.5", "PM10", "PM10", "PM2.5", "PM2.5", "PM10", "PM2.5",…
$ latitude   &lt;dbl&gt; -41.52664, -41.28196, -44.40448, -44.40448, -41.52664, -41.…
$ longitude  &lt;dbl&gt; 173.9561, 173.2908, 171.2497, 171.2497, 173.9561, 173.2908,…
$ total_conc &lt;dbl&gt; 57.4400, 1644.5000, 8578.9230, 4666.7880, 5220.9400, 1919.5…</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-yearly-total-concentrations-at-nz-sites-1.png" class="img-fluid figure-img" width="1344"></p>
<figcaption>Boxplots of yearly total PM10 and PM2.5 concentrations across NZ sites (2016–2023)</figcaption>
</figure>
</div>
</div>
</div>
<p>Locations such as Timaru, Invercargill, and Mount Maunganui frequently appear with higher PM10 values, suggesting regional emissions from transport, industry, or meteorological conditions. Lower PM10 levels are recorded at Nelson Centre/North, Stoke, Gisborne, and Christchurch, indicating relatively better air quality in these areas.</p>
<p>Timaru, Blenheim, Tokoroa, and Kaiapoi consistently report elevated PM2.5 levels, emphasizing finer particulate pollution concerns, possibly linked to combustion sources. Sites like Blenheim, Nelson South, Hamilton, Te Kuiti, Patumahoe, Christchurch, Napier, and Awatoto exhibit lower PM2.5 concentrations, suggesting fewer major emission sources or better pollutant dispersion.</p>
<p>Seasonal influences (e.g., winter heating emissions) could explain peaks in both PM10 and PM2.5. Site-specific pollutant sources (e.g., traffic, industry, and wood burning) contribute to long-term trends.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add last two digits of year in column year</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>dailyairdata <span class="ot">&lt;-</span> dailyairdata <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">format</span>(date, <span class="st">"%y"</span>),</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">month =</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(date, <span class="st">"%m"</span>)))</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate pollutant concentrations per season per year</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>dailyairdata <span class="ot">&lt;-</span> dailyairdata <span class="sc">|&gt;</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">season =</span> <span class="fu">case_when</span>(</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">~</span> <span class="st">"Sum"</span>,</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">~</span> <span class="st">"Aut"</span>,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>) <span class="sc">~</span> <span class="st">"Win"</span>,</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>) <span class="sc">~</span> <span class="st">"Spr"</span>),</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">season_year =</span> <span class="fu">paste0</span>(season, <span class="st">"_"</span>, year))</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>season_order <span class="ot">&lt;-</span> <span class="fu">unique</span>(dailyairdata<span class="sc">$</span>season_year)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>seasonairdata <span class="ot">&lt;-</span> dailyairdata <span class="sc">|&gt;</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">season_year =</span> <span class="fu">factor</span>(season_year, <span class="at">levels =</span> season_order, <span class="at">ordered =</span> <span class="cn">TRUE</span>))</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>seasonairdata <span class="ot">&lt;-</span> seasonairdata <span class="sc">|&gt;</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season_year, town, indicator) <span class="sc">|&gt;</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_conc =</span> <span class="fu">sum</span>(total_conc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(seasonairdata<span class="sc">$</span>total_conc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    8.0   624.5  1025.2  1189.8  1399.4 12305.8 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seasonal total concentration range from 7.1µg/m³ to 31168.9µg/m³, so using log scale is valid.</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter town with the seasonal lowest and highest concentration of pollutants</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>text_label <span class="ot">&lt;-</span> seasonairdata <span class="sc">|&gt;</span> </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season_year, indicator) <span class="sc">|&gt;</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(total_conc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="fu">min</span>(total_conc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">max</span>(total_conc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">|&gt;</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(text_label)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 128
Columns: 4
$ season_year &lt;ord&gt; Sum_16, Sum_16, Sum_16, Sum_16, Aut_16, Aut_16, Aut_16, Au…
$ town        &lt;chr&gt; "Blenheim", "Christchurch", "Christchurch", "Nelson Centre…
$ indicator   &lt;chr&gt; "PM2.5", "PM10", "PM2.5", "PM10", "PM10", "PM2.5", "PM10",…
$ total_conc  &lt;dbl&gt; 57.440, 3136.030, 1147.860, 159.000, 3125.592, 1403.090, 2…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot seasonal total pollutant concentration across NZ monitoring sites (2016–2023), using boxplots, with towns labelled at the annual minimum and maximum concentration levels</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>plot_season <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> seasonairdata, <span class="fu">aes</span>(<span class="at">x =</span> season_year, <span class="at">y =</span> total_conc)) <span class="sc">+</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> town, <span class="at">color =</span> town), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> text_label,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> season_year, <span class="at">y =</span> total_conc, <span class="at">label =</span> town), <span class="at">font_face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">nudge_y =</span> <span class="fl">0.1</span>, <span class="at">check_overlap =</span> <span class="cn">TRUE</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> indicator, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>scientific) <span class="sc">+</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Total Pollutant Concentrations across Monitoring Multiple Sites in New Zealand (2016-2023)"</span>,</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Seasonal total PM10 and PM2.5 concentrations, with towns labelled at annual extremes"</span>,</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Season Year"</span>,</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Seasonal Pollutant Concentration (µg/m³)"</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>plot_season</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-seasonal-total-concentration-for-each-year-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
<p>The plots show seasonal PM10 and PM2.5 trends (2016–2023) across NZ. PM10 levels are higher, with peaks in Mount Maunganui, Masterton, and Christchurch. PM2.5 peaks in Christchurch, Masterton, and Timaru. Both show winter highs and summer lows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect subgroup of longitude, latitude, site_type, and town</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>airdata_group <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(longitude, latitude, site_type, town)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 69
Columns: 4
$ longitude &lt;dbl&gt; 174.6520, 174.6284, 174.6284, 174.8904, 174.8640, 174.8156, …
$ latitude  &lt;dbl&gt; -36.92214, -36.86800, -36.86800, -36.90548, -37.20450, -36.9…
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, Traffic, NES site", "…
$ town      &lt;chr&gt; "Glen Eden", "Henderson", "Henderson", "Pakuranga", "Patumah…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 69 data observations.</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create label dataset of coordinates, and town</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>label_text <span class="ot">&lt;-</span> airdata_group <span class="sc">|&gt;</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(latitude, longitude, town)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(label_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 67
Columns: 3
$ latitude  &lt;dbl&gt; -36.92214, -36.86800, -36.90548, -37.20450, -36.90456, -36.8…
$ longitude &lt;dbl&gt; 174.6520, 174.6284, 174.8904, 174.8640, 174.8156, 174.7657, …
$ town      &lt;chr&gt; "Glen Eden", "Henderson", "Pakuranga", "Patumahoe", "Penrose…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a static map of spatial distribution of site types</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> airdata_group) <span class="sc">+</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">color =</span> site_type), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> label_text, <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">label =</span> town)) <span class="sc">+</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"turbo"</span>) <span class="sc">+</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Spatial Distribution of Air Quality Monitoring Site Type in New Zealand (2016–2023)"</span>,</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Monitoring site locations grouped by type"</span>,</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>, <span class="at">color =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"gray80"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>),</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>plot1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/Static-plot-of-lawa-site-types-monitoring-locations-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
<p>Residential sites are widespread, especially in southern cities like Invercargill and Christchurch. Industrial and mixed-use sites cluster in urban areas such as Wellington and Auckland. Coastal sites are scattered, with notable presence in Wellington and Taupo, reflecting urban and industrial monitoring priorities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by date, indicator, site_name, site_type, comput sum of concentrations</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>dailyairdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date, indicator, site_name, site_type) <span class="sc">|&gt;</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_conc =</span> <span class="fu">sum</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dailyairdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 232,280
Columns: 5
$ date       &lt;date&gt; 2016-01-01, 2016-01-01, 2016-01-01, 2016-01-01, 2016-01-01…
$ indicator  &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM…
$ site_name  &lt;chr&gt; "126 Hautapu Street", "34 Maata Street", "Anzac Square", "A…
$ site_type  &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Resident…
$ total_conc &lt;dbl&gt; 8.45400, 10.57200, 16.07100, 7.70000, 29.09000, 6.19802, 10…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a plot of PM2.5 and PM10 concentration versus date faceted by site_type</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dailyairdata, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> total_conc, <span class="at">color =</span> indicator)) <span class="sc">+</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># geom_text_repel(data = label_text, aes(x = longitude, y = latitude, label = town)) +</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"PM10"</span> <span class="ot">=</span> <span class="st">"#0072B2"</span>, <span class="st">"PM2.5"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>)) <span class="sc">+</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> site_type, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span> </span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Daily PM2.5 and PM10 Concentration versus Date at Site Types in New Zealand (2016–2023)"</span>,</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Pollutant Concentration grouped by Monitoring site locations type"</span>,</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Daily total concentration (µg/m³)"</span>,</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Indicator"</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot1</span></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>plot1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot_site-types-of-concentration-versus-date-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot1)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot restricted by y axis for more than 25</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> plot1 <span class="sc">+</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="cn">NA</span>)) <span class="sc">+</span> </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Pollutant Concentration Restricted for at least 25µg/m³"</span>,</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot2</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>plot2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot_site-types-of-concentration-versus-date-2.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
<p>PM10 levels consistently exceed PM2.5, peaking in winter, especially at residential and NES sites, likely from wood burning. Industrial sites show high but less extreme values. Coastal and traffic sites show lower levels. Site type and season strongly influence pollution patterns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute scalar medians (as single value)</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>median16_pm25 <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(indicator <span class="sc">==</span> <span class="st">"PM2.5"</span>, year <span class="sc">==</span> <span class="dv">2016</span>) <span class="sc">|&gt;</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">median_val =</span> <span class="fu">median</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(median_val)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute scaler medians (as single value)</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>median16_pm10 <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(indicator <span class="sc">==</span> <span class="st">"PM10"</span>, year <span class="sc">==</span> <span class="dv">2016</span>) <span class="sc">|&gt;</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">median_val =</span> <span class="fu">median</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(median_val)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a new column using scalar values properly</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>normalize_airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">baseline =</span> <span class="fu">case_when</span>(</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>    indicator <span class="sc">==</span> <span class="st">"PM2.5"</span> <span class="sc">~</span> median16_pm25,</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>    indicator <span class="sc">==</span> <span class="st">"PM10"</span>  <span class="sc">~</span> median16_pm10,</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span>  <span class="co"># fallback for other indicators</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute normalized concentration values relative to the 2016 baseline</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>normalize_airdata <span class="ot">&lt;-</span> normalize_airdata <span class="sc">|&gt;</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">normalized_concentration =</span> concentration <span class="sc">/</span> baseline)</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly select 6 towns from the dataset for visualization</span></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">13</span>) <span class="co"># For reproducibility</span></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>townlist <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">unique</span>(airdata<span class="sc">$</span>town), <span class="dv">10</span>)</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the dataset to include only the selected towns</span></span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>normalize_filtered <span class="ot">&lt;-</span> normalize_airdata <span class="sc">|&gt;</span></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(town <span class="sc">%in%</span> townlist) <span class="sc">|&gt;</span></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">town_indicator =</span> <span class="fu">paste0</span>(town, <span class="st">"_"</span>, indicator))</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a faceted plot to visualize pollutant trends, highlighting differences across towns</span></span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">filter</span>(normalize_filtered), <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y =</span> normalized_concentration)) <span class="sc">+</span></span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> indicator), <span class="at">lwd=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> town_indicator, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"turbo"</span>) <span class="sc">+</span></span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Normalized Air Pollutant Concentrations Across Selected New Zealand Towns (2016–2023)"</span>,</span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"PM2.5 and PM10 Levels Adjusted to 2016 Median Concentration for Comparative Analysis"</span>,</span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Normalized Pollutant Concentration (Relative to 2016 Median)"</span>,</span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend =</span> <span class="st">"Pollutant Type"</span></span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a>   <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a>   <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a>   <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a>   <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a>   <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb49-57"><a href="#cb49-57" aria-hidden="true" tabindex="-1"></a>plot1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/normalized-pollution-trends-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
<p>Compared to the 2016 median concentration, PM2.5 and PM10 levels show varied trends across locations. Auckland City Centre and Rotorua exhibit sharp PM2.5 spikes around 2020, while Cromwell and Timaru experience periodic peaks in both pollutants. Other towns display stable or fluctuating patterns, with some decreasing trends in PM2.5. These changes indicate local factors affecting air quality, including urban emissions, seasonal variations, and regulatory impacts on pollutant concentrations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(region, site_type, site_name, site_id, latitude, longitude, town) <span class="sc">|&gt;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  region          site_type     site_name site_id latitude longitude town      n
  &lt;chr&gt;           &lt;chr&gt;         &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;int&gt;
1 Auckland region Residential,… Penrose   7          -36.9      175. Penr…  5466
2 Auckland region Residential,… Glen Eden 67         -36.9      175. Glen…  2827
3 Auckland region Residential,… Henderson 5          -36.9      175. Hend…   361
4 Auckland region Residential,… Pakuranga 1          -36.9      175. Paku…  2876
5 Auckland region Residential,… Patumahoe 2          -37.2      175. Patu…  5390
6 Auckland region Residential,… Queen St… 9          -36.8      175. Quee…   460</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the list of unique town from the airdata</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>town_list <span class="ot">&lt;-</span> <span class="fu">unique</span>(airdata<span class="sc">$</span>town)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the list to ensure valid sampling</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(town_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> chr [1:56] "Glen Eden" "Henderson" "Pakuranga" "Patumahoe" "Penrose" ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly select 10 town from the list (seeded for reproducibility)</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">13</span>)  </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>random_town <span class="ot">&lt;-</span> <span class="fu">sample</span>(town_list, <span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the randomly selected towns</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>random_town</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Auckland City Centre" "Cromwell"             "Morrinsville"        
 [4] "Napier"               "Pakuranga"            "Patumahoe"           
 [7] "Rotorua"              "Stoke"                "Taihape"             
[10] "Timaru"              </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by region and filter airdata for the 10 randomly selected towns </span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>airdata_random_town <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(town <span class="sc">%in%</span> random_town) <span class="sc">|&gt;</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Count number of distinct town, date, indicator</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>airdata_random_town <span class="sc">|&gt;</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(town, date, indicator) <span class="sc">|&gt;</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  town    date       indicator     n
  &lt;chr&gt;   &lt;date&gt;     &lt;chr&gt;     &lt;int&gt;
1 Rotorua 2023-01-01 PM10          2
2 Rotorua 2023-01-01 PM2.5         2
3 Rotorua 2023-01-02 PM10          2
4 Rotorua 2023-01-02 PM2.5         2
5 Rotorua 2023-01-03 PM10          2
6 Rotorua 2023-01-03 PM2.5         2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate total concentration for each town by date and indicator to prepare for plotting</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>airdata_random_town <span class="ot">&lt;-</span> airdata_random_town <span class="sc">|&gt;</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(town, date, indicator) <span class="sc">|&gt;</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_conc =</span> <span class="fu">sum</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the aggregated data</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata_random_town)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 34,897
Columns: 4
$ town       &lt;chr&gt; "Auckland City Centre", "Auckland City Centre", "Auckland C…
$ date       &lt;date&gt; 2017-03-04, 2017-03-05, 2017-03-06, 2017-03-07, 2017-03-08…
$ indicator  &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM…
$ total_conc &lt;dbl&gt; 11.5, 15.4, 14.7, 13.4, 8.2, 11.4, 20.3, 18.2, 20.7, 19.5, …</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the summary of total_conc of randomly selected town</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>airdata_random_town <span class="sc">|&gt;</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     town                date             indicator           total_conc     
 Length:34897       Min.   :2016-01-01   Length:34897       Min.   :  0.000  
 Class :character   1st Qu.:2018-02-13   Class :character   1st Qu.:  6.828  
 Mode  :character   Median :2020-01-19   Mode  :character   Median : 10.851  
                    Mean   :2020-01-14                      Mean   : 14.220  
                    3rd Qu.:2021-12-05                      3rd Qu.: 16.723  
                    Max.   :2023-12-31                      Max.   :159.579  </code></pre>
</div>
</div>
<ul>
<li>Total_conc range from 0 to 159.579 from 1 January 2016 to 31 December 2023.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace zero's with 1e-05, since log works on positive values</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>airdata_random_town <span class="ot">&lt;-</span> airdata_random_town <span class="sc">|&gt;</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_conc =</span> <span class="fu">ifelse</span>(</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>      total_conc <span class="sc">==</span> <span class="dv">0</span>, <span class="fl">1e-05</span>, total_conc))</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(airdata_random_town<span class="sc">$</span>total_conc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
  0.00001   6.82817  10.85118  14.21979  16.72300 159.57900 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Colorblind-friendly palette (Okabe-Ito)</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>colorblind_palette <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#999999"</span>, <span class="st">"#E69F00"</span>, <span class="st">"#440154"</span>, <span class="st">"#F0E442"</span>, <span class="st">"#009E73"</span>, <span class="st">"#D55E00"</span>, <span class="st">"#35b779"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#000000"</span>, <span class="st">"#660099"</span>, <span class="st">"#CC79A7"</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a reusable function to plot airdata concentration trends by selected town, indicator, and date. This function uses faceted plots with colorblind-friendly palettes for better accessibility</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>plot_selected_conc <span class="ot">&lt;-</span> <span class="cf">function</span>(data, title, subtitle, x_label, y_label, sum_var) {</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the plot using ggplot2</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> {{ sum_var }}, <span class="at">color =</span> indicator)) <span class="sc">+</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colorblind_palette) <span class="sc">+</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> town, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> title,</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> subtitle,</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> x_label,</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> y_label,</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"Indicator"</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>), <span class="co"># Center the main title</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot log-scaled airdata trends for 10 randomly selected towns using the custom plot function. The plot will show daily PM10 and PM2.5 concentrations across towns, scaled logarithmically.</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>plot_random_log <span class="ot">&lt;-</span> <span class="fu">plot_selected_conc</span>(</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> airdata_random_town,</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Air Pollutant Concentration Trends in 10 Random Town (2016-2023)"</span>,</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">subtitle =</span> <span class="st">"Log-scaled daily PM10, and PM2.5 concentration by indicatior"</span>,</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_label =</span> <span class="st">"Month-Year"</span>,</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_label =</span> <span class="st">"Daily Concentration (log scale)"</span>,</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">sum_var =</span> total_conc</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2016-01-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2023-12-31"</span>), <span class="at">by =</span> <span class="st">"6 months"</span>),</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">date_labels =</span> <span class="st">"%b %y"</span> <span class="co"># Format date for better readability</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_scientific</span>()) <span class="co"># Use log scale for concentration</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>plot_random_log</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/log-plot-lawa-concentration-trends-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
<p>Auckland shows stable PM levels, while Napier and Timaru have frequent seasonal spikes. Cromwell and Stoke reveal distinct 2023 patterns. Other towns remain stable. PM10 and PM2.5 generally align, though PM2.5 varies more, highlighting seasonal and source-specific pollution influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(site_name <span class="sc">%in%</span> town)) <span class="sc">|&gt;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(site_name, town)  <span class="sc">|&gt;</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [51 × 3] (S3: tbl_df/tbl/data.frame)
 $ site_name: chr [1:51] "126 Hautapu Street" "34 Maata Street" "Alexandra at 5 Ventry Street" "Anzac Square" ...
 $ town     : chr [1:51] "Taihape" "Taumarunui" "Alexandra" "Timaru" ...
 $ n        : int [1:51] 3072 3466 2333 5829 4782 5272 5177 2864 2675 2783 ...</code></pre>
</div>
</div>
<p>51 site_name are not same as 51 town.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview multiple groups of coordinates and region</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(longitude, latitude, region) <span class="sc">|&gt;</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  longitude latitude region                   n
      &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;                &lt;int&gt;
1      176.    -38.1 Bay of Plenty region   717
2      177.    -39.6 Hawke's Bay region    5336
3      177.    -39.5 Hawke's Bay region    3748
4      177.    -39.5 Hawke's Bay region    4782
5      177.    -38.0 Bay of Plenty region  2203
6      178.    -38.7 Gisborne region       3071</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the word region in region column then trim white space</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">str_trim</span>(<span class="fu">str_remove</span>(region, <span class="fu">regex</span>(<span class="st">"region"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))))</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(airdata<span class="sc">$</span>region, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "West Coast" "West Coast" "West Coast"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>official_nz_regions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Northland"</span>, <span class="st">"Auckland"</span>, <span class="st">"Waikato"</span>, <span class="st">"Bay of Plenty"</span>, <span class="st">"Gisborne"</span>, <span class="st">"Hawke's Bay"</span>, <span class="st">"Taranaki"</span>, <span class="st">"Manawatu-Whanganui"</span>, <span class="st">"Wellington"</span>, <span class="st">"Tasman"</span>, <span class="st">"Nelson"</span>, <span class="st">"Marlborough"</span>, <span class="st">"West Coast"</span>, <span class="st">"Canterbury"</span>, <span class="st">"Otago"</span>, <span class="st">"Southland"</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview regions in airdata not in the official list of NZ regions</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>airdata <span class="sc">|&gt;</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(region <span class="sc">%in%</span> official_nz_regions)) <span class="sc">|&gt;</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  region                 n
  &lt;chr&gt;              &lt;int&gt;
1 Manawatū-Whanganui  6538</code></pre>
</div>
</div>
<p>We need to clean Manawatu-Whanganui region. It has bar on top of u in Manawatu.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean region name Manawatu-Whanganui</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span> </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">ifelse</span>(region <span class="sc">==</span> <span class="st">"Manawatū-Whanganui"</span>, <span class="st">"Manawatu-Whanganui"</span>, region))</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute total concentration of groups of coordinates and region</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>region_airdata <span class="ot">&lt;-</span> airdata <span class="sc">|&gt;</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="fu">round</span>(longitude, <span class="dv">5</span>), </span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="fu">round</span>(latitude, <span class="dv">5</span>),</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_conc =</span> <span class="fu">sum</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(region_airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [232,293 × 4] (S3: tbl_df/tbl/data.frame)
 $ region    : chr [1:232293] "Auckland" "Auckland" "Auckland" "Auckland" ...
 $ longitude : num [1:232293] 175 175 175 175 175 ...
 $ latitude  : num [1:232293] -36.9 -36.9 -36.9 -36.9 -36.9 ...
 $ total_conc: num [1:232293] 318149 318149 318149 318149 318149 ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count location coordinates </span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>region_airdata <span class="sc">|&gt;</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">"Wellington"</span>) <span class="sc">|&gt;</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(longitude, latitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  longitude latitude     n
      &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
1      175.    -41.3  5666
2      175.    -41.2  2892
3      175.    -41.3  5776
4      175.    -41.1  2897
5      176.    -41.0  5663
6      176.    -41.0  4388</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect coordinates and region for labelling</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>label_text <span class="ot">&lt;-</span> region_airdata <span class="sc">|&gt;</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, total_conc) <span class="sc">|&gt;</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="fu">min</span>(longitude), <span class="at">latitude =</span> <span class="fu">min</span>(latitude),</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(label_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [15 × 4] (S3: tbl_df/tbl/data.frame)
 $ region    : chr [1:15] "Auckland" "Bay of Plenty" "Canterbury" "Gisborne" ...
 $ total_conc: num [1:15] 318149 317754 643087 47055 166544 ...
 $ longitude : num [1:15] 175 176 171 178 177 ...
 $ latitude  : num [1:15] -37.2 -38.1 -44.7 -38.7 -39.6 ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Get New Zealand map</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>nz_map <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">country =</span> <span class="st">"New Zealand"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot monitoring sites locatioms colored total concentration by region</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> nz_map) <span class="sc">+</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">fill =</span> <span class="st">"gray95"</span>, <span class="at">color =</span> <span class="st">"gray80"</span>) <span class="sc">+</span>  <span class="co"># Basemap</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> region_airdata, </span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">color =</span> total_conc), <span class="at">size =</span> <span class="dv">5</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> label_text, <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">label =</span> region, <span class="at">color =</span> total_conc),</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">box.padding =</span> <span class="fl">0.3</span>, <span class="at">segment.color =</span> <span class="st">"grey30"</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">trans =</span> <span class="st">"log10"</span>,</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_scientific</span>()) <span class="sc">+</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">165</span>, <span class="dv">180</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">48</span>, <span class="sc">-</span><span class="dv">34</span>)) <span class="sc">+</span> <span class="co"># Add coord_sf to zoom in to nz</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Total Region Pollutant concentrations from Monitoring Sites locations in New Zealand"</span>,</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Longitude"</span>,</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Latitude"</span>,</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Total Pollutant</span><span class="sc">\n</span><span class="st">Concentration (µg/m³)"</span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span>  <span class="co"># Add title</span></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>) <span class="sc">+</span>  <span class="co"># Adds scale bar</span></span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tl"</span>, <span class="at">which_north =</span> <span class="st">"true"</span>, <span class="at">style =</span> <span class="fu">north_arrow_fancy_orienteering</span>())</span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Save map as PDF</span></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/map-lawa-total-concentration-by-region-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Areas such as Auckland and Canterbury exhibit higher overall pollution levels, likely due to urban density, traffic emissions, and industrial activities. The more rural regions like Gisbourne appear in cooler colors, indicating lower concentrations.</p>
</section>
</section>
<section id="load-2018-population-data-and-regional-map-data-from-stats-nz" class="level2 tabset" data-number="4">
<h2 class="tabset anchored" data-number="4" data-anchor-id="load-2018-population-data-and-regional-map-data-from-stats-nz"><span class="header-section-number">4</span> Load 2018 population data and regional map data from Stats NZ</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the spatial data (GeoPackage) for SA2 regions</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>sa2_nz <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/SA2_nz.gpkg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `SA2_NZ' from data source 
  `C:\Users\vishal\Documents\Earthsci705\projectfile\project\data\SA2_NZ.gpkg' 
  using driver `GPKG'
Simple feature collection with 2151 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 1089970 ymin: 4747987 xmax: 2470102 ymax: 6194308
Projected CRS: NZGD2000 / New Zealand Transverse Mercator 2000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the spatial data structure</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(sa2_nz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,151
Columns: 4
$ SA2_Name &lt;chr&gt; "North Cape", "Rangaunu Harbour", "Karikari Peninsula", "Tang…
$ SA2_ID   &lt;int&gt; 100100, 100200, 100400, 100500, 102100, 102200, 102300, 10240…
$ Pop2018  &lt;int&gt; 1660, 2410, 1300, 1180, 1290, 2200, 1290, 1550, 900, 1760, 11…
$ geom     &lt;MULTIPOLYGON [m]&gt; MULTIPOLYGON (((1596201 615..., MULTIPOLYGON (((…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The SA2_NZ layer was read from a GeoPackage file using the GPKG driver. It contains 2,151 features with three attribute fields and multipolygon geometries in the NZGD2000 Transverse Mercator projection.</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load regional map data from [regions](https://datafinder.stats.govt.nz/layer/104254-regional-council-2020-generalised/)</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load a shape file of regions</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>regions <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/statsnz-regional-council-2020-generalised-SHP/regional-council-2020-generalised.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `regional-council-2020-generalised' from data source 
  `C:\Users\vishal\Documents\Earthsci705\projectfile\project\data\statsnz-regional-council-2020-generalised-SHP\regional-council-2020-generalised.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 17 features and 6 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 1067061 ymin: 4701317 xmax: 2523320 ymax: 6242140
Projected CRS: NZGD2000 / New Zealand Transverse Mercator 2000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(regions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 17
Columns: 7
$ REGC2020_V &lt;chr&gt; "02", "03", "04", "05", "06", "07", "08", "09", "12", "13",…
$ REGC2020_1 &lt;chr&gt; "Auckland Region", "Waikato Region", "Bay of Plenty Region"…
$ REGC2020_2 &lt;chr&gt; "Auckland Region", "Waikato Region", "Bay of Plenty Region"…
$ LAND_AREA_ &lt;dbl&gt; 4941.0723, 23900.3640, 12071.8091, 8385.3265, 14138.0113, 7…
$ AREA_SQ_KM &lt;dbl&gt; 16156.206, 34888.831, 21883.748, 13989.051, 21444.166, 1269…
$ SHAPE_Leng &lt;dbl&gt; 660973.5, 1268419.5, 1093733.7, 695917.9, 928783.7, 564431.…
$ geometry   &lt;MULTIPOLYGON [m]&gt; MULTIPOLYGON (((1745493 600..., MULTIPOLYGON (…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The regional-council-2020-generalised layer, read from an ESRI Shapefile, contains 17 multipolygon features representing New Zealand's regional councils. It includes six attribute fields and uses the NZGD2000 Transverse Mercator projected coordinate system for spatial reference.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="spatial-join-of-datasets-population-and-region" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="spatial-join-of-datasets-population-and-region"><span class="header-section-number">4.1</span> Spatial join of datasets: population and region</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find values from regions columns which does not match</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(regions) <span class="sc">|&gt;</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(REGC2020_1 <span class="sc">!=</span> REGC2020_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  REGC2020_V                REGC2020_1                REGC2020_2 LAND_AREA_
1         08 Manawatū-Whanganui Region Manawatu-Whanganui Region   22220.58
  AREA_SQ_KM SHAPE_Leng                       geometry
1   25322.14    1176349 MULTIPOLYGON (((1823327 573...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The two columns are different for Manawatu, which has a bar on top in one and the REGC2020_2 does not. Let's select REGC2020_2.</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure both layers are in same CRS</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(sa2_nz)<span class="sc">$</span>epsg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2193</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(regions)<span class="sc">$</span>epsg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2193</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># They are same, both sa2_nz and regions datasets are in crs of epsg:2193</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform a spatial join to assign each SA2 to a region</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>sa2_nz <span class="ot">&lt;-</span> <span class="fu">st_join</span>(sa2_nz, regions[, <span class="fu">c</span>(<span class="st">"REGC2020_2"</span>, <span class="st">"geometry"</span>)]) </span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview column names of sa2_nz</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sa2_nz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SA2_Name"   "SA2_ID"     "Pop2018"    "REGC2020_2" "geom"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 5 columns of SA2_Name, SA2_ID, Pop2018, REGC2020_2, and geom </span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Count added regions</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="fu">st_drop_geometry</span>(sa2_nz) <span class="sc">|&gt;</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(REGC2020_2) <span class="sc">|&gt;</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   17 obs. of  1 variable:
 $ REGC2020_2: chr  "Northland Region" "Auckland Region" "Bay of Plenty Region" "Taranaki Region" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The column contains 17 distinct regions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform the coordinate reference system (CRS) of sa2_nz to WGS84</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>sa2_nz <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(sa2_nz, <span class="at">crs =</span> <span class="dv">4326</span>)  </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(sa2_nz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,332
Columns: 5
$ SA2_Name   &lt;chr&gt; "North Cape", "Rangaunu Harbour", "Karikari Peninsula", "Ta…
$ SA2_ID     &lt;int&gt; 100100, 100200, 100400, 100500, 102100, 102200, 102300, 102…
$ Pop2018    &lt;int&gt; 1660, 2410, 1300, 1180, 1290, 2200, 1290, 1550, 900, 1760, …
$ REGC2020_2 &lt;chr&gt; "Northland Region", "Northland Region", "Northland Region",…
$ geom       &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((172.9585 -3..., MULTIPOLYGON (…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This dataset includes 2,332 rows with SA2 names, IDs, 2018 population data, regional council names, and multipolygon geometries, representing spatial boundaries for statistical areas across New Zealand.</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check class of geom</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(sa2_nz<span class="sc">$</span>geom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sfc_MULTIPOLYGON" "sfc"             </code></pre>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The geom column in sa2_nz is of class sfc_MULTIPOLYGON, meaning it stores spatial features as multipolygons using the simple features (sf) framework for geospatial vector data in R.</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean column names of sa2_nz </span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>sa2_nz <span class="ot">&lt;-</span> sa2_nz <span class="sc">|&gt;</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="co"># View column names of sa2_nz</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sa2_nz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sa2_name"   "sa2_id"     "pop2018"    "regc2020_2" "geom"      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview names of geographical units</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_drop_geometry</span>(sa2_nz) <span class="sc">|&gt;</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   2151 obs. of  1 variable:
 $ sa2_name: chr  "North Cape" "Rangaunu Harbour" "Karikari Peninsula" "Tangonge" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 2151 distinct sa2_name in the dataset sa2_nz</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="co"># View distinct region in sa2_nz</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(sa2_nz) <span class="sc">|&gt;</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(regc2020_2) <span class="sc">|&gt;</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 17
Columns: 1
$ regc2020_2 &lt;chr&gt; "Northland Region", "Auckland Region", "Bay of Plenty Regio…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 17 distinct region in the sa2_nz dataset</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename region column and remove region from values</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>sa2_nz <span class="ot">&lt;-</span> sa2_nz <span class="sc">|&gt;</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">region =</span> regc2020_2) <span class="sc">|&gt;</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">str_trim</span>(<span class="fu">str_remove</span>(region, <span class="fu">regex</span>(<span class="st">"region"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))))</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(sa2_nz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,332
Columns: 5
$ sa2_name &lt;chr&gt; "North Cape", "Rangaunu Harbour", "Karikari Peninsula", "Tang…
$ sa2_id   &lt;int&gt; 100100, 100200, 100400, 100500, 102100, 102200, 102300, 10240…
$ pop2018  &lt;int&gt; 1660, 2410, 1300, 1180, 1290, 2200, 1290, 1550, 900, 1760, 11…
$ region   &lt;chr&gt; "Northland", "Northland", "Northland", "Northland", "Northlan…
$ geom     &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((172.9585 -3..., MULTIPOLYGON (((…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate centroids of geometry polygons</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>sa2_centroids <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(sa2_nz)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview first few rows</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(sa2_centroids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,332
Columns: 5
$ sa2_name &lt;chr&gt; "North Cape", "Rangaunu Harbour", "Karikari Peninsula", "Tang…
$ sa2_id   &lt;int&gt; 100100, 100200, 100400, 100500, 102100, 102200, 102300, 10240…
$ pop2018  &lt;int&gt; 1660, 2410, 1300, 1180, 1290, 2200, 1290, 1550, 900, 1760, 11…
$ region   &lt;chr&gt; "Northland", "Northland", "Northland", "Northland", "Northlan…
$ geom     &lt;POINT [°]&gt; POINT (172.9301 -34.61058), POINT (173.1995 -34.9607), …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sa2_centroids has 2332 rows with 5 columns, geom column is of point type</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract longitude and latitude from centroids</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>sa2_centroids <span class="ot">&lt;-</span> sa2_centroids <span class="sc">|&gt;</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="fu">st_coordinates</span>(geom)[, <span class="dv">1</span>],</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="fu">st_coordinates</span>(geom)[, <span class="dv">2</span>])</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(sa2_centroids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,332
Columns: 7
$ sa2_name  &lt;chr&gt; "North Cape", "Rangaunu Harbour", "Karikari Peninsula", "Tan…
$ sa2_id    &lt;int&gt; 100100, 100200, 100400, 100500, 102100, 102200, 102300, 1024…
$ pop2018   &lt;int&gt; 1660, 2410, 1300, 1180, 1290, 2200, 1290, 1550, 900, 1760, 1…
$ region    &lt;chr&gt; "Northland", "Northland", "Northland", "Northland", "Northla…
$ geom      &lt;POINT [°]&gt; POINT (172.9301 -34.61058), POINT (173.1995 -34.9607),…
$ longitude &lt;dbl&gt; 172.9301, 173.1995, 173.3659, 173.1831, 173.4844, 173.8903, …
$ latitude  &lt;dbl&gt; -34.61058, -34.96070, -34.92885, -35.15506, -35.46800, -35.1…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now there are two more columns of longitude and latitude of double type</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by region and slice minimum location and preserve geometry</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>label_text <span class="ot">&lt;-</span> sa2_centroids <span class="sc">|&gt;</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(<span class="at">order_by =</span> longitude <span class="sc">+</span> latitude, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> <span class="co"># Sum ensures SW-most</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(region, longitude, latitude)</span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(label_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 17
Columns: 4
$ region    &lt;chr&gt; "Area Outside", "Auckland", "Bay of Plenty", "Canterbury", "…
$ longitude &lt;dbl&gt; -176.5269, 174.7283, 175.9479, 169.2815, 176.7677, 176.3104,…
$ latitude  &lt;dbl&gt; -43.93630, -37.25538, -39.05760, -44.94244, -38.45032, -40.5…
$ geom      &lt;POINT [°]&gt; POINT (-176.5269 -43.9363), POINT (174.7283 -37.25538)…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Label_text contains 17 rows of regions with minimum longitude, minimum latitude, geometry column of point type</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview class</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(label_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The object label_text is a spatial data frame of class sf, meaning it contains geospatial features along with attribute data, making it compatible with tidyverse and spatial analysis functions.</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check coordinate reference system are same</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(sa2_nz) <span class="sc">==</span> <span class="fu">st_crs</span>(label_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Classes of datasets: sa2_nz and label_text are same</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group and merge SA2 polygons by region to get region-level boundaries and region total population</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>region_boundaries <span class="ot">&lt;-</span> sa2_nz <span class="sc">|&gt;</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop =</span> <span class="fu">sum</span>(pop2018),</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">geometry =</span> <span class="fu">st_union</span>(geom), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a glimpse</span></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(region_boundaries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 17
Columns: 3
$ region    &lt;chr&gt; "Area Outside", "Auckland", "Bay of Plenty", "Canterbury", "…
$ total_pop &lt;int&gt; 690, 1667670, 350600, 641650, 57340, 181840, 273240, 60040, …
$ geometry  &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-176.5709 -..., MULTIPOLYGON ((…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The region_boundaries dataset contains 17 regions with total population and multipolygon geometries. It uses the WGS 84 geodetic coordinate system and covers New Zealand's full extent, making it suitable for spatial analysis and regional population visualization.</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot region population with both SA2 polygons and region boundaries</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>plot_spatial <span class="ot">&lt;-</span> <span class="cf">function</span>(data, fill_var) {</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data) <span class="sc">+</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> {{ fill_var }}), <span class="at">color =</span> <span class="st">"#999999"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span>  <span class="co"># SA2 polygons</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text_repel</span>(</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> label_text,</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">label =</span> region),</span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>,</span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">12</span>  <span class="co"># Ensures reproducible label placement</span></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">165</span>, <span class="dv">180</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">48</span>, <span class="sc">-</span><span class="dv">34</span>)) <span class="sc">+</span></span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis_c</span>(</span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">option =</span> <span class="st">"turbo"</span>, </span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_scientific</span>()</span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>,</span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">"Population (2018)"</span></span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb128-23"><a href="#cb128-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb128-24"><a href="#cb128-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_north_arrow</span>(</span>
<span id="cb128-25"><a href="#cb128-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">location =</span> <span class="st">"tl"</span>, <span class="at">which_north =</span> <span class="st">"true"</span>,</span>
<span id="cb128-26"><a href="#cb128-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="fu">north_arrow_fancy_orienteering</span>())</span>
<span id="cb128-27"><a href="#cb128-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-28"><a href="#cb128-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-29"><a href="#cb128-29" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">plot_spatial</span>(sa2_nz, pop2018) <span class="sc">+</span></span>
<span id="cb128-30"><a href="#cb128-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"SA2 Population"</span>) </span>
<span id="cb128-31"><a href="#cb128-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-32"><a href="#cb128-32" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot_spatial</span>(region_boundaries, total_pop) <span class="sc">+</span> </span>
<span id="cb128-33"><a href="#cb128-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Region Population"</span>) </span>
<span id="cb128-34"><a href="#cb128-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-35"><a href="#cb128-35" aria-hidden="true" tabindex="-1"></a>combined_plot <span class="ot">&lt;-</span> plot1 <span class="sc">+</span> plot2 <span class="sc">+</span></span>
<span id="cb128-36"><a href="#cb128-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb128-37"><a href="#cb128-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span><span class="st">"Spatial Distribution of the 2018 Population in SA2 Areas (Left) and Regions (Right) of New Zealand"</span>,</span>
<span id="cb128-38"><a href="#cb128-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"A comparison of population patterns across fine-scale SA2 areas and broader regional boundaries"</span>,</span>
<span id="cb128-39"><a href="#cb128-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb128-40"><a href="#cb128-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb128-41"><a href="#cb128-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb128-42"><a href="#cb128-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>)  <span class="co"># Forces legend to bottom</span></span>
<span id="cb128-43"><a href="#cb128-43" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb128-44"><a href="#cb128-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-45"><a href="#cb128-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb128-46"><a href="#cb128-46" aria-hidden="true" tabindex="-1"></a>combined_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-population-trends-in-each-region-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, combined_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These maps compare population distribution in New Zealand at different scales. The SA2 Population map (left) provides detailed insights, highlighting densely populated urban clusters, while the Region Population map (right) aggregates data, emphasizing regional total population concentration. Auckland appears dominant in both maps, though the finer SA2 breakdown reveals local density patterns. The left map’s scale (0–6,000) captures variations within cities, whereas the right map (400,000–1.6 million) focuses on broader regional totals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Explore sa2_nz</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(sa2_nz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sa2_nz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sa2_name" "sa2_id"   "pop2018"  "region"   "geom"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The sa2_nz object is a simple features (sf) spatial data frame containing five columns: sa2_name, sa2_id, pop2018, region, and geom. It includes 2018 population data and multipolygon geometries for each SA2 area in New Zealand.</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Explore airdata</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "region"        "agency"        "lawa_site_id"  "site_name"    
 [5] "site_id"       "latitude"      "longitude"     "town"         
 [9] "site_type"     "indicator"     "date"          "concentration"
[13] "year"         </code></pre>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The airdata object is a tibble data frame containing air quality data, including region, site details, location, pollutant indicators, concentration values, and corresponding dates and years for analysis.</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert airdata data.frame to sf</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert columns "longitude" and "latitude" to WGS84 (EPSG:4326)</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>airdata <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(airdata, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata<span class="sc">$</span>geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sfc_POINT of length 232293; first list element:  'XY' num [1:2] 174.7 -36.9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The geometry column in airdata now contains 232,293 spatial point features in WGS84 coordinates, each representing air monitoring locations with longitude and latitude, starting near Auckland at (174.7, -36.9).</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview region not in airdata region</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(sa2_nz) <span class="sc">|&gt;</span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(region <span class="sc">%in%</span> airdata<span class="sc">$</span>region)) <span class="sc">|&gt;</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(region) <span class="sc">|&gt;</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        region  n
1 Area Outside  1
2     Taranaki 65</code></pre>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The region: Area Outside and Taranaki are not in airdata</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Count region, town, site_name</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(airdata) <span class="sc">|&gt;</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(region, town, site_name) <span class="sc">|&gt;</span></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 67
Columns: 3
$ region    &lt;chr&gt; "Auckland", "Auckland", "Auckland", "Auckland", "Auckland", …
$ town      &lt;chr&gt; "Glen Eden", "Henderson", "Pakuranga", "Patumahoe", "Penrose…
$ site_name &lt;chr&gt; "Glen Eden", "Henderson", "Pakuranga", "Patumahoe", "Penrose…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 67 distinct region, town, and site_name</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview matching CRS</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(sa2_centroids)<span class="sc">$</span>epsg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4326</code></pre>
</div>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(airdata)<span class="sc">$</span>epsg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4326</code></pre>
</div>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Both datasets have same crs epsg of 4326</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview summary</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(sa2_centroids<span class="sc">$</span>geom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sfc_POINT of length 2332; first list element:  'XY' num [1:2] 172.9 -34.6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(airdata<span class="sc">$</span>geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sfc_POINT of length 232293; first list element:  'XY' num [1:2] 174.7 -36.9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sa2_centroids has 2,332 points; airdata has 232,293 points. Both are sfc_POINT with XY coordinates in WGS84.</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview sa2_name in region Waikato</span></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(sa2_centroids) <span class="sc">|&gt;</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">"Waikato"</span>) <span class="sc">|&gt;</span></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 264
Columns: 1
$ sa2_name &lt;chr&gt; "National Park", "Tangiwai", "Tahuroa", "Richmond Downs-Wardv…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co">#There are 264 distinct sa2_name in region: Waikato</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview site_name for region Waikato in airdata</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(airdata) <span class="sc">|&gt;</span></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">"Waikato"</span>) <span class="sc">|&gt;</span></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(site_name) <span class="sc">|&gt;</span></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8
Columns: 1
$ site_name &lt;chr&gt; "Billah Street", "Bloodbank", "Bowling Club", "Claudelands",…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 8 site_name in region: Waikato</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform a spatial join of airdata and sa2_centroids to assign each SA2 to a region</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>airdata_with_sa2 <span class="ot">&lt;-</span> <span class="fu">st_join</span>(airdata, sa2_centroids[, <span class="fu">c</span>(<span class="st">"region"</span>, <span class="st">"sa2_name"</span>, <span class="st">"pop2018"</span>, <span class="st">"geom"</span>)], <span class="at">join =</span> st_nearest_feature)</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview column names </span></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(airdata_with_sa2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "region.x"      "agency"        "lawa_site_id"  "site_name"    
 [5] "site_id"       "town"          "site_type"     "indicator"    
 [9] "date"          "concentration" "year"          "geometry"     
[13] "region.y"      "sa2_name"      "pop2018"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove columns not needed</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>airdata_with_sa2 <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>region.y, <span class="sc">-</span>town, <span class="sc">-</span>site_id, <span class="sc">-</span>agency, <span class="sc">-</span>site_name) <span class="sc">|&gt;</span></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">region =</span> region.x)</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(airdata_with_sa2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "region"        "lawa_site_id"  "site_type"     "indicator"    
 [5] "date"          "concentration" "year"          "geometry"     
 [9] "sa2_name"      "pop2018"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save RAM, remove data not needed</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(airdata)</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(sa2_centroids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview summary of concentration</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(airdata_with_sa2<span class="sc">$</span>concentration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
   0.00    6.41   10.50   12.67   16.10  202.80     107 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Concentration ranges from 0 to 202.8, with mean 12.67, median 10.5, and 107 missing values (NA's).</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Use ARIMA imputation to approximate the missing concentration values.</span></span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>airdata_with_sa2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(airdata_with_sa2) <span class="sc">|&gt;</span></span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">arima_concentration =</span> <span class="fu">na_kalman</span>(concentration, <span class="at">model =</span> <span class="st">"auto.arima"</span>))  <span class="co"># ARIMA imputation</span></span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(airdata_with_sa2<span class="sc">$</span>arima_concentration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  0.000   6.407  10.494  12.664  16.100 202.800 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All the 107 missing values are now computed using ARIMA and ranges from 0 to 202.8 with a mean of 12.664 and median of 10.494</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="normalize-pollutant-concentration-by-2018-population-and-plot-concentration-per-capita-trends-for-eac-site-type." class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="normalize-pollutant-concentration-by-2018-population-and-plot-concentration-per-capita-trends-for-eac-site-type."><span class="header-section-number">4.2</span> Normalize pollutant concentration by 2018 population and plot concentration per capita trends for eac site type.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute total daily pollutant concentrations</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_type_indicator =</span> <span class="fu">paste0</span>(site_type, <span class="st">"_"</span>, indicator)) <span class="sc">|&gt;</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, site_type_indicator, site_type, indicator, date, sa2_name, pop2018) <span class="sc">|&gt;</span></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_conc =</span> <span class="fu">sum</span>(arima_concentration),</span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary statistics</span></span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata<span class="sc">$</span>total_conc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00    6.40   10.47   12.87   16.16  202.80 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># total_conc ranges from 0 to 202.8, with mean 12.87, median 10.47.</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate daily concentration per pop2018 </span></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">conc_per_capita =</span> total_conc <span class="sc">/</span> pop2018 )</span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the new column</span></span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata<span class="sc">$</span>conc_per_capita)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
0.000000 0.002628 0.004437 0.007249 0.007542 0.486536 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># conc_per_pop18 ranges from 0 to 0.486536 with a mean of 0.007249 and a median of 0.004437</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform daily_airdata into a long format for easier plotting</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate total concentration and per capita concentration into a "Type" column</span></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>long_data <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_type) <span class="sc">|&gt;</span></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(total_conc, conc_per_capita),</span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Type"</span>,</span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Value"</span>) <span class="sc">|&gt;</span></span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert 'Type' to a factor to control the facets order</span></span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Type =</span> <span class="fu">factor</span>(Type, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"total_conc"</span>, <span class="st">"conc_per_capita"</span>))) </span>
<span id="cb172-11"><a href="#cb172-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-12"><a href="#cb172-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define custom labels for facets to make them more descriptive</span></span>
<span id="cb172-13"><a href="#cb172-13" aria-hidden="true" tabindex="-1"></a>facet_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb172-14"><a href="#cb172-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_conc =</span> <span class="st">"Daily Concentration (µg/m³)"</span>,</span>
<span id="cb172-15"><a href="#cb172-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">conc_per_capita =</span> <span class="st">"Daily Concentration per Capita (µg/m³/person)"</span></span>
<span id="cb172-16"><a href="#cb172-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb172-17"><a href="#cb172-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-18"><a href="#cb172-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Using column plot, compare daily total and per capita pollutant concentrations by site type</span></span>
<span id="cb172-19"><a href="#cb172-19" aria-hidden="true" tabindex="-1"></a>pollutant_concentration_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(long_data, <span class="fu">aes</span>(<span class="at">x =</span> Value, <span class="at">y =</span> site_type, <span class="at">fill =</span> indicator)) <span class="sc">+</span></span>
<span id="cb172-20"><a href="#cb172-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.8</span>), <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb172-21"><a href="#cb172-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> Type, <span class="at">scales =</span> <span class="st">"free_x"</span>, <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">Type =</span> facet_labels)) <span class="sc">+</span></span>
<span id="cb172-22"><a href="#cb172-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>)) <span class="sc">+</span> </span>
<span id="cb172-23"><a href="#cb172-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total and Per Capita Daily Pollutant Concentrations (2016–2024)"</span>,</span>
<span id="cb172-24"><a href="#cb172-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Daily Concentration (Total and Per Capita)"</span>,</span>
<span id="cb172-25"><a href="#cb172-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Monitoring Site Type"</span>, <span class="at">fill =</span> <span class="st">"Indicator"</span>,</span>
<span id="cb172-26"><a href="#cb172-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Per capita values were calculated using 2018 population estimates."</span></span>
<span id="cb172-27"><a href="#cb172-27" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb172-28"><a href="#cb172-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb172-29"><a href="#cb172-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb172-30"><a href="#cb172-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb172-31"><a href="#cb172-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb172-32"><a href="#cb172-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb172-33"><a href="#cb172-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb172-34"><a href="#cb172-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb172-35"><a href="#cb172-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb172-36"><a href="#cb172-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-37"><a href="#cb172-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb172-38"><a href="#cb172-38" aria-hidden="true" tabindex="-1"></a>pollutant_concentration_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/pivot_long_format_and_plot_total_per_capita_concentration-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save to HTML</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, pollutant_concentration_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Traffic and industrial sites generally show high total pollutant concentrations, especially for PM10. However, per capita values are lower in densely populated areas due to population dilution. In contrast, mixed-use or coastal sites with fewer residents exhibit higher per capita concentrations despite moderate total values. PM10 levels consistently exceed PM2.5 across all site types, highlighting its dominance in daily particulate pollution from 2016 to 2024.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize conc_per_capita and classify based on how many standard deviations from the mean</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_type, indicator) <span class="sc">|&gt;</span></span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">z_score =</span> <span class="fu">scale</span>(conc_per_capita),</span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">conc_per_capita_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>           z_score <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">~</span> <span class="st">"Low"</span>,</span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a>           z_score <span class="sc">&lt;=</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Moderate"</span>,</span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a>           z_score <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"High"</span>,</span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a>           <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Very High"</span></span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a>         ))</span>
<span id="cb174-11"><a href="#cb174-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-12"><a href="#cb174-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define function for pollutant trends categorised by z-anomaly</span></span>
<span id="cb174-13"><a href="#cb174-13" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="cf">function</span>(data, title_var) {</span>
<span id="cb174-14"><a href="#cb174-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> conc_per_capita)) <span class="sc">+</span></span>
<span id="cb174-15"><a href="#cb174-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="fu">aes</span>(<span class="at">color =</span> conc_per_capita_category)) <span class="sc">+</span></span>
<span id="cb174-16"><a href="#cb174-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> site_type, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb174-17"><a href="#cb174-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(</span>
<span id="cb174-18"><a href="#cb174-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"Concentration Category"</span>, </span>
<span id="cb174-19"><a href="#cb174-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Low"</span> <span class="ot">=</span> <span class="st">"#1b9e77"</span>, <span class="st">"Moderate"</span> <span class="ot">=</span> <span class="st">"#7570b3"</span>,</span>
<span id="cb174-20"><a href="#cb174-20" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"High"</span> <span class="ot">=</span> <span class="st">"#d95f02"</span>, <span class="st">"Very High"</span> <span class="ot">=</span> <span class="st">"#e7298a"</span>)</span>
<span id="cb174-21"><a href="#cb174-21" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb174-22"><a href="#cb174-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb174-23"><a href="#cb174-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb174-24"><a href="#cb174-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(title_var, <span class="st">" Daily Concentration Per Capita Trends by Site Type (2016-2023)"</span>),</span>
<span id="cb174-25"><a href="#cb174-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"By 2018 population Categorized by Z-anomaly"</span>,</span>
<span id="cb174-26"><a href="#cb174-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Concentration per capita (µg/m³/person)"</span></span>
<span id="cb174-27"><a href="#cb174-27" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb174-28"><a href="#cb174-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb174-29"><a href="#cb174-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb174-30"><a href="#cb174-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb174-31"><a href="#cb174-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb174-32"><a href="#cb174-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb174-33"><a href="#cb174-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb174-34"><a href="#cb174-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb174-35"><a href="#cb174-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb174-36"><a href="#cb174-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-37"><a href="#cb174-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb174-38"><a href="#cb174-38" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">p</span>(<span class="fu">filter</span>(daily_airdata, indicator <span class="sc">==</span> <span class="st">"PM10"</span>), <span class="st">"PM10"</span>)</span>
<span id="cb174-39"><a href="#cb174-39" aria-hidden="true" tabindex="-1"></a>plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-pollutant-trends-zscore-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Industrial and multi-category sites show the highest PM10 variability, peaking in 2018, 2020, and 2022. Residential and NES sites maintain lower levels with fewer spikes. Traffic-influenced sites experience occasional peaks but remain relatively stable. Overall, site type strongly impacts PM10 trends, with industrial areas displaying the widest range.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">p</span>(<span class="fu">filter</span>(daily_airdata, indicator <span class="sc">==</span> <span class="st">"PM2.5"</span>), <span class="st">"PM2.5"</span>)</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-pollution-trend-pm25-zscore-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Industrial sites show the highest PM2.5 concentrations with frequent High and Very High Z-anomalies. Residential sites vary, with some exhibiting moderate pollution trends. Coastal and NES sites tend toward lower anomalies. Mixed-use sites Residential-Industrial and Residential-Traffic show inconsistent trends. Overall, site type strongly influences anomaly frequency, highlighting regional air quality disparities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract year and classify per capita categories</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">format</span>(date, <span class="st">"%Y"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_type, indicator, year) <span class="sc">|&gt;</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">conc_per_capita_category =</span> <span class="fu">ntile</span>(conc_per_capita, <span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">conc_per_capita_category =</span> <span class="fu">factor</span>(</span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a>    conc_per_capita_category, </span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Moderate"</span>, <span class="st">"High"</span>, <span class="st">"Very High"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-12"><a href="#cb178-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define jitter plot function by year and site_type</span></span>
<span id="cb178-13"><a href="#cb178-13" aria-hidden="true" tabindex="-1"></a>jitter_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, title_var) {</span>
<span id="cb178-14"><a href="#cb178-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(year), <span class="at">y =</span> conc_per_capita)) <span class="sc">+</span></span>
<span id="cb178-15"><a href="#cb178-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">color =</span> conc_per_capita_category), <span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb178-16"><a href="#cb178-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> site_type, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb178-17"><a href="#cb178-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis_d</span>(</span>
<span id="cb178-18"><a href="#cb178-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"Concentration Category"</span>, <span class="at">option =</span> <span class="st">"C"</span></span>
<span id="cb178-19"><a href="#cb178-19" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb178-20"><a href="#cb178-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb178-21"><a href="#cb178-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb178-22"><a href="#cb178-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(title_var, <span class="st">"Per Capita Concentration by Year and Site (2016-2023)"</span>),</span>
<span id="cb178-23"><a href="#cb178-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Jittered points grouped by per capita concentration category"</span>,</span>
<span id="cb178-24"><a href="#cb178-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Concentration per capita (µg/m³/person)"</span></span>
<span id="cb178-25"><a href="#cb178-25" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb178-26"><a href="#cb178-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb178-27"><a href="#cb178-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb178-28"><a href="#cb178-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb178-29"><a href="#cb178-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb178-30"><a href="#cb178-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb178-31"><a href="#cb178-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb178-32"><a href="#cb178-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb178-33"><a href="#cb178-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb178-34"><a href="#cb178-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb178-35"><a href="#cb178-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-36"><a href="#cb178-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot and save</span></span>
<span id="cb178-37"><a href="#cb178-37" aria-hidden="true" tabindex="-1"></a>plot_jitter <span class="ot">&lt;-</span> <span class="fu">jitter_plot</span>(<span class="fu">filter</span>(daily_airdata, indicator <span class="sc">==</span> <span class="st">"PM10"</span>), <span class="st">"PM10"</span>)</span>
<span id="cb178-38"><a href="#cb178-38" aria-hidden="true" tabindex="-1"></a>plot_jitter</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/jitter-plot-by-year-site-and-plot-PM10-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_jitter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The plots show PM10 per capita concentrations across sites from 2016 to 2023, classified into four concentration levels. Residential and industrial sites saw the sharpest increases in 2023. Coastal and traffic sites remained relatively stable, though minor fluctuations occurred. The categorization highlights notable shifts in pollution patterns, emphasizing areas experiencing heightened exposure. Standardization using 2018 population refines comparisons across sites.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot and save</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>plot_jitter <span class="ot">&lt;-</span> <span class="fu">jitter_plot</span>(<span class="fu">filter</span>(daily_airdata, indicator <span class="sc">==</span> <span class="st">"PM2.5"</span>), <span class="st">"PM2.5"</span>)</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>plot_jitter</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/jitter-plot-by-year-for-pm25-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_jitter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The PM2.5 jitter plots reveal distinct site-specific trends. Industrial sites show the highest variability, with elevated peaks in 2023. Residential sites display moderate fluctuations, reflecting seasonal shifts. Coastal sites exhibit the lowest PM2.5 concentrations, with stable trends. Traffic sites maintain consistently high pollution, showing persistent emissions. These differences underscore varying exposure risks based on site type and location.</p>
</section>
<section id="seasonal-trends-in-pollutant-concentration-by-site-type" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="seasonal-trends-in-pollutant-concentration-by-site-type"><span class="header-section-number">4.3</span> Seasonal Trends in Pollutant Concentration by Site Type</h3>
<p>Visualizing pollutant concentration per capita across seasons and site types, highlighting PM10 and PM2.5 variations, seasonal peaks, and site-specific dispersion dynamics from 2016 to 2023.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate daily air quality data into seasonal trends</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>seasondata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(date, <span class="st">"%y"</span>)),</span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">season =</span> <span class="fu">case_when</span>(</span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">month</span>(date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">~</span> <span class="st">"Sum"</span>, <span class="co"># Summer</span></span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">month</span>(date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">~</span> <span class="st">"Aut"</span>, <span class="co"># Autumn</span></span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">month</span>(date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>) <span class="sc">~</span> <span class="st">"Win"</span>, <span class="co"># Winter</span></span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">month</span>(date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>) <span class="sc">~</span> <span class="st">"Spr"</span>, <span class="co"># Spring</span></span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span>),</span>
<span id="cb182-11"><a href="#cb182-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">season =</span> <span class="fu">factor</span>(season, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Sum"</span>, <span class="st">"Aut"</span>, <span class="st">"Win"</span>, <span class="st">"Spr"</span>)),</span>
<span id="cb182-12"><a href="#cb182-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">season_year =</span> <span class="fu">paste0</span>(season, year),</span>
<span id="cb182-13"><a href="#cb182-13" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Use this to sort by season-year properly</span></span>
<span id="cb182-14"><a href="#cb182-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">season_year =</span> <span class="fu">factor</span>(season_year, </span>
<span id="cb182-15"><a href="#cb182-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="fu">unique</span>(season_year[<span class="fu">order</span>(year, season)])))</span>
<span id="cb182-16"><a href="#cb182-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-17"><a href="#cb182-17" aria-hidden="true" tabindex="-1"></a>sitedata <span class="ot">&lt;-</span> seasondata <span class="sc">|&gt;</span></span>
<span id="cb182-18"><a href="#cb182-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season_year, year, site_type, indicator) <span class="sc">|&gt;</span></span>
<span id="cb182-19"><a href="#cb182-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb182-20"><a href="#cb182-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_conc_per_capita =</span> <span class="fu">sum</span>(conc_per_capita, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb182-21"><a href="#cb182-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb182-22"><a href="#cb182-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-23"><a href="#cb182-23" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(seasondata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 228,625
Columns: 14
$ region                   &lt;chr&gt; "Auckland", "Auckland", "Auckland", "Auckland…
$ site_type_indicator      &lt;chr&gt; "Residential, Industrial, NES site_PM10", "Re…
$ site_type                &lt;chr&gt; "Residential, Industrial, NES site", "Residen…
$ indicator                &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10…
$ date                     &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-06, 2016-01-…
$ sa2_name                 &lt;chr&gt; "Ellerslie South", "Ellerslie South", "Ellers…
$ pop2018                  &lt;int&gt; 2720, 2720, 2720, 2720, 2720, 2720, 2720, 272…
$ total_conc               &lt;dbl&gt; 15.8, 11.2, 11.9, 8.7, 9.8, 9.1, 14.1, 6.8, 8…
$ conc_per_capita          &lt;dbl&gt; 0.005808824, 0.004117647, 0.004375000, 0.0031…
$ z_score                  &lt;dbl[,1]&gt; &lt;matrix[26 x 1]&gt;
$ conc_per_capita_category &lt;fct&gt; Moderate, Low, Low, Low, Low, Low, Modera…
$ year                     &lt;dbl&gt; 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 1…
$ season                   &lt;fct&gt; Sum, Sum, Sum, Sum, Sum, Sum, Sum, Sum, Sum, …
$ season_year              &lt;fct&gt; Sum16, Sum16, Sum16, Sum16, Sum16, Sum16, Sum…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the heatmap of seasondata</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sitedata, <span class="fu">aes</span>(<span class="at">x =</span> season_year, <span class="at">y =</span> site_type, <span class="at">fill =</span> total_conc_per_capita)) <span class="sc">+</span></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"grey90"</span>) <span class="sc">+</span></span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> indicator) <span class="sc">+</span></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"C"</span>,</span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"Total Concentration</span><span class="sc">\n</span><span class="st">(per capita, 2018 pop)"</span>) <span class="sc">+</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Heatmap of Seasonal Pollutant Concentration Per Capita (2016-2023)"</span>,</span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Summed by site type and season, normalized by 2018 population"</span>,</span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Season-Year"</span>, <span class="at">y =</span> <span class="st">"Site Type"</span>) <span class="sc">+</span></span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb184-14"><a href="#cb184-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb184-15"><a href="#cb184-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb184-16"><a href="#cb184-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb184-17"><a href="#cb184-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-18"><a href="#cb184-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-19"><a href="#cb184-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb184-20"><a href="#cb184-20" aria-hidden="true" tabindex="-1"></a>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/seasonal-pollution-by-site-type-heatmap-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, p2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The heatmap shows PM10 concentrations generally higher than PM2.5 across most site types and seasons from 2016–2023. PM10 peaks prominently at “Residential, NES site” and “Residential, Traffic, Industrial, Coastal, NES site”, reaching values above 30. PM2.5 values remain mostly below 10, with modest elevations at residential sites. Missing data patterns differ slightly between the two pollutants, notably in residential-industrial combinations.</p>
</section>
<section id="regional-trends-in-seasonal-per-capita-pollutant-concentration-20162023" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="regional-trends-in-seasonal-per-capita-pollutant-concentration-20162023"><span class="header-section-number">4.4</span> Regional Trends in Seasonal Per Capita Pollutant Concentration (2016–2023)</h3>
<p>This heatmap shows seasonal per capita pollutant concentrations across regions (2016–2023), helping identify spatial and temporal pollution trends.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate seasonal data to region</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>regiondata <span class="ot">&lt;-</span> seasondata <span class="sc">|&gt;</span></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, season_year, year, indicator) <span class="sc">|&gt;</span></span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_conc_per_capita =</span> <span class="fu">sum</span>(conc_per_capita, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(regiondata<span class="sc">$</span>total_conc_per_capita)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
 0.003854  0.516080  1.029960  1.991850  2.228748 19.300111 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This shows the summary statistics of a dataset, indicating a right-skewed distribution with a mean (1.99) higher than the median (1.03) and a maximum value of 19.3.</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the heatmap</span></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(regiondata, <span class="fu">aes</span>(<span class="at">x =</span> season_year, <span class="at">y =</span> region, <span class="at">fill =</span> total_conc_per_capita)) <span class="sc">+</span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"grey90"</span>) <span class="sc">+</span></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add lockdown marker (assuming x-axis is a factor or character)</span></span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">which</span>(<span class="fu">levels</span>(<span class="fu">factor</span>(regiondata<span class="sc">$</span>season_year)) <span class="sc">==</span> <span class="st">"Aut20"</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#E69F00"</span>, <span class="at">lwd =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> indicator) <span class="sc">+</span></span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_continuous_sequential</span>(</span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"Mint"</span>, <span class="at">name =</span> <span class="st">"Total Concentration</span><span class="sc">\n</span><span class="st">(per capita, 2018 pop)"</span>, <span class="at">rev =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb188-12"><a href="#cb188-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Air Pollution per Capita Across NZ Regions (2016–2023)"</span>,</span>
<span id="cb188-13"><a href="#cb188-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Summed pollutant concentrations by region and season (normalized by 2018 population), with COVID-19 lockdown marked (in orange)"</span>,</span>
<span id="cb188-14"><a href="#cb188-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Season-Year"</span>, <span class="at">y =</span> <span class="st">"Region"</span>) <span class="sc">+</span></span>
<span id="cb188-15"><a href="#cb188-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb188-16"><a href="#cb188-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb188-17"><a href="#cb188-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb188-18"><a href="#cb188-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb188-19"><a href="#cb188-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb188-20"><a href="#cb188-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb188-21"><a href="#cb188-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb188-22"><a href="#cb188-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-23"><a href="#cb188-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb188-24"><a href="#cb188-24" aria-hidden="true" tabindex="-1"></a>p1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/seasonal-pollution-by-region-heatmap-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, p1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The PM10 plot shows consistently higher concentrations across regions, while PM2.5 exhibits more variability with lower overall levels. Seasonal patterns are evident in both, but PM10 peaks are more pronounced. COVID-19 lockdowns affected both pollutants, with sharper declines in PM2.5. Regional disparities are stronger in PM10, highlighting differences in pollution dynamics and sources. The PM2.5 plot has more white spaces, indicating lower concentrations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata_with_sa2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 232,293
Columns: 11
$ region              &lt;chr&gt; "Auckland", "Auckland", "Auckland", "Auckland", "A…
$ lawa_site_id        &lt;chr&gt; "LAWA-100059", "LAWA-100059", "LAWA-100059", "LAWA…
$ site_type           &lt;chr&gt; "Residential, NES site", "Residential, NES site", …
$ indicator           &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "P…
$ date                &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2…
$ concentration       &lt;dbl&gt; 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2…
$ year                &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2…
$ geometry            &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -3…
$ sa2_name            &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Ed…
$ pop2018             &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 37…
$ arima_concentration &lt;dbl&gt; 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview repeating geometry last few rows</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sa2_name, geometry, pop2018) <span class="sc">|&gt;</span></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            sa2_name                   geometry pop2018    n
61        Washington POINT (173.2735 -41.27823)    2990 5066
62     Waterloo West POINT (174.9209 -41.21261)    2370 2892
63          Westlake POINT (174.7489 -36.78031)    3120 5493
64 Whangarei Central POINT (174.3242 -35.72673)    1000 5524
65            Winton POINT (168.3235 -46.14758)    2400 1379
66    Woolston South POINT (172.6813 -43.55716)     530 5809</code></pre>
</div>
</div>
</section>
<section id="comparing-total-and-per-capita-air-pollutant-concentrations-for-2018" class="level3" data-number="4.5">
<h3 data-number="4.5" class="anchored" data-anchor-id="comparing-total-and-per-capita-air-pollutant-concentrations-for-2018"><span class="header-section-number">4.5</span> Comparing Total and Per Capita Air Pollutant Concentrations for 2018</h3>
<p>To ensure consistency, we focus on 2018—the year for which both pollutant and population data are available. We aggregate total pollutant concentrations by SA2 regions and compute per capita values using 2018 population figures. Spatial visualisations then highlight the distribution of PM2.5 and PM10 levels across New Zealand, both in total and per person.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter 2018 data and summarise total pollutant concentration by SA2, indicator, and population</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>airdata_group <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2018</span>) <span class="sc">|&gt;</span></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name, geometry, indicator, pop2018) <span class="sc">|&gt;</span></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_conc18 =</span> <span class="fu">sum</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Display structure of the summarised dataset (86 rows x 5 columns)</span></span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 86
Columns: 5
$ sa2_name     &lt;chr&gt; "Alexandra South", "Allandale", "Arrowtown", "Bird Area",…
$ geometry     &lt;POINT [°]&gt; POINT (169.3903 -45.25485), POINT (176.9812 -37.960…
$ indicator    &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM2.5", …
$ pop2018      &lt;int&gt; 2710, 2610, 2970, 2310, 2940, 2230, 2230, 2210, 3220, 322…
$ total_conc18 &lt;dbl&gt; 5114.2000, 4258.1750, 6292.2000, 3976.0280, 3072.2500, 50…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate per capita pollutant concentration for each SA2</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>airdata_group <span class="ot">&lt;-</span> airdata_group <span class="sc">|&gt;</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">conc_per_capita18 =</span> total_conc18 <span class="sc">/</span> pop2018)</span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure airdata_group is an sf (spatial features) object</span></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>airdata_group <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(airdata_group)</span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarise distribution of per capita concentrations</span></span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(airdata_group<span class="sc">$</span>conc_per_capita18)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
 0.07344  1.19984  1.72504  2.15444  2.47601 11.94561 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Per capita PM10 concentration ranges from 0.07 to 11.95, with a median of 1.73 and a mean of 2.15.</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare label data: unique combinations of SA2, indicator, concentration values, and geometry</span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>label_text <span class="ot">&lt;-</span> airdata_group <span class="sc">|&gt;</span></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sa2_name, indicator, total_conc18, conc_per_capita18, geometry) <span class="sc">|&gt;</span></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>n)</span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Confirm label_text is a dataframe</span></span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(label_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert label_text to an sf object for spatial operations</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>label_text <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(label_text)</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract longitude and latitude from geometry column for text placement</span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>label_text<span class="sc">$</span>longitude <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(label_text)[, <span class="dv">1</span>]</span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a>label_text<span class="sc">$</span>latitude  <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(label_text)[, <span class="dv">2</span>]</span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarise longitude range — confirms spatial extent within New Zealand</span></span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(label_text<span class="sc">$</span>longitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  168.4   172.6   174.8   174.0   175.7   177.0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarise latitude range — confirms coverage from South to North Island</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(label_text<span class="sc">$</span>latitude) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 -46.43  -43.38  -40.95  -40.49  -37.67  -35.73 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a reusable function to map pollutant concentrations by SA2</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="cf">function</span>(indicator_var, color_var) {</span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> sa2_nz) <span class="sc">+</span></span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span>  <span class="co"># base map</span></span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> airdata_group <span class="sc">|&gt;</span> <span class="fu">filter</span>(indicator <span class="sc">==</span> {{indicator_var}}), <span class="fu">aes</span>(<span class="at">color =</span> {{ color_var }}), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text_repel</span>(<span class="at">data =</span> label_text <span class="sc">|&gt;</span> <span class="fu">filter</span>(indicator <span class="sc">==</span> {{indicator_var}}), <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">label =</span> sa2_name), <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">labels =</span>  scales<span class="sc">::</span><span class="fu">label_scientific</span>()) <span class="sc">+</span> </span>
<span id="cb204-8"><a href="#cb204-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">165</span>, <span class="dv">180</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">48</span>, <span class="sc">-</span><span class="dv">34</span>)) <span class="sc">+</span> <span class="co"># Add coord_sf to zoom in to nz</span></span>
<span id="cb204-9"><a href="#cb204-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb204-10"><a href="#cb204-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb204-11"><a href="#cb204-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Longitude"</span>,</span>
<span id="cb204-12"><a href="#cb204-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Latitude"</span>) <span class="sc">+</span></span>
<span id="cb204-13"><a href="#cb204-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb204-14"><a href="#cb204-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb204-15"><a href="#cb204-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb204-16"><a href="#cb204-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb204-17"><a href="#cb204-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.legend =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb204-18"><a href="#cb204-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb204-19"><a href="#cb204-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>, <span class="at">width_hint =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb204-20"><a href="#cb204-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_north_arrow</span>(</span>
<span id="cb204-21"><a href="#cb204-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">location =</span> <span class="st">"tl"</span>, <span class="at">which_north =</span> <span class="st">"true"</span>,</span>
<span id="cb204-22"><a href="#cb204-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="fu">north_arrow_fancy_orienteering</span>())</span>
<span id="cb204-23"><a href="#cb204-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb204-24"><a href="#cb204-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-25"><a href="#cb204-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Create spatial plots for PM10 and PM2.5 total concentrations (2018)</span></span>
<span id="cb204-26"><a href="#cb204-26" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">plot</span>(<span class="st">"PM10"</span>, total_conc18) <span class="sc">+</span></span>
<span id="cb204-27"><a href="#cb204-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total PM10"</span>, <span class="at">color =</span> <span class="st">"Total (µg/m³)"</span>)</span>
<span id="cb204-28"><a href="#cb204-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-29"><a href="#cb204-29" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot</span>(<span class="st">"PM2.5"</span>, total_conc18) <span class="sc">+</span> </span>
<span id="cb204-30"><a href="#cb204-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total PM2.5"</span>, <span class="at">color =</span> <span class="st">"Total (µg/m³)"</span>)</span>
<span id="cb204-31"><a href="#cb204-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-32"><a href="#cb204-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine plots into one figure with title and subtitle</span></span>
<span id="cb204-33"><a href="#cb204-33" aria-hidden="true" tabindex="-1"></a>combined_plot <span class="ot">&lt;-</span> plot1 <span class="sc">+</span> plot2 <span class="sc">+</span></span>
<span id="cb204-34"><a href="#cb204-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb204-35"><a href="#cb204-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Total PM2.5 and PM10 Concentration Across New Zealand for the Year Ending 2018"</span>,</span>
<span id="cb204-36"><a href="#cb204-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Spatial distribution of cumulative pollutant concentrations by SA2 region"</span>) <span class="sc">&amp;</span></span>
<span id="cb204-37"><a href="#cb204-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb204-38"><a href="#cb204-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb204-39"><a href="#cb204-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb204-40"><a href="#cb204-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-41"><a href="#cb204-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb204-42"><a href="#cb204-42" aria-hidden="true" tabindex="-1"></a>combined_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/aggregate-and-map-pollution-2018-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, combined_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Air pollution varies across New Zealand, with PM10 and PM2.5 showing distinct spatial patterns. PM10 concentrations, which include coarse and fine particles, are more widespread, while PM2.5—primarily from combustion sources—forms hotspots in urban areas. Regions like Meeanee–Awatoto and Mayfair appear prominently in both datasets, while Ruakaka and Mount Maunganui Central show pollutant-specific trends. The broader spread of PM10 suggests diverse sources, including road dust, whereas PM2.5 aligns with industrial and traffic emissions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create map of per capita PM10 concentrations for 2018</span></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">plot</span>(<span class="st">"PM10"</span>, conc_per_capita18) <span class="sc">+</span></span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"PM10 Per Capita"</span>, <span class="at">color =</span> <span class="st">"Per Capita (µg/m³)"</span>) <span class="sc">+</span> <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>) </span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create map of per capita PM2.5 concentrations for 2018</span></span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot</span>(<span class="st">"PM2.5"</span>, conc_per_capita18) <span class="sc">+</span></span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"PM2.5 Per Capita"</span>, <span class="at">color =</span> <span class="st">"Per Capita (µg/m³)"</span>) <span class="sc">+</span> </span>
<span id="cb206-8"><a href="#cb206-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>) </span>
<span id="cb206-9"><a href="#cb206-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-10"><a href="#cb206-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine both plots with shared title and styling</span></span>
<span id="cb206-11"><a href="#cb206-11" aria-hidden="true" tabindex="-1"></a>per_capita18_plot <span class="ot">&lt;-</span> plot1 <span class="sc">+</span> plot2 <span class="sc">+</span></span>
<span id="cb206-12"><a href="#cb206-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb206-13"><a href="#cb206-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Geospatial Distribution of Air Pollutants Per Capita (2018)"</span>,</span>
<span id="cb206-14"><a href="#cb206-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Comparison of PM10 and PM2.5 concentrations across SA2 regions"</span>) <span class="sc">&amp;</span></span>
<span id="cb206-15"><a href="#cb206-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb206-16"><a href="#cb206-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb206-17"><a href="#cb206-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb206-18"><a href="#cb206-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-19"><a href="#cb206-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb206-20"><a href="#cb206-20" aria-hidden="true" tabindex="-1"></a>per_capita18_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/map-per-capita-pollutants-2018-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, per_capita18_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Air quality varies across New Zealand, with PM10 and PM2.5 concentrations showing distinct patterns. PM10 levels are higher in Whangarei Central, Gore Main, Taihape and Parkside, while PM2.5 hotspots include Whangarai Central, Kuripuni, Redwoodtown East, and Mount Maunganui Central. PM10 appears more widespread, whereas PM2.5 is more localized in urban areas. These differences matter—PM2.5 particles penetrate deeper into lungs, posing greater health risks. Understanding these trends helps highlight potential environmental influences, such as traffic patterns or meteorological conditions.</p>
</section>
<section id="interactive-map-of-2018-particulate-matter-concentrations-by-sa2-region" class="level3" data-number="4.6">
<h3 data-number="4.6" class="anchored" data-anchor-id="interactive-map-of-2018-particulate-matter-concentrations-by-sa2-region"><span class="header-section-number">4.6</span> Interactive Map of 2018 Particulate Matter Concentrations by SA2 Region</h3>
<p>To enhance spatial interpretation, we created an interactive map showing PM10 and PM2.5 concentrations across New Zealand for 2018. Marker size represents total pollutant concentration (µg/m³), while color intensity indicates per capita exposure (µg/m³/person). This visualization allows users to explore regional air quality disparities in both absolute and population-adjusted terms.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Plotly map: marker size = total concentration, color = per capita concentration</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>interactive_map18 <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(</span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> label_text, <span class="at">type =</span> <span class="st">'scattermapbox'</span>, <span class="at">mode =</span> <span class="st">'markers'</span>,</span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">lat =</span> <span class="sc">~</span>latitude, <span class="at">lon =</span> <span class="sc">~</span>longitude,</span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="cn">NULL</span>, <span class="at">showlegend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="sc">~</span><span class="fu">paste0</span>(<span class="st">"SA2: "</span>, sa2_name,</span>
<span id="cb208-7"><a href="#cb208-7" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"</span><span class="sc">\n</span><span class="st">Indicator: "</span>, indicator,</span>
<span id="cb208-8"><a href="#cb208-8" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"</span><span class="sc">\n</span><span class="st">Total Concentration: "</span>, total_conc18,</span>
<span id="cb208-9"><a href="#cb208-9" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"</span><span class="sc">\n</span><span class="st">Concentration Per Capita: "</span>, conc_per_capita18),</span>
<span id="cb208-10"><a href="#cb208-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">marker =</span> <span class="fu">list</span>(</span>
<span id="cb208-11"><a href="#cb208-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="sc">~</span>scales<span class="sc">::</span><span class="fu">rescale</span>(total_conc18, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">20</span>)),</span>
<span id="cb208-12"><a href="#cb208-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="sc">~</span>conc_per_capita18, <span class="at">colorscale =</span> <span class="st">'Plasma'</span>,</span>
<span id="cb208-13"><a href="#cb208-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">opacity =</span> <span class="fl">0.8</span>, <span class="at">showscale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb208-14"><a href="#cb208-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">colorbar =</span> <span class="fu">list</span>(</span>
<span id="cb208-15"><a href="#cb208-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Per Capita Conc. (µg/m³/person)"</span>,</span>
<span id="cb208-16"><a href="#cb208-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fl">0.95</span>, <span class="at">xanchor =</span> <span class="st">"left"</span>, <span class="at">len =</span> <span class="fl">0.75</span>)</span>
<span id="cb208-17"><a href="#cb208-17" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">|&gt;</span></span>
<span id="cb208-18"><a href="#cb208-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb208-19"><a href="#cb208-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">list</span>(</span>
<span id="cb208-20"><a href="#cb208-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="fu">paste0</span>(</span>
<span id="cb208-21"><a href="#cb208-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;b&gt;Unified Map of Particulate Matter Concentrations (2018)&lt;/b&gt;&lt;br&gt;"</span>,</span>
<span id="cb208-22"><a href="#cb208-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;span style='font-size:18px;'&gt;Marker Size: Total Concentration (µg/m³),</span></span>
<span id="cb208-23"><a href="#cb208-23" aria-hidden="true" tabindex="-1"></a><span class="st">        Color: Per Capita (µg/m³/person)&lt;/span&gt;"</span>), <span class="at">x =</span> <span class="fl">0.5</span>),</span>
<span id="cb208-24"><a href="#cb208-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapbox =</span> <span class="fu">list</span>(</span>
<span id="cb208-25"><a href="#cb208-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="st">"open-street-map"</span>, <span class="at">zoom =</span> <span class="dv">5</span>,</span>
<span id="cb208-26"><a href="#cb208-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">center =</span> <span class="fu">list</span>(</span>
<span id="cb208-27"><a href="#cb208-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">lat =</span> <span class="fu">median</span>(label_text<span class="sc">$</span>latitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb208-28"><a href="#cb208-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">lon =</span> <span class="fu">median</span>(label_text<span class="sc">$</span>longitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb208-29"><a href="#cb208-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb208-30"><a href="#cb208-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-31"><a href="#cb208-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb208-32"><a href="#cb208-32" aria-hidden="true" tabindex="-1"></a>interactive_map18</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-32d77e72753b304bb7dd" style="width:100%;height:278px;"></div>
<script type="application/json" data-for="htmlwidget-32d77e72753b304bb7dd">{"x":{"visdat":{"fe47d243593":["function () ","plotlyVisDat"],"fe4673d2bc8":["function () ","data"]},"cur_data":"fe4673d2bc8","attrs":{"fe47d243593":{"mode":"markers","lat":{},"lon":{},"showlegend":false,"text":{},"marker":{"size":{},"color":{},"colorscale":"Plasma","opacity":0.80000000000000004,"showscale":true,"colorbar":{"title":"Per Capita Conc. (µg/m³/person)","x":0.94999999999999996,"xanchor":"left","len":0.75}},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scattermapbox"},"fe4673d2bc8":{"mode":"markers","lat":{},"lon":{},"showlegend":false,"text":{},"marker":{"size":{},"color":{},"colorscale":"Plasma","opacity":0.80000000000000004,"showscale":true,"colorbar":{"title":"Per Capita Conc. (µg/m³/person)","x":0.94999999999999996,"xanchor":"left","len":0.75}},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scattermapbox","x":{},"y":{},"_bbox":[168.36991681000001,-46.431928390000003,176.98120116999999,-35.726732210000002],"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":{"text":"<b>Unified Map of Particulate Matter Concentrations (2018)<\/b><br><span style='font-size:18px;'>Marker Size: Total Concentration (µg/m³),<br />        Color: Per Capita (µg/m³/person)<\/span>","x":0.5},"mapbox":{"style":"open-street-map","zoom":5,"center":{"lat":-40.95230652,"lon":174.76880900000003}},"xaxis":{"title":"x"},"yaxis":{"title":"y"},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"mode":"markers","lat":[-45.254852,-37.960750580000003,-44.948571270000002,-38.691894929999997,-37.683528899999999,-40.959198239999999,-40.959198239999999,-45.86909824,-37.777543180000002,-37.777543180000002,-45.190852329999998,-45.045879059999997,-41.121542999999974,-36.904558461006303,-36.904558461006303,-44.100181000449801,-44.100181000449801,-36.922142811073002,-46.106208889999998,-43.912238001285893,-43.912238001285893,-36.8680004511356,-41.267711429999999,-41.267711429999999,-43.384643000579501,-43.384643000579501,-40.95230652,-40.95230652,-43.307540001188499,-43.307540001188499,-41.314170019999999,-38.135818479999998,-38.135818479999998,-39.500164509999998,-39.638873269999998,-39.638873269999998,-39.545889350000003,-39.545889350000003,-37.807709979999998,-46.121327919999999,-37.649612619999999,-37.669638999999997,-37.670021060000003,-37.662139889999999,-37.662139889999999,-37.6434195,-37.6541,-37.66057215,-44.404483000805463,-44.404483000805463,-37.204503610808089,-37.204503610808089,-38.05712209,-36.847430000000003,-36.847430000000003,-41.526639879999998,-41.526639879999998,-42.114231930000003,-41.3395984,-35.894313879999999,-41.281961500000001,-45.871813070000002,-43.511257001057103,-43.511257001057103,-38.221616740000002,-38.221616740000002,-46.431928390000003,-36.905483750710502,-41.295116849999999,-39.677799999999998,-38.886175000000001,-38.33779552,-37.140490550000003,-41.293621999999971,-41.293621999999971,-44.732601001408,-44.732601001408,-41.278229529999997,-41.278229529999997,-41.212606999999899,-36.780305250869901,-36.780305250869901,-35.726732210000002,-35.726732210000002,-43.55715800095718,-43.55715800095718],"lon":[169.390333,176.98120116999999,168.84573717000001,176.09117495000001,176.13549805,175.65321069999999,175.65321069999999,170.51770311000001,175.28715905000001,175.28715905000001,169.32131981000001,169.21000461,175.07034500000009,174.815563500351,174.815563500351,171.24148099998411,171.24148099998411,174.6520009000113,168.93967924,171.7552360004602,171.7552360004602,174.6284,174.95375106,174.95375106,172.65199100072721,172.65199100072721,175.64661441999999,175.64661441999999,172.59526499979901,172.59526499979901,173.23720159999999,176.21420287999999,176.21420287999999,176.89701746,176.85880198000001,176.85880198000001,176.91912704000001,176.91912704000001,175.28036621000001,169.96150159999999,175.53579672000001,176.17971600000001,176.18357850000001,176.1873932,176.1873932,176.1850786,176.1859,176.1691179,171.2496629996013,171.2496629996013,174.86401940002824,174.86401940002824,175.77192840999999,174.76570000000001,174.76570000000001,173.95608203,173.95608203,171.86288712000001,173.18316353,174.45716173,173.29078544999999,170.35672382000001,172.63370500048501,172.63370500048501,175.85843044000001,175.85843044000001,168.36991681000001,174.8904,173.24237590000001,175.80083999999999,175.27104600000001,175.16533762,175.54629323,174.77191800000003,174.77191800000003,171.04992999942601,171.04992999942601,173.27352647999999,173.27352647999999,174.92087600000002,174.74890449976101,174.74890449976101,174.32424642999999,174.32424642999999,172.68127600047541,172.68127600047541],"showlegend":false,"text":["SA2: Alexandra South<br />Indicator: PM10<br />Total Concentration: 5114.2<br />Concentration Per Capita: 1.88715867158672","SA2: Allandale<br />Indicator: PM10<br />Total Concentration: 4258.175<br />Concentration Per Capita: 1.6314846743295","SA2: Arrowtown<br />Indicator: PM10<br />Total Concentration: 6292.2<br />Concentration Per Capita: 2.11858585858586","SA2: Bird Area<br />Indicator: PM10<br />Total Concentration: 3976.02802<br />Concentration Per Capita: 1.72122425108225","SA2: Brookfield East<br />Indicator: PM10<br />Total Concentration: 3072.25<br />Concentration Per Capita: 1.04498299319728","SA2: Cameron and Soldiers Park<br />Indicator: PM10<br />Total Concentration: 5087.39<br />Concentration Per Capita: 2.28134080717489","SA2: Cameron and Soldiers Park<br />Indicator: PM2.5<br />Total Concentration: 3605.64<br />Concentration Per Capita: 1.61687892376682","SA2: Campus South<br />Indicator: PM10<br />Total Concentration: 5350.4<br />Concentration Per Capita: 2.42099547511312","SA2: Claudelands<br />Indicator: PM10<br />Total Concentration: 4195.91194<br />Concentration Per Capita: 1.30307824223602","SA2: Claudelands<br />Indicator: PM2.5<br />Total Concentration: 844.20908<br />Concentration Per Capita: 0.262176732919255","SA2: Clyde<br />Indicator: PM10<br />Total Concentration: 3365<br />Concentration Per Capita: 2.85169491525424","SA2: Cromwell East<br />Indicator: PM10<br />Total Concentration: 3185.2<br />Concentration Per Capita: 1.19744360902256","SA2: Ebdentown<br />Indicator: PM10<br />Total Concentration: 3746.11<br />Concentration Per Capita: 1.45763035019455","SA2: Ellerslie South<br />Indicator: PM10<br />Total Concentration: 5166.8<br />Concentration Per Capita: 1.89955882352941","SA2: Ellerslie South<br />Indicator: PM2.5<br />Total Concentration: 2284.3<br />Concentration Per Capita: 0.839816176470588","SA2: Geraldine<br />Indicator: PM10<br />Total Concentration: 5851.876<br />Concentration Per Capita: 2.12795490909091","SA2: Geraldine<br />Indicator: PM2.5<br />Total Concentration: 3512.952<br />Concentration Per Capita: 1.27743709090909","SA2: Glen Eden Central<br />Indicator: PM10<br />Total Concentration: 4166.3<br />Concentration Per Capita: 1.09928759894459","SA2: Gore Main<br />Indicator: PM10<br />Total Concentration: 6811.45<br />Concentration Per Capita: 5.36334645669291","SA2: Hampstead<br />Indicator: PM10<br />Total Concentration: 5844.644<br />Concentration Per Capita: 1.93531258278146","SA2: Hampstead<br />Indicator: PM2.5<br />Total Concentration: 3269.338<br />Concentration Per Capita: 1.08256225165563","SA2: Henderson Lincoln South<br />Indicator: PM10<br />Total Concentration: 4138.8<br />Concentration Per Capita: 1.53288888888889","SA2: Homedale East<br />Indicator: PM10<br />Total Concentration: 3962.13<br />Concentration Per Capita: 1.25781904761905","SA2: Homedale East<br />Indicator: PM2.5<br />Total Concentration: 2074.36<br />Concentration Per Capita: 0.658526984126984","SA2: Kaiapoi Central<br />Indicator: PM10<br />Total Concentration: 5986.641<br />Concentration Per Capita: 2.69668513513514","SA2: Kaiapoi Central<br />Indicator: PM2.5<br />Total Concentration: 3622.129<br />Concentration Per Capita: 1.63158963963964","SA2: Kuripuni<br />Indicator: PM10<br />Total Concentration: 5048.94<br />Concentration Per Capita: 2.96996470588235","SA2: Kuripuni<br />Indicator: PM2.5<br />Total Concentration: 3473.11<br />Concentration Per Capita: 2.04300588235294","SA2: Lilybrook<br />Indicator: PM10<br />Total Concentration: 5648.284<br />Concentration Per Capita: 1.85189639344262","SA2: Lilybrook<br />Indicator: PM2.5<br />Total Concentration: 2595.197<br />Concentration Per Capita: 0.850884262295082","SA2: Maitlands<br />Indicator: PM10<br />Total Concentration: 164.5<br />Concentration Per Capita: 0.0734375","SA2: Mangakakahi West<br />Indicator: PM10<br />Total Concentration: 4718.263<br />Concentration Per Capita: 2.12534369369369","SA2: Mangakakahi West<br />Indicator: PM2.5<br />Total Concentration: 3255.47<br />Concentration Per Capita: 1.46642792792793","SA2: Marewa West<br />Indicator: PM10<br />Total Concentration: 4637.09<br />Concentration Per Capita: 2.60510674157303","SA2: Mayfair<br />Indicator: PM10<br />Total Concentration: 4889.56<br />Concentration Per Capita: 1.59269055374593","SA2: Mayfair<br />Indicator: PM2.5<br />Total Concentration: 3141.9<br />Concentration Per Capita: 1.02342019543974","SA2: Meeanee-Awatoto<br />Indicator: PM10<br />Total Concentration: 7065.12<br />Concentration Per Capita: 2.6966106870229","SA2: Meeanee-Awatoto<br />Indicator: PM2.5<br />Total Concentration: 2194.1<br />Concentration Per Capita: 0.837442748091603","SA2: Melville North<br />Indicator: PM10<br />Total Concentration: 4386.86012<br />Concentration Per Capita: 1.48204733783784","SA2: Milton<br />Indicator: PM10<br />Total Concentration: 4561.1<br />Concentration Per Capita: 2.07322727272727","SA2: Morrinsville East<br />Indicator: PM10<br />Total Concentration: 1808.20755<br />Concentration Per Capita: 0.366033917004049","SA2: Mount Maunganui Central<br />Indicator: PM10<br />Total Concentration: 2132.39<br />Concentration Per Capita: 5.92330555555556","SA2: Mount Maunganui Central<br />Indicator: PM10<br />Total Concentration: 2605.434<br />Concentration Per Capita: 7.23731666666667","SA2: Mount Maunganui Central<br />Indicator: PM10<br />Total Concentration: 3495.916<br />Concentration Per Capita: 9.71087777777778","SA2: Mount Maunganui Central<br />Indicator: PM2.5<br />Total Concentration: 1071.3<br />Concentration Per Capita: 2.97583333333333","SA2: Mount Maunganui North<br />Indicator: PM10<br />Total Concentration: 283.985<br />Concentration Per Capita: 0.0816048850574713","SA2: Mount Maunganui South<br />Indicator: PM10<br />Total Concentration: 1870.28<br />Concentration Per Capita: 0.617254125412541","SA2: Otumoetai North<br />Indicator: PM10<br />Total Concentration: 1689.915<br />Concentration Per Capita: 0.384946469248292","SA2: Parkside<br />Indicator: PM10<br />Total Concentration: 7360.756<br />Concentration Per Capita: 3.00439020408163","SA2: Parkside<br />Indicator: PM2.5<br />Total Concentration: 4035.274<br />Concentration Per Capita: 1.6470506122449","SA2: Puni<br />Indicator: PM10<br />Total Concentration: 4349.3<br />Concentration Per Capita: 2.63593939393939","SA2: Puni<br />Indicator: PM2.5<br />Total Concentration: 1593.9<br />Concentration Per Capita: 0.966","SA2: Putaruru<br />Indicator: PM10<br />Total Concentration: 4001.48685<br />Concentration Per Capita: 0.899210528089888","SA2: Queen Street<br />Indicator: PM10<br />Total Concentration: 5694.6<br />Concentration Per Capita: 2.33385245901639","SA2: Queen Street<br />Indicator: PM2.5<br />Total Concentration: 2338.4<br />Concentration Per Capita: 0.958360655737705","SA2: Redwoodtown East<br />Indicator: PM10<br />Total Concentration: 6961.5<br />Concentration Per Capita: 2.47740213523132","SA2: Redwoodtown East<br />Indicator: PM2.5<br />Total Concentration: 4824.63<br />Concentration Per Capita: 1.71695017793594","SA2: Reefton<br />Indicator: PM10<br />Total Concentration: 3052.12<br />Concentration Per Capita: 3.24693617021277","SA2: Richmond Central (Tasman District)<br />Indicator: PM10<br />Total Concentration: 6785<br />Concentration Per Capita: 3.55235602094241","SA2: Ruakaka<br />Indicator: PM10<br />Total Concentration: 4529.304913<br />Concentration Per Capita: 1.70274620789474","SA2: Rutherford<br />Indicator: PM10<br />Total Concentration: 1536<br />Concentration Per Capita: 0.575280898876405","SA2: Seddon Park<br />Indicator: PM10<br />Total Concentration: 6277.3<br />Concentration Per Capita: 2.14242320819113","SA2: St Albans North<br />Indicator: PM10<br />Total Concentration: 6369.855<br />Concentration Per Capita: 2.85643721973094","SA2: St Albans North<br />Indicator: PM2.5<br />Total Concentration: 2831.497<br />Concentration Per Capita: 1.26972959641256","SA2: Stanley Park<br />Indicator: PM10<br />Total Concentration: 4925.84208<br />Concentration Per Capita: 2.12320779310345","SA2: Stanley Park<br />Indicator: PM2.5<br />Total Concentration: 2860.82443<br />Concentration Per Capita: 1.23311397844828","SA2: Strathern<br />Indicator: PM10<br />Total Concentration: 7473.85<br />Concentration Per Capita: 3.2924449339207","SA2: Sunnyhills East<br />Indicator: PM10<br />Total Concentration: 4646.5<br />Concentration Per Capita: 1.29790502793296","SA2: Tahuna Hills<br />Indicator: PM10<br />Total Concentration: 6508.66<br />Concentration Per Capita: 2.20632542372881","SA2: Taihape<br />Indicator: PM10<br />Total Concentration: 6242.098<br />Concentration Per Capita: 3.54664659090909","SA2: Taumarunui Central<br />Indicator: PM10<br />Total Concentration: 3806.652<br />Concentration Per Capita: 2.47185194805195","SA2: Te Kuiti West<br />Indicator: PM10<br />Total Concentration: 4835.51358<br />Concentration Per Capita: 1.79758869144981","SA2: Thames Central<br />Indicator: PM10<br />Total Concentration: 1974.37152<br />Concentration Per Capita: 1.82812177777778","SA2: Vivian West<br />Indicator: PM10<br />Total Concentration: 4538.48<br />Concentration Per Capita: 1.20704255319149","SA2: Vivian West<br />Indicator: PM2.5<br />Total Concentration: 1953.25<br />Concentration Per Capita: 0.519481382978723","SA2: Waimate East<br />Indicator: PM10<br />Total Concentration: 4929.26<br />Concentration Per Capita: 2.95165269461078","SA2: Waimate East<br />Indicator: PM2.5<br />Total Concentration: 2771.666<br />Concentration Per Capita: 1.65968023952096","SA2: Washington<br />Indicator: PM10<br />Total Concentration: 6054.34<br />Concentration Per Capita: 2.02486287625418","SA2: Washington<br />Indicator: PM2.5<br />Total Concentration: 3374.6<br />Concentration Per Capita: 1.12862876254181","SA2: Waterloo West<br />Indicator: PM10<br />Total Concentration: 4097.37<br />Concentration Per Capita: 1.72884810126582","SA2: Westlake<br />Indicator: PM10<br />Total Concentration: 5038<br />Concentration Per Capita: 1.61474358974359","SA2: Westlake<br />Indicator: PM2.5<br />Total Concentration: 2360.5<br />Concentration Per Capita: 0.756570512820513","SA2: Whangarei Central<br />Indicator: PM10<br />Total Concentration: 4836.034552<br />Concentration Per Capita: 4.836034552","SA2: Whangarei Central<br />Indicator: PM2.5<br />Total Concentration: 2247.491037<br />Concentration Per Capita: 2.247491037","SA2: Woolston South<br />Indicator: PM10<br />Total Concentration: 6331.171<br />Concentration Per Capita: 11.9456056603774","SA2: Woolston South<br />Indicator: PM2.5<br />Total Concentration: 2487.357<br />Concentration Per Capita: 4.69312641509434"],"marker":{"color":[1.8871586715867159,1.6314846743295019,2.1185858585858584,1.7212242510822511,1.0449829931972789,2.281340807174888,1.6168789237668162,2.4209954751131222,1.3030782422360248,0.26217673291925464,2.8516949152542375,1.1974436090225564,1.4576303501945527,1.8995588235294119,0.83981617647058826,2.1279549090909091,1.2774370909090909,1.0992875989445912,5.3633464566929137,1.935312582781457,1.0825622516556292,1.532888888888889,1.2578190476190476,0.65852698412698418,2.6966851351351351,1.6315896396396397,2.9699647058823526,2.0430058823529413,1.8518963934426229,0.85088426229508196,0.073437500000000003,2.1253436936936936,1.4664279279279278,2.6051067415730338,1.5926905537459284,1.0234201954397395,2.6966106870229005,0.83744274809160302,1.482047337837838,2.0732272727272729,0.36603391700404858,5.9233055555555554,7.2373166666666675,9.7108777777777782,2.9758333333333331,0.081604885057471266,0.61725412541254121,0.38494646924829157,3.0043902040816328,1.647050612244898,2.635939393939394,0.96600000000000008,0.89921052808988755,2.3338524590163936,0.9583606557377049,2.4774021352313169,1.7169501779359431,3.2469361702127659,3.5523560209424083,1.7027462078947369,0.57528089887640455,2.1424232081911265,2.8564372197309416,1.2697295964125559,2.1232077931034485,1.2331139784482759,3.2924449339207049,1.2979050279329609,2.2063254237288135,3.546646590909091,2.4718519480519481,1.797588691449814,1.8281217777777776,1.2070425531914892,0.51948138297872337,2.9516526946107784,1.6596802395209582,2.0248628762541805,1.1286287625418059,1.7288481012658228,1.6147435897435898,0.7565705128205128,4.8360345520000001,2.2474910369999996,11.945605660377359,4.6931264150943397],"size":[16.126085082804899,14.72072072072072,18.060046378952983,14.257510755402327,12.773748691744135,16.082070225122617,13.649432576084056,16.51386238174393,14.618501409838084,9.1159007244146188,13.254365983295369,12.959182417041188,13.880046789386196,16.212440230663464,11.48014529335714,17.337152003940158,13.497263641773891,14.569886515216812,18.912516160807733,17.325278991976031,13.097314535492213,14.524738861868702,14.23469391943196,11.135479899033431,17.558400131338626,13.676503109031582,16.018945597077714,13.431853721603151,17.002908329742041,11.990555110919576,8,15.476062303761621,13.074546984341971,15.342797923207947,15.757286215600566,12.888095384678529,19.328974532619178,11.332060990375341,14.931987309405077,15.218042644010755,10.698528679020706,11.230749656262184,12.007361530095015,13.46929508095795,9.4887233474932788,8.1961624494654099,10.800435059204991,10.504323913891112,19.814329865172688,14.354776826940835,14.870323626587863,10.346692934392252,14.299307352910997,17.078946828377351,11.568963040489237,19.158858174803505,15.650688501713558,12.74070060949332,18.869092326951098,15.165843605245335,10.251636602433869,18.035584559502553,18.187535143343798,12.378496583143509,15.816851698167415,12.426644388351907,20,15.358246629317245,18.415415871452318,17.977792279751277,13.979440579531694,15.668556432514517,10.971325526893636,15.180906646965871,10.936649633688358,15.822463009706746,12.280270065053664,17.669543803484579,13.27012661864598,14.456721869933714,16.000985039709413,11.605245336452626,15.669411729360339,11.419714809661597,18.124026349812226,11.813510640481027],"colorscale":"Plasma","opacity":0.80000000000000004,"showscale":true,"colorbar":{"title":"Per Capita Conc. (µg/m³/person)","x":0.94999999999999996,"xanchor":"left","len":0.75},"line":{"color":"rgba(31,119,180,1)"}},"type":"scattermapbox","line":{"color":"rgba(31,119,180,1)"},"frame":null},{"mode":"markers","lat":[-45.254852,-37.960750580000003,-44.948571270000002,-38.691894929999997,-37.683528899999999,-40.959198239999999,-40.959198239999999,-45.86909824,-37.777543180000002,-37.777543180000002,-45.190852329999998,-45.045879059999997,-41.121542999999974,-36.904558461006303,-36.904558461006303,-44.100181000449801,-44.100181000449801,-36.922142811073002,-46.106208889999998,-43.912238001285893,-43.912238001285893,-36.8680004511356,-41.267711429999999,-41.267711429999999,-43.384643000579501,-43.384643000579501,-40.95230652,-40.95230652,-43.307540001188499,-43.307540001188499,-41.314170019999999,-38.135818479999998,-38.135818479999998,-39.500164509999998,-39.638873269999998,-39.638873269999998,-39.545889350000003,-39.545889350000003,-37.807709979999998,-46.121327919999999,-37.649612619999999,-37.669638999999997,-37.670021060000003,-37.662139889999999,-37.662139889999999,-37.6434195,-37.6541,-37.66057215,-44.404483000805463,-44.404483000805463,-37.204503610808089,-37.204503610808089,-38.05712209,-36.847430000000003,-36.847430000000003,-41.526639879999998,-41.526639879999998,-42.114231930000003,-41.3395984,-35.894313879999999,-41.281961500000001,-45.871813070000002,-43.511257001057103,-43.511257001057103,-38.221616740000002,-38.221616740000002,-46.431928390000003,-36.905483750710502,-41.295116849999999,-39.677799999999998,-38.886175000000001,-38.33779552,-37.140490550000003,-41.293621999999971,-41.293621999999971,-44.732601001408,-44.732601001408,-41.278229529999997,-41.278229529999997,-41.212606999999899,-36.780305250869901,-36.780305250869901,-35.726732210000002,-35.726732210000002,-43.55715800095718,-43.55715800095718],"lon":[169.390333,176.98120116999999,168.84573717000001,176.09117495000001,176.13549805,175.65321069999999,175.65321069999999,170.51770311000001,175.28715905000001,175.28715905000001,169.32131981000001,169.21000461,175.07034500000009,174.815563500351,174.815563500351,171.24148099998411,171.24148099998411,174.6520009000113,168.93967924,171.7552360004602,171.7552360004602,174.6284,174.95375106,174.95375106,172.65199100072721,172.65199100072721,175.64661441999999,175.64661441999999,172.59526499979901,172.59526499979901,173.23720159999999,176.21420287999999,176.21420287999999,176.89701746,176.85880198000001,176.85880198000001,176.91912704000001,176.91912704000001,175.28036621000001,169.96150159999999,175.53579672000001,176.17971600000001,176.18357850000001,176.1873932,176.1873932,176.1850786,176.1859,176.1691179,171.2496629996013,171.2496629996013,174.86401940002824,174.86401940002824,175.77192840999999,174.76570000000001,174.76570000000001,173.95608203,173.95608203,171.86288712000001,173.18316353,174.45716173,173.29078544999999,170.35672382000001,172.63370500048501,172.63370500048501,175.85843044000001,175.85843044000001,168.36991681000001,174.8904,173.24237590000001,175.80083999999999,175.27104600000001,175.16533762,175.54629323,174.77191800000003,174.77191800000003,171.04992999942601,171.04992999942601,173.27352647999999,173.27352647999999,174.92087600000002,174.74890449976101,174.74890449976101,174.32424642999999,174.32424642999999,172.68127600047541,172.68127600047541],"showlegend":false,"text":["SA2: Alexandra South<br />Indicator: PM10<br />Total Concentration: 5114.2<br />Concentration Per Capita: 1.88715867158672","SA2: Allandale<br />Indicator: PM10<br />Total Concentration: 4258.175<br />Concentration Per Capita: 1.6314846743295","SA2: Arrowtown<br />Indicator: PM10<br />Total Concentration: 6292.2<br />Concentration Per Capita: 2.11858585858586","SA2: Bird Area<br />Indicator: PM10<br />Total Concentration: 3976.02802<br />Concentration Per Capita: 1.72122425108225","SA2: Brookfield East<br />Indicator: PM10<br />Total Concentration: 3072.25<br />Concentration Per Capita: 1.04498299319728","SA2: Cameron and Soldiers Park<br />Indicator: PM10<br />Total Concentration: 5087.39<br />Concentration Per Capita: 2.28134080717489","SA2: Cameron and Soldiers Park<br />Indicator: PM2.5<br />Total Concentration: 3605.64<br />Concentration Per Capita: 1.61687892376682","SA2: Campus South<br />Indicator: PM10<br />Total Concentration: 5350.4<br />Concentration Per Capita: 2.42099547511312","SA2: Claudelands<br />Indicator: PM10<br />Total Concentration: 4195.91194<br />Concentration Per Capita: 1.30307824223602","SA2: Claudelands<br />Indicator: PM2.5<br />Total Concentration: 844.20908<br />Concentration Per Capita: 0.262176732919255","SA2: Clyde<br />Indicator: PM10<br />Total Concentration: 3365<br />Concentration Per Capita: 2.85169491525424","SA2: Cromwell East<br />Indicator: PM10<br />Total Concentration: 3185.2<br />Concentration Per Capita: 1.19744360902256","SA2: Ebdentown<br />Indicator: PM10<br />Total Concentration: 3746.11<br />Concentration Per Capita: 1.45763035019455","SA2: Ellerslie South<br />Indicator: PM10<br />Total Concentration: 5166.8<br />Concentration Per Capita: 1.89955882352941","SA2: Ellerslie South<br />Indicator: PM2.5<br />Total Concentration: 2284.3<br />Concentration Per Capita: 0.839816176470588","SA2: Geraldine<br />Indicator: PM10<br />Total Concentration: 5851.876<br />Concentration Per Capita: 2.12795490909091","SA2: Geraldine<br />Indicator: PM2.5<br />Total Concentration: 3512.952<br />Concentration Per Capita: 1.27743709090909","SA2: Glen Eden Central<br />Indicator: PM10<br />Total Concentration: 4166.3<br />Concentration Per Capita: 1.09928759894459","SA2: Gore Main<br />Indicator: PM10<br />Total Concentration: 6811.45<br />Concentration Per Capita: 5.36334645669291","SA2: Hampstead<br />Indicator: PM10<br />Total Concentration: 5844.644<br />Concentration Per Capita: 1.93531258278146","SA2: Hampstead<br />Indicator: PM2.5<br />Total Concentration: 3269.338<br />Concentration Per Capita: 1.08256225165563","SA2: Henderson Lincoln South<br />Indicator: PM10<br />Total Concentration: 4138.8<br />Concentration Per Capita: 1.53288888888889","SA2: Homedale East<br />Indicator: PM10<br />Total Concentration: 3962.13<br />Concentration Per Capita: 1.25781904761905","SA2: Homedale East<br />Indicator: PM2.5<br />Total Concentration: 2074.36<br />Concentration Per Capita: 0.658526984126984","SA2: Kaiapoi Central<br />Indicator: PM10<br />Total Concentration: 5986.641<br />Concentration Per Capita: 2.69668513513514","SA2: Kaiapoi Central<br />Indicator: PM2.5<br />Total Concentration: 3622.129<br />Concentration Per Capita: 1.63158963963964","SA2: Kuripuni<br />Indicator: PM10<br />Total Concentration: 5048.94<br />Concentration Per Capita: 2.96996470588235","SA2: Kuripuni<br />Indicator: PM2.5<br />Total Concentration: 3473.11<br />Concentration Per Capita: 2.04300588235294","SA2: Lilybrook<br />Indicator: PM10<br />Total Concentration: 5648.284<br />Concentration Per Capita: 1.85189639344262","SA2: Lilybrook<br />Indicator: PM2.5<br />Total Concentration: 2595.197<br />Concentration Per Capita: 0.850884262295082","SA2: Maitlands<br />Indicator: PM10<br />Total Concentration: 164.5<br />Concentration Per Capita: 0.0734375","SA2: Mangakakahi West<br />Indicator: PM10<br />Total Concentration: 4718.263<br />Concentration Per Capita: 2.12534369369369","SA2: Mangakakahi West<br />Indicator: PM2.5<br />Total Concentration: 3255.47<br />Concentration Per Capita: 1.46642792792793","SA2: Marewa West<br />Indicator: PM10<br />Total Concentration: 4637.09<br />Concentration Per Capita: 2.60510674157303","SA2: Mayfair<br />Indicator: PM10<br />Total Concentration: 4889.56<br />Concentration Per Capita: 1.59269055374593","SA2: Mayfair<br />Indicator: PM2.5<br />Total Concentration: 3141.9<br />Concentration Per Capita: 1.02342019543974","SA2: Meeanee-Awatoto<br />Indicator: PM10<br />Total Concentration: 7065.12<br />Concentration Per Capita: 2.6966106870229","SA2: Meeanee-Awatoto<br />Indicator: PM2.5<br />Total Concentration: 2194.1<br />Concentration Per Capita: 0.837442748091603","SA2: Melville North<br />Indicator: PM10<br />Total Concentration: 4386.86012<br />Concentration Per Capita: 1.48204733783784","SA2: Milton<br />Indicator: PM10<br />Total Concentration: 4561.1<br />Concentration Per Capita: 2.07322727272727","SA2: Morrinsville East<br />Indicator: PM10<br />Total Concentration: 1808.20755<br />Concentration Per Capita: 0.366033917004049","SA2: Mount Maunganui Central<br />Indicator: PM10<br />Total Concentration: 2132.39<br />Concentration Per Capita: 5.92330555555556","SA2: Mount Maunganui Central<br />Indicator: PM10<br />Total Concentration: 2605.434<br />Concentration Per Capita: 7.23731666666667","SA2: Mount Maunganui Central<br />Indicator: PM10<br />Total Concentration: 3495.916<br />Concentration Per Capita: 9.71087777777778","SA2: Mount Maunganui Central<br />Indicator: PM2.5<br />Total Concentration: 1071.3<br />Concentration Per Capita: 2.97583333333333","SA2: Mount Maunganui North<br />Indicator: PM10<br />Total Concentration: 283.985<br />Concentration Per Capita: 0.0816048850574713","SA2: Mount Maunganui South<br />Indicator: PM10<br />Total Concentration: 1870.28<br />Concentration Per Capita: 0.617254125412541","SA2: Otumoetai North<br />Indicator: PM10<br />Total Concentration: 1689.915<br />Concentration Per Capita: 0.384946469248292","SA2: Parkside<br />Indicator: PM10<br />Total Concentration: 7360.756<br />Concentration Per Capita: 3.00439020408163","SA2: Parkside<br />Indicator: PM2.5<br />Total Concentration: 4035.274<br />Concentration Per Capita: 1.6470506122449","SA2: Puni<br />Indicator: PM10<br />Total Concentration: 4349.3<br />Concentration Per Capita: 2.63593939393939","SA2: Puni<br />Indicator: PM2.5<br />Total Concentration: 1593.9<br />Concentration Per Capita: 0.966","SA2: Putaruru<br />Indicator: PM10<br />Total Concentration: 4001.48685<br />Concentration Per Capita: 0.899210528089888","SA2: Queen Street<br />Indicator: PM10<br />Total Concentration: 5694.6<br />Concentration Per Capita: 2.33385245901639","SA2: Queen Street<br />Indicator: PM2.5<br />Total Concentration: 2338.4<br />Concentration Per Capita: 0.958360655737705","SA2: Redwoodtown East<br />Indicator: PM10<br />Total Concentration: 6961.5<br />Concentration Per Capita: 2.47740213523132","SA2: Redwoodtown East<br />Indicator: PM2.5<br />Total Concentration: 4824.63<br />Concentration Per Capita: 1.71695017793594","SA2: Reefton<br />Indicator: PM10<br />Total Concentration: 3052.12<br />Concentration Per Capita: 3.24693617021277","SA2: Richmond Central (Tasman District)<br />Indicator: PM10<br />Total Concentration: 6785<br />Concentration Per Capita: 3.55235602094241","SA2: Ruakaka<br />Indicator: PM10<br />Total Concentration: 4529.304913<br />Concentration Per Capita: 1.70274620789474","SA2: Rutherford<br />Indicator: PM10<br />Total Concentration: 1536<br />Concentration Per Capita: 0.575280898876405","SA2: Seddon Park<br />Indicator: PM10<br />Total Concentration: 6277.3<br />Concentration Per Capita: 2.14242320819113","SA2: St Albans North<br />Indicator: PM10<br />Total Concentration: 6369.855<br />Concentration Per Capita: 2.85643721973094","SA2: St Albans North<br />Indicator: PM2.5<br />Total Concentration: 2831.497<br />Concentration Per Capita: 1.26972959641256","SA2: Stanley Park<br />Indicator: PM10<br />Total Concentration: 4925.84208<br />Concentration Per Capita: 2.12320779310345","SA2: Stanley Park<br />Indicator: PM2.5<br />Total Concentration: 2860.82443<br />Concentration Per Capita: 1.23311397844828","SA2: Strathern<br />Indicator: PM10<br />Total Concentration: 7473.85<br />Concentration Per Capita: 3.2924449339207","SA2: Sunnyhills East<br />Indicator: PM10<br />Total Concentration: 4646.5<br />Concentration Per Capita: 1.29790502793296","SA2: Tahuna Hills<br />Indicator: PM10<br />Total Concentration: 6508.66<br />Concentration Per Capita: 2.20632542372881","SA2: Taihape<br />Indicator: PM10<br />Total Concentration: 6242.098<br />Concentration Per Capita: 3.54664659090909","SA2: Taumarunui Central<br />Indicator: PM10<br />Total Concentration: 3806.652<br />Concentration Per Capita: 2.47185194805195","SA2: Te Kuiti West<br />Indicator: PM10<br />Total Concentration: 4835.51358<br />Concentration Per Capita: 1.79758869144981","SA2: Thames Central<br />Indicator: PM10<br />Total Concentration: 1974.37152<br />Concentration Per Capita: 1.82812177777778","SA2: Vivian West<br />Indicator: PM10<br />Total Concentration: 4538.48<br />Concentration Per Capita: 1.20704255319149","SA2: Vivian West<br />Indicator: PM2.5<br />Total Concentration: 1953.25<br />Concentration Per Capita: 0.519481382978723","SA2: Waimate East<br />Indicator: PM10<br />Total Concentration: 4929.26<br />Concentration Per Capita: 2.95165269461078","SA2: Waimate East<br />Indicator: PM2.5<br />Total Concentration: 2771.666<br />Concentration Per Capita: 1.65968023952096","SA2: Washington<br />Indicator: PM10<br />Total Concentration: 6054.34<br />Concentration Per Capita: 2.02486287625418","SA2: Washington<br />Indicator: PM2.5<br />Total Concentration: 3374.6<br />Concentration Per Capita: 1.12862876254181","SA2: Waterloo West<br />Indicator: PM10<br />Total Concentration: 4097.37<br />Concentration Per Capita: 1.72884810126582","SA2: Westlake<br />Indicator: PM10<br />Total Concentration: 5038<br />Concentration Per Capita: 1.61474358974359","SA2: Westlake<br />Indicator: PM2.5<br />Total Concentration: 2360.5<br />Concentration Per Capita: 0.756570512820513","SA2: Whangarei Central<br />Indicator: PM10<br />Total Concentration: 4836.034552<br />Concentration Per Capita: 4.836034552","SA2: Whangarei Central<br />Indicator: PM2.5<br />Total Concentration: 2247.491037<br />Concentration Per Capita: 2.247491037","SA2: Woolston South<br />Indicator: PM10<br />Total Concentration: 6331.171<br />Concentration Per Capita: 11.9456056603774","SA2: Woolston South<br />Indicator: PM2.5<br />Total Concentration: 2487.357<br />Concentration Per Capita: 4.69312641509434"],"marker":{"color":[1.8871586715867159,1.6314846743295019,2.1185858585858584,1.7212242510822511,1.0449829931972789,2.281340807174888,1.6168789237668162,2.4209954751131222,1.3030782422360248,0.26217673291925464,2.8516949152542375,1.1974436090225564,1.4576303501945527,1.8995588235294119,0.83981617647058826,2.1279549090909091,1.2774370909090909,1.0992875989445912,5.3633464566929137,1.935312582781457,1.0825622516556292,1.532888888888889,1.2578190476190476,0.65852698412698418,2.6966851351351351,1.6315896396396397,2.9699647058823526,2.0430058823529413,1.8518963934426229,0.85088426229508196,0.073437500000000003,2.1253436936936936,1.4664279279279278,2.6051067415730338,1.5926905537459284,1.0234201954397395,2.6966106870229005,0.83744274809160302,1.482047337837838,2.0732272727272729,0.36603391700404858,5.9233055555555554,7.2373166666666675,9.7108777777777782,2.9758333333333331,0.081604885057471266,0.61725412541254121,0.38494646924829157,3.0043902040816328,1.647050612244898,2.635939393939394,0.96600000000000008,0.89921052808988755,2.3338524590163936,0.9583606557377049,2.4774021352313169,1.7169501779359431,3.2469361702127659,3.5523560209424083,1.7027462078947369,0.57528089887640455,2.1424232081911265,2.8564372197309416,1.2697295964125559,2.1232077931034485,1.2331139784482759,3.2924449339207049,1.2979050279329609,2.2063254237288135,3.546646590909091,2.4718519480519481,1.797588691449814,1.8281217777777776,1.2070425531914892,0.51948138297872337,2.9516526946107784,1.6596802395209582,2.0248628762541805,1.1286287625418059,1.7288481012658228,1.6147435897435898,0.7565705128205128,4.8360345520000001,2.2474910369999996,11.945605660377359,4.6931264150943397],"size":[16.126085082804899,14.72072072072072,18.060046378952983,14.257510755402327,12.773748691744135,16.082070225122617,13.649432576084056,16.51386238174393,14.618501409838084,9.1159007244146188,13.254365983295369,12.959182417041188,13.880046789386196,16.212440230663464,11.48014529335714,17.337152003940158,13.497263641773891,14.569886515216812,18.912516160807733,17.325278991976031,13.097314535492213,14.524738861868702,14.23469391943196,11.135479899033431,17.558400131338626,13.676503109031582,16.018945597077714,13.431853721603151,17.002908329742041,11.990555110919576,8,15.476062303761621,13.074546984341971,15.342797923207947,15.757286215600566,12.888095384678529,19.328974532619178,11.332060990375341,14.931987309405077,15.218042644010755,10.698528679020706,11.230749656262184,12.007361530095015,13.46929508095795,9.4887233474932788,8.1961624494654099,10.800435059204991,10.504323913891112,19.814329865172688,14.354776826940835,14.870323626587863,10.346692934392252,14.299307352910997,17.078946828377351,11.568963040489237,19.158858174803505,15.650688501713558,12.74070060949332,18.869092326951098,15.165843605245335,10.251636602433869,18.035584559502553,18.187535143343798,12.378496583143509,15.816851698167415,12.426644388351907,20,15.358246629317245,18.415415871452318,17.977792279751277,13.979440579531694,15.668556432514517,10.971325526893636,15.180906646965871,10.936649633688358,15.822463009706746,12.280270065053664,17.669543803484579,13.27012661864598,14.456721869933714,16.000985039709413,11.605245336452626,15.669411729360339,11.419714809661597,18.124026349812226,11.813510640481027],"colorscale":"Plasma","opacity":0.80000000000000004,"showscale":true,"colorbar":{"title":"Per Capita Conc. (µg/m³/person)","x":0.94999999999999996,"xanchor":"left","len":0.75},"line":{"color":"rgba(255,127,14,1)"}},"type":"scattermapbox","_bbox":[168.36991681000001,-46.431928390000003,176.98120116999999,-35.726732210000002],"line":{"color":"rgba(255,127,14,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>htmlwidgets<span class="sc">::</span><span class="fu">saveWidget</span>(interactive_map18, <span class="st">"dist.html"</span>, <span class="at">selfcontained =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>New Zealand’s air quality varies significantly across regions, with particulate matter (PM) concentrations reflecting both human activity and environmental conditions. This map highlights total and per capita PM levels, revealing how pollution impacts individuals versus overall atmospheric load. The deep red zones indicate areas where residents experience heightened exposure, often influenced by traffic, industry, or natural events. Future analyses could explore seasonal changes, meteorological influences, and links to traffic congestion.</p>
</section>
<section id="standardizing-daily-air-pollutant-concentrations-for-cross-regional-analysis" class="level3" data-number="4.7">
<h3 data-number="4.7" class="anchored" data-anchor-id="standardizing-daily-air-pollutant-concentrations-for-cross-regional-analysis"><span class="header-section-number">4.7</span> Standardizing Daily Air Pollutant Concentrations for Cross-Regional Analysis</h3>
<p>To enable consistent comparisons across regions, we first removed duplicate entries by aggregating pollutant data by SA2, region, date, and indicator. We then calculated total daily concentrations and standardized them using z-scores. This normalization allows us to detect anomalies and analyze trends over time on a common scale, regardless of differences in baseline pollution levels across regions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Check for duplicate pollutant entries recorded on the same day, in the same location, for the same indicator</span></span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(airdata_with_sa2) <span class="sc">|&gt;</span></span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sa2_name, region, date, indicator) <span class="sc">|&gt;</span></span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,972
Columns: 5
$ sa2_name  &lt;chr&gt; "Alexandra South", "Alexandra South", "Alexandra South", "Al…
$ region    &lt;chr&gt; "Otago", "Otago", "Otago", "Otago", "Otago", "Otago", "Otago…
$ date      &lt;date&gt; 2018-03-31, 2019-04-06, 2020-04-04, 2021-04-03, 2016-04-02,…
$ indicator &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "PM1…
$ n         &lt;int&gt; 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co"># → Some SA2 regions record pollutant levels multiple times per day per indicator.</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine duplicates by summing concentration values across SA2 name, region, date, and indicator. This step ensures cleaner trend lines for time-series analysis</span></span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(airdata_with_sa2) <span class="sc">|&gt;</span></span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">region_indicator =</span> <span class="fu">paste</span>(region, indicator, <span class="at">sep =</span> <span class="st">" - "</span>)) <span class="sc">|&gt;</span></span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name, region, date, indicator, region_indicator, pop2018) <span class="sc">|&gt;</span></span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">region_concentration =</span> <span class="fu">sum</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb212-9"><a href="#cb212-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb212-10"><a href="#cb212-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb212-11"><a href="#cb212-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-12"><a href="#cb212-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Confirm that aggregation at the region-date-indicator level has resolved duplicates</span></span>
<span id="cb212-13"><a href="#cb212-13" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb212-14"><a href="#cb212-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(region, date, indicator) <span class="sc">|&gt;</span></span>
<span id="cb212-15"><a href="#cb212-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb212-16"><a href="#cb212-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 45,633
Columns: 4
$ region    &lt;chr&gt; "Auckland", "Auckland", "Auckland", "Auckland", "Auckland", …
$ date      &lt;date&gt; 2016-01-01, 2016-01-01, 2016-01-02, 2016-01-02, 2016-01-03,…
$ indicator &lt;chr&gt; "PM10", "PM2.5", "PM10", "PM2.5", "PM10", "PM2.5", "PM10", "…
$ n         &lt;int&gt; 6, 3, 6, 3, 5, 2, 5, 2, 5, 2, 6, 3, 5, 2, 5, 2, 5, 2, 5, 2, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Further aggregate by region, date, and indicator to prepare for regional trend analysis</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="ot">&lt;-</span> daily_airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, date, indicator, region_indicator, pop2018) <span class="sc">|&gt;</span></span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">region_concentration =</span> <span class="fu">sum</span>(region_concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb214-7"><a href="#cb214-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-8"><a href="#cb214-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean pollutant concentration for each region and indicator combination</span></span>
<span id="cb214-9"><a href="#cb214-9" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="ot">&lt;-</span> daily_airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb214-10"><a href="#cb214-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, indicator) <span class="sc">|&gt;</span></span>
<span id="cb214-11"><a href="#cb214-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">grp_mean =</span> <span class="fu">mean</span>(region_concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb214-12"><a href="#cb214-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb214-13"><a href="#cb214-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-14"><a href="#cb214-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute standardized concentrations (z-scores) to enable cross-region comparison on a uniform scale</span></span>
<span id="cb214-15"><a href="#cb214-15" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="ot">&lt;-</span> daily_airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb214-16"><a href="#cb214-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, indicator) <span class="sc">|&gt;</span></span>
<span id="cb214-17"><a href="#cb214-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb214-18"><a href="#cb214-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_concentration =</span> (region_concentration <span class="sc">-</span> <span class="fu">mean</span>(region_concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(region_concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb214-19"><a href="#cb214-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb214-20"><a href="#cb214-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb214-21"><a href="#cb214-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-22"><a href="#cb214-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of standardized concentration values</span></span>
<span id="cb214-23"><a href="#cb214-23" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata_with_sa2<span class="sc">$</span>sd_concentration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-2.2741 -0.6267 -0.2622  0.0000  0.3367 21.5596 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># → Standardized concentration ranges from -2.57 to 7.99, with a median of -0.26 and a mean of 0.</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of raw regional concentrations</span></span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata_with_sa2<span class="sc">$</span>region_concentration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00    6.40   10.46   12.86   16.16  202.80 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="co"># → Regional concentration ranges from 0 to 549.98 µg/m³, with a median of 22.88 and a mean of 40.62.</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to randomly select a fixed number of regions, filter the dataset accordingly, and replace zero concentrations with a small positive value to avoid log/scale issues</span></span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>prepare_selected_airdata <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">n_regions =</span> <span class="dv">5</span>, <span class="at">seed =</span> <span class="dv">123</span>) {</span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed) <span class="co"># Ensure reproducibility</span></span>
<span id="cb218-6"><a href="#cb218-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb218-7"><a href="#cb218-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Randomly sample 'n_regions' unique region names</span></span>
<span id="cb218-8"><a href="#cb218-8" aria-hidden="true" tabindex="-1"></a>  selected_regions <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">unique</span>(data<span class="sc">$</span>region), <span class="at">size =</span> n_regions)</span>
<span id="cb218-9"><a href="#cb218-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb218-10"><a href="#cb218-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter to selected regions and replace zero concentration values</span></span>
<span id="cb218-11"><a href="#cb218-11" aria-hidden="true" tabindex="-1"></a>  data_filtered <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb218-12"><a href="#cb218-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(region <span class="sc">%in%</span> selected_regions) <span class="sc">|&gt;</span></span>
<span id="cb218-13"><a href="#cb218-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb218-14"><a href="#cb218-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">region_concentration =</span> <span class="fu">ifelse</span>(region_concentration <span class="sc">==</span> <span class="dv">0</span>, <span class="fl">1e-05</span>, region_concentration)</span>
<span id="cb218-15"><a href="#cb218-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb218-16"><a href="#cb218-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb218-17"><a href="#cb218-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb218-18"><a href="#cb218-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb218-19"><a href="#cb218-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data_filtered,</span>
<span id="cb218-20"><a href="#cb218-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">selected_regions =</span> selected_regions</span>
<span id="cb218-21"><a href="#cb218-21" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb218-22"><a href="#cb218-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply function to filter dataset and get selected regions</span></span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">prepare_selected_airdata</span>(daily_airdata_with_sa2, <span class="dv">6</span>)</span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a>daily_airdata_selected <span class="ot">&lt;-</span> result<span class="sc">$</span>data</span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a>selected_regions <span class="ot">&lt;-</span> result<span class="sc">$</span>selected_regions</span>
<span id="cb219-5"><a href="#cb219-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-6"><a href="#cb219-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview column names and selected regions</span></span>
<span id="cb219-7"><a href="#cb219-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(daily_airdata_selected)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "region"               "date"                 "indicator"           
[4] "region_indicator"     "pop2018"              "region_concentration"
[7] "grp_mean"             "sd_concentration"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>selected_regions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "West Coast"         "Canterbury"         "Wellington"        
[4] "Otago"              "Bay of Plenty"      "Manawatu-Whanganui"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a faceted line plot showing log-scale air pollutant concentration trends by region. This visualizes pollutant concentrations across selected regions from 2016 to 2023</span></span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a>plot_log_by_region <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> daily_airdata_selected, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> region_concentration, <span class="at">color =</span> indicator)) <span class="sc">+</span></span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> region)) <span class="sc">+</span></span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"PM10"</span> <span class="ot">=</span> <span class="st">"#0072B2"</span>, <span class="st">"PM2.5"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>)) <span class="sc">+</span></span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Log-Scale Trends in Air Pollutant Concentration in Selected Regions (2016-2023)"</span>,</span>
<span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Log-transformed trends in PM2.5 and PM10 concentration"</span>,</span>
<span id="cb223-8"><a href="#cb223-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Month-Year"</span>,</span>
<span id="cb223-9"><a href="#cb223-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Total Pollutant Concentration (log scale)"</span>,</span>
<span id="cb223-10"><a href="#cb223-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Pollutant Type"</span>) <span class="sc">+</span></span>
<span id="cb223-11"><a href="#cb223-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb223-12"><a href="#cb223-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb223-13"><a href="#cb223-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb223-14"><a href="#cb223-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb223-15"><a href="#cb223-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>), <span class="co"># Center the main title</span></span>
<span id="cb223-16"><a href="#cb223-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb223-17"><a href="#cb223-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> <span class="co"># Center the subtitle</span></span>
<span id="cb223-18"><a href="#cb223-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> region, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb223-19"><a href="#cb223-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb223-20"><a href="#cb223-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2016-01-01"</span>),</span>
<span id="cb223-21"><a href="#cb223-21" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">as.Date</span>(<span class="st">"2023-12-31"</span>), <span class="at">by =</span> <span class="st">"6 months"</span>), <span class="co"># tick every 6 months</span></span>
<span id="cb223-22"><a href="#cb223-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">"%b %y"</span>) <span class="sc">+</span></span>
<span id="cb223-23"><a href="#cb223-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_scientific</span>()) <span class="co"># Apply log10 scale</span></span>
<span id="cb223-24"><a href="#cb223-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-25"><a href="#cb223-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb223-26"><a href="#cb223-26" aria-hidden="true" tabindex="-1"></a>plot_log_by_region</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-log-concentration-by-region-facets-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_log_by_region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Air pollution trends across New Zealand regions reveal intriguing variations. Canterbury’s pronounced seasonal fluctuations hint at climatic influences, while Otago’s cyclical peaks suggest recurring pollution sources. Bay of Plenty and Wellington maintain relatively stable pollutant levels, contrasting with the West Coast’s dramatic drops, possibly due to extreme weather events or data gaps. The use of log scales provides clarity in detecting subtle changes over time, distinguishing PM2.5 and PM10 trends.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to compute specified quantiles (e.g., thresholds) for a numeric column in a dataframe</span></span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>compute_quantiles <span class="ot">&lt;-</span> <span class="cf">function</span>(data, column, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>)) {</span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a>  column_data <span class="ot">&lt;-</span> data[[<span class="fu">deparse</span>(<span class="fu">substitute</span>(column))]]</span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quantile</span>(column_data, <span class="at">probs =</span> probs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb225-6"><a href="#cb225-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-7"><a href="#cb225-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute moderate and extreme anomaly thresholds (5th, 10th, 90th, 95th percentiles)</span></span>
<span id="cb225-8"><a href="#cb225-8" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">compute_quantiles</span>(daily_airdata_selected, sd_concentration)</span>
<span id="cb225-9"><a href="#cb225-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(quantiles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        5%        10%        90%        95% 
-0.9538486 -0.8320200  1.1835574  1.9922713 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with both threshold lines in new colors</span></span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>plot_region_zanomaly <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> daily_airdata_selected, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> sd_concentration, <span class="at">color =</span> indicator)) <span class="sc">+</span></span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> region)) <span class="sc">+</span></span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"PM10"</span> <span class="ot">=</span> <span class="st">"#0072B2"</span>, <span class="st">"PM2.5"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>)) <span class="sc">+</span></span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb227-6"><a href="#cb227-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 10th–90th percentile range</span></span>
<span id="cb227-7"><a href="#cb227-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="st">"10%"</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#009E73"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span>  <span class="co"># Bluish green</span></span>
<span id="cb227-8"><a href="#cb227-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="st">"90%"</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#009E73"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb227-9"><a href="#cb227-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-10"><a href="#cb227-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 5th–95th percentile range</span></span>
<span id="cb227-11"><a href="#cb227-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="st">"5%"</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span>  <span class="co"># Reddish purple</span></span>
<span id="cb227-12"><a href="#cb227-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="st">"95%"</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb227-13"><a href="#cb227-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-14"><a href="#cb227-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> region, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb227-15"><a href="#cb227-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb227-16"><a href="#cb227-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2016-01-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2023-12-31"</span>), <span class="at">by =</span> <span class="st">"6 months"</span>),</span>
<span id="cb227-17"><a href="#cb227-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">"%b %y"</span></span>
<span id="cb227-18"><a href="#cb227-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb227-19"><a href="#cb227-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb227-20"><a href="#cb227-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb227-21"><a href="#cb227-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Standardized PM2.5 and PM10 Trends by Region (2016–2023)"</span>,</span>
<span id="cb227-22"><a href="#cb227-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Z-score trends with 10th/90th (green) and 5th/95th (purple) percentiles marking moderate and extreme anomalies"</span>,</span>
<span id="cb227-23"><a href="#cb227-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Month–Year"</span>,</span>
<span id="cb227-24"><a href="#cb227-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized Concentration (Z-score)"</span>,</span>
<span id="cb227-25"><a href="#cb227-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Pollutant"</span></span>
<span id="cb227-26"><a href="#cb227-26" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb227-27"><a href="#cb227-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb227-28"><a href="#cb227-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>), </span>
<span id="cb227-29"><a href="#cb227-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb227-30"><a href="#cb227-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb227-31"><a href="#cb227-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb227-32"><a href="#cb227-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb227-33"><a href="#cb227-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb227-34"><a href="#cb227-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb227-35"><a href="#cb227-35" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb227-36"><a href="#cb227-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-37"><a href="#cb227-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot</span></span>
<span id="cb227-38"><a href="#cb227-38" aria-hidden="true" tabindex="-1"></a>plot_region_zanomaly</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/zscore-threshold-lines-by-region-plot-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_region_zanomaly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Regional air quality trends reveal striking differences in pollutant behavior, particularly in extreme cases. Canterbury exhibits persistently high PM2.5 and PM10 levels, frequently exceeding the 90th and 95th percentiles, indicating prolonged pollution events. In contrast, Bay of Plenty and Wellington experience volatile PM2.5 concentrations, with frequent spikes surpassing upper quantiles. Otago and West Coast display seasonal PM10 peaks, reflecting meteorological influences rather than urban emissions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign pollution category based on standardized concentration thresholds</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorize each day's standardized concentration as "good", "typical", or "bad", based on 10th and 90th percentile z-score thresholds computed earlier</span></span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>daily_airdata_selected <span class="ot">&lt;-</span> daily_airdata_selected <span class="sc">|&gt;</span></span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pollution_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a>    sd_concentration <span class="sc">&lt;</span> quantiles[<span class="st">"10%"</span>] <span class="sc">~</span> <span class="st">"good"</span>,<span class="co"># below 10th</span></span>
<span id="cb229-6"><a href="#cb229-6" aria-hidden="true" tabindex="-1"></a>    sd_concentration <span class="sc">&gt;</span> quantiles[<span class="st">"90%"</span>] <span class="sc">~</span> <span class="st">"bad"</span>, <span class="co"># above 90th</span></span>
<span id="cb229-7"><a href="#cb229-7" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"typical"</span>)) <span class="co"># between 10th and 90th</span></span>
<span id="cb229-8"><a href="#cb229-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-9"><a href="#cb229-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a faceted column plot showing daily standardized concentrations. Fill color reflects pollution category: good (green), typical (grey), bad (orange)</span></span>
<span id="cb229-10"><a href="#cb229-10" aria-hidden="true" tabindex="-1"></a>plot_threshold <span class="ot">&lt;-</span> <span class="cf">function</span>(xvar, yvar) {</span>
<span id="cb229-11"><a href="#cb229-11" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> daily_airdata_selected, <span class="fu">aes</span>(<span class="at">x =</span> {{xvar}}, <span class="at">y =</span> {{yvar}}, <span class="at">fill =</span> pollution_category)) <span class="sc">+</span></span>
<span id="cb229-12"><a href="#cb229-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> <span class="co"># stack columns side by side</span></span>
<span id="cb229-13"><a href="#cb229-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"good"</span> <span class="ot">=</span> <span class="st">"#1b9e77"</span>, <span class="st">"typical"</span> <span class="ot">=</span> <span class="st">"#999999"</span>, <span class="st">"bad"</span> <span class="ot">=</span> <span class="st">"#d95f02"</span>)) <span class="sc">+</span></span>
<span id="cb229-14"><a href="#cb229-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb229-15"><a href="#cb229-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb229-16"><a href="#cb229-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Month–Year"</span>, </span>
<span id="cb229-17"><a href="#cb229-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Daily Standardized Concentration"</span>, </span>
<span id="cb229-18"><a href="#cb229-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Pollution Category"</span>) <span class="sc">+</span></span>
<span id="cb229-19"><a href="#cb229-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb229-20"><a href="#cb229-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb229-21"><a href="#cb229-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb229-22"><a href="#cb229-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb229-23"><a href="#cb229-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb229-24"><a href="#cb229-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb229-25"><a href="#cb229-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>), </span>
<span id="cb229-26"><a href="#cb229-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb229-27"><a href="#cb229-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb229-28"><a href="#cb229-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb229-29"><a href="#cb229-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-30"><a href="#cb229-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb229-31"><a href="#cb229-31" aria-hidden="true" tabindex="-1"></a>plot_zscore_pollution_categories <span class="ot">&lt;-</span> <span class="fu">plot_threshold</span>(date, sd_concentration) <span class="sc">+</span></span>
<span id="cb229-32"><a href="#cb229-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> region_indicator, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb229-33"><a href="#cb229-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(</span>
<span id="cb229-34"><a href="#cb229-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.Date</span>(<span class="st">"2016-01-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2023-12-31"</span>), <span class="at">by =</span> <span class="st">"6 months"</span>), <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">date_format</span>(<span class="st">"%b%y"</span>)) <span class="sc">+</span></span>
<span id="cb229-35"><a href="#cb229-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb229-36"><a href="#cb229-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Categorized Standardized Daily Air Pollution Levels by Region (2016–2023)"</span>,</span>
<span id="cb229-37"><a href="#cb229-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Z-score scaled concentrations colored by pollution severity based on 10th/90th percentile cutoffs"</span>)</span>
<span id="cb229-38"><a href="#cb229-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-39"><a href="#cb229-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb229-40"><a href="#cb229-40" aria-hidden="true" tabindex="-1"></a>plot_zscore_pollution_categories</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-daily-zscore-pollution-categories-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_zscore_pollution_categories)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Across the regions of New Zealand depicted, a common thread of seasonal air pollution emerges, with particulate matter (PM10 and PM2.5) concentrations generally peaking during the colder winter months. Canterbury stands out with a seemingly higher frequency of “Bad” air quality days, especially for PM2.5, suggesting potential issues with pollutant trapping. Bay of Plenty also exhibits a clear seasonal pattern with notable “Bad” days. In contrast, Wellington appears to enjoy relatively better air quality with less pronounced seasonal variation and fewer instances of “Bad” pollution. Otago and the West Coast, for which only PM10 data is shown, also display seasonal trends but seem to experience fewer severe pollution episodes than Canterbury. These regional differences likely stem from a combination of factors including heating practices, local industrial activity, topography, and prevailing weather patterns.</p>
</section>
<section id="seasonal-aggregation-and-visualization-of-air-quality-data-20162023" class="level3" data-number="4.8">
<h3 data-number="4.8" class="anchored" data-anchor-id="seasonal-aggregation-and-visualization-of-air-quality-data-20162023"><span class="header-section-number">4.8</span> Seasonal Aggregation and Visualization of Air Quality Data (2016–2023)</h3>
<p>This section defines seasonal categories, computes total and seasonal pollutant concentrations by region, and calculates z-score anomalies. It then visualizes seasonal trends in PM2.5 and PM10 concentrations across selected New Zealand regions from 2016 to 2023 using a log-scaled line plot, highlighting temporal and spatial variations in air quality.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to classify dates into custom seasons</span></span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>get_season <span class="ot">&lt;-</span> <span class="cf">function</span>(date) {</span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>  month <span class="ot">&lt;-</span> <span class="fu">month</span>(date)</span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">case_when</span>(</span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>)  <span class="sc">~</span> <span class="st">"Sum"</span>, <span class="co"># Summer: Dec–Feb</span></span>
<span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)   <span class="sc">~</span> <span class="st">"Aut"</span>, <span class="co"># Autumn: Mar–May</span></span>
<span id="cb231-7"><a href="#cb231-7" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>)   <span class="sc">~</span> <span class="st">"Win"</span>, <span class="co"># Winter: Jun–Aug</span></span>
<span id="cb231-8"><a href="#cb231-8" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>) <span class="sc">~</span> <span class="st">"Spr"</span> <span class="co"># Spring: Sep–Nov</span></span>
<span id="cb231-9"><a href="#cb231-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb231-10"><a href="#cb231-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb231-11"><a href="#cb231-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-12"><a href="#cb231-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract 'season' and 'year' from the date column</span></span>
<span id="cb231-13"><a href="#cb231-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Factorize 'season' for ordered plotting</span></span>
<span id="cb231-14"><a href="#cb231-14" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(airdata_with_sa2) <span class="sc">|&gt;</span></span>
<span id="cb231-15"><a href="#cb231-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb231-16"><a href="#cb231-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">season =</span> <span class="fu">get_season</span>(date),</span>
<span id="cb231-17"><a href="#cb231-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">season =</span> <span class="fu">factor</span>(season, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Sum"</span>, <span class="st">"Aut"</span>, <span class="st">"Win"</span>, <span class="st">"Spr"</span>)),</span>
<span id="cb231-18"><a href="#cb231-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">format</span>(date, <span class="st">"%y"</span>) </span>
<span id="cb231-19"><a href="#cb231-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb231-20"><a href="#cb231-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, season, year, indicator, pop2018) <span class="sc">|&gt;</span></span>
<span id="cb231-21"><a href="#cb231-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb231-22"><a href="#cb231-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">region_concentration =</span> <span class="fu">sum</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb231-23"><a href="#cb231-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb231-24"><a href="#cb231-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb231-25"><a href="#cb231-25" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata_with_sa2<span class="sc">$</span>region_concentration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    8.0   612.2  1002.8  1081.7  1346.3  5898.8 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Region concentration ranges 12.41–21558.9, median 2055.98, mean 3535.07, skewed right distribution.</span></span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize distribution of season and year</span></span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata_with_sa2<span class="sc">$</span>season)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sum Aut Win Spr 
680 671 684 684 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">as.integer</span>(daily_airdata_with_sa2<span class="sc">$</span>year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  16.00   18.00   20.00   19.64   22.00   23.00 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Season column shows balanced seasonal distribution. Year column spans from 2016 to 2023 with median year 2020.</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute seasonal mean, standard deviation, and z-anomaly by region and indicator</span></span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="ot">&lt;-</span> daily_airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, season, indicator) <span class="sc">|&gt;</span></span>
<span id="cb237-6"><a href="#cb237-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb237-7"><a href="#cb237-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">seasonal_mean =</span> <span class="fu">mean</span>(region_concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb237-8"><a href="#cb237-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">seasonal_sd =</span> <span class="fu">sd</span>(region_concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb237-9"><a href="#cb237-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_concentration =</span> (region_concentration <span class="sc">-</span> seasonal_mean) <span class="sc">/</span> seasonal_sd</span>
<span id="cb237-10"><a href="#cb237-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb237-11"><a href="#cb237-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb237-12"><a href="#cb237-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-13"><a href="#cb237-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize seasonal statistics</span></span>
<span id="cb237-14"><a href="#cb237-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata_with_sa2<span class="sc">$</span>seasonal_mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  169.6   691.1  1092.0  1081.7  1384.6  2631.9 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata_with_sa2<span class="sc">$</span>seasonal_sd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   41.8   148.9   248.3   346.6   405.0  1288.8 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seasonal mean ranges from 204.8 to 17998.3 with mean 3535.1; seasonal SD ranges 41.8–5301, mean 713.8.</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(daily_airdata_with_sa2<span class="sc">$</span>sd_concentration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-3.3050 -0.6890 -0.1014  0.0000  0.6288  3.8590 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SD concentration ranges from -2.402 to 2.195, mean approximately zero.</span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate ordered season-year combinations for time-series plotting</span></span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique sorted years from the data</span></span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(daily_airdata_with_sa2<span class="sc">$</span>year))</span>
<span id="cb243-6"><a href="#cb243-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-7"><a href="#cb243-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define ordered season labels</span></span>
<span id="cb243-8"><a href="#cb243-8" aria-hidden="true" tabindex="-1"></a>season_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Sum"</span>, <span class="st">"Aut"</span>, <span class="st">"Win"</span>, <span class="st">"Spr"</span>)</span>
<span id="cb243-9"><a href="#cb243-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-10"><a href="#cb243-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate ordered levels like "Sum16", "Aut16", ..., "Spr23"</span></span>
<span id="cb243-11"><a href="#cb243-11" aria-hidden="true" tabindex="-1"></a>season_year_levels <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">outer</span>(season_order, years, paste0))</span>
<span id="cb243-12"><a href="#cb243-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-13"><a href="#cb243-13" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(season_year_levels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> chr [1:32] "Sum16" "Aut16" "Win16" "Spr16" "Sum17" "Aut17" "Win17" "Spr17" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and factorize 'season_year'</span></span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a>daily_airdata_with_sa2 <span class="ot">&lt;-</span> daily_airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">season_year =</span> <span class="fu">paste0</span>(season, year),</span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">season_year =</span> <span class="fu">factor</span>(season_year, <span class="at">levels =</span> season_year_levels),</span>
<span id="cb245-6"><a href="#cb245-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">region_indicator =</span> <span class="fu">paste0</span>(region, <span class="st">"_"</span>, indicator)</span>
<span id="cb245-7"><a href="#cb245-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb245-8"><a href="#cb245-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-9"><a href="#cb245-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview distinct levels</span></span>
<span id="cb245-10"><a href="#cb245-10" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(daily_airdata_with_sa2<span class="sc">$</span>season_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Factor w/ 32 levels "Sum16","Aut16",..: 1 1 1 1 1 1 1 1 1 5 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define plotting function for seasonal trends</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, y_var) {</span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> season_year, <span class="at">y =</span> {{y_var}}, <span class="at">color =</span> indicator)) <span class="sc">+</span></span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> indicator)) <span class="sc">+</span></span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"PM10"</span> <span class="ot">=</span> <span class="st">"#0072B2"</span>, <span class="st">"PM2.5"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>)) <span class="sc">+</span></span>
<span id="cb247-7"><a href="#cb247-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb247-8"><a href="#cb247-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Season_Year"</span>, <span class="at">color =</span> <span class="st">"Indicator"</span>) <span class="sc">+</span></span>
<span id="cb247-9"><a href="#cb247-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb247-10"><a href="#cb247-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb247-11"><a href="#cb247-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb247-12"><a href="#cb247-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb247-13"><a href="#cb247-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb247-14"><a href="#cb247-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb247-15"><a href="#cb247-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select a reproducible random sample of 6 regions for focused seasonal trend visualization</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">prepare_selected_airdata</span>(daily_airdata_with_sa2, <span class="at">n_regions =</span> <span class="dv">6</span>, <span class="at">seed =</span> <span class="dv">1234</span>)</span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>daily_airdata_selected <span class="ot">&lt;-</span> result<span class="sc">$</span>data</span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>selected_regions <span class="ot">&lt;-</span> result<span class="sc">$</span>selected_regions</span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-6"><a href="#cb248-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect structure of the selected dataset and confirm chosen regions</span></span>
<span id="cb248-7"><a href="#cb248-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(daily_airdata_selected)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "region"               "season"               "year"                
 [4] "indicator"            "pop2018"              "region_concentration"
 [7] "seasonal_mean"        "seasonal_sd"          "sd_concentration"    
[10] "season_year"          "region_indicator"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a>selected_regions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Tasman"             "Otago"              "Manawatu-Whanganui"
[4] "Hawke's Bay"        "Northland"          "West Coast"        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute distribution quantiles (5th, 10th, 90th, 95th percentiles) for reference lines</span></span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">compute_quantiles</span>(daily_airdata_selected, region_concentration)</span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(quantiles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       5%       10%       90%       95% 
 317.6326  415.3020 1894.4922 2280.6600 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate seasonal concentration trends with reference bands for selected regions and indicators</span></span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>seasonal_concentration_plot <span class="ot">&lt;-</span> <span class="fu">plot</span>(daily_airdata_selected, region_concentration) <span class="sc">+</span></span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> region, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Seasonal Trends of Pollutants in Selected New Zealand Regions (2016–2023)"</span>,</span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Seasonal average pollutant concentrations (log scale) across six randomly selected regions, highlighting inter-seasonal variability"</span>,</span>
<span id="cb254-7"><a href="#cb254-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Seasonal Average Concentration (µg/m³, log scale)"</span>) <span class="sc">+</span></span>
<span id="cb254-8"><a href="#cb254-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>scientific) <span class="sc">+</span></span>
<span id="cb254-9"><a href="#cb254-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb254-10"><a href="#cb254-10" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Add horizontal dashed lines for 10th–90th percentile range</span></span>
<span id="cb254-11"><a href="#cb254-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="dv">2</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#009E73"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span>  <span class="co"># Bluish green</span></span>
<span id="cb254-12"><a href="#cb254-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="dv">3</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#009E73"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb254-13"><a href="#cb254-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb254-14"><a href="#cb254-14" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Add horizontal dashed lines for 5th–95th percentile range</span></span>
<span id="cb254-15"><a href="#cb254-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="dv">1</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Reddish purple</span></span>
<span id="cb254-16"><a href="#cb254-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="dv">4</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)</span>
<span id="cb254-17"><a href="#cb254-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-18"><a href="#cb254-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb254-19"><a href="#cb254-19" aria-hidden="true" tabindex="-1"></a>seasonal_concentration_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/seasonal-trends-selected-regions-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, seasonal_concentration_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Otago shows high seasonal PM10 variability, while Hawke’s Bay and Manawatu-Whanganui remain stable. PM2.5 fluctuates in Tasman and West Coast but stays consistent in Northland. Winter pollution spikes, likely from heating emissions, persist. Quantile lines reveal extremes—Otago’s PM10 fluctuates widely, while Hawke’s Bay and Manawatu-Whanganui have tighter bands, emphasizing seasonal influences on air quality across regions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute quantiles (5th, 10th, 90th, 95th percentiles) for Z-score scaled seasonal concentrations</span></span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 'daily_airdata_selected' contains data; 'sd_concentration' is the standardized concentration column</span></span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">compute_quantiles</span>(daily_airdata_selected, sd_concentration)</span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(quantiles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       5%       10%       90%       95% 
-1.551783 -1.217957  1.285400  1.687826 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate seasonal trend plot of standardized pollutant concentrations across selected regions</span></span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a>seasonal_zscore_plot <span class="ot">&lt;-</span> <span class="fu">plot</span>(daily_airdata_selected, sd_concentration) <span class="sc">+</span></span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> region, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Standardized Seasonal Variations in PM2.5 and PM10 Across NZ Regions (2016–2023)"</span>,</span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Z-score scaled concentrations per season and region. Dashed green lines = moderate (10th/90th), purple = extreme (5th/95th) thresholds"</span>,</span>
<span id="cb258-7"><a href="#cb258-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized Concentration (Z-score)"</span></span>
<span id="cb258-8"><a href="#cb258-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb258-9"><a href="#cb258-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add dashed lines for moderate concentration range (10th–90th percentile)</span></span>
<span id="cb258-10"><a href="#cb258-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="dv">2</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#009E73"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span>  <span class="co"># Bluish green</span></span>
<span id="cb258-11"><a href="#cb258-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="dv">3</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#009E73"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb258-12"><a href="#cb258-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb258-13"><a href="#cb258-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add dashed lines for extreme concentration range (5th–95th percentile)</span></span>
<span id="cb258-14"><a href="#cb258-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="dv">1</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Reddish purple</span></span>
<span id="cb258-15"><a href="#cb258-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> quantiles[<span class="dv">4</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)</span>
<span id="cb258-16"><a href="#cb258-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-17"><a href="#cb258-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb258-18"><a href="#cb258-18" aria-hidden="true" tabindex="-1"></a>seasonal_zscore_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-zscore-seasonal-trends-selected-regions-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, seasonal_zscore_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The plots show varying pollution trends across NZ regions from 2016-2023. Hawke’s Bay and Northland exhibit frequent extreme PM2.5 concentrations. Manawatu-Whanganui and Tasman show moderate PM10 fluctuations, while West Coast consistently stays within normal ranges. Otago experiences occasional moderate PM10 increases. Overall, PM10 often reaches extreme levels more frequently than PM2.5 in several regions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorize pollution levels based on standardized (Z-score) concentration thresholds</span></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>daily_airdata_selected <span class="ot">&lt;-</span> daily_airdata_selected <span class="sc">|&gt;</span></span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">pollution_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a>      sd_concentration <span class="sc">&lt;</span> quantiles[<span class="st">"10%"</span>] <span class="sc">~</span> <span class="st">"good"</span>,</span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a>      sd_concentration <span class="sc">&gt;</span> quantiles[<span class="st">"90%"</span>] <span class="sc">~</span> <span class="st">"bad"</span>,</span>
<span id="cb260-7"><a href="#cb260-7" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"typical"</span>),</span>
<span id="cb260-8"><a href="#cb260-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb260-9"><a href="#cb260-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to ordered factor for consistent plotting</span></span>
<span id="cb260-10"><a href="#cb260-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pollution_category =</span> <span class="fu">factor</span>(pollution_category, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"good"</span>, <span class="st">"typical"</span>, <span class="st">"bad"</span>)))</span>
<span id="cb260-11"><a href="#cb260-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-12"><a href="#cb260-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a plot highlighting pollution category over time</span></span>
<span id="cb260-13"><a href="#cb260-13" aria-hidden="true" tabindex="-1"></a>categorized_pollution_plot <span class="ot">&lt;-</span> <span class="fu">plot_threshold</span>(season_year, sd_concentration) <span class="sc">+</span></span>
<span id="cb260-14"><a href="#cb260-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> region, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb260-15"><a href="#cb260-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb260-16"><a href="#cb260-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Categorized Standardized Air Pollution Concentration Trends (2016–2023)"</span>,</span>
<span id="cb260-17"><a href="#cb260-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Z-score concentrations classified as Good (&lt;10th), Typical (10th–90th), or Bad (&gt;90th percentile)"</span>,</span>
<span id="cb260-18"><a href="#cb260-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Season-Year"</span>,</span>
<span id="cb260-19"><a href="#cb260-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized Concentration (Z-score)"</span></span>
<span id="cb260-20"><a href="#cb260-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb260-21"><a href="#cb260-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-22"><a href="#cb260-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot</span></span>
<span id="cb260-23"><a href="#cb260-23" aria-hidden="true" tabindex="-1"></a>categorized_pollution_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-categorized-zscore-seasonal-trends-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, categorized_pollution_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>All regions exhibit periods of “bad” (orange) and “good” (teal) pollution categories, with “typical” (grey) being most frequent. Otago, Manawatu-Whanganui, and Hawke’s Bay show more frequent “bad” periods, particularly earlier in the time series. Northland, Tasman, and West Coast experience fewer “bad” periods, with Tasman and West Coast showing more consistent “good” periods later on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute per capita pollutant concentration by dividing total regional concentration by 2018 population</span></span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Assumes population remained relatively stable between 2016–2023</span></span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a>daily_airdata_selected <span class="ot">&lt;-</span> daily_airdata_selected <span class="sc">|&gt;</span></span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, indicator) <span class="sc">|&gt;</span></span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb262-6"><a href="#cb262-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">concentration_per_capita =</span> region_concentration <span class="sc">/</span> pop2018,</span>
<span id="cb262-7"><a href="#cb262-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb262-8"><a href="#cb262-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standardize per capita concentration within each region-indicator group</span></span>
<span id="cb262-9"><a href="#cb262-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_concentration =</span> (concentration_per_capita <span class="sc">-</span> <span class="fu">mean</span>(concentration_per_capita, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))<span class="sc">/</span> <span class="fu">sd</span>(concentration_per_capita, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb262-10"><a href="#cb262-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb262-11"><a href="#cb262-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-12"><a href="#cb262-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create faceted column plot of standardized per capita concentrations</span></span>
<span id="cb262-13"><a href="#cb262-13" aria-hidden="true" tabindex="-1"></a>plot_per_capita_sd <span class="ot">&lt;-</span> <span class="fu">plot_threshold</span>(season_year, sd_concentration) <span class="sc">+</span></span>
<span id="cb262-14"><a href="#cb262-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> region, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb262-15"><a href="#cb262-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb262-16"><a href="#cb262-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Standardized Seasonal Air Pollution Concentration Per Capita by Region (2016–2023)"</span>,</span>
<span id="cb262-17"><a href="#cb262-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Z-score scaled concentrations adjusted for 2018 population; colored thresholds highlight top and bottom 10%"</span>,</span>
<span id="cb262-18"><a href="#cb262-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized Per Capita Concentration (Z-score)"</span>)</span>
<span id="cb262-19"><a href="#cb262-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-20"><a href="#cb262-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb262-21"><a href="#cb262-21" aria-hidden="true" tabindex="-1"></a>plot_per_capita_sd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-standardized-concentration-per-capita-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_per_capita_sd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The graphs display standardized seasonal air pollution concentrations per capita for various regions from 2016 to 2023. Hawke’s Bay and Tasman show more frequent “good” (teal) periods, particularly in later years. Manawatu-Whanganui and Northland exhibit a higher prevalence of “bad” (orange) periods, especially in the earlier years. Hawke’s Bay and Otago present a mix, with Otago having some notable “bad” spikes later on. Overall, there’s regional variability in pollution trends, with some areas consistently better or worse.</p>
</section>
</section>
<section id="sa2-level-air-quality-insights-for-auckland-20162023" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="sa2-level-air-quality-insights-for-auckland-20162023"><span class="header-section-number">5</span> SA2-Level Air Quality Insights for Auckland (2016–2023)</h2>
<p>This map highlights spatial variation in particulate pollution across Auckland SA2 zones, helping identify areas with elevated per capita exposure for targeted environmental interventions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the airdata_with_sa2 dataset to include only Auckland region</span></span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a>airdata_with_sa2 <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">"Auckland"</span>)</span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a><span class="co"># View the structure of the filtered data</span></span>
<span id="cb264-6"><a href="#cb264-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata_with_sa2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 29,308
Columns: 11
$ region              &lt;chr&gt; "Auckland", "Auckland", "Auckland", "Auckland", "A…
$ lawa_site_id        &lt;chr&gt; "LAWA-100059", "LAWA-100059", "LAWA-100059", "LAWA…
$ site_type           &lt;chr&gt; "Residential, NES site", "Residential, NES site", …
$ indicator           &lt;chr&gt; "PM10", "PM10", "PM10", "PM10", "PM10", "PM10", "P…
$ date                &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2…
$ concentration       &lt;dbl&gt; 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2…
$ year                &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2…
$ geometry            &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -3…
$ sa2_name            &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Ed…
$ pop2018             &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 37…
$ arima_concentration &lt;dbl&gt; 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove unneeded columns for summary calculations</span></span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>airdata_with_sa2 <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>region, <span class="sc">-</span>lawa_site_id, <span class="sc">-</span>arima_concentration)</span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract longitude and latitude from geometry column</span></span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a>airdata_with_sa2 <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb266-7"><a href="#cb266-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb266-8"><a href="#cb266-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">1</span>],</span>
<span id="cb266-9"><a href="#cb266-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">2</span>]</span>
<span id="cb266-10"><a href="#cb266-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb266-11"><a href="#cb266-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-12"><a href="#cb266-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarise concentration data by SA2 area</span></span>
<span id="cb266-13"><a href="#cb266-13" aria-hidden="true" tabindex="-1"></a>airdata_summary <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb266-14"><a href="#cb266-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name, longitude, latitude) <span class="sc">|&gt;</span></span>
<span id="cb266-15"><a href="#cb266-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb266-16"><a href="#cb266-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">sa2_conc =</span> <span class="fu">sum</span>(concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># Sum conc.</span></span>
<span id="cb266-17"><a href="#cb266-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">sa2_conc_per_capita =</span> sa2_conc <span class="sc">/</span> pop2018 <span class="sc">*</span> <span class="dv">100</span>, <span class="co"># Per capita conc.</span></span>
<span id="cb266-18"><a href="#cb266-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb266-19"><a href="#cb266-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb266-20"><a href="#cb266-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(sa2_name, longitude, latitude, sa2_conc, sa2_conc_per_capita)</span>
<span id="cb266-21"><a href="#cb266-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-22"><a href="#cb266-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Output for verification</span></span>
<span id="cb266-23"><a href="#cb266-23" aria-hidden="true" tabindex="-1"></a>airdata_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 5
  sa2_name                longitude latitude sa2_conc sa2_conc_per_capita
  &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;               &lt;dbl&gt;
1 Ellerslie South              175.    -36.9   57527.               2115.
2 Glen Eden Central            175.    -36.9   35021.                924.
3 Henderson Lincoln South      175.    -36.9   34102.               1263.
4 Puni                         175.    -37.2   45549.               2761.
5 Queen Street                 175.    -36.8   55926.               2292.
6 Sunnyhills East              175.    -36.9   36121.               1009.
7 Westlake                     175.    -36.8   53903.               1728.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a Plotly map where:</span></span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a><span class="co"># - Marker color represents concentration per capita</span></span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - Marker size is fixed (not scaled by concentration)</span></span>
<span id="cb268-4"><a href="#cb268-4" aria-hidden="true" tabindex="-1"></a>sa2_auckland_per_capita <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(</span>
<span id="cb268-5"><a href="#cb268-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> airdata_summary, <span class="at">type =</span> <span class="st">'scattermapbox'</span>, <span class="at">mode =</span> <span class="st">'markers'</span>,</span>
<span id="cb268-6"><a href="#cb268-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">lat =</span> <span class="sc">~</span>latitude, <span class="at">lon =</span> <span class="sc">~</span>longitude,</span>
<span id="cb268-7"><a href="#cb268-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="cn">NULL</span>, <span class="at">showlegend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb268-8"><a href="#cb268-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="sc">~</span><span class="fu">paste0</span>(</span>
<span id="cb268-9"><a href="#cb268-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SA2: "</span>, sa2_name,</span>
<span id="cb268-10"><a href="#cb268-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"&lt;br&gt;Site Concentration: "</span>, <span class="fu">round</span>(sa2_conc, <span class="dv">1</span>), <span class="st">" µg/m³"</span>,</span>
<span id="cb268-11"><a href="#cb268-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"&lt;br&gt;Per Capita: "</span>, <span class="fu">round</span>(sa2_conc_per_capita, <span class="dv">2</span>), <span class="st">" µg/m³/person"</span>),</span>
<span id="cb268-12"><a href="#cb268-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">marker =</span> <span class="fu">list</span>(</span>
<span id="cb268-13"><a href="#cb268-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">20</span>, <span class="co"># Marker size is fixed</span></span>
<span id="cb268-14"><a href="#cb268-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="sc">~</span>sa2_conc_per_capita, </span>
<span id="cb268-15"><a href="#cb268-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">colorscale =</span> <span class="st">'Viridis'</span>,</span>
<span id="cb268-16"><a href="#cb268-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">opacity =</span> <span class="dv">1</span>, <span class="at">showscale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb268-17"><a href="#cb268-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">colorbar =</span> <span class="fu">list</span>(</span>
<span id="cb268-18"><a href="#cb268-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Per Capita Conc. (µg/m³/person)"</span>,</span>
<span id="cb268-19"><a href="#cb268-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fl">0.95</span>, <span class="at">xanchor =</span> <span class="st">"left"</span>, <span class="at">len =</span> <span class="fl">0.75</span>)</span>
<span id="cb268-20"><a href="#cb268-20" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">|&gt;</span></span>
<span id="cb268-21"><a href="#cb268-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb268-22"><a href="#cb268-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">list</span>(</span>
<span id="cb268-23"><a href="#cb268-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="sc">~</span><span class="fu">paste</span>(</span>
<span id="cb268-24"><a href="#cb268-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;b&gt;SA2:&lt;/b&gt;"</span>, sa2_name,</span>
<span id="cb268-25"><a href="#cb268-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;br&gt;&lt;b&gt;Total Concentration:&lt;/b&gt;"</span>, <span class="fu">round</span>(sa2_conc), <span class="st">"µg/m³"</span>,</span>
<span id="cb268-26"><a href="#cb268-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;br&gt;&lt;b&gt;Per Capita:&lt;/b&gt;"</span>, <span class="fu">round</span>(sa2_conc_per_capita, <span class="dv">2</span>), <span class="st">"µg/m³/person"</span>),</span>
<span id="cb268-27"><a href="#cb268-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">26</span>)  <span class="co"># ← title font size</span></span>
<span id="cb268-28"><a href="#cb268-28" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb268-29"><a href="#cb268-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapbox =</span> <span class="fu">list</span>(</span>
<span id="cb268-30"><a href="#cb268-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="st">"open-street-map"</span>, <span class="at">zoom =</span> <span class="dv">10</span>,</span>
<span id="cb268-31"><a href="#cb268-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">center =</span> <span class="fu">list</span>(</span>
<span id="cb268-32"><a href="#cb268-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">lat =</span> <span class="fu">median</span>(airdata_summary<span class="sc">$</span>latitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb268-33"><a href="#cb268-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">lon =</span> <span class="fu">median</span>(airdata_summary<span class="sc">$</span>longitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb268-34"><a href="#cb268-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb268-35"><a href="#cb268-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-36"><a href="#cb268-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the interactive map</span></span>
<span id="cb268-37"><a href="#cb268-37" aria-hidden="true" tabindex="-1"></a>sa2_auckland_per_capita</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-b8789f1e917cb2c4d14d" style="width:100%;height:278px;"></div>
<script type="application/json" data-for="htmlwidget-b8789f1e917cb2c4d14d">{"x":{"visdat":{"fe453fa2c8e":["function () ","plotlyVisDat"]},"cur_data":"fe453fa2c8e","attrs":{"fe453fa2c8e":{"mode":"markers","lat":{},"lon":{},"showlegend":false,"text":{},"marker":{"size":20,"color":{},"colorscale":"Viridis","opacity":1,"showscale":true,"colorbar":{"title":"Per Capita Conc. (µg/m³/person)","x":0.94999999999999996,"xanchor":"left","len":0.75}},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scattermapbox"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":{"text":["<b>SA2:<\/b> Ellerslie South <br><b>Total Concentration:<\/b> 57527 µg/m³ <br><b>Per Capita:<\/b> 2114.95 µg/m³/person","<b>SA2:<\/b> Glen Eden Central <br><b>Total Concentration:<\/b> 35021 µg/m³ <br><b>Per Capita:<\/b> 924.04 µg/m³/person","<b>SA2:<\/b> Henderson Lincoln South <br><b>Total Concentration:<\/b> 34102 µg/m³ <br><b>Per Capita:<\/b> 1263.02 µg/m³/person","<b>SA2:<\/b> Puni <br><b>Total Concentration:<\/b> 45549 µg/m³ <br><b>Per Capita:<\/b> 2760.53 µg/m³/person","<b>SA2:<\/b> Queen Street <br><b>Total Concentration:<\/b> 55926 µg/m³ <br><b>Per Capita:<\/b> 2292.04 µg/m³/person","<b>SA2:<\/b> Sunnyhills East <br><b>Total Concentration:<\/b> 36121 µg/m³ <br><b>Per Capita:<\/b> 1008.97 µg/m³/person","<b>SA2:<\/b> Westlake <br><b>Total Concentration:<\/b> 53903 µg/m³ <br><b>Per Capita:<\/b> 1727.67 µg/m³/person"],"x":0.5,"font":{"size":26}},"mapbox":{"style":"open-street-map","zoom":10,"center":{"lat":-36.904558461006303,"lon":174.76570000000001}},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"mode":"markers","lat":[-36.904558461006303,-36.922142811073002,-36.8680004511356,-37.204503610808089,-36.847430000000003,-36.905483750710502,-36.780305250869901],"lon":[174.815563500351,174.6520009000113,174.6284,174.86401940002824,174.76570000000001,174.8904,174.74890449976101],"showlegend":false,"text":["SA2: Ellerslie South<br>Site Concentration: 57526.8 µg/m³<br>Per Capita: 2114.95 µg/m³/person","SA2: Glen Eden Central<br>Site Concentration: 35021.2 µg/m³<br>Per Capita: 924.04 µg/m³/person","SA2: Henderson Lincoln South<br>Site Concentration: 34101.5 µg/m³<br>Per Capita: 1263.02 µg/m³/person","SA2: Puni<br>Site Concentration: 45548.7 µg/m³<br>Per Capita: 2760.53 µg/m³/person","SA2: Queen Street<br>Site Concentration: 55925.9 µg/m³<br>Per Capita: 2292.04 µg/m³/person","SA2: Sunnyhills East<br>Site Concentration: 36121.1 µg/m³<br>Per Capita: 1008.97 µg/m³/person","SA2: Westlake<br>Site Concentration: 53903.4 µg/m³<br>Per Capita: 1727.67 µg/m³/person"],"marker":{"color":[2114.9542647058825,924.04274406332456,1263.02,2760.5264242424246,2292.0437704918031,1008.9686871508379,1727.6718910256409],"size":20,"colorscale":"Viridis","opacity":1,"showscale":true,"colorbar":{"title":"Per Capita Conc. (µg/m³/person)","x":0.94999999999999996,"xanchor":"left","len":0.75},"line":{"color":"rgba(31,119,180,1)"}},"type":"scattermapbox","line":{"color":"rgba(31,119,180,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save map as a self-contained HTML widget</span></span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a>htmlwidgets<span class="sc">::</span><span class="fu">saveWidget</span>(sa2_auckland_per_capita, <span class="st">"dist.html"</span>, <span class="at">selfcontained =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The interactive map reveals spatial disparities in air quality across Auckland SA2 areas from 2016 to 2023. Puni consistently exhibits the highest particulate matter concentrations, indicating significant localized pollution sources. Glen Eden Central, Sunnyhills East, and Henderson Lincoln South show notably low levels, suggesting relatively clean air. Queen Street, Ellerslie South, and Westlake maintain moderate concentrations, likely reflecting persistent but stable urban emissions over time.</p>
<section id="integrating-and-enriching-air-quality-data-across-auckland-sa2-areas" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="integrating-and-enriching-air-quality-data-across-auckland-sa2-areas"><span class="header-section-number">5.1</span> Integrating and Enriching Air Quality Data Across Auckland SA2 Areas</h3>
<p>This section consolidates Air Quality Index (AQI) and key pollutant readings—including NO2, NO, PM10, and PM2.5—across multiple SA2 regions in Auckland. A reusable function is defined to prepare pollutant-specific datasets, which are then systematically merged with the main air quality dataset by date and SA2 name. This process results in a comprehensive, temporally aligned dataset suitable for spatial and temporal air quality analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a>prepare_pollutant_data <span class="ot">&lt;-</span> <span class="cf">function</span>(file_path, column_name, <span class="at">start_date =</span> <span class="st">"2016-01-01"</span>, <span class="at">end_date =</span> <span class="st">"2024-12-31"</span>) {</span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read CSV</span></span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb270-4"><a href="#cb270-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb270-5"><a href="#cb270-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename columns</span></span>
<span id="cb270-6"><a href="#cb270-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"date"</span>, column_name)</span>
<span id="cb270-7"><a href="#cb270-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb270-8"><a href="#cb270-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove first row (header row re-imported as data)</span></span>
<span id="cb270-9"><a href="#cb270-9" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df[<span class="sc">-</span><span class="dv">1</span>, ]</span>
<span id="cb270-10"><a href="#cb270-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb270-11"><a href="#cb270-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert columns</span></span>
<span id="cb270-12"><a href="#cb270-12" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb270-13"><a href="#cb270-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb270-14"><a href="#cb270-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb270-15"><a href="#cb270-15" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!!</span><span class="fu">sym</span>(column_name) <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(.data[[column_name]])</span>
<span id="cb270-16"><a href="#cb270-16" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb270-17"><a href="#cb270-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb270-18"><a href="#cb270-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter by date range</span></span>
<span id="cb270-19"><a href="#cb270-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(start_date), date <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(end_date)) <span class="sc">|&gt;</span></span>
<span id="cb270-20"><a href="#cb270-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb270-21"><a href="#cb270-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by date and sum the specified column</span></span>
<span id="cb270-22"><a href="#cb270-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb270-23"><a href="#cb270-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="sc">!!</span><span class="fu">sym</span>(column_name) <span class="sc">:</span><span class="er">=</span> <span class="fu">sum</span>(.data[[column_name]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb270-24"><a href="#cb270-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb270-25"><a href="#cb270-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb270-26"><a href="#cb270-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using pivot_wider() function to extract wide form of indicator</span></span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a>airdata_with_sa2 <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb271-4"><a href="#cb271-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> indicator,</span>
<span id="cb271-5"><a href="#cb271-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> concentration</span>
<span id="cb271-6"><a href="#cb271-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb271-7"><a href="#cb271-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-8"><a href="#cb271-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a glimpse</span></span>
<span id="cb271-9"><a href="#cb271-9" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata_with_sa2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 19,338
Columns: 10
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Residenti…
$ date      &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01-05,…
$ year      &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2016", "201…
$ geometry  &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -36.92214), …
$ sa2_name  &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Eden Central…
$ pop2018   &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, …
$ longitude &lt;dbl&gt; 174.652, 174.652, 174.652, 174.652, 174.652, 174.652, 174.65…
$ latitude  &lt;dbl&gt; -36.92214, -36.92214, -36.92214, -36.92214, -36.92214, -36.9…
$ PM10      &lt;dbl&gt; 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2, 10.6, 15…
$ PM2.5     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove PM10, and PM2.5 columns</span></span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a>airdata_with_sa2 <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>PM10, <span class="sc">-</span>PM2<span class="fl">.5</span>)</span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-5"><a href="#cb273-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a glimpse</span></span>
<span id="cb273-6"><a href="#cb273-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(airdata_with_sa2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 19,338
Columns: 8
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Residenti…
$ date      &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01-05,…
$ year      &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2016", "201…
$ geometry  &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -36.92214), …
$ sa2_name  &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Eden Central…
$ pop2018   &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, …
$ longitude &lt;dbl&gt; 174.652, 174.652, 174.652, 174.652, 174.652, 174.652, 174.65…
$ latitude  &lt;dbl&gt; -36.92214, -36.92214, -36.92214, -36.92214, -36.92214, -36.9…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Quality Index - Henderson</span></span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a>aqi_henderson <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/henderson/aqi-henderson/DataSetExport-AQI.Air Quality Index (AQI) - Unverified@5-Instantaneous-AQI-20250522060037.csv"</span>, <span class="st">"AQI"</span>)</span>
<span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Quality Index - Pakuranga</span></span>
<span id="cb275-5"><a href="#cb275-5" aria-hidden="true" tabindex="-1"></a>aqi_pakuranga <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/pakuranga/aqi-pakuranga/DataSetExport-AQI.Air Quality Index (AQI) - Unverified@1-Instantaneous-AQI-20250522055337.csv"</span>, <span class="st">"AQI"</span>)</span>
<span id="cb275-6"><a href="#cb275-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-7"><a href="#cb275-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Quality Index - Glen Eden</span></span>
<span id="cb275-8"><a href="#cb275-8" aria-hidden="true" tabindex="-1"></a>aqi_gleneden <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/gleneden/aqi-gleneden/DataSetExport-AQI.Air Quality Index (AQI) - Unverified@67-Instantaneous-AQI-20250522053925.csv"</span>, <span class="st">"AQI"</span>)</span>
<span id="cb275-9"><a href="#cb275-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-10"><a href="#cb275-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Quality Index - Patumahoe</span></span>
<span id="cb275-11"><a href="#cb275-11" aria-hidden="true" tabindex="-1"></a>aqi_patumahoe <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/patumahoe/aqi-patumahoe/DataSetExport-AQI.Air Quality Index (AQI) - Unverified@2-Maximum-AQI-20250412191546.csv"</span>, <span class="st">"AQI"</span>)</span>
<span id="cb275-12"><a href="#cb275-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-13"><a href="#cb275-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Quality Index - Takapuna</span></span>
<span id="cb275-14"><a href="#cb275-14" aria-hidden="true" tabindex="-1"></a>aqi_takapuna <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/takapuna/aqi-takapuna/DataSetExport-AQI.Air Quality Index (AQI) - Unverified@23-Instantaneous-AQI-20250513132258.csv"</span>, <span class="st">"AQI"</span>)</span>
<span id="cb275-15"><a href="#cb275-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-16"><a href="#cb275-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Quality Index - Penrose</span></span>
<span id="cb275-17"><a href="#cb275-17" aria-hidden="true" tabindex="-1"></a>aqi_penrose <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/penrose/aqi-penrose/DataSetExport-AQI.Air Quality Index (AQI) - Unverified@23-Instantaneous-AQI-20250513132258.csv"</span>, <span class="st">"AQI"</span>)</span>
<span id="cb275-18"><a href="#cb275-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-19"><a href="#cb275-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Quality Index - Queen Street</span></span>
<span id="cb275-20"><a href="#cb275-20" aria-hidden="true" tabindex="-1"></a>aqi_queenstreet <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/queenstreet/aqi-queenstreet/DataSetExport-AQI.Air Quality Index (AQI) - Unverified@9-Maximum-AQI-20250412201809.csv"</span>, <span class="st">"AQI"</span>)</span>
<span id="cb275-21"><a href="#cb275-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-22"><a href="#cb275-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind rows of air quality index</span></span>
<span id="cb275-23"><a href="#cb275-23" aria-hidden="true" tabindex="-1"></a>bind_pollutant_data <span class="ot">&lt;-</span> <span class="cf">function</span>(data_list, sa2_names) {</span>
<span id="cb275-24"><a href="#cb275-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(data_list) <span class="ot">&lt;-</span> sa2_names</span>
<span id="cb275-25"><a href="#cb275-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(data_list, <span class="at">.id =</span> <span class="st">"sa2_name"</span>)</span>
<span id="cb275-26"><a href="#cb275-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb275-27"><a href="#cb275-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-28"><a href="#cb275-28" aria-hidden="true" tabindex="-1"></a>aqi_combined <span class="ot">&lt;-</span> <span class="fu">bind_pollutant_data</span>(</span>
<span id="cb275-29"><a href="#cb275-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(aqi_henderson, aqi_pakuranga, aqi_gleneden, aqi_patumahoe, aqi_takapuna, aqi_penrose, aqi_queenstreet),</span>
<span id="cb275-30"><a href="#cb275-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>, <span class="st">"Glen Eden Central"</span>, <span class="st">"Puni"</span>, <span class="st">"Westlake"</span>, <span class="st">"Ellerslie South"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb275-31"><a href="#cb275-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-32"><a href="#cb275-32" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(aqi_combined)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 19,057
Columns: 3
$ sa2_name &lt;chr&gt; "Henderson Lincoln South", "Henderson Lincoln South", "Hender…
$ date     &lt;date&gt; 2016-02-01, 2016-02-02, 2016-02-03, 2016-02-04, 2016-02-05, …
$ AQI      &lt;dbl&gt; 197, 575, 579, 487, 156, 85, 520, 721, 594, 676, 263, 151, 63…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join by matching rows where both date and sa2_name are same </span></span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a>merged_airdata <span class="ot">&lt;-</span> airdata_with_sa2 <span class="sc">|&gt;</span></span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(aqi_combined, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span> <span class="ot">=</span> <span class="st">"date"</span>, <span class="st">"sa2_name"</span> <span class="ot">=</span> <span class="st">"sa2_name"</span>)) </span>
<span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-5"><a href="#cb277-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a glimpse</span></span>
<span id="cb277-6"><a href="#cb277-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(merged_airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 19,338
Columns: 9
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Residenti…
$ date      &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01-05,…
$ year      &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2016", "201…
$ geometry  &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -36.92214), …
$ sa2_name  &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Eden Central…
$ pop2018   &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, …
$ longitude &lt;dbl&gt; 174.652, 174.652, 174.652, 174.652, 174.652, 174.652, 174.65…
$ latitude  &lt;dbl&gt; -36.92214, -36.92214, -36.92214, -36.92214, -36.92214, -36.9…
$ AQI       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitrogen Oxide (NO2) - Henderson</span></span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>no2_henderson <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/henderson/no2-henderson/DataSetExport-NO2.24-Hour Aggregate (╡g m│)@5-Instantaneous-ug m^3-20250522063804.csv"</span>, <span class="st">"NO2"</span>)</span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitrogen Oxide (NO2) - Glen Eden</span></span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a>no2_gleneden <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/gleneden/no2-gleneden/DataSetExport-NO2.24-Hour Aggregate (╡g m│)@67-Instantaneous-ug m^3-20250522064657.csv"</span>, <span class="st">"NO2"</span>)</span>
<span id="cb279-6"><a href="#cb279-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-7"><a href="#cb279-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitrogen Oxide (NO2) - Patumahoe</span></span>
<span id="cb279-8"><a href="#cb279-8" aria-hidden="true" tabindex="-1"></a>no2_patumahoe <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/patumahoe/no2-patumahoe/DataSetExport-NO2.24-Hour Aggregate (╡g m│)@2-Maximum-ug m^3-20250417183335.csv"</span>, <span class="st">"NO2"</span>)</span>
<span id="cb279-9"><a href="#cb279-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-10"><a href="#cb279-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitrogen Oxide (NO2) - Takapuna</span></span>
<span id="cb279-11"><a href="#cb279-11" aria-hidden="true" tabindex="-1"></a>no2_takapuna <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/takapuna/no2-takapuna/DataSetExport-NO2.24-Hour Aggregate (╡g m│)@23-Instantaneous-ug m^3-20250513123549.csv"</span>, <span class="st">"NO2"</span>)</span>
<span id="cb279-12"><a href="#cb279-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-13"><a href="#cb279-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitrogen Oxide (NO2) - Penrose</span></span>
<span id="cb279-14"><a href="#cb279-14" aria-hidden="true" tabindex="-1"></a>no2_penrose <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/penrose/no2-penrose/DataSetExport-NO2.24-Hour Aggregate (╡g m│)@7-Instantaneous-ug m^3-20250514220927.csv"</span>, <span class="st">"NO2"</span>)</span>
<span id="cb279-15"><a href="#cb279-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-16"><a href="#cb279-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitrogen Oxide (NO2) - Queen Street</span></span>
<span id="cb279-17"><a href="#cb279-17" aria-hidden="true" tabindex="-1"></a>no2_queenstreet <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/queenstreet/no2-queenstreet/DataSetExport-NO2.24-Hour Aggregate (╡g m│)@9-Maximum-ug m^3-20250417181653.csv"</span>, <span class="st">"NO2"</span>)</span>
<span id="cb279-18"><a href="#cb279-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-19"><a href="#cb279-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind Rows of Nitrogen Dioxide (NO2)</span></span>
<span id="cb279-20"><a href="#cb279-20" aria-hidden="true" tabindex="-1"></a>no2_combined <span class="ot">&lt;-</span> <span class="fu">bind_pollutant_data</span>(</span>
<span id="cb279-21"><a href="#cb279-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(no2_henderson, no2_gleneden, no2_patumahoe, no2_takapuna, no2_penrose, no2_queenstreet),</span>
<span id="cb279-22"><a href="#cb279-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Henderson Lincoln South"</span>, <span class="st">"Glen Eden Central"</span>, <span class="st">"Puni"</span>, <span class="st">"Westlake"</span>, <span class="st">"Ellerslie South"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb279-23"><a href="#cb279-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-24"><a href="#cb279-24" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(no2_combined)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 16,062
Columns: 3
$ sa2_name &lt;chr&gt; "Henderson Lincoln South", "Henderson Lincoln South", "Hender…
$ date     &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01-05, …
$ NO2      &lt;dbl&gt; 6.6, 3.3, 2.9, 1.8, 3.9, 7.8, 7.9, 5.4, 7.1, 2.4, 1.2, 7.9, 9…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join by matching rows where both date and sa2_name are same </span></span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a>merged_airdata <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(no2_combined, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span> <span class="ot">=</span> <span class="st">"date"</span>, <span class="st">"sa2_name"</span> <span class="ot">=</span> <span class="st">"sa2_name"</span>)) </span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-5"><a href="#cb281-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a glimpse</span></span>
<span id="cb281-6"><a href="#cb281-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(merged_airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 19,338
Columns: 10
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Residenti…
$ date      &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01-05,…
$ year      &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2016", "201…
$ geometry  &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -36.92214), …
$ sa2_name  &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Eden Central…
$ pop2018   &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, …
$ longitude &lt;dbl&gt; 174.652, 174.652, 174.652, 174.652, 174.652, 174.652, 174.65…
$ latitude  &lt;dbl&gt; -36.92214, -36.92214, -36.92214, -36.92214, -36.92214, -36.9…
$ AQI       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ NO2       &lt;dbl&gt; 3.4, 2.0, 3.8, 1.3, 2.5, 4.2, 4.5, 2.7, 4.1, 0.6, 0.4, 3.0, …</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitric Oxide (NO) - Henderson</span></span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a>no_henderson <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/henderson/no-henderson/DataSetExport-NO.24-Hour Aggregate (╡g m│)@5-Instantaneous-ug m^3-20250522071408.csv"</span>, <span class="st">"NO"</span>)</span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-4"><a href="#cb283-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitric Oxide (NO) - Glen Eden</span></span>
<span id="cb283-5"><a href="#cb283-5" aria-hidden="true" tabindex="-1"></a>no_gleneden <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/gleneden/no-gleneden/DataSetExport-NO.24-Hour Aggregate (╡g m│)@67-Instantaneous-ug m^3-20250522071648.csv"</span>, <span class="st">"NO"</span>)</span>
<span id="cb283-6"><a href="#cb283-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-7"><a href="#cb283-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitric Oxide (NO) - Patumahoe</span></span>
<span id="cb283-8"><a href="#cb283-8" aria-hidden="true" tabindex="-1"></a>no_patumahoe <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/patumahoe/no-patumahoe/DataSetExport-NO.24-Hour Aggregate (╡g m│)@2-Maximum-ug m^3-20250417183303.csv"</span>, <span class="st">"NO"</span>)</span>
<span id="cb283-9"><a href="#cb283-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-10"><a href="#cb283-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitric Oxide (NO) - Takapuna</span></span>
<span id="cb283-11"><a href="#cb283-11" aria-hidden="true" tabindex="-1"></a>no_takapuna <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/takapuna/no-takapuna/DataSetExport-NO.24-Hour Aggregate (╡g m│)@23-Instantaneous-ug m^3-20250517231409.csv"</span>, <span class="st">"NO"</span>)</span>
<span id="cb283-12"><a href="#cb283-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-13"><a href="#cb283-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitric Oxide (NO) - Penrose</span></span>
<span id="cb283-14"><a href="#cb283-14" aria-hidden="true" tabindex="-1"></a>no_penrose <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/penrose/no-penrose/DataSetExport-NO.24-Hour Aggregate (╡g m│)@7-Instantaneous-ug m^3-20250517231058.csv"</span>, <span class="st">"NO"</span>)</span>
<span id="cb283-15"><a href="#cb283-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-16"><a href="#cb283-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Nitrogen Oxide (NO) - Queen Street</span></span>
<span id="cb283-17"><a href="#cb283-17" aria-hidden="true" tabindex="-1"></a>no_queenstreet <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/queenstreet/no-queenstreet/DataSetExport-NO.24-Hour Aggregate (╡g m│)@9-Instantaneous-ug m^3-20250430044717.csv"</span>, <span class="st">"NO"</span>)</span>
<span id="cb283-18"><a href="#cb283-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-19"><a href="#cb283-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind Rows of NO dataframes</span></span>
<span id="cb283-20"><a href="#cb283-20" aria-hidden="true" tabindex="-1"></a>no_combined <span class="ot">&lt;-</span> <span class="fu">bind_pollutant_data</span>(</span>
<span id="cb283-21"><a href="#cb283-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(no_henderson, no_gleneden, no_patumahoe, no_takapuna, no_penrose, no_queenstreet),</span>
<span id="cb283-22"><a href="#cb283-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Henderson Lincoln South"</span>, <span class="st">"Glen Eden Central"</span>, <span class="st">"Puni"</span>, <span class="st">"Westlake"</span>, <span class="st">"Ellerslie South"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb283-23"><a href="#cb283-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-24"><a href="#cb283-24" aria-hidden="true" tabindex="-1"></a>no_combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="st">`</span><span class="at">Henderson Lincoln South</span><span class="st">`</span> <span class="ot">=</span> no_henderson, <span class="st">`</span><span class="at">Glen Eden Central</span><span class="st">`</span> <span class="ot">=</span> no_gleneden, <span class="at">Puni =</span> no_patumahoe, <span class="at">Westlake =</span> no_takapuna, <span class="st">`</span><span class="at">Ellerslie South</span><span class="st">`</span> <span class="ot">=</span> no_penrose, <span class="st">`</span><span class="at">Queen Street</span><span class="st">`</span> <span class="ot">=</span> no_queenstreet, <span class="at">.id =</span> <span class="st">"sa2_name"</span>)</span>
<span id="cb283-25"><a href="#cb283-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-26"><a href="#cb283-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join by matching rows where both date and sa2_name are same </span></span>
<span id="cb283-27"><a href="#cb283-27" aria-hidden="true" tabindex="-1"></a>merged_airdata <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb283-28"><a href="#cb283-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(no_combined, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span> <span class="ot">=</span> <span class="st">"date"</span>, <span class="st">"sa2_name"</span> <span class="ot">=</span> <span class="st">"sa2_name"</span>)) </span>
<span id="cb283-29"><a href="#cb283-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-30"><a href="#cb283-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a glimpse</span></span>
<span id="cb283-31"><a href="#cb283-31" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(merged_airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 19,338
Columns: 11
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Residenti…
$ date      &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01-05,…
$ year      &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2016", "201…
$ geometry  &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -36.92214), …
$ sa2_name  &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Eden Central…
$ pop2018   &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, …
$ longitude &lt;dbl&gt; 174.652, 174.652, 174.652, 174.652, 174.652, 174.652, 174.65…
$ latitude  &lt;dbl&gt; -36.92214, -36.92214, -36.92214, -36.92214, -36.92214, -36.9…
$ AQI       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ NO2       &lt;dbl&gt; 3.4, 2.0, 3.8, 1.3, 2.5, 4.2, 4.5, 2.7, 4.1, 0.6, 0.4, 3.0, …
$ NO        &lt;dbl&gt; 1.9, 0.4, 0.7, 0.4, 0.8, 1.5, 2.5, 0.8, 1.4, 0.3, 0.3, 1.2, …</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb285"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Particulate Matter 10 (PM10) - Henderson</span></span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a>pm10_henderson <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/henderson/pm10-henderson/DataSetExport-PM10.24-Hour Aggregate (╡g m│)@5-Instantaneous-ug m^3-20250522072915.csv"</span>, <span class="st">"PM10"</span>)</span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-4"><a href="#cb285-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Particulate Matter 10 (PM10) - Pakuranga</span></span>
<span id="cb285-5"><a href="#cb285-5" aria-hidden="true" tabindex="-1"></a>pm10_pakuranga <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/pakuranga/pm10-pakuranga/DataSetExport-PM10.24-Hour Aggregate (╡g m│)@1-Instantaneous-ug m^3-20250522073103.csv"</span>, <span class="st">"PM10"</span>)</span>
<span id="cb285-6"><a href="#cb285-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-7"><a href="#cb285-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Particulate Matter 10 (PM10) - Glen Eden</span></span>
<span id="cb285-8"><a href="#cb285-8" aria-hidden="true" tabindex="-1"></a>pm10_gleneden <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/gleneden/pm10-gleneden/DataSetExport-PM10.24-Hour Aggregate (╡g m│)@67-Instantaneous-ug m^3-20250522073329.csv"</span>, <span class="st">"PM10"</span>)</span>
<span id="cb285-9"><a href="#cb285-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-10"><a href="#cb285-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Particulate Matter 10 (PM10) - Patumahoe</span></span>
<span id="cb285-11"><a href="#cb285-11" aria-hidden="true" tabindex="-1"></a>pm10_patumahoe <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/patumahoe/pm10-patumahoe/DataSetExport-PM10.24-Hour Aggregate (╡g m│)@2-Maximum-ug m^3-20250417183456.csv"</span>, <span class="st">"PM10"</span>)</span>
<span id="cb285-12"><a href="#cb285-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-13"><a href="#cb285-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Particulate Matter 10 (PM10) - Takapuna</span></span>
<span id="cb285-14"><a href="#cb285-14" aria-hidden="true" tabindex="-1"></a>pm10_takapuna <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/takapuna/pm10-takapuna/DataSetExport-PM10.24-Hour Aggregate (╡g m│)@23-Instantaneous-ug m^3-20250515001633.csv"</span>, <span class="st">"PM10"</span>)</span>
<span id="cb285-15"><a href="#cb285-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-16"><a href="#cb285-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Particulate Matter 10 (PM10) - Penrose</span></span>
<span id="cb285-17"><a href="#cb285-17" aria-hidden="true" tabindex="-1"></a>pm10_penrose <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/penrose/pm10-penrose/DataSetExport-PM10.24-Hour Aggregate (╡g m│)@7-Instantaneous-ug m^3-20250515001754.csv"</span>, <span class="st">"PM10"</span>)</span>
<span id="cb285-18"><a href="#cb285-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-19"><a href="#cb285-19" aria-hidden="true" tabindex="-1"></a>pm10_queenstreet <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/queenstreet/pm10-queenstreet/DataSetExport-PM10.24-Hour Aggregate (╡g m│) - Unverified@9-Maximum-ug m^3-20250417181740.csv"</span>, <span class="st">"PM10"</span>)</span>
<span id="cb285-20"><a href="#cb285-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-21"><a href="#cb285-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind Rows of PM10 dataframes</span></span>
<span id="cb285-22"><a href="#cb285-22" aria-hidden="true" tabindex="-1"></a>pm10_combined <span class="ot">&lt;-</span> <span class="fu">bind_pollutant_data</span>(</span>
<span id="cb285-23"><a href="#cb285-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(pm10_henderson, pm10_pakuranga, pm10_gleneden, pm10_patumahoe, pm10_takapuna, pm10_penrose, pm10_queenstreet),</span>
<span id="cb285-24"><a href="#cb285-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>, <span class="st">"Glen Eden Central"</span>, <span class="st">"Puni"</span>, <span class="st">"Westlake"</span>, <span class="st">"Ellerslie South"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb285-25"><a href="#cb285-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-26"><a href="#cb285-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join ny matching rows where both date and sa2_name are same </span></span>
<span id="cb285-27"><a href="#cb285-27" aria-hidden="true" tabindex="-1"></a>merged_airdata <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb285-28"><a href="#cb285-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pm10_combined, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span> <span class="ot">=</span> <span class="st">"date"</span>, <span class="st">"sa2_name"</span> <span class="ot">=</span> <span class="st">"sa2_name"</span>)) </span>
<span id="cb285-29"><a href="#cb285-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-30"><a href="#cb285-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a glimpse</span></span>
<span id="cb285-31"><a href="#cb285-31" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(merged_airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 19,338
Columns: 12
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Residenti…
$ date      &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01-05,…
$ year      &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2016", "201…
$ geometry  &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -36.92214), …
$ sa2_name  &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Eden Central…
$ pop2018   &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, …
$ longitude &lt;dbl&gt; 174.652, 174.652, 174.652, 174.652, 174.652, 174.652, 174.65…
$ latitude  &lt;dbl&gt; -36.92214, -36.92214, -36.92214, -36.92214, -36.92214, -36.9…
$ AQI       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ NO2       &lt;dbl&gt; 3.4, 2.0, 3.8, 1.3, 2.5, 4.2, 4.5, 2.7, 4.1, 0.6, 0.4, 3.0, …
$ NO        &lt;dbl&gt; 1.9, 0.4, 0.7, 0.4, 0.8, 1.5, 2.5, 0.8, 1.4, 0.3, 0.3, 1.2, …
$ PM10      &lt;dbl&gt; 11.4, 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2, 10…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb287"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Particulate Matter 2.5 (PM2.5) - Patumahoe</span></span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a>pm2<span class="fl">.5</span>_patumahoe <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/patumahoe/pm2.5-patumahoe/DataSetExport-PM2,5.24-Hour Aggregate (╡g m│)@2-Maximum-ug m^3-20250417183512.csv"</span>, <span class="st">"PM2.5"</span>)</span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-4"><a href="#cb287-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Particulate Matter 2.5 (PM2.5) - Takapuna</span></span>
<span id="cb287-5"><a href="#cb287-5" aria-hidden="true" tabindex="-1"></a>pm2<span class="fl">.5</span>_takapuna <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/takapuna/pm2.5-takapuna/DataSetExport-PM2,5.24-Hour Aggregate (╡g m│)@23-Instantaneous-ug m^3-20250515010302.csv"</span>, <span class="st">"PM2.5"</span>)</span>
<span id="cb287-6"><a href="#cb287-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-7"><a href="#cb287-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Particulate Matter 2.5 (PM2.5) - Penrose</span></span>
<span id="cb287-8"><a href="#cb287-8" aria-hidden="true" tabindex="-1"></a>pm2<span class="fl">.5</span>_penrose <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/penrose/pm2.5-penrose/DataSetExport-PM2,5.24-Hour Aggregate (╡g m│)@7-Instantaneous-ug m^3-20250515010122.csv"</span>, <span class="st">"PM2.5"</span>)</span>
<span id="cb287-9"><a href="#cb287-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-10"><a href="#cb287-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Particulate Matter 2.5 (PM2.5) - Queen Street</span></span>
<span id="cb287-11"><a href="#cb287-11" aria-hidden="true" tabindex="-1"></a>pm2<span class="fl">.5</span>_queenstreet <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/queenstreet/pm2.5-queenstreet/DataSetExport-PM2,5.24-Hour Aggregate (╡g m│) - Unverified@9-Maximum-ug m^3-20250417181802.csv"</span>, <span class="st">"PM2.5"</span>)</span>
<span id="cb287-12"><a href="#cb287-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-13"><a href="#cb287-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind Rows of PM2.5 dataframes</span></span>
<span id="cb287-14"><a href="#cb287-14" aria-hidden="true" tabindex="-1"></a>pm2<span class="fl">.5</span>_combined <span class="ot">&lt;-</span> <span class="fu">bind_pollutant_data</span>(</span>
<span id="cb287-15"><a href="#cb287-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(pm2<span class="fl">.5</span>_patumahoe, pm2<span class="fl">.5</span>_takapuna, pm2<span class="fl">.5</span>_penrose, pm2<span class="fl">.5</span>_queenstreet),</span>
<span id="cb287-16"><a href="#cb287-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Westlake"</span>, <span class="st">"Ellerslie South"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb287-17"><a href="#cb287-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-18"><a href="#cb287-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join by matching rows where both date and sa2_name are same</span></span>
<span id="cb287-19"><a href="#cb287-19" aria-hidden="true" tabindex="-1"></a>merged_airdata <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb287-20"><a href="#cb287-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pm2<span class="fl">.5</span>_combined, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span> <span class="ot">=</span> <span class="st">"date"</span>, <span class="st">"sa2_name"</span> <span class="ot">=</span> <span class="st">"sa2_name"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Sulphur Dioxide (SO2) - Penrose</span></span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a>so2_penrose <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/penrose/so2-penrose/DataSetExport-SO2.24-Hour Aggregate (╡g m│)@7-Instantaneous-ug m^3-20250514230023.csv"</span>, <span class="st">"SO2"</span>)</span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind Rows of SO2</span></span>
<span id="cb288-5"><a href="#cb288-5" aria-hidden="true" tabindex="-1"></a>so2_combined <span class="ot">&lt;-</span> <span class="fu">bind_pollutant_data</span>(</span>
<span id="cb288-6"><a href="#cb288-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(so2_penrose),</span>
<span id="cb288-7"><a href="#cb288-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Ellerslie South"</span>))</span>
<span id="cb288-8"><a href="#cb288-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-9"><a href="#cb288-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join by matching rows where both date and sa2_name are same</span></span>
<span id="cb288-10"><a href="#cb288-10" aria-hidden="true" tabindex="-1"></a>merged_airdata <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb288-11"><a href="#cb288-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(so2_combined, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span> <span class="ot">=</span> <span class="st">"date"</span>, <span class="st">"sa2_name"</span> <span class="ot">=</span> <span class="st">"sa2_name"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Temperature - Henderson</span></span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a>airtemp_henderson <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/henderson/airtemp-henderson/DataSetExport-Air Temp.24-Hour Aggregate (░C)@5-Instantaneous-degC-20250522081344.csv"</span>, <span class="st">"AirTemp"</span>)</span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Temperature - Pakuranga</span></span>
<span id="cb289-5"><a href="#cb289-5" aria-hidden="true" tabindex="-1"></a>airtemp_pakuranga <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/pakuranga/airtemp-pakuranga/DataSetExport-Air Temp.24-Hour Aggregate (░C)@1-Instantaneous-degC-20250522082128.csv"</span>, <span class="st">"AirTemp"</span>)</span>
<span id="cb289-6"><a href="#cb289-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-7"><a href="#cb289-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Temperature - Glen Eden</span></span>
<span id="cb289-8"><a href="#cb289-8" aria-hidden="true" tabindex="-1"></a>airtemp_gleneden <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/gleneden/airtemp-gleneden/DataSetExport-Air Temp.24-Hour Aggregate (░C)@67-Instantaneous-degC-20250522082803.csv"</span>, <span class="st">"AirTemp"</span>)</span>
<span id="cb289-9"><a href="#cb289-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-10"><a href="#cb289-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Temperature - Takapuna</span></span>
<span id="cb289-11"><a href="#cb289-11" aria-hidden="true" tabindex="-1"></a>airtemp_takapuna <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/takapuna/airtemp-takapuna/DataSetExport-Air Temp.24-Hour Aggregate (░C)@23-Instantaneous-degC-20250514062829.csv"</span>, <span class="st">"AirTemp"</span>)</span>
<span id="cb289-12"><a href="#cb289-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-13"><a href="#cb289-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Temperature - Penrose</span></span>
<span id="cb289-14"><a href="#cb289-14" aria-hidden="true" tabindex="-1"></a>airtemp_penrose <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/penrose/airtemp-penrose/DataSetExport-Air Temp.24-Hour Aggregate (░C)@7-Instantaneous-degC-20250514064042.csv"</span>, <span class="st">"AirTemp"</span>)</span>
<span id="cb289-15"><a href="#cb289-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-16"><a href="#cb289-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Air Temperature - Queen Street</span></span>
<span id="cb289-17"><a href="#cb289-17" aria-hidden="true" tabindex="-1"></a>airtemp_queenstreet <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/queenstreet/airtemp-queenstreet/DataSetExport-Air Temp.24-Hour Aggregate (░C)@9-Maximum-degC-20250417181451.csv"</span>, <span class="st">"AirTemp"</span>)</span>
<span id="cb289-18"><a href="#cb289-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-19"><a href="#cb289-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind rows</span></span>
<span id="cb289-20"><a href="#cb289-20" aria-hidden="true" tabindex="-1"></a>airtemp_combined <span class="ot">&lt;-</span> <span class="fu">bind_pollutant_data</span>(</span>
<span id="cb289-21"><a href="#cb289-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(airtemp_henderson, airtemp_pakuranga, airtemp_gleneden, airtemp_takapuna, airtemp_penrose, airtemp_queenstreet),</span>
<span id="cb289-22"><a href="#cb289-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>, <span class="st">"Glen Eden Central"</span>, <span class="st">"Westlake"</span>, <span class="st">"Ellerslie South"</span>, <span class="st">"Queen Street"</span>))</span>
<span id="cb289-23"><a href="#cb289-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-24"><a href="#cb289-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join by matching rows where both date and sa2_name are same </span></span>
<span id="cb289-25"><a href="#cb289-25" aria-hidden="true" tabindex="-1"></a>merged_airdata <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb289-26"><a href="#cb289-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(airtemp_combined, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span> <span class="ot">=</span> <span class="st">"date"</span>, <span class="st">"sa2_name"</span> <span class="ot">=</span> <span class="st">"sa2_name"</span>)) </span>
<span id="cb289-27"><a href="#cb289-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-28"><a href="#cb289-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a glimpse</span></span>
<span id="cb289-29"><a href="#cb289-29" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(merged_airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 19,338
Columns: 15
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Residenti…
$ date      &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01-05,…
$ year      &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2016", "201…
$ geometry  &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -36.92214), …
$ sa2_name  &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Eden Central…
$ pop2018   &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, …
$ longitude &lt;dbl&gt; 174.652, 174.652, 174.652, 174.652, 174.652, 174.652, 174.65…
$ latitude  &lt;dbl&gt; -36.92214, -36.92214, -36.92214, -36.92214, -36.92214, -36.9…
$ AQI       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ NO2       &lt;dbl&gt; 3.4, 2.0, 3.8, 1.3, 2.5, 4.2, 4.5, 2.7, 4.1, 0.6, 0.4, 3.0, …
$ NO        &lt;dbl&gt; 1.9, 0.4, 0.7, 0.4, 0.8, 1.5, 2.5, 0.8, 1.4, 0.3, 0.3, 1.2, …
$ PM10      &lt;dbl&gt; 11.4, 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2, 10…
$ PM2.5     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ SO2       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ AirTemp   &lt;dbl&gt; 21, 19, 18, 21, 19, 17, 17, 19, 20, 19, 18, 20, 19, 18, 20, …</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Wind Direction - Henderson</span></span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a>winddir_henderson <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/henderson/winddir-henderson/DataSetExport-Wind Dir.24-Hour Aggregate (░) - Unverified@5-Instantaneous-deg-20250522081739.csv"</span>, <span class="st">"WindDir"</span>)</span>
<span id="cb291-3"><a href="#cb291-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-4"><a href="#cb291-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Wind Direction - Pakuranga</span></span>
<span id="cb291-5"><a href="#cb291-5" aria-hidden="true" tabindex="-1"></a>winddir_pakuranga <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/pakuranga/winddir-pakuranga/DataSetExport-Wind Dir.24-Hour Aggregate (░) - Unverified@1-Instantaneous-deg-20250522082446.csv"</span>, <span class="st">"WindDir"</span>)</span>
<span id="cb291-6"><a href="#cb291-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-7"><a href="#cb291-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Wind Direction - Glen Eden</span></span>
<span id="cb291-8"><a href="#cb291-8" aria-hidden="true" tabindex="-1"></a>winddir_gleneden <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/gleneden/winddir-gleneden/DataSetExport-Wind Dir.24-Hour Aggregate (░) - Unverified@67-Instantaneous-deg-20250522083144.csv"</span>, <span class="st">"WindDir"</span>)</span>
<span id="cb291-9"><a href="#cb291-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-10"><a href="#cb291-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Wind Direction - Takapuna</span></span>
<span id="cb291-11"><a href="#cb291-11" aria-hidden="true" tabindex="-1"></a>winddir_takapuna <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/takapuna/winddir-takapuna/DataSetExport-Wind Dir.24-Hour Aggregate (░) - Unverified@23-Instantaneous-deg-20250522083849.csv"</span>, <span class="st">"WindDir"</span>)</span>
<span id="cb291-12"><a href="#cb291-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-13"><a href="#cb291-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Wind Direction - Penrose</span></span>
<span id="cb291-14"><a href="#cb291-14" aria-hidden="true" tabindex="-1"></a>winddir_penrose <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/penrose/winddir-penrose/DataSetExport-Wind Dir.24-Hour Aggregate (░) - Unverified@7-Instantaneous-deg-20250522084231.csv"</span>, <span class="st">"WindDir"</span>)</span>
<span id="cb291-15"><a href="#cb291-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-16"><a href="#cb291-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind rows</span></span>
<span id="cb291-17"><a href="#cb291-17" aria-hidden="true" tabindex="-1"></a>winddir_combined <span class="ot">&lt;-</span> <span class="fu">bind_pollutant_data</span>(</span>
<span id="cb291-18"><a href="#cb291-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(winddir_henderson, winddir_pakuranga, winddir_gleneden, winddir_takapuna, winddir_penrose),</span>
<span id="cb291-19"><a href="#cb291-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>, <span class="st">"Glen Eden Central"</span>, <span class="st">"Westlake"</span>, <span class="st">"Ellerslie South"</span>))</span>
<span id="cb291-20"><a href="#cb291-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-21"><a href="#cb291-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join by matching rows where both date and sa2_name are same </span></span>
<span id="cb291-22"><a href="#cb291-22" aria-hidden="true" tabindex="-1"></a>merged_airdata <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb291-23"><a href="#cb291-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(winddir_combined, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span> <span class="ot">=</span> <span class="st">"date"</span>, <span class="st">"sa2_name"</span> <span class="ot">=</span> <span class="st">"sa2_name"</span>)) </span>
<span id="cb291-24"><a href="#cb291-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-25"><a href="#cb291-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a glimpse</span></span>
<span id="cb291-26"><a href="#cb291-26" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(merged_airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 19,338
Columns: 16
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Residenti…
$ date      &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01-05,…
$ year      &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2016", "201…
$ geometry  &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -36.92214), …
$ sa2_name  &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Eden Central…
$ pop2018   &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, …
$ longitude &lt;dbl&gt; 174.652, 174.652, 174.652, 174.652, 174.652, 174.652, 174.65…
$ latitude  &lt;dbl&gt; -36.92214, -36.92214, -36.92214, -36.92214, -36.92214, -36.9…
$ AQI       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ NO2       &lt;dbl&gt; 3.4, 2.0, 3.8, 1.3, 2.5, 4.2, 4.5, 2.7, 4.1, 0.6, 0.4, 3.0, …
$ NO        &lt;dbl&gt; 1.9, 0.4, 0.7, 0.4, 0.8, 1.5, 2.5, 0.8, 1.4, 0.3, 0.3, 1.2, …
$ PM10      &lt;dbl&gt; 11.4, 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2, 10…
$ PM2.5     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ SO2       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ AirTemp   &lt;dbl&gt; 21, 19, 18, 21, 19, 17, 17, 19, 20, 19, 18, 20, 19, 18, 20, …
$ WindDir   &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Wind Speed - Henderson</span></span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a>windspeed_henderson <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/henderson/windspeed-henderson/DataSetExport-Wind Speed m s.24-Hour Aggregate (m s)@5-Instantaneous-m s-20250522081853.csv"</span>, <span class="st">"WindSpeed"</span>)</span>
<span id="cb293-3"><a href="#cb293-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-4"><a href="#cb293-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Wind Speed - Pakuranga</span></span>
<span id="cb293-5"><a href="#cb293-5" aria-hidden="true" tabindex="-1"></a>windspeed_pakuranga <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/pakuranga/windspeed-pakuranga/DataSetExport-Wind Speed m s.24-Hour Aggregate (m s)@1-Instantaneous-m s-20250522082606.csv"</span>, <span class="st">"WindSpeed"</span>)</span>
<span id="cb293-6"><a href="#cb293-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-7"><a href="#cb293-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Wind Speed - Glen Eden</span></span>
<span id="cb293-8"><a href="#cb293-8" aria-hidden="true" tabindex="-1"></a>windspeed_gleneden <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/gleneden/windspeed-gleneden/DataSetExport-Wind Speed m s.24-Hour Aggregate (m s)@67-Instantaneous-m s-20250522083258.csv"</span>, <span class="st">"WindSpeed"</span>)</span>
<span id="cb293-9"><a href="#cb293-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-10"><a href="#cb293-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Wind Speed - Takapuna</span></span>
<span id="cb293-11"><a href="#cb293-11" aria-hidden="true" tabindex="-1"></a>windspeed_takapuna <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/takapuna/windspeed-takapuna/DataSetExport-Wind Speed m s.24-Hour Aggregate (m s)@23-Instantaneous-m s-20250522084008.csv"</span>, <span class="st">"WindSpeed"</span>)</span>
<span id="cb293-12"><a href="#cb293-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-13"><a href="#cb293-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Wind Speed - Penrose</span></span>
<span id="cb293-14"><a href="#cb293-14" aria-hidden="true" tabindex="-1"></a>windspeed_penrose <span class="ot">&lt;-</span> <span class="fu">prepare_pollutant_data</span>(<span class="st">"data/penrose/windspeed-penrose/DataSetExport-Wind Speed m s.24-Hour Aggregate (m s)@7-Instantaneous-m s-20250522084333.csv"</span>, <span class="st">"WindSpeed"</span>)</span>
<span id="cb293-15"><a href="#cb293-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-16"><a href="#cb293-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind rows</span></span>
<span id="cb293-17"><a href="#cb293-17" aria-hidden="true" tabindex="-1"></a>windspeed_combined <span class="ot">&lt;-</span> <span class="fu">bind_pollutant_data</span>(</span>
<span id="cb293-18"><a href="#cb293-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(windspeed_henderson, windspeed_pakuranga, windspeed_gleneden, windspeed_takapuna, windspeed_penrose),</span>
<span id="cb293-19"><a href="#cb293-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>, <span class="st">"Glen Eden Central"</span>, <span class="st">"Westlake"</span>, <span class="st">"Ellerslie South"</span>))</span>
<span id="cb293-20"><a href="#cb293-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-21"><a href="#cb293-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join by matching rows where both date and sa2_name are same </span></span>
<span id="cb293-22"><a href="#cb293-22" aria-hidden="true" tabindex="-1"></a>merged_airdata <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb293-23"><a href="#cb293-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(windspeed_combined, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span> <span class="ot">=</span> <span class="st">"date"</span>, <span class="st">"sa2_name"</span> <span class="ot">=</span> <span class="st">"sa2_name"</span>)) </span>
<span id="cb293-24"><a href="#cb293-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-25"><a href="#cb293-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a glimpse</span></span>
<span id="cb293-26"><a href="#cb293-26" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(merged_airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 19,338
Columns: 17
$ site_type &lt;chr&gt; "Residential, NES site", "Residential, NES site", "Residenti…
$ date      &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-04, 2016-01-05,…
$ year      &lt;chr&gt; "2016", "2016", "2016", "2016", "2016", "2016", "2016", "201…
$ geometry  &lt;POINT [°]&gt; POINT (174.652 -36.92214), POINT (174.652 -36.92214), …
$ sa2_name  &lt;chr&gt; "Glen Eden Central", "Glen Eden Central", "Glen Eden Central…
$ pop2018   &lt;int&gt; 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, 3790, …
$ longitude &lt;dbl&gt; 174.652, 174.652, 174.652, 174.652, 174.652, 174.652, 174.65…
$ latitude  &lt;dbl&gt; -36.92214, -36.92214, -36.92214, -36.92214, -36.92214, -36.9…
$ AQI       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ NO2       &lt;dbl&gt; 3.4, 2.0, 3.8, 1.3, 2.5, 4.2, 4.5, 2.7, 4.1, 0.6, 0.4, 3.0, …
$ NO        &lt;dbl&gt; 1.9, 0.4, 0.7, 0.4, 0.8, 1.5, 2.5, 0.8, 1.4, 0.3, 0.3, 1.2, …
$ PM10      &lt;dbl&gt; 11.4, 11.1, 10.6, 4.7, 6.9, 13.2, 11.1, 15.2, 10.7, 15.2, 10…
$ PM2.5     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ SO2       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ AirTemp   &lt;dbl&gt; 21, 19, 18, 21, 19, 17, 17, 19, 20, 19, 18, 20, 19, 18, 20, …
$ WindDir   &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ WindSpeed &lt;dbl&gt; 2.0, 2.5, 2.6, 3.0, 2.0, 1.7, 1.7, 2.7, 3.2, 2.7, 2.3, 1.7, …</code></pre>
</div>
</div>
<details>
<summary>
Correlation Heatmaps by Site
</summary>
<p>This section visualizes the relationships between weather and air quality variables across Auckland sites. Correlation heatmaps are generated to identify pollutant interdependencies and meteorological influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a>plot_heatmap <span class="ot">&lt;-</span> <span class="cf">function</span>(data, title_var) {</span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a>  correlation_data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_modify</span>(<span class="sc">~</span> {</span>
<span id="cb295-4"><a href="#cb295-4" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> .x  <span class="co"># Assign the subset data frame</span></span>
<span id="cb295-5"><a href="#cb295-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(<span class="fu">na.omit</span>(df)) <span class="sc">&gt;=</span> <span class="dv">2</span>) { </span>
<span id="cb295-6"><a href="#cb295-6" aria-hidden="true" tabindex="-1"></a>    corr_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(df, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb295-7"><a href="#cb295-7" aria-hidden="true" tabindex="-1"></a>    corr_long <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.table</span>(corr_matrix))</span>
<span id="cb295-8"><a href="#cb295-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(corr_long) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Var1"</span>, <span class="st">"Var2"</span>, <span class="st">"Correlation"</span>)</span>
<span id="cb295-9"><a href="#cb295-9" aria-hidden="true" tabindex="-1"></a>    corr_long</span>
<span id="cb295-10"><a href="#cb295-10" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb295-11"><a href="#cb295-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">Var1 =</span> <span class="fu">character</span>(), <span class="at">Var2 =</span> <span class="fu">character</span>(), <span class="at">Correlation =</span> <span class="fu">numeric</span>())</span>
<span id="cb295-12"><a href="#cb295-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb295-13"><a href="#cb295-13" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span></span>
<span id="cb295-14"><a href="#cb295-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb295-15"><a href="#cb295-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-16"><a href="#cb295-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the correlation heatmap</span></span>
<span id="cb295-17"><a href="#cb295-17" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(correlation_data, <span class="fu">aes</span>(<span class="at">x =</span> Var1, <span class="at">y =</span> Var2, <span class="at">fill =</span> Correlation)) <span class="sc">+</span></span>
<span id="cb295-18"><a href="#cb295-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span> <span class="co">#color = "white") +</span></span>
<span id="cb295-19"><a href="#cb295-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(Correlation, <span class="dv">2</span>)), <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb295-20"><a href="#cb295-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(</span>
<span id="cb295-21"><a href="#cb295-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">option =</span> <span class="st">"mako"</span>,  </span>
<span id="cb295-22"><a href="#cb295-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb295-23"><a href="#cb295-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Pearson r"</span></span>
<span id="cb295-24"><a href="#cb295-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb295-25"><a href="#cb295-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb295-26"><a href="#cb295-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb295-27"><a href="#cb295-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Correlation Matrix of Daily Weather and Air Quality Variables (2016–2024)"</span>,</span>
<span id="cb295-28"><a href="#cb295-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"For "</span>, title_var, <span class="st">" in Auckland"</span>),</span>
<span id="cb295-29"><a href="#cb295-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">fill =</span> <span class="st">"Pearson r"</span></span>
<span id="cb295-30"><a href="#cb295-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb295-31"><a href="#cb295-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb295-32"><a href="#cb295-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb295-33"><a href="#cb295-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb295-34"><a href="#cb295-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb295-35"><a href="#cb295-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb295-36"><a href="#cb295-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb295-37"><a href="#cb295-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb295-38"><a href="#cb295-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb295-39"><a href="#cb295-39" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(p)</span>
<span id="cb295-40"><a href="#cb295-40" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb296"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find which factor has all missing values</span></span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a>merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb296-3"><a href="#cb296-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb296-4"><a href="#cb296-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(WindSpeed, WindDir, AirTemp, AQI, NO2, NO, PM10, PM2<span class="fl">.5</span>, SO2) <span class="sc">|&gt;</span></span>
<span id="cb296-5"><a href="#cb296-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">all</span>(<span class="fu">is.na</span>(.x))),</span>
<span id="cb296-6"><a href="#cb296-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 10
  sa2_name         WindSpeed WindDir AirTemp AQI   NO2   NO    PM10  PM2.5 SO2  
  &lt;chr&gt;            &lt;lgl&gt;     &lt;lgl&gt;   &lt;lgl&gt;   &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt;
1 Ellerslie South  FALSE     FALSE   FALSE   FALSE FALSE FALSE FALSE FALSE FALSE
2 Glen Eden Centr… FALSE     FALSE   FALSE   FALSE FALSE FALSE FALSE TRUE  TRUE 
3 Henderson Linco… FALSE     FALSE   FALSE   FALSE FALSE FALSE FALSE TRUE  TRUE 
4 Puni             TRUE      TRUE    TRUE    FALSE FALSE FALSE FALSE FALSE TRUE 
5 Queen Street     TRUE      TRUE    FALSE   FALSE FALSE FALSE FALSE FALSE TRUE 
6 Sunnyhills East  FALSE     FALSE   FALSE   FALSE TRUE  TRUE  FALSE TRUE  TRUE 
7 Westlake         FALSE     FALSE   FALSE   FALSE FALSE FALSE FALSE FALSE TRUE </code></pre>
</div>
<div class="sourceCode cell-code" id="cb298"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ellerslie South has numeric data for all variables</span></span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Glen Eden Central and Henderson Lincoln South has all data missing for PM2.5 and SO2</span></span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Puni has all data missing for WindSpeed, WindDir, AirTemp, and SO2</span></span>
<span id="cb298-4"><a href="#cb298-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Queen Street does not contain data for WindSpeed, WindDir, and SO2</span></span>
<span id="cb298-5"><a href="#cb298-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Sunnyhills East has all data missing for NO2, NO, PM2.5, SO2</span></span>
<span id="cb298-6"><a href="#cb298-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Westlake has all data missing for SO2</span></span>
<span id="cb298-7"><a href="#cb298-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-8"><a href="#cb298-8" aria-hidden="true" tabindex="-1"></a>ellerslie_data <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb298-9"><a href="#cb298-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>) <span class="sc">|&gt;</span></span>
<span id="cb298-10"><a href="#cb298-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(WindSpeed, WindDir, AirTemp, AQI, NO2, NO, PM10, PM2<span class="fl">.5</span>, SO2)</span>
<span id="cb298-11"><a href="#cb298-11" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap <span class="ot">&lt;-</span> <span class="fu">plot_heatmap</span>(ellerslie_data, <span class="st">"Ellerslie South site"</span>)</span>
<span id="cb298-12"><a href="#cb298-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-13"><a href="#cb298-13" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-correlation-ellerslie-data-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb299"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_corr_heatmap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>NO and NO2 have the highest correlations (0.78), indicating strong correlation. NO and NO2 also show high correlation with SO2 (0.7 and 0.57). AirTemp negatively correlates with NO2 (-0.48), while WindSpeed has weak correlations with pollutants (-0.47 to 0.24). AQI has 0 correlation with WindSpeed. Correlations suggest meteorological influences on air pollution dynamics at Ellerslie South.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View the number of missing values in key columns</span></span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a>ellerslie_data <span class="sc">|&gt;</span></span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(WindSpeed, WindDir, AirTemp, AQI, NO2, NO, PM10, PM2<span class="fl">.5</span>, SO2), <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 9
  WindSpeed WindDir AirTemp   AQI   NO2    NO  PM10 PM2.5   SO2
      &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
1       358     229     355   246   386   393   313   788   435</code></pre>
</div>
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Impute missing values using Kalman smoothing (auto ARIMA model)</span></span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This method handles time-series gaps more intelligently than simple methods</span></span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a>ellerslie_data <span class="ot">&lt;-</span> ellerslie_data <span class="sc">|&gt;</span> </span>
<span id="cb302-4"><a href="#cb302-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb302-5"><a href="#cb302-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">WindSpeed =</span> <span class="fu">na_kalman</span>(WindSpeed, <span class="at">model =</span> <span class="st">"auto.arima"</span>),</span>
<span id="cb302-6"><a href="#cb302-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">WindDir =</span> <span class="fu">na_kalman</span>(WindDir, <span class="at">model =</span> <span class="st">"auto.arima"</span>),</span>
<span id="cb302-7"><a href="#cb302-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">AirTemp =</span> <span class="fu">na_kalman</span>(AirTemp, <span class="at">model =</span> <span class="st">"auto.arima"</span>),</span>
<span id="cb302-8"><a href="#cb302-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">AQI =</span> <span class="fu">na_kalman</span>(AQI, <span class="at">model =</span> <span class="st">"auto.arima"</span>),</span>
<span id="cb302-9"><a href="#cb302-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">NO2 =</span> <span class="fu">na_kalman</span>(NO2, <span class="at">model =</span> <span class="st">"auto.arima"</span>),</span>
<span id="cb302-10"><a href="#cb302-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">NO =</span> <span class="fu">na_kalman</span>(NO, <span class="at">model =</span> <span class="st">"auto.arima"</span>),</span>
<span id="cb302-11"><a href="#cb302-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">PM10 =</span> <span class="fu">na_kalman</span>(PM10, <span class="at">model =</span> <span class="st">"auto.arima"</span>),</span>
<span id="cb302-12"><a href="#cb302-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">PM2.5 =</span> <span class="fu">na_kalman</span>(PM2<span class="fl">.5</span>, <span class="at">model =</span> <span class="st">"auto.arima"</span>),</span>
<span id="cb302-13"><a href="#cb302-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">SO2 =</span> <span class="fu">na_kalman</span>(SO2, <span class="at">model =</span> <span class="st">"auto.arima"</span>))</span>
<span id="cb302-14"><a href="#cb302-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-15"><a href="#cb302-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a heatmap of correlations after imputing missing values</span></span>
<span id="cb302-16"><a href="#cb302-16" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap <span class="ot">&lt;-</span> <span class="fu">plot_heatmap</span>(ellerslie_data, <span class="st">"ARIMA approximated missing values at Ellerslie South site"</span>)</span>
<span id="cb302-17"><a href="#cb302-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-18"><a href="#cb302-18" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/impute-and-correlation-plot-ellerslie-data-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb303"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_corr_heatmap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>SO2, NO, and NO2 show strong positive correlations, indicating shared sources. PM2.5 is tightly linked with PM10 and NO. Wind speed inversely correlates with AQI and all pollutants except PM10, suggesting pollutant dispersion. Air temperature correlates negatively with AQI and all pollutants but positively with PM10 concentrations, reflecting meteorological influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the required columns</span></span>
<span id="cb304-2"><a href="#cb304-2" aria-hidden="true" tabindex="-1"></a>gleneden_data <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb304-3"><a href="#cb304-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">==</span> <span class="st">"Glen Eden Central"</span>) <span class="sc">|&gt;</span></span>
<span id="cb304-4"><a href="#cb304-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(WindSpeed, WindDir, AirTemp, AQI, NO2, NO, PM10)</span>
<span id="cb304-5"><a href="#cb304-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-6"><a href="#cb304-6" aria-hidden="true" tabindex="-1"></a><span class="co"># View the number of missing values in key columns</span></span>
<span id="cb304-7"><a href="#cb304-7" aria-hidden="true" tabindex="-1"></a>gleneden_data <span class="sc">|&gt;</span></span>
<span id="cb304-8"><a href="#cb304-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(WindSpeed, WindDir, AirTemp, AQI, NO2, NO, PM10), <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  WindSpeed WindDir AirTemp   AQI   NO2    NO  PM10
      &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
1       235     273     266   253   324   331   274</code></pre>
</div>
<div class="sourceCode cell-code" id="cb306"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a heatmap of correlations</span></span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap <span class="ot">&lt;-</span> <span class="fu">plot_heatmap</span>(gleneden_data, <span class="st">"Glen Eden Central site"</span>)</span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-4"><a href="#cb306-4" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/correlation-plot-glen-eden-data-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb307"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_corr_heatmap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>NO2 shows a strong positive correlation with NO. WindSpeed has a negative correlation with NO and NO2, suggesting pollutant dispersion. AirTemp correlates negatively but weakly with AQI and pollutants, reflecting indirect effects on pollution levels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb308"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the columns required</span></span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a>henderson_data <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">==</span> <span class="st">"Henderson Lincoln South"</span>) <span class="sc">|&gt;</span></span>
<span id="cb308-4"><a href="#cb308-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(WindSpeed, WindDir, AirTemp, AQI, NO2, NO, PM10)</span>
<span id="cb308-5"><a href="#cb308-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-6"><a href="#cb308-6" aria-hidden="true" tabindex="-1"></a><span class="co"># View the number of missing values in key columns</span></span>
<span id="cb308-7"><a href="#cb308-7" aria-hidden="true" tabindex="-1"></a>henderson_data <span class="sc">|&gt;</span></span>
<span id="cb308-8"><a href="#cb308-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(WindSpeed, WindDir, AirTemp, AQI, NO2, NO, PM10), <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  WindSpeed WindDir AirTemp   AQI   NO2    NO  PM10
      &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
1       293     151     293   216  1158   478   947</code></pre>
</div>
<div class="sourceCode cell-code" id="cb310"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a heatmap of correlations</span></span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap <span class="ot">&lt;-</span> <span class="fu">plot_heatmap</span>(henderson_data, <span class="st">"Henderson Lincoln South site"</span>)</span>
<span id="cb310-3"><a href="#cb310-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-4"><a href="#cb310-4" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/correlation-plot-henderson-data-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb311"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_corr_heatmap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The correlation matrix at Henderson Lincoln South (2016–2024) reveals strong positive correlation between NO and NO2 (0.81), suggesting co-emission sources. Conversely, NO and NO2 show negative correlation with AirTemp (-0.3 and -0.34), indicating atmospheric dispersion effects. PM10 and AQI exhibit a positive correlation (0.73), reflecting air quality deterioration with increased PM10 levels. NO and NO2 shows negative correlation with WindSpeed, implying pollutant dispersion under higher wind conditions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the required columns</span></span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a>puni_data <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">==</span> <span class="st">"Puni"</span>) <span class="sc">|&gt;</span></span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(AQI, NO2, NO, PM10, PM2<span class="fl">.5</span>)</span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-6"><a href="#cb312-6" aria-hidden="true" tabindex="-1"></a><span class="co"># View the number of missing values in key columns</span></span>
<span id="cb312-7"><a href="#cb312-7" aria-hidden="true" tabindex="-1"></a>puni_data <span class="sc">|&gt;</span></span>
<span id="cb312-8"><a href="#cb312-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(AQI, NO2, NO, PM10, PM2<span class="fl">.5</span>), <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
    AQI   NO2    NO  PM10 PM2.5
  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
1   252   340   339   297   571</code></pre>
</div>
<div class="sourceCode cell-code" id="cb314"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a heatmap of correlations</span></span>
<span id="cb314-2"><a href="#cb314-2" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap <span class="ot">&lt;-</span> <span class="fu">plot_heatmap</span>(puni_data, <span class="st">"Puni site"</span>)</span>
<span id="cb314-3"><a href="#cb314-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-4"><a href="#cb314-4" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/correlation-plot-puni-data-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb315"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_corr_heatmap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>NO and NO2 show the strongest correlation (0.57), indicating linked emissions. PM10 and NO2 exhibit the weakest negative correlation (-0.11). AQI weakly correlates with other pollutants, suggesting multifactorial influences. The matrix highlights variability in pollutant interactions over time and site conditions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb316"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the required columns</span></span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true" tabindex="-1"></a>queen_data <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb316-3"><a href="#cb316-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">==</span> <span class="st">"Queen Street"</span>) <span class="sc">|&gt;</span></span>
<span id="cb316-4"><a href="#cb316-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(AirTemp, AQI, NO2, NO, PM10, PM2<span class="fl">.5</span>)</span>
<span id="cb316-5"><a href="#cb316-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-6"><a href="#cb316-6" aria-hidden="true" tabindex="-1"></a><span class="co"># View the number of missing values in key columns</span></span>
<span id="cb316-7"><a href="#cb316-7" aria-hidden="true" tabindex="-1"></a>queen_data <span class="sc">|&gt;</span></span>
<span id="cb316-8"><a href="#cb316-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(AirTemp, AQI, NO2, NO, PM10, PM2<span class="fl">.5</span>), <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  AirTemp   AQI   NO2    NO  PM10 PM2.5
    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
1     362   161   302   309   447   447</code></pre>
</div>
<div class="sourceCode cell-code" id="cb318"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a heatmap of correlations </span></span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap <span class="ot">&lt;-</span> <span class="fu">plot_heatmap</span>(queen_data, <span class="st">"Queen Street site"</span>)</span>
<span id="cb318-3"><a href="#cb318-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-4"><a href="#cb318-4" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/correlation-plot-queen-street-data-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb319"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_corr_heatmap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The correlation matrix shows strong positive correlations between NO and NO2 (0.86) and between PM2.5 and PM10 (0.85). AirTemp has a moderate negative correlation with NO2 (-0.33), suggesting temperature influences nitrogen dioxide concentrations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb320"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select required columns</span></span>
<span id="cb320-2"><a href="#cb320-2" aria-hidden="true" tabindex="-1"></a>sunnyhills_data <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb320-3"><a href="#cb320-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">==</span> <span class="st">"Sunnyhills East"</span>) <span class="sc">|&gt;</span></span>
<span id="cb320-4"><a href="#cb320-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(WindSpeed, WindDir, AirTemp, AQI, PM10)</span>
<span id="cb320-5"><a href="#cb320-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-6"><a href="#cb320-6" aria-hidden="true" tabindex="-1"></a><span class="co"># View the number of missing values in key columns</span></span>
<span id="cb320-7"><a href="#cb320-7" aria-hidden="true" tabindex="-1"></a>sunnyhills_data <span class="sc">|&gt;</span></span>
<span id="cb320-8"><a href="#cb320-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(WindSpeed, WindDir, AirTemp, AQI, PM10), <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
  WindSpeed WindDir AirTemp   AQI  PM10
      &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;
1       417     858     416  1465   358</code></pre>
</div>
<div class="sourceCode cell-code" id="cb322"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a heatmap of correlations</span></span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap <span class="ot">&lt;-</span> <span class="fu">plot_heatmap</span>(sunnyhills_data, <span class="st">"Sunnyhills East site"</span>)</span>
<span id="cb322-3"><a href="#cb322-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-4"><a href="#cb322-4" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/correlation-plot-sunnyhills-data-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb323"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_corr_heatmap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>WindSpeed and WindDir show the moderate positive correlation (0.48), indicating wind speed tends to rise with directional shifts. PM10 and AQI correlate’s moderately (0.51), linking pollution levels with air quality index changes. AirTemp has weak connections, with WindSpeed and WindDir.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb324"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the required columns</span></span>
<span id="cb324-2"><a href="#cb324-2" aria-hidden="true" tabindex="-1"></a>westlake_data <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb324-3"><a href="#cb324-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">==</span> <span class="st">"Westlake"</span>) <span class="sc">|&gt;</span></span>
<span id="cb324-4"><a href="#cb324-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(WindSpeed, WindDir, AirTemp, AQI, NO2, NO, PM10, PM2<span class="fl">.5</span>)</span>
<span id="cb324-5"><a href="#cb324-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-6"><a href="#cb324-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a heatmap of correlations</span></span>
<span id="cb324-7"><a href="#cb324-7" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap <span class="ot">&lt;-</span> <span class="fu">plot_heatmap</span>(westlake_data, <span class="st">"Westlake site"</span>)</span>
<span id="cb324-8"><a href="#cb324-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-9"><a href="#cb324-9" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/correlation-plot-westlake-data-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb325"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_corr_heatmap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
NO and NO2 strongly correlate (0.76), indicating related emission sources. NO2 and NO inversely correlates with WindSpeed (-0.46 and -0.55), suggesting dispersion effects. PM2.5 and AQI correlate moderately (0.39), reflecting air quality dependencies. NO2 and WindDir show moderate correlation (0.45), hinting at directional transport influences. NO and NO2 negatively correlates with AirTemp.
</details>
<details>
<summary>
Temporal Trends in Daily Pollutant Concentrations
</summary>
<p>This section explores daily pollutant trends across Auckland sites from 2016 to 2024. After imputing missing values using ARIMA and median substitution, visualizations reveal site-specific air quality patterns and temporal changes in key pollutants like AQI, NO2, NO, PM10, PM2.5, and SO2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb326"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find approximate values for missing ones, fill the missing values with ARIMA approximated values.</span></span>
<span id="cb326-2"><a href="#cb326-2" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb326-3"><a href="#cb326-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb326-4"><a href="#cb326-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_modify</span>(<span class="sc">~</span> {</span>
<span id="cb326-5"><a href="#cb326-5" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> .</span>
<span id="cb326-6"><a href="#cb326-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb326-7"><a href="#cb326-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply ARIMA imputation only if the entire column is not all NA</span></span>
<span id="cb326-8"><a href="#cb326-8" aria-hidden="true" tabindex="-1"></a>    data<span class="sc">$</span>WindSpeed <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(data<span class="sc">$</span>WindSpeed))) data<span class="sc">$</span>WindSpeed <span class="cf">else</span> <span class="fu">na_kalman</span>(data<span class="sc">$</span>WindSpeed, <span class="at">model =</span> <span class="st">"auto.arima"</span>)</span>
<span id="cb326-9"><a href="#cb326-9" aria-hidden="true" tabindex="-1"></a>    data<span class="sc">$</span>WindDir <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(data<span class="sc">$</span>WindDir))) data<span class="sc">$</span>WindDir <span class="cf">else</span> <span class="fu">na_kalman</span>(data<span class="sc">$</span>WindDir, <span class="at">model =</span> <span class="st">"auto.arima"</span>)</span>
<span id="cb326-10"><a href="#cb326-10" aria-hidden="true" tabindex="-1"></a>    data<span class="sc">$</span>AirTemp <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(data<span class="sc">$</span>AirTemp))) data<span class="sc">$</span>AirTemp <span class="cf">else</span> <span class="fu">na_kalman</span>(data<span class="sc">$</span>AirTemp, <span class="at">model =</span> <span class="st">"auto.arima"</span>)</span>
<span id="cb326-11"><a href="#cb326-11" aria-hidden="true" tabindex="-1"></a>    data<span class="sc">$</span>AQI  <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(data<span class="sc">$</span>AQI)))  data<span class="sc">$</span>AQI  <span class="cf">else</span> <span class="fu">na_kalman</span>(data<span class="sc">$</span>AQI, <span class="at">model =</span> <span class="st">"auto.arima"</span>)</span>
<span id="cb326-12"><a href="#cb326-12" aria-hidden="true" tabindex="-1"></a>    data<span class="sc">$</span>NO2   <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(data<span class="sc">$</span>NO2)))  data<span class="sc">$</span>NO2 <span class="cf">else</span> <span class="fu">na_kalman</span>(data<span class="sc">$</span>NO2, <span class="at">model =</span> <span class="st">"auto.arima"</span>)</span>
<span id="cb326-13"><a href="#cb326-13" aria-hidden="true" tabindex="-1"></a>    data<span class="sc">$</span>NO   <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(data<span class="sc">$</span>NO)))  data<span class="sc">$</span>NO <span class="cf">else</span> <span class="fu">na_kalman</span>(data<span class="sc">$</span>NO, <span class="at">model =</span> <span class="st">"auto.arima"</span>)</span>
<span id="cb326-14"><a href="#cb326-14" aria-hidden="true" tabindex="-1"></a>    data<span class="sc">$</span>PM10 <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(data<span class="sc">$</span>PM10))) data<span class="sc">$</span>PM10 <span class="cf">else</span> <span class="fu">na_kalman</span>(data<span class="sc">$</span>PM10, <span class="at">model =</span> <span class="st">"auto.arima"</span>)</span>
<span id="cb326-15"><a href="#cb326-15" aria-hidden="true" tabindex="-1"></a>    data<span class="sc">$</span>PM2<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(data<span class="sc">$</span>PM2<span class="fl">.5</span>))) data<span class="sc">$</span>PM2<span class="fl">.5</span> <span class="cf">else</span> <span class="fu">na_kalman</span>(data<span class="sc">$</span>PM2<span class="fl">.5</span>, <span class="at">model =</span> <span class="st">"auto.arima"</span>)</span>
<span id="cb326-16"><a href="#cb326-16" aria-hidden="true" tabindex="-1"></a>    data<span class="sc">$</span>SO2 <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(data<span class="sc">$</span>SO2))) data<span class="sc">$</span>SO2 <span class="cf">else</span> <span class="fu">na_kalman</span>(data<span class="sc">$</span>SO2, <span class="at">model =</span> <span class="st">"auto.arima"</span>)</span>
<span id="cb326-17"><a href="#cb326-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb326-18"><a href="#cb326-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(data)</span>
<span id="cb326-19"><a href="#cb326-19" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">|&gt;</span></span>
<span id="cb326-20"><a href="#cb326-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb326-21"><a href="#cb326-21" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb326-22"><a href="#cb326-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Produce a daily_airdata dataset that contains daily total pollutant concentrations and AQI for each SA2_name</span></span>
<span id="cb326-23"><a href="#cb326-23" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb326-24"><a href="#cb326-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name, date) <span class="sc">|&gt;</span></span>
<span id="cb326-25"><a href="#cb326-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb326-26"><a href="#cb326-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">NO2 =</span> <span class="fu">sum</span>(NO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb326-27"><a href="#cb326-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">NO =</span> <span class="fu">sum</span>(NO, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb326-28"><a href="#cb326-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">PM10 =</span> <span class="fu">sum</span>(PM10, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb326-29"><a href="#cb326-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">PM2.5 =</span> <span class="fu">sum</span>(PM2<span class="fl">.5</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb326-30"><a href="#cb326-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">SO2 =</span> <span class="fu">sum</span>(SO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb326-31"><a href="#cb326-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">AQI =</span> <span class="fu">sum</span>(AQI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb326-32"><a href="#cb326-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb326-33"><a href="#cb326-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-34"><a href="#cb326-34" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(daily_airdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "sa2_name"  "site_type" "date"      "year"      "geometry"  "pop2018"  
 [7] "longitude" "latitude"  "AQI"       "NO2"       "NO"        "PM10"     
[13] "PM2.5"     "SO2"       "AirTemp"   "WindDir"   "WindSpeed"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb328"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to plot pollutants versus date for each sa2_name</span></span>
<span id="cb328-2"><a href="#cb328-2" aria-hidden="true" tabindex="-1"></a>plot_pollutant <span class="ot">&lt;-</span> <span class="cf">function</span>(data, yvar) {</span>
<span id="cb328-3"><a href="#cb328-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> .data[[yvar]])) <span class="sc">+</span></span>
<span id="cb328-4"><a href="#cb328-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> color_group)) <span class="sc">+</span></span>
<span id="cb328-5"><a href="#cb328-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_cor</span>(</span>
<span id="cb328-6"><a href="#cb328-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">"pearson"</span>, <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb328-7"><a href="#cb328-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">label.x.npc =</span> <span class="st">"center"</span>, <span class="at">label.y.npc =</span> <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb328-8"><a href="#cb328-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> sa2_name, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb328-9"><a href="#cb328-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_identity</span>(</span>
<span id="cb328-10"><a href="#cb328-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="fu">paste</span>(yvar, <span class="st">"Level"</span>),</span>
<span id="cb328-11"><a href="#cb328-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">guide =</span> <span class="st">"legend"</span>,</span>
<span id="cb328-12"><a href="#cb328-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Moderate"</span>, <span class="st">"High"</span>),</span>
<span id="cb328-13"><a href="#cb328-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"#377eb8"</span>, <span class="st">"#A0AEB2"</span>, <span class="st">"#E24A33"</span>)</span>
<span id="cb328-14"><a href="#cb328-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb328-15"><a href="#cb328-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_date</span>(</span>
<span id="cb328-16"><a href="#cb328-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2016-01-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2024-12-31"</span>), <span class="at">by =</span> <span class="st">"6 months"</span>),</span>
<span id="cb328-17"><a href="#cb328-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">date_labels =</span> <span class="st">"%b %y"</span>) <span class="sc">+</span></span>
<span id="cb328-18"><a href="#cb328-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb328-19"><a href="#cb328-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb328-20"><a href="#cb328-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Daily Trend of"</span>, yvar, <span class="st">"at Each Site in Auckland (2016–2024)"</span>),</span>
<span id="cb328-21"><a href="#cb328-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Missing values are approximate by ARIMA method"</span>,</span>
<span id="cb328-22"><a href="#cb328-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Month Year"</span>, </span>
<span id="cb328-23"><a href="#cb328-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">bquote</span>(.(yvar) <span class="sc">~</span> <span class="st">"Concentration ("</span> <span class="sc">*</span> mu <span class="sc">*</span> <span class="st">"g/"</span> <span class="sc">*</span> m<span class="sc">^</span><span class="dv">3</span> <span class="sc">*</span> <span class="st">")"</span>) ) <span class="sc">+</span></span>
<span id="cb328-24"><a href="#cb328-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb328-25"><a href="#cb328-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb328-26"><a href="#cb328-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb328-27"><a href="#cb328-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb328-28"><a href="#cb328-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb328-29"><a href="#cb328-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb328-30"><a href="#cb328-30" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb328-31"><a href="#cb328-31" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb329"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 10th and 90th percentiles</span></span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(daily_airdata<span class="sc">$</span>AQI, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb329-3"><a href="#cb329-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-4"><a href="#cb329-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add color grouping based on AQI percentiles</span></span>
<span id="cb329-5"><a href="#cb329-5" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">%&gt;%</span></span>
<span id="cb329-6"><a href="#cb329-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb329-7"><a href="#cb329-7" aria-hidden="true" tabindex="-1"></a>    AQI <span class="sc">&lt;=</span> quantiles[<span class="dv">1</span>] <span class="sc">~</span> <span class="st">"#377eb8"</span>,</span>
<span id="cb329-8"><a href="#cb329-8" aria-hidden="true" tabindex="-1"></a>    AQI <span class="sc">&gt;=</span> quantiles[<span class="dv">2</span>] <span class="sc">~</span> <span class="st">"#E24A33"</span>,</span>
<span id="cb329-9"><a href="#cb329-9" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"#A0AEB2"</span></span>
<span id="cb329-10"><a href="#cb329-10" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb329-11"><a href="#cb329-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-12"><a href="#cb329-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate plot</span></span>
<span id="cb329-13"><a href="#cb329-13" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_date <span class="ot">&lt;-</span> <span class="fu">plot_pollutant</span>(daily_airdata, <span class="st">"AQI"</span>) <span class="sc">+</span></span>
<span id="cb329-14"><a href="#cb329-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"AQI"</span>)</span>
<span id="cb329-15"><a href="#cb329-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb329-16"><a href="#cb329-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Save plot</span></span>
<span id="cb329-17"><a href="#cb329-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_aqi_vs_date)</span>
<span id="cb329-18"><a href="#cb329-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-19"><a href="#cb329-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb329-20"><a href="#cb329-20" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_date</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-auckland-aqi-vs-date-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
<p>Queen Street shows the strongest AQI decline (R = –0.35), indicating worsening air quality. Puni and Sunnyhills East have frequent extreme spikes with moderate declines. Henderson Lincoln South, Westlake, and Ellerslie South show smaller but significant decreases. Glen Eden Central exhibit weak, significant positive trend. AQI trends vary notably across Auckland sites.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb330"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 10th and 90th percentiles</span></span>
<span id="cb330-2"><a href="#cb330-2" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(daily_airdata<span class="sc">$</span>NO2, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb330-3"><a href="#cb330-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb330-4"><a href="#cb330-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add color grouping based on NO2 percentiles</span></span>
<span id="cb330-5"><a href="#cb330-5" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">%&gt;%</span></span>
<span id="cb330-6"><a href="#cb330-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb330-7"><a href="#cb330-7" aria-hidden="true" tabindex="-1"></a>    NO2 <span class="sc">&lt;=</span> quantiles[<span class="dv">1</span>] <span class="sc">~</span> <span class="st">"#377eb8"</span>,</span>
<span id="cb330-8"><a href="#cb330-8" aria-hidden="true" tabindex="-1"></a>    NO2 <span class="sc">&gt;=</span> quantiles[<span class="dv">2</span>] <span class="sc">~</span> <span class="st">"#E24A33"</span>,</span>
<span id="cb330-9"><a href="#cb330-9" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"#A0AEB2"</span></span>
<span id="cb330-10"><a href="#cb330-10" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb330-11"><a href="#cb330-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb330-12"><a href="#cb330-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate plot</span></span>
<span id="cb330-13"><a href="#cb330-13" aria-hidden="true" tabindex="-1"></a>plot_no2_vs_date <span class="ot">&lt;-</span> <span class="fu">plot_pollutant</span>(<span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">!=</span> <span class="st">"Sunnyhills East"</span>), <span class="st">"NO2"</span>)</span>
<span id="cb330-14"><a href="#cb330-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb330-15"><a href="#cb330-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb330-16"><a href="#cb330-16" aria-hidden="true" tabindex="-1"></a>plot_no2_vs_date</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-auckland-no2-vs-date-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb331"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_no2_vs_date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Queen Street show consistently high NO2 levels, especially pre-2021, with clear downward trend (R = –0.38). Westlake and Ellerslie South also show moderate levels and significant declines. Henderson Lincoln South has low-moderate values with a weak trend (R = –0.11). Glen Eden Central and Puni stands out with the lowest and a slight positive trend (R = 0.063 and 0.016) with Puni being stable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 10th and 90th percentiles</span></span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(daily_airdata<span class="sc">$</span>NO, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb332-3"><a href="#cb332-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-4"><a href="#cb332-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add color grouping based on NO percentiles</span></span>
<span id="cb332-5"><a href="#cb332-5" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">%&gt;%</span></span>
<span id="cb332-6"><a href="#cb332-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb332-7"><a href="#cb332-7" aria-hidden="true" tabindex="-1"></a>    NO <span class="sc">&lt;=</span> quantiles[<span class="dv">1</span>] <span class="sc">~</span> <span class="st">"#377eb8"</span>,</span>
<span id="cb332-8"><a href="#cb332-8" aria-hidden="true" tabindex="-1"></a>    NO <span class="sc">&gt;=</span> quantiles[<span class="dv">2</span>] <span class="sc">~</span> <span class="st">"#E24A33"</span>,</span>
<span id="cb332-9"><a href="#cb332-9" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"#A0AEB2"</span></span>
<span id="cb332-10"><a href="#cb332-10" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb332-11"><a href="#cb332-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-12"><a href="#cb332-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate plot</span></span>
<span id="cb332-13"><a href="#cb332-13" aria-hidden="true" tabindex="-1"></a>plot_no_vs_date <span class="ot">&lt;-</span> <span class="fu">plot_pollutant</span>(<span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">!=</span> <span class="st">"Sunnyhills East"</span>), <span class="st">"NO"</span>)</span>
<span id="cb332-14"><a href="#cb332-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-15"><a href="#cb332-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb332-16"><a href="#cb332-16" aria-hidden="true" tabindex="-1"></a>plot_no_vs_date</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-auckland-no-vs-date-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb333"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_no_vs_date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>NO levels varied notably across sites. Queen Street showed frequent high NO levels, while Henderson Lincoln South recorded predominantly moderate and low levels. Ellerslie South and Westlake had moderate NO with few high peaks. Notably, Puni and Glen Eden Central showed a positive trend, while others showed declining or fluctuating NO levels over time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb334"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 10th and 90th percentiles</span></span>
<span id="cb334-2"><a href="#cb334-2" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(daily_airdata<span class="sc">$</span>PM10, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb334-3"><a href="#cb334-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb334-4"><a href="#cb334-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add color grouping based on PM10 percentiles</span></span>
<span id="cb334-5"><a href="#cb334-5" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">%&gt;%</span></span>
<span id="cb334-6"><a href="#cb334-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb334-7"><a href="#cb334-7" aria-hidden="true" tabindex="-1"></a>    PM10 <span class="sc">&lt;=</span> quantiles[<span class="dv">1</span>] <span class="sc">~</span> <span class="st">"#377eb8"</span>,</span>
<span id="cb334-8"><a href="#cb334-8" aria-hidden="true" tabindex="-1"></a>    PM10 <span class="sc">&gt;=</span> quantiles[<span class="dv">2</span>] <span class="sc">~</span> <span class="st">"#E24A33"</span>,</span>
<span id="cb334-9"><a href="#cb334-9" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"#A0AEB2"</span></span>
<span id="cb334-10"><a href="#cb334-10" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb334-11"><a href="#cb334-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb334-12"><a href="#cb334-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate plot</span></span>
<span id="cb334-13"><a href="#cb334-13" aria-hidden="true" tabindex="-1"></a>plot_pm10_vs_date <span class="ot">&lt;-</span> <span class="fu">plot_pollutant</span>(daily_airdata, <span class="st">"PM10"</span>)</span>
<span id="cb334-14"><a href="#cb334-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb334-15"><a href="#cb334-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb334-16"><a href="#cb334-16" aria-hidden="true" tabindex="-1"></a>plot_pm10_vs_date</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-auckland-pm10-vs-date-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb335"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_pm10_vs_date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>PM10 levels vary across Auckland sites, with notable trends. Queen Street (R = 0.16) shows an increasing trend, while Henderson Lincoln South (R = -0.26) and Ellerslie South (R = -0.097) show declines. Puni (R = -0.064), Glen Eden Central (R = -0.099), and Ellerslie South (R = -0.097) show minor decreases.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb336"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 10th and 90th percentiles</span></span>
<span id="cb336-2"><a href="#cb336-2" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(daily_airdata<span class="sc">$</span>PM2<span class="fl">.5</span>, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb336-3"><a href="#cb336-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb336-4"><a href="#cb336-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add color grouping based on PM2.5 percentiles</span></span>
<span id="cb336-5"><a href="#cb336-5" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">%&gt;%</span></span>
<span id="cb336-6"><a href="#cb336-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb336-7"><a href="#cb336-7" aria-hidden="true" tabindex="-1"></a>    PM2<span class="fl">.5</span> <span class="sc">&lt;=</span> quantiles[<span class="dv">1</span>] <span class="sc">~</span> <span class="st">"#377eb8"</span>,</span>
<span id="cb336-8"><a href="#cb336-8" aria-hidden="true" tabindex="-1"></a>    PM2<span class="fl">.5</span> <span class="sc">&gt;=</span> quantiles[<span class="dv">2</span>] <span class="sc">~</span> <span class="st">"#E24A33"</span>,</span>
<span id="cb336-9"><a href="#cb336-9" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"#A0AEB2"</span></span>
<span id="cb336-10"><a href="#cb336-10" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb336-11"><a href="#cb336-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb336-12"><a href="#cb336-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate plot</span></span>
<span id="cb336-13"><a href="#cb336-13" aria-hidden="true" tabindex="-1"></a>plot_pm25_vs_date <span class="ot">&lt;-</span> <span class="fu">plot_pollutant</span>(<span class="fu">filter</span>(daily_airdata, <span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sunnyhills East"</span>, <span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>))), <span class="st">"PM2.5"</span>)</span>
<span id="cb336-14"><a href="#cb336-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb336-15"><a href="#cb336-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb336-16"><a href="#cb336-16" aria-hidden="true" tabindex="-1"></a>plot_pm25_vs_date</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-auckland-pm25-vs-date-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb337"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_pm25_vs_date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Queen Street and Puni shows a moderate positive trend over time (R = 0.12 and R = 0.11). Ellerslie South and Westlake experience frequent high levels, and shows moderate and weak trends. Statistical significance confirms clear differences across site-specific trends.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 10th and 90th percentiles</span></span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(daily_airdata<span class="sc">$</span>SO2, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb338-3"><a href="#cb338-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-4"><a href="#cb338-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add color grouping based on SO2 percentiles</span></span>
<span id="cb338-5"><a href="#cb338-5" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">%&gt;%</span></span>
<span id="cb338-6"><a href="#cb338-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb338-7"><a href="#cb338-7" aria-hidden="true" tabindex="-1"></a>    SO2 <span class="sc">&lt;=</span> quantiles[<span class="dv">1</span>] <span class="sc">~</span> <span class="st">"#377eb8"</span>,</span>
<span id="cb338-8"><a href="#cb338-8" aria-hidden="true" tabindex="-1"></a>    SO2 <span class="sc">&gt;=</span> quantiles[<span class="dv">2</span>] <span class="sc">~</span> <span class="st">"#E24A33"</span>,</span>
<span id="cb338-9"><a href="#cb338-9" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"#A0AEB2"</span></span>
<span id="cb338-10"><a href="#cb338-10" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb338-11"><a href="#cb338-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-12"><a href="#cb338-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate plot</span></span>
<span id="cb338-13"><a href="#cb338-13" aria-hidden="true" tabindex="-1"></a>plot_so2_vs_date <span class="ot">&lt;-</span> <span class="fu">plot_pollutant</span>(<span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>), <span class="st">"SO2"</span>)</span>
<span id="cb338-14"><a href="#cb338-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-15"><a href="#cb338-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb338-16"><a href="#cb338-16" aria-hidden="true" tabindex="-1"></a>plot_so2_vs_date</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-auckland-so2-vs-date-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb339"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_so2_vs_date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The graph presents daily SO2 levels at Ellerslie South, Auckland (2016–2024), highlighting ARIMA-estimated missing values and a weak negative correlation, emphasizing seasonal fluctuations and long-term variability in pollutant concentrations.</p>
</details></section>
<section id="air-quality-index-vs-pollutant-concentrations-across-auckland-suburbs" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="air-quality-index-vs-pollutant-concentrations-across-auckland-suburbs"><span class="header-section-number">5.2</span> Air Quality Index vs Pollutant Concentrations Across Auckland Suburbs</h3>
<p>This section explores how daily concentrations of NO2, NO, PM10, PM2.5, and SO2 relate to the Air Quality Index (AQI) from 2016 to 2024. Using GAM trend lines and Pearson correlations across Auckland suburbs, the plots highlight varying relationships between pollutants and AQI, revealing regional differences in air quality responses.</p>
<details>
<summary>
Air Quality Index vs Pollutant Concentrations Across Auckland Suburbs
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb340"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a custom plotting function to examine the relationship between AQI and a selected pollutant</span></span>
<span id="cb340-2"><a href="#cb340-2" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_pollutants <span class="ot">&lt;-</span> <span class="cf">function</span>(data, xvar) {</span>
<span id="cb340-3"><a href="#cb340-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> .data[[xvar]], <span class="at">y =</span> AQI)) <span class="sc">+</span></span>
<span id="cb340-4"><a href="#cb340-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color_group)) <span class="sc">+</span> <span class="co"># Scatter plot colored by AQI categories</span></span>
<span id="cb340-5"><a href="#cb340-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="co"># Add smooth GAM trend line</span></span>
<span id="cb340-6"><a href="#cb340-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_identity</span>(</span>
<span id="cb340-7"><a href="#cb340-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"AQI Level"</span>,  <span class="co"># Title for the legend</span></span>
<span id="cb340-8"><a href="#cb340-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">guide =</span> <span class="st">"legend"</span>, </span>
<span id="cb340-9"><a href="#cb340-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Low AQI"</span>, <span class="st">"High AQI"</span>, <span class="st">"Mid-range"</span>), <span class="co"># Labels for color groups</span></span>
<span id="cb340-10"><a href="#cb340-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"#377eb8"</span>, <span class="st">"#E24A33"</span>, <span class="st">"#A0AEB2"</span>) <span class="co"># Color codes matching the legend labels</span></span>
<span id="cb340-11"><a href="#cb340-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb340-12"><a href="#cb340-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>scientific) <span class="sc">+</span> <span class="co"># Apply log scale to AQI </span></span>
<span id="cb340-13"><a href="#cb340-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_cor</span>(<span class="at">method =</span> <span class="st">"pearson"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span> <span class="co"># Display Pearson correlation coefficients</span></span>
<span id="cb340-14"><a href="#cb340-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> sa2_name, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span> <span class="co"># One panel per SA2 suburb with independent scales</span></span>
<span id="cb340-15"><a href="#cb340-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb340-16"><a href="#cb340-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb340-17"><a href="#cb340-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Relationship Between Daily "</span>, xvar, <span class="st">" Concentration and Air Quality Index (2016–2024)"</span>),</span>
<span id="cb340-18"><a href="#cb340-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"GAM smooth trend with Pearson correlation for each SA2 region"</span>,</span>
<span id="cb340-19"><a href="#cb340-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">bquote</span>(.(xvar) <span class="sc">~</span> <span class="st">"Concentration ("</span> <span class="sc">*</span> mu <span class="sc">*</span> <span class="st">"g/"</span> <span class="sc">*</span> m<span class="sc">^</span><span class="dv">3</span> <span class="sc">*</span> <span class="st">")"</span>), <span class="co"># Dynamic x-axis label with units</span></span>
<span id="cb340-20"><a href="#cb340-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Air Quality Index (log scale)"</span> <span class="co"># y-axis label</span></span>
<span id="cb340-21"><a href="#cb340-21" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb340-22"><a href="#cb340-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb340-23"><a href="#cb340-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb340-24"><a href="#cb340-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb340-25"><a href="#cb340-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb340-26"><a href="#cb340-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb340-27"><a href="#cb340-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb340-28"><a href="#cb340-28" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb340-29"><a href="#cb340-29" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb341"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checks if NO2 data is available for Sunnyhills East (it's not)</span></span>
<span id="cb341-2"><a href="#cb341-2" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb341-3"><a href="#cb341-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">==</span> <span class="st">"Sunnyhills East"</span>) <span class="sc">|&gt;</span></span>
<span id="cb341-4"><a href="#cb341-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(NO2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
    NO2     n
  &lt;dbl&gt; &lt;int&gt;
1     0  2876</code></pre>
</div>
<div class="sourceCode cell-code" id="cb343"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 10th and 90th percentiles</span></span>
<span id="cb343-2"><a href="#cb343-2" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(daily_airdata<span class="sc">$</span>AQI, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb343-3"><a href="#cb343-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-4"><a href="#cb343-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorizes AQI into Low, Mid-range, and High using 10th and 90th percentiles</span></span>
<span id="cb343-5"><a href="#cb343-5" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">%&gt;%</span></span>
<span id="cb343-6"><a href="#cb343-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb343-7"><a href="#cb343-7" aria-hidden="true" tabindex="-1"></a>    AQI <span class="sc">&lt;=</span> quantiles[<span class="dv">1</span>] <span class="sc">~</span> <span class="st">"#377eb8"</span>,</span>
<span id="cb343-8"><a href="#cb343-8" aria-hidden="true" tabindex="-1"></a>    AQI <span class="sc">&gt;=</span> quantiles[<span class="dv">2</span>] <span class="sc">~</span> <span class="st">"#E24A33"</span>,</span>
<span id="cb343-9"><a href="#cb343-9" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"#A0AEB2"</span></span>
<span id="cb343-10"><a href="#cb343-10" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb343-11"><a href="#cb343-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-12"><a href="#cb343-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots AQI vs NO2 for Auckland suburbs (excluding Sunnyhills East)</span></span>
<span id="cb343-13"><a href="#cb343-13" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_no2 <span class="ot">&lt;-</span> <span class="fu">plot_aqi_vs_pollutants</span>(</span>
<span id="cb343-14"><a href="#cb343-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">!=</span> <span class="st">"Sunnyhills East"</span>), <span class="st">"NO2"</span>)</span>
<span id="cb343-15"><a href="#cb343-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-16"><a href="#cb343-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb343-17"><a href="#cb343-17" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_no2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-auckland-aqi-vs-no2-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb344"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_aqi_vs_no2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Queen Street shows a clear upward trend in AQI with increasing NO2, reinforced by a strong correlation (R = 0.49). Ellerslie South and Westlake follow similar, though weaker, trends. Sites like Puni, Henderson Lincoln South, and Glen Eden Central show slight AQI declines as NO2 rises, with Puni’s correlation (R = -0.048) suggesting a modest inverse relationship between pollution levels and air quality categorization.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb345"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots AQI vs NO across Auckland suburbs</span></span>
<span id="cb345-2"><a href="#cb345-2" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_no <span class="ot">&lt;-</span> <span class="fu">plot_aqi_vs_pollutants</span>(<span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">!=</span> <span class="st">"Sunnyhills East"</span>), <span class="st">"NO"</span>)</span>
<span id="cb345-3"><a href="#cb345-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-4"><a href="#cb345-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb345-5"><a href="#cb345-5" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_no</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-auckland-aqi-vs-no-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb346"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_aqi_vs_no)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Queen Street shows the moderate positive correlation (R = 0.35), while Puni has a weak negative correlation (R = -0.049). Ellerslie South and Westlake also show notable trends (R = 0.14, 0.17). AQI categories highlight pollutant variability, with high AQI associated with elevated NO levels across sites. Henderson Lincoln South shows no clear correlation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb347"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb347-1"><a href="#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots AQI vs PM10 for all Auckland suburbs</span></span>
<span id="cb347-2"><a href="#cb347-2" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_pm10 <span class="ot">&lt;-</span> <span class="fu">plot_aqi_vs_pollutants</span>(daily_airdata, <span class="st">"PM10"</span>)</span>
<span id="cb347-3"><a href="#cb347-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-4"><a href="#cb347-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb347-5"><a href="#cb347-5" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_pm10</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-auckland-aqi-vs-pm10-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb348"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_aqi_vs_pm10)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>PM10 concentration correlates moderately with AQI across regions, with R values between 0.22 and 0.41. The GAM trend lines indicate varying patterns, suggesting differences in pollution dynamics. High AQI levels align with increased PM10, while low AQI spans broader concentration ranges. Regional variations highlight distinct pollutant behaviors, emphasizing localized air quality influences and the need for tailored mitigation strategies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb349"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots AQI vs PM2.5 (excludes suburbs with incomplete PM2.5 data)</span></span>
<span id="cb349-2"><a href="#cb349-2" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_pm2<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">plot_aqi_vs_pollutants</span>(</span>
<span id="cb349-3"><a href="#cb349-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(daily_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Glen Eden Central"</span>, <span class="st">"Henderson Lincoln South"</span>, <span class="st">"Sunnyhills East"</span>)), <span class="st">"PM2.5"</span>)</span>
<span id="cb349-4"><a href="#cb349-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-5"><a href="#cb349-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb349-6"><a href="#cb349-6" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_pm2<span class="fl">.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-auckland-aqi-vs-pm25-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb350"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_aqi_vs_pm2<span class="fl">.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The GAM smooth trends show increasing PM2.5 concentrations with AQI across all regions, though with variations in slope. Correlation coefficients indicate weak to moderate positive associations (R = 0.18 to 0.34). Queen Street exhibit highest correlations. Categories reveal AQI levels predominantly in the low to mid range, with high AQI events infrequent yet impactful.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb351"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots AQI vs SO2 specifically for Ellerslie South</span></span>
<span id="cb351-2"><a href="#cb351-2" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_so2 <span class="ot">&lt;-</span> <span class="fu">plot_aqi_vs_pollutants</span>(<span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>), <span class="st">"SO2"</span>)</span>
<span id="cb351-3"><a href="#cb351-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-4"><a href="#cb351-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb351-5"><a href="#cb351-5" aria-hidden="true" tabindex="-1"></a>plot_aqi_vs_so2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-auckland-aqi-vs-so2-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb352"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_aqi_vs_so2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>SO2 concentration and AQI in Ellerslie South show a weak correlation (R = 0.059, p = 0.0016). High AQI events are rare, with most readings in low-to-mid categories. No strong temporal trend is evident.</p>
</details>
<details>
<summary>
Air Temperature effects on pollutants in Auckland sites
</summary>
<p>This section explores how daily air temperature influences pollutant concentrations (NO2, NO, PM10, PM2.5, SO2) across selected Auckland suburbs. Using GAM smoothing and correlation analysis, both raw and standardized data are examined to reveal regional trends and statistical relationships, highlighting the impact of temperature extremes on urban air quality from 2016 to 2024.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb353"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 10th and 90th percentiles</span></span>
<span id="cb353-2"><a href="#cb353-2" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(daily_airdata<span class="sc">$</span>AirTemp, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb353-3"><a href="#cb353-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-4"><a href="#cb353-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorizes air temperature into Low, Mid-range, and High using 10th and 90th percentiles</span></span>
<span id="cb353-5"><a href="#cb353-5" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">%&gt;%</span></span>
<span id="cb353-6"><a href="#cb353-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb353-7"><a href="#cb353-7" aria-hidden="true" tabindex="-1"></a>    AirTemp <span class="sc">&lt;=</span> quantiles[<span class="dv">1</span>] <span class="sc">~</span> <span class="st">"#377eb8"</span>,</span>
<span id="cb353-8"><a href="#cb353-8" aria-hidden="true" tabindex="-1"></a>    AirTemp <span class="sc">&gt;=</span> quantiles[<span class="dv">2</span>] <span class="sc">~</span> <span class="st">"#E24A33"</span>,</span>
<span id="cb353-9"><a href="#cb353-9" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"#A0AEB2"</span></span>
<span id="cb353-10"><a href="#cb353-10" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb353-11"><a href="#cb353-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-12"><a href="#cb353-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a custom plotting function to examine the relationship between air temperature and a selected pollutant</span></span>
<span id="cb353-13"><a href="#cb353-13" aria-hidden="true" tabindex="-1"></a>plot_airtemp_vs_pollutants <span class="ot">&lt;-</span> <span class="cf">function</span>(data, yvar, stat_y) {</span>
<span id="cb353-14"><a href="#cb353-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> AirTemp, <span class="at">y =</span> .data[[yvar]])) <span class="sc">+</span></span>
<span id="cb353-15"><a href="#cb353-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color_group)) <span class="sc">+</span> <span class="co"># Scatter plot colored by pollutant categories</span></span>
<span id="cb353-16"><a href="#cb353-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="co"># Add smooth GAM trend line</span></span>
<span id="cb353-17"><a href="#cb353-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_identity</span>(</span>
<span id="cb353-18"><a href="#cb353-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"AirTemp Level"</span>,  <span class="co"># Title for the legend</span></span>
<span id="cb353-19"><a href="#cb353-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">guide =</span> <span class="st">"legend"</span>, </span>
<span id="cb353-20"><a href="#cb353-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Cold"</span>, <span class="st">"Warm"</span>, <span class="st">"Hot"</span>), <span class="co"># Labels for color groups</span></span>
<span id="cb353-21"><a href="#cb353-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"#377eb8"</span>, <span class="st">"#A0AEB2"</span>, <span class="st">"#E24A33"</span>) <span class="co"># Color codes matching the legend labels</span></span>
<span id="cb353-22"><a href="#cb353-22" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb353-23"><a href="#cb353-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>scientific) <span class="sc">+</span> <span class="co"># Apply log scale to AQI </span></span>
<span id="cb353-24"><a href="#cb353-24" aria-hidden="true" tabindex="-1"></a>   <span class="fu">stat_cor</span>(</span>
<span id="cb353-25"><a href="#cb353-25" aria-hidden="true" tabindex="-1"></a>     <span class="at">method =</span> <span class="st">"pearson"</span>, <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb353-26"><a href="#cb353-26" aria-hidden="true" tabindex="-1"></a>     <span class="at">label.x.npc =</span> <span class="st">"left"</span>, <span class="at">label.y.npc =</span> stat_y) <span class="sc">+</span></span>
<span id="cb353-27"><a href="#cb353-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> sa2_name, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span> <span class="co"># One panel per SA2 suburb with independent scales</span></span>
<span id="cb353-28"><a href="#cb353-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb353-29"><a href="#cb353-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb353-30"><a href="#cb353-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Relationship Between Daily Air Temperature and "</span>, yvar, <span class="st">" Concentration (2016–2024)"</span>),</span>
<span id="cb353-31"><a href="#cb353-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"GAM smooth trend with Pearson correlation for each SA2 region"</span>,</span>
<span id="cb353-32"><a href="#cb353-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Air Temperature (°C)"</span>,</span>
<span id="cb353-33"><a href="#cb353-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">bquote</span>(.(yvar) <span class="sc">~</span> <span class="st">"Concentration ("</span> <span class="sc">*</span> mu <span class="sc">*</span> <span class="st">"g/"</span> <span class="sc">*</span> m<span class="sc">^</span><span class="dv">3</span> <span class="sc">*</span> <span class="st">")"</span>) <span class="co"># Dynamic y-axis label with units</span></span>
<span id="cb353-34"><a href="#cb353-34" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb353-35"><a href="#cb353-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb353-36"><a href="#cb353-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb353-37"><a href="#cb353-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb353-38"><a href="#cb353-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb353-39"><a href="#cb353-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb353-40"><a href="#cb353-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb353-41"><a href="#cb353-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb353-42"><a href="#cb353-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb353-43"><a href="#cb353-43" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb353-44"><a href="#cb353-44" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb354"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View distinct values of AirTemp in each sa2_name</span></span>
<span id="cb354-2"><a href="#cb354-2" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb354-3"><a href="#cb354-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb354-4"><a href="#cb354-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_rows =</span> <span class="fu">n</span>(), </span>
<span id="cb354-5"><a href="#cb354-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">missing_airtemp =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(AirTemp)),</span>
<span id="cb354-6"><a href="#cb354-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 3
  sa2_name                total_rows missing_airtemp
  &lt;chr&gt;                        &lt;int&gt;           &lt;int&gt;
1 Ellerslie South               2879               0
2 Glen Eden Central             2827               0
3 Henderson Lincoln South       2823               0
4 Puni                          2834            2834
5 Queen Street                  2276               0
6 Sunnyhills East               2876               0
7 Westlake                      2823               0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb356"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Puni has all values missing, while others have partial missing data</span></span>
<span id="cb356-2"><a href="#cb356-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-3"><a href="#cb356-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out "Puni"</span></span>
<span id="cb356-4"><a href="#cb356-4" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb356-5"><a href="#cb356-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">!=</span> <span class="st">"Puni"</span>) <span class="sc">|&gt;</span></span>
<span id="cb356-6"><a href="#cb356-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb356-7"><a href="#cb356-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Approximate missing AirTemp using ARIMA imputation</span></span>
<span id="cb356-8"><a href="#cb356-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AirTemp =</span> <span class="fu">na_kalman</span>(AirTemp, <span class="at">model =</span> <span class="st">"auto.arima"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb356-9"><a href="#cb356-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb356-10"><a href="#cb356-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-11"><a href="#cb356-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if missing values are all approximated</span></span>
<span id="cb356-12"><a href="#cb356-12" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb356-13"><a href="#cb356-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb356-14"><a href="#cb356-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(AirTemp)) <span class="sc">|&gt;</span> </span>
<span id="cb356-15"><a href="#cb356-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 18
# ℹ 18 variables: sa2_name &lt;chr&gt;, site_type &lt;chr&gt;, date &lt;date&gt;, year &lt;chr&gt;,
#   geometry &lt;GEOMETRY [°]&gt;, pop2018 &lt;int&gt;, longitude &lt;dbl&gt;, latitude &lt;dbl&gt;,
#   AQI &lt;dbl&gt;, NO2 &lt;dbl&gt;, NO &lt;dbl&gt;, PM10 &lt;dbl&gt;, PM2.5 &lt;dbl&gt;, SO2 &lt;dbl&gt;,
#   AirTemp &lt;dbl&gt;, WindDir &lt;dbl&gt;, WindSpeed &lt;dbl&gt;, color_group &lt;chr&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb358"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All missing AirTemp values are approximated</span></span>
<span id="cb358-2"><a href="#cb358-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-3"><a href="#cb358-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardized air temperature, air pollutants, and AQI for each site</span></span>
<span id="cb358-4"><a href="#cb358-4" aria-hidden="true" tabindex="-1"></a>standardized_airdata <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb358-5"><a href="#cb358-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb358-6"><a href="#cb358-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb358-7"><a href="#cb358-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">AirTemp =</span> (AirTemp <span class="sc">-</span> <span class="fu">mean</span>(AirTemp)) <span class="sc">/</span> <span class="fu">sd</span>(AirTemp),</span>
<span id="cb358-8"><a href="#cb358-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">AQI =</span> (AQI <span class="sc">-</span> <span class="fu">mean</span>(AQI)) <span class="sc">/</span> <span class="fu">sd</span>(AQI),</span>
<span id="cb358-9"><a href="#cb358-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">NO2 =</span> (NO2 <span class="sc">-</span> <span class="fu">mean</span>(NO2)) <span class="sc">/</span> <span class="fu">sd</span>(NO2),</span>
<span id="cb358-10"><a href="#cb358-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">NO =</span> (NO <span class="sc">-</span> <span class="fu">mean</span>(NO)) <span class="sc">/</span> <span class="fu">sd</span>(NO),</span>
<span id="cb358-11"><a href="#cb358-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">PM10 =</span> (PM10 <span class="sc">-</span> <span class="fu">mean</span>(PM10)) <span class="sc">/</span> <span class="fu">sd</span>(PM10),</span>
<span id="cb358-12"><a href="#cb358-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">PM2.5 =</span> (PM2<span class="fl">.5</span> <span class="sc">-</span> <span class="fu">mean</span>(PM2<span class="fl">.5</span>)) <span class="sc">/</span> <span class="fu">sd</span>(PM2<span class="fl">.5</span>),</span>
<span id="cb358-13"><a href="#cb358-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">SO2 =</span> (SO2 <span class="sc">-</span> <span class="fu">mean</span>(SO2)) <span class="sc">/</span> <span class="fu">sd</span>(SO2)</span>
<span id="cb358-14"><a href="#cb358-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb358-15"><a href="#cb358-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb358-16"><a href="#cb358-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-17"><a href="#cb358-17" aria-hidden="true" tabindex="-1"></a><span class="co"># View the selected column details</span></span>
<span id="cb358-18"><a href="#cb358-18" aria-hidden="true" tabindex="-1"></a>standardized_airdata <span class="sc">|&gt;</span></span>
<span id="cb358-19"><a href="#cb358-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(AirTemp, AQI, NO2, NO, PM10, PM2<span class="fl">.5</span>, SO2) <span class="sc">|&gt;</span></span>
<span id="cb358-20"><a href="#cb358-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">skim</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">select(…)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">16504</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 6%">
<col style="width: 3%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 7%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AirTemp</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-14.87</td>
<td style="text-align: right;">-0.42</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">4.03</td>
<td style="text-align: left;">▁▁▁▇▆</td>
</tr>
<tr class="even">
<td style="text-align: left;">AQI</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-2.44</td>
<td style="text-align: right;">-0.32</td>
<td style="text-align: right;">-0.10</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">35.23</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NO2</td>
<td style="text-align: right;">2876</td>
<td style="text-align: right;">0.83</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-3.50</td>
<td style="text-align: right;">-0.74</td>
<td style="text-align: right;">-0.17</td>
<td style="text-align: right;">0.62</td>
<td style="text-align: right;">13.24</td>
<td style="text-align: left;">▇▇▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">NO</td>
<td style="text-align: right;">2876</td>
<td style="text-align: right;">0.83</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1.77</td>
<td style="text-align: right;">-0.71</td>
<td style="text-align: right;">-0.34</td>
<td style="text-align: right;">0.41</td>
<td style="text-align: right;">9.30</td>
<td style="text-align: left;">▇▂▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PM10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-3.01</td>
<td style="text-align: right;">-0.65</td>
<td style="text-align: right;">-0.12</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">25.18</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">PM2.5</td>
<td style="text-align: right;">8526</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-2.90</td>
<td style="text-align: right;">-0.72</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">39.01</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SO2</td>
<td style="text-align: right;">13625</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-2.61</td>
<td style="text-align: right;">-0.57</td>
<td style="text-align: right;">-0.16</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">8.74</td>
<td style="text-align: left;">▆▇▁▁▁</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb359"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All variables are approximately centered around zero, confirming successful standardization. The missing value counts are for the sites not having that pollutant. Histograms show skewness, with AQI and PM pollutants heavily right-skewed, and NO2 and SO2 slightly more dispersed.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
AQI vs Air Temperature
</summary>
<p>Visually check for correlation between raw air temperature and AQI levels across sites. Explore whether AQI vary consistently with temperature. Assess whether standardizing air temperature and AQI improves clarity of trends. Reduces distortion from temperature outliers for better pattern detection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb360"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw air temperature vs AQI for selected sites</span></span>
<span id="cb360-2"><a href="#cb360-2" aria-hidden="true" tabindex="-1"></a>plot_airtemp_vs_aqi <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(</span>
<span id="cb360-3"><a href="#cb360-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">!=</span> <span class="st">"Puni"</span>), <span class="st">"AQI"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb360-4"><a href="#cb360-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Air Quality Index (AQI)"</span>)</span>
<span id="cb360-5"><a href="#cb360-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb360-6"><a href="#cb360-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb360-7"><a href="#cb360-7" aria-hidden="true" tabindex="-1"></a>plot_airtemp_vs_aqi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-airtemp-vs-aqi-all-sites-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb361"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_airtemp_vs_aqi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>AQI declines with temperature significantly at Queen Street (R = -0.12), Ellerslie South (R = -0.085), and Glen Eden Central (R = -0.082), suggesting a weak negative trend. Westlake, Henderson Lincoln South, and Sunnyhills East shows non-significant correlation (p &gt; 0.001), while other sites exhibit insignificant trends. Potential outliers may exist where AQI spikes unexpectedly, possibly due to local pollution events.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb362"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot standardized air temperature vs AQI standardized for selected sites</span></span>
<span id="cb362-2"><a href="#cb362-2" aria-hidden="true" tabindex="-1"></a>standardize_airtemp_vs_aqi <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(<span class="fu">filter</span>(standardized_airdata, sa2_name <span class="sc">!=</span> <span class="st">"Puni"</span>), <span class="st">"AQI"</span>, <span class="st">"top"</span>) <span class="sc">+</span> </span>
<span id="cb362-3"><a href="#cb362-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span> <span class="co"># Change to normal scale</span></span>
<span id="cb362-4"><a href="#cb362-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb362-5"><a href="#cb362-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Relationship Between Daily Standardized Air Temperature and AQI Standardized (2016–2024)"</span>,</span>
<span id="cb362-6"><a href="#cb362-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Standardized Air Temperature"</span>,</span>
<span id="cb362-7"><a href="#cb362-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Standardized AQI"</span>)</span>
<span id="cb362-8"><a href="#cb362-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-9"><a href="#cb362-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb362-10"><a href="#cb362-10" aria-hidden="true" tabindex="-1"></a>standardize_airtemp_vs_aqi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-standardized-airtemp-vs-aqi-standardized-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb363"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, standardize_airtemp_vs_aqi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Standardized AQI data improves clarity but retains similar trends. Ellerslie South loses significance (p &gt; 0.001). Queen Street, Glen Eden Central and Henderson Lincoln South have weak significant correlations. Sunnyhills East correlation remains insignificant. Possibilities of outliers at all the sites, likely due to pollution spikes. Temperature categories remain unchanged. Standardization highlights variability but doesn’t alter trends significantly.</p>
<details>
<summary>
NO2 vs Air Temperature
</summary>
<p>Visually check for correlation between raw air temperature and NO2 levels across sites. Explore whether NO2 concentrations vary consistently with air temperature. Assess whether standardizing air temperature and NO2 improves clarity of trends. Reduces distortion from temperature outliers for better pattern detection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb364"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb364-1"><a href="#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checks if NO2 data is available for Sunnyhills East (it's not)</span></span>
<span id="cb364-2"><a href="#cb364-2" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb364-3"><a href="#cb364-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sunnyhills East"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb364-4"><a href="#cb364-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(NO2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
    NO2     n
  &lt;dbl&gt; &lt;int&gt;
1     0  2876</code></pre>
</div>
<div class="sourceCode cell-code" id="cb366"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw air temperature vs NO2 for selected sites</span></span>
<span id="cb366-2"><a href="#cb366-2" aria-hidden="true" tabindex="-1"></a>plot_airtemp_vs_no2 <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(</span>
<span id="cb366-3"><a href="#cb366-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(daily_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Sunnyhills East"</span>)), <span class="st">"NO2"</span>, <span class="st">"bottom"</span>)</span>
<span id="cb366-4"><a href="#cb366-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb366-5"><a href="#cb366-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb366-6"><a href="#cb366-6" aria-hidden="true" tabindex="-1"></a>plot_airtemp_vs_no2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-airtemp-vs-no2-at-all-sites-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb367"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb367-1"><a href="#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_airtemp_vs_no2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>All regions show a negative correlation between air temperature and NO2, strongest in Ellerslie South (R = -0.28). Cold days (blue) generally have higher NO2. Queen Street shows more scatter, suggesting potential outliers. Nonlinear trends suggest other influencing factors, and hot days (red) consistently show lower concentrations. Outliers may exist at very low or high concentrations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb368"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb368-1"><a href="#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot standardized air temperature vs NO2 standardized for selected sites</span></span>
<span id="cb368-2"><a href="#cb368-2" aria-hidden="true" tabindex="-1"></a>standardize_airtemp_vs_no2 <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(<span class="fu">filter</span>(standardized_airdata, sa2_name <span class="sc">!=</span> <span class="st">"Sunnyhills East"</span>), <span class="st">"NO2"</span>, <span class="st">"top"</span>) <span class="sc">+</span> </span>
<span id="cb368-3"><a href="#cb368-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span> <span class="co"># Change to normal scale</span></span>
<span id="cb368-4"><a href="#cb368-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb368-5"><a href="#cb368-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Relationship Between Daily Standardized Air Temperature and NO2 Standardized (2016–2024)"</span>,</span>
<span id="cb368-6"><a href="#cb368-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Standardized Air Temperature"</span>,</span>
<span id="cb368-7"><a href="#cb368-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Standardized NO2 Concentration"</span>)</span>
<span id="cb368-8"><a href="#cb368-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-9"><a href="#cb368-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb368-10"><a href="#cb368-10" aria-hidden="true" tabindex="-1"></a>standardize_airtemp_vs_no2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-standardized-airtemp-vs-no2-standardized-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb369"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb369-1"><a href="#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, standardize_airtemp_vs_no2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The standardized graph refines trends by normalizing variables, highlighting clearer negative correlations between air temperature and NO2 levels across sites. While both graphs show high significance (p &lt; 0.00001), the standardized version enhances visibility of minor variations. Outliers remain evident at extreme temperatures, suggesting local influences.</p>
</details>
<details>
<summary>
NO vs Air Temperature
</summary>
<p>Identify general pattern between raw air temperature and NO levels across sites. Check for outliers or nonlinear trends in NO vs temperature. Use standardized temperature and standardized NO levels to evaluate cleaner NO trends. Highlights central tendency while minimizing extreme value effects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb370"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checks if NO data is available for Sunnyhills East (it's not)</span></span>
<span id="cb370-2"><a href="#cb370-2" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb370-3"><a href="#cb370-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sunnyhills East"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb370-4"><a href="#cb370-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(NO)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
     NO     n
  &lt;dbl&gt; &lt;int&gt;
1     0  2876</code></pre>
</div>
<div class="sourceCode cell-code" id="cb372"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb372-1"><a href="#cb372-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw air temperature vs NO for selected sites</span></span>
<span id="cb372-2"><a href="#cb372-2" aria-hidden="true" tabindex="-1"></a>plot_airtemp_vs_no <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(</span>
<span id="cb372-3"><a href="#cb372-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(daily_airdata, <span class="sc">!</span>sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Puni"</span>, <span class="st">"Sunnyhills East"</span>)), <span class="st">"NO"</span>, <span class="st">"bottom"</span>)</span>
<span id="cb372-4"><a href="#cb372-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-5"><a href="#cb372-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb372-6"><a href="#cb372-6" aria-hidden="true" tabindex="-1"></a>plot_airtemp_vs_no</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-airtemp-vs-no-auckland-sites-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb373"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb373-1"><a href="#cb373-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_airtemp_vs_no)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The graph shows that NO concentration generally decreases as temperature rises, except on Queen Street. Correlations range from -0.1 to -0.2, all statistically significant (p &lt; 0.0001). Outliers appear at all sites, particularly at higher temperatures. Different sites exhibit distinct trends, suggesting environmental factors may influence NO levels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb374"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot standardized air temperature vs NO standardized for selected sites</span></span>
<span id="cb374-2"><a href="#cb374-2" aria-hidden="true" tabindex="-1"></a>standardize_airtemp_vs_no <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(<span class="fu">filter</span>(standardized_airdata, sa2_name <span class="sc">!=</span> <span class="st">"Sunnyhills East"</span>), <span class="st">"NO"</span>, <span class="st">"top"</span>) <span class="sc">+</span> </span>
<span id="cb374-3"><a href="#cb374-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span> <span class="co"># Change to normal scale</span></span>
<span id="cb374-4"><a href="#cb374-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb374-5"><a href="#cb374-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Relationship Between Daily Standardized Air Temperature and NO Standardized (2016–2024)"</span>,</span>
<span id="cb374-6"><a href="#cb374-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Standardized Air Temperature"</span>,</span>
<span id="cb374-7"><a href="#cb374-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Standardized NO Concentration"</span>)</span>
<span id="cb374-8"><a href="#cb374-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-9"><a href="#cb374-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb374-10"><a href="#cb374-10" aria-hidden="true" tabindex="-1"></a>standardize_airtemp_vs_no</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-standardized-airtemp-vs-no-standardized-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb375"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb375-1"><a href="#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, standardize_airtemp_vs_no)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
Standardization reveals clearer trends: NO concentration decreases more uniformly with temperature, strengthening correlations (-0.06 to -0.13). Significance remains unchanged, except Queen Street correlation is now non-significant. Category divisions (cold, warm, hot) show more distinct separation, reducing overlap. Outliers persist but are more identifiable at extreme temperatures and extreme NO concentration. The refined view emphasizes regional differences and environmental influences more effectively.
</details>
<details>
<summary>
PM10 vs Air Temperature
</summary>
<p>Examine how PM10 concentrations change with raw temperature. Helps identify seasonal or heat-related pollution effects. Use standardized temperature and standard PM10 concentrations to clarify relationship. Removes noise from extreme temperature values to focus on main trend.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb376"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb376-1"><a href="#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw air temperature vs PM10 for selected sites</span></span>
<span id="cb376-2"><a href="#cb376-2" aria-hidden="true" tabindex="-1"></a>plot_airtemp_vs_pm10 <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(</span>
<span id="cb376-3"><a href="#cb376-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">!=</span> <span class="st">"Puni"</span>), <span class="st">"PM10"</span>, <span class="st">"top"</span>)</span>
<span id="cb376-4"><a href="#cb376-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-5"><a href="#cb376-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb376-6"><a href="#cb376-6" aria-hidden="true" tabindex="-1"></a>plot_airtemp_vs_pm10</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-airtemp-vs-pm10-auckland-sites-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb377"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb377-1"><a href="#cb377-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_airtemp_vs_pm10)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ellerslie South and Westlake show no clear trend, with weak correlations and non-significant relationships. Glen Eden, Henderson Lincoln South, and Sunnyhills East show mild downward trends with significant negative correlations. Queen Street shows a weak, significant upward trend. Temperature-related PM10 effects vary by site, with some showing clear relationships while others remain inconclusive.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb378"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb378-1"><a href="#cb378-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot standardized air temperature vs PM10 standardized for each site </span></span>
<span id="cb378-2"><a href="#cb378-2" aria-hidden="true" tabindex="-1"></a>plot_standardized_airtemp_vs_pm10 <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(standardized_airdata, <span class="st">"PM10"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb378-3"><a href="#cb378-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb378-4"><a href="#cb378-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Relationship Between Daily Standardized Air Temperature and PM10 Concentration Standardized (2016–2024)"</span>),</span>
<span id="cb378-5"><a href="#cb378-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Air Temperature"</span>,</span>
<span id="cb378-6"><a href="#cb378-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized PM10"</span>)</span>
<span id="cb378-7"><a href="#cb378-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-8"><a href="#cb378-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb378-9"><a href="#cb378-9" aria-hidden="true" tabindex="-1"></a>plot_standardized_airtemp_vs_pm10</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-standardized-airtemp-vs-pm10-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb379"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_standardized_airtemp_vs_pm10)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
Ellerslie South and Westlake show no clear trend, with weak correlations and no significance. Glen Eden Central shows weak upward trend with significant positive correlations. The rest of the sites exhibits weak non-significant upward and downward trends. Outliers are present at all sites, especially Queen Street and Sunnyhills East. Temperature categories influence PM10 differently across sites.
</details>
<details>
<summary>
PM2.5 vs Air Temperature
</summary>
<p>Investigate PM2.5 variation with raw air temperature across selected sites. Detect possible temperature-dependent behavior of fine particulates. Compare standardized temperature effect on standardized PM2.5. Filter out extreme values to enhance trend visibility. Improves trend interpretation by reducing the impact of outliers in both variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb380"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb380-1"><a href="#cb380-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw air temperature vs PM2.5 (data available for 3 sites)</span></span>
<span id="cb380-2"><a href="#cb380-2" aria-hidden="true" tabindex="-1"></a>plot_airtemp_vs_pm2<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(</span>
<span id="cb380-3"><a href="#cb380-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ellerslie South"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Westlake"</span>)), <span class="st">"PM2.5"</span>, <span class="st">"bottom"</span>)</span>
<span id="cb380-4"><a href="#cb380-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-5"><a href="#cb380-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb380-6"><a href="#cb380-6" aria-hidden="true" tabindex="-1"></a>plot_airtemp_vs_pm2<span class="fl">.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-airtemp-vs-pm25-selected-sites-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb381"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb381-1"><a href="#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_airtemp_vs_pm2<span class="fl">.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Westlake shows the strongest negative correlation (-0.14), suggesting PM2.5 decreases as temperature rises. Ellerslie South follows (-0.093), while Queen Street’s correlation is weak and non-significant (0.052, p=0.014). Cold temperatures generally align with higher PM2.5 levels. Outliers, especially in Westlake, indicate extreme PM2.5 spikes at warm and hot temperatures, likely from localized emissions or meteorological influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb382"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb382-1"><a href="#cb382-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot standardized air temperature vs PM2.5 standardized</span></span>
<span id="cb382-2"><a href="#cb382-2" aria-hidden="true" tabindex="-1"></a>plot_standardized_airtemp_vs_pm2<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(<span class="fu">filter</span>(standardized_airdata, sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ellerslie South"</span>, <span class="st">"Queen Street"</span>, <span class="st">"Westlake"</span>)), <span class="st">"PM2.5"</span>, <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb382-3"><a href="#cb382-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb382-4"><a href="#cb382-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Relationship Between Standardized Daily Air Temperature and Daily PM2.5 Concentration Standardized (2016–2024)"</span>),</span>
<span id="cb382-5"><a href="#cb382-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Air Temperature"</span>,</span>
<span id="cb382-6"><a href="#cb382-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized PM2.5"</span>)</span>
<span id="cb382-7"><a href="#cb382-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-8"><a href="#cb382-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb382-9"><a href="#cb382-9" aria-hidden="true" tabindex="-1"></a>plot_standardized_airtemp_vs_pm2<span class="fl">.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-standardized-airtemp-vs-pm25-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb383"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb383-1"><a href="#cb383-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_standardized_airtemp_vs_pm2<span class="fl">.5</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
Air temperature and PM2.5 levels shows negative significant correlations at Ellerslie South and Westlake whereas Queen Street shows non-significant correlation. PM2.5 outliers might arise from local pollution spikes. Statistical significance depends on seasonal variation and source proximity.
</details>
<details>
<summary>
SO2 vs Air Temperature
</summary>
<p>Analyze SO2 variation with raw air temperature at Ellerslie (only site with SO2 data). Evaluate site-specific patterns in SO2 behavior with temperature. Repeat analysis using standardized temperature and standardized SO2. Improve visualization by reducing impact of temperature outliers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb384"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb384-1"><a href="#cb384-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw air temperature vs SO2 (SO2 data is available for Ellerslie site only)</span></span>
<span id="cb384-2"><a href="#cb384-2" aria-hidden="true" tabindex="-1"></a>airtemp_vs_so2 <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(</span>
<span id="cb384-3"><a href="#cb384-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(daily_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>), <span class="st">"SO2"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb384-4"><a href="#cb384-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">""</span>, <span class="at">subtitle =</span> <span class="st">"Raw Data"</span>) <span class="sc">+</span></span>
<span id="cb384-5"><a href="#cb384-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb384-6"><a href="#cb384-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb384-7"><a href="#cb384-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot standardized air temperature vs SO2 standardized </span></span>
<span id="cb384-8"><a href="#cb384-8" aria-hidden="true" tabindex="-1"></a>standardized_airtemp_vs_so2 <span class="ot">&lt;-</span> <span class="fu">plot_airtemp_vs_pollutants</span>(<span class="fu">filter</span>(standardized_airdata, sa2_name <span class="sc">==</span> <span class="st">"Ellerslie South"</span>), <span class="st">"SO2"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb384-9"><a href="#cb384-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb384-10"><a href="#cb384-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">""</span>, <span class="at">subtitle =</span> <span class="st">"Standardized Data"</span>,</span>
<span id="cb384-11"><a href="#cb384-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Air Temperature"</span>,</span>
<span id="cb384-12"><a href="#cb384-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized SO2"</span>) <span class="sc">+</span></span>
<span id="cb384-13"><a href="#cb384-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb384-14"><a href="#cb384-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb384-15"><a href="#cb384-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb384-16"><a href="#cb384-16" aria-hidden="true" tabindex="-1"></a>combined_airtemp_vs_so2 <span class="ot">&lt;-</span> airtemp_vs_so2 <span class="sc">+</span> standardized_airtemp_vs_so2 <span class="sc">+</span></span>
<span id="cb384-17"><a href="#cb384-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">+</span> <span class="co"># Collect legend</span></span>
<span id="cb384-18"><a href="#cb384-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb384-19"><a href="#cb384-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Daily Air Temperature and SO2 Concentration (2016–2024)"</span>,</span>
<span id="cb384-20"><a href="#cb384-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"GAM smooth trend with Pearson correlation for each SA2 region"</span>,</span>
<span id="cb384-21"><a href="#cb384-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb384-22"><a href="#cb384-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb384-23"><a href="#cb384-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb384-24"><a href="#cb384-24" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb384-25"><a href="#cb384-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb384-26"><a href="#cb384-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb384-27"><a href="#cb384-27" aria-hidden="true" tabindex="-1"></a>combined_airtemp_vs_so2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-airtemp-vs-so2-ellerslie-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb385"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb385-1"><a href="#cb385-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, combined_airtemp_vs_so2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
The standardized data plot shows a slightly stronger negative correlation between air temperature and SO2 concentration (R = -0.16, significant). The raw data data weakens this correlation (R = -0.13, significant). Cold days generally show higher SO2 levels, while warm and hot days show a downward trend. The GAM smooth confirms overall SO2 decrease with rising temperature.
</details>
<details>
<summary>
Wind speed effects on wind direction and air temperature in Auckland suburbs
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb386"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify sites where WindSpeed is missing for all observations</span></span>
<span id="cb386-2"><a href="#cb386-2" aria-hidden="true" tabindex="-1"></a>daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb386-3"><a href="#cb386-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name) <span class="sc">|&gt;</span></span>
<span id="cb386-4"><a href="#cb386-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">all</span>(<span class="fu">is.na</span>(WindSpeed))) <span class="sc">|&gt;</span></span>
<span id="cb386-5"><a href="#cb386-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb386-6"><a href="#cb386-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sa2_name, WindSpeed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  sa2_name     WindSpeed     n
  &lt;chr&gt;            &lt;dbl&gt; &lt;int&gt;
1 Queen Street        NA  2276</code></pre>
</div>
<div class="sourceCode cell-code" id="cb388"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="co"># =&gt; Queen Street has no WindSpeed data and will be excluded from plotting</span></span>
<span id="cb388-2"><a href="#cb388-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb388-3"><a href="#cb388-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out Queen Street due to entirely missing WindSpeed data</span></span>
<span id="cb388-4"><a href="#cb388-4" aria-hidden="true" tabindex="-1"></a>daily_windspeed <span class="ot">&lt;-</span> daily_airdata <span class="sc">|&gt;</span></span>
<span id="cb388-5"><a href="#cb388-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sa2_name <span class="sc">!=</span> <span class="st">"Queen Street"</span>)</span>
<span id="cb388-6"><a href="#cb388-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb388-7"><a href="#cb388-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create scatter plot of daily WindSpeed over time, faceted by site</span></span>
<span id="cb388-8"><a href="#cb388-8" aria-hidden="true" tabindex="-1"></a>plot_pts <span class="ot">&lt;-</span> <span class="cf">function</span>(data, xvar) {</span>
<span id="cb388-9"><a href="#cb388-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> {{xvar}}, <span class="at">y =</span> WindSpeed)) <span class="sc">+</span></span>
<span id="cb388-10"><a href="#cb388-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> site_type)) <span class="sc">+</span></span>
<span id="cb388-11"><a href="#cb388-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_cor</span>(</span>
<span id="cb388-12"><a href="#cb388-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">"pearson"</span>, <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb388-13"><a href="#cb388-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">label.x.npc =</span> <span class="st">"left"</span>, <span class="at">label.y.npc =</span> <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb388-14"><a href="#cb388-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> sa2_name, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb388-15"><a href="#cb388-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"G"</span>) <span class="sc">+</span> </span>
<span id="cb388-16"><a href="#cb388-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb388-17"><a href="#cb388-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb388-18"><a href="#cb388-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Distribution of Daily Wind Speed vs. Date by Sites in Auckland (2016–2024)"</span>,</span>
<span id="cb388-19"><a href="#cb388-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Excludes Queen Street and Puni (all missing values)"</span>,</span>
<span id="cb388-20"><a href="#cb388-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Wind Speed (m/s)"</span>, <span class="at">color =</span> <span class="st">"Site Type"</span>) <span class="sc">+</span></span>
<span id="cb388-21"><a href="#cb388-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb388-22"><a href="#cb388-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb388-23"><a href="#cb388-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb388-24"><a href="#cb388-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb388-25"><a href="#cb388-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb388-26"><a href="#cb388-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb388-27"><a href="#cb388-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb388-28"><a href="#cb388-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb388-29"><a href="#cb388-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb388-30"><a href="#cb388-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb388-31"><a href="#cb388-31" aria-hidden="true" tabindex="-1"></a>plot_windspeed <span class="ot">&lt;-</span> <span class="fu">plot_pts</span>(daily_windspeed, date)</span>
<span id="cb388-32"><a href="#cb388-32" aria-hidden="true" tabindex="-1"></a>plot_windspeed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/windspeed-scatter-by-site-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb389"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb389-1"><a href="#cb389-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_windspeed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ellerslie South contains erroneous negative values, causing the plot to be diverted. Let’s filter out the invalid wind speed values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb390"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb390-1"><a href="#cb390-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot for valid WindSpeed values</span></span>
<span id="cb390-2"><a href="#cb390-2" aria-hidden="true" tabindex="-1"></a>plot_windspeed <span class="ot">&lt;-</span> <span class="fu">plot_pts</span>(<span class="fu">filter</span>(daily_windspeed, WindSpeed <span class="sc">&gt;=</span> <span class="dv">0</span>) , date)</span>
<span id="cb390-3"><a href="#cb390-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb390-4"><a href="#cb390-4" aria-hidden="true" tabindex="-1"></a>plot_windspeed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-valid-wind-speed-vs-date-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
<p>Wind speed trends from 2016–2024 vary by site in Auckland. Ellerslie South and Glen Eden Central show the strongest positive correlations with time (R = 0.15, 0.14), while Westlake shows no trend (R = –0.016, p = 0.39). Henderson and Westlake shows a shift in site type in 2023.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb391"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb391-1"><a href="#cb391-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot for WindSpeed versus WindDir</span></span>
<span id="cb391-2"><a href="#cb391-2" aria-hidden="true" tabindex="-1"></a>plot_windspeed <span class="ot">&lt;-</span> <span class="fu">plot_pts</span>(<span class="fu">filter</span>(daily_windspeed, WindSpeed <span class="sc">&gt;=</span> <span class="dv">0</span>), WindDir) <span class="sc">+</span></span>
<span id="cb391-3"><a href="#cb391-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb391-4"><a href="#cb391-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Distribution of Daily Wind Speed vs. Wind Direction by Site Types in Auckland (2016–2024)"</span>,</span>
<span id="cb391-5"><a href="#cb391-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Wind Direction (°)"</span>) </span>
<span id="cb391-6"><a href="#cb391-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb391-7"><a href="#cb391-7" aria-hidden="true" tabindex="-1"></a>plot_windspeed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-wind-speed-vs-wind-direction-site-type-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb392"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb392-1"><a href="#cb392-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"dist.pdf"</span>, plot_windspeed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wind speed shows varying correlations with wind direction across site types. Sunnyhills East exhibits the strongest positive relationship (R = 0.37), while Westlake shows a weak negative one (R = −0.11). Henderson Lincoln South displays no significant association.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb393"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb393-1"><a href="#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot for WindSpeed versus AirTemp</span></span>
<span id="cb393-2"><a href="#cb393-2" aria-hidden="true" tabindex="-1"></a>plot_windspeed <span class="ot">&lt;-</span> <span class="fu">plot_pts</span>(daily_windspeed, AirTemp) <span class="sc">+</span></span>
<span id="cb393-3"><a href="#cb393-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb393-4"><a href="#cb393-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Distribution of Daily Wind Speed vs. Air Temperature by Site Types in Auckland (2016–2024)"</span>,</span>
<span id="cb393-5"><a href="#cb393-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Air Temperature (°C)"</span>) </span>
<span id="cb393-6"><a href="#cb393-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb393-7"><a href="#cb393-7" aria-hidden="true" tabindex="-1"></a>plot_windspeed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/display-plot-for-WindSpeed-vs-AirTemp-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
<p>Ellerslie South contains large negative invalid wind speed values and Sunnyhills East has large negative air temperature value of below -50 degree celsius. These values are causing the plot to be diverted towards them. Let’s remove them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb394"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb394-1"><a href="#cb394-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot for WindSpeed versus AirTemp</span></span>
<span id="cb394-2"><a href="#cb394-2" aria-hidden="true" tabindex="-1"></a>plot_windspeed <span class="ot">&lt;-</span> <span class="fu">plot_pts</span>(<span class="fu">filter</span>(daily_windspeed, WindSpeed <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> AirTemp <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">5</span>), AirTemp) <span class="sc">+</span></span>
<span id="cb394-3"><a href="#cb394-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb394-4"><a href="#cb394-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Distribution of Daily Wind Speed vs. Air Temperature by Site Types in Auckland (2016–2024)"</span>,</span>
<span id="cb394-5"><a href="#cb394-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Air Temperature (°C)"</span>) </span>
<span id="cb394-6"><a href="#cb394-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb394-7"><a href="#cb394-7" aria-hidden="true" tabindex="-1"></a>plot_windspeed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/display-plot-for-WindSpeed-vs-AirTemp-for-valid-values-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
The strongest positive correlation between wind speed and air temperature is seen at Ellerslie South (R = 0.55), followed by Glen Eden Central (R = 0.48) and Westlake (R = 0.37). Henderson Lincoln South (R = 0.21) and Sunnyhills East (R = 0.14) show weaker correlations. Warmer temperatures tend to align with higher wind speeds across all sites, but the relationship is notably weaker in more suburban residential areas like Sunnyhills. Industrial sites like Ellerslie exhibit stronger associations, possibly reflecting localized urban heat and turbulence effects.
</details>
<details>
<summary>
Wind speed effects on pollutants in Auckland suburbs
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb395"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb395-1"><a href="#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter required columns</span></span>
<span id="cb395-2"><a href="#cb395-2" aria-hidden="true" tabindex="-1"></a>daily_windspeed <span class="ot">&lt;-</span> merged_airdata <span class="sc">|&gt;</span></span>
<span id="cb395-3"><a href="#cb395-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sa2_name, site_type, AQI, NO2, NO, PM10, PM2<span class="fl">.5</span>, SO2, WindSpeed)</span>
<span id="cb395-4"><a href="#cb395-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-5"><a href="#cb395-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 10th and 90th percentiles of WindSpeed </span></span>
<span id="cb395-6"><a href="#cb395-6" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(daily_windspeed<span class="sc">$</span>WindSpeed, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb395-7"><a href="#cb395-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-8"><a href="#cb395-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorizes wind speed into Low, Mid-range, and High using 10th and 90th percentiles</span></span>
<span id="cb395-9"><a href="#cb395-9" aria-hidden="true" tabindex="-1"></a>daily_windspeed <span class="ot">&lt;-</span> daily_windspeed <span class="sc">|&gt;</span></span>
<span id="cb395-10"><a href="#cb395-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb395-11"><a href="#cb395-11" aria-hidden="true" tabindex="-1"></a>    WindSpeed <span class="sc">&lt;=</span> quantiles[<span class="dv">1</span>] <span class="sc">~</span> <span class="st">"#377eb8"</span>,</span>
<span id="cb395-12"><a href="#cb395-12" aria-hidden="true" tabindex="-1"></a>    WindSpeed <span class="sc">&gt;=</span> quantiles[<span class="dv">2</span>] <span class="sc">~</span> <span class="st">"#E24A33"</span>,</span>
<span id="cb395-13"><a href="#cb395-13" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"#A0AEB2"</span></span>
<span id="cb395-14"><a href="#cb395-14" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb395-15"><a href="#cb395-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-16"><a href="#cb395-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a custom plotting function to examine the relationship between wind speed and a selected pollutant</span></span>
<span id="cb395-17"><a href="#cb395-17" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_pollutants <span class="ot">&lt;-</span> <span class="cf">function</span>(data, yvar, stat_var) {</span>
<span id="cb395-18"><a href="#cb395-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> WindSpeed, <span class="at">y =</span> .data[[yvar]])) <span class="sc">+</span></span>
<span id="cb395-19"><a href="#cb395-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color_group)) <span class="sc">+</span> <span class="co"># Scatter plot colored by pollutant categories</span></span>
<span id="cb395-20"><a href="#cb395-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="co"># Add smooth GAM trend line</span></span>
<span id="cb395-21"><a href="#cb395-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_identity</span>(</span>
<span id="cb395-22"><a href="#cb395-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"WindSpeed Level"</span>,  <span class="co"># Title for the legend</span></span>
<span id="cb395-23"><a href="#cb395-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">guide =</span> <span class="st">"legend"</span>, </span>
<span id="cb395-24"><a href="#cb395-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>), <span class="co"># Labels for color groups</span></span>
<span id="cb395-25"><a href="#cb395-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"#377eb8"</span>, <span class="st">"#A0AEB2"</span>, <span class="st">"#E24A33"</span>) <span class="co"># Color codes matching the legend labels</span></span>
<span id="cb395-26"><a href="#cb395-26" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb395-27"><a href="#cb395-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>scientific) <span class="sc">+</span></span>
<span id="cb395-28"><a href="#cb395-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_cor</span>(</span>
<span id="cb395-29"><a href="#cb395-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">"pearson"</span>, <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb395-30"><a href="#cb395-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">label.x.npc =</span> <span class="st">"left"</span>, <span class="at">label.y.npc =</span> stat_var) <span class="sc">+</span></span>
<span id="cb395-31"><a href="#cb395-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> sa2_name, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span> <span class="co"># One panel per SA2 suburb with independent scales</span></span>
<span id="cb395-32"><a href="#cb395-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb395-33"><a href="#cb395-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb395-34"><a href="#cb395-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Relationship Between Daily Wind Speed and "</span>, yvar, <span class="st">" Concentration in Auckland (2016–2024)"</span>),</span>
<span id="cb395-35"><a href="#cb395-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"GAM smooth trend with Pearson correlation for each Site"</span>,</span>
<span id="cb395-36"><a href="#cb395-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Wind Speed (m/s)"</span>, <span class="at">y =</span> <span class="fu">paste</span>(yvar, <span class="st">" concentration (µg/m³)"</span>)</span>
<span id="cb395-37"><a href="#cb395-37" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb395-38"><a href="#cb395-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb395-39"><a href="#cb395-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb395-40"><a href="#cb395-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb395-41"><a href="#cb395-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb395-42"><a href="#cb395-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb395-43"><a href="#cb395-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb395-44"><a href="#cb395-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb395-45"><a href="#cb395-45" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb395-46"><a href="#cb395-46" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb396"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb396-1"><a href="#cb396-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View missing values of WindSpeed in each sa2_name</span></span>
<span id="cb396-2"><a href="#cb396-2" aria-hidden="true" tabindex="-1"></a>daily_windspeed <span class="sc">|&gt;</span></span>
<span id="cb396-3"><a href="#cb396-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name, site_type) <span class="sc">|&gt;</span></span>
<span id="cb396-4"><a href="#cb396-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_rows =</span> <span class="fu">n</span>(), </span>
<span id="cb396-5"><a href="#cb396-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">missing_windspeed =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(WindSpeed)),</span>
<span id="cb396-6"><a href="#cb396-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   sa2_name                site_type                total_rows missing_windspeed
   &lt;chr&gt;                   &lt;chr&gt;                         &lt;int&gt;             &lt;int&gt;
 1 Ellerslie South         Residential, Industrial…       2879               358
 2 Glen Eden Central       Residential, NES site          2827               235
 3 Henderson Lincoln South Residential, NES site           361                29
 4 Henderson Lincoln South Residential, Traffic, N…       2462               264
 5 Puni                    Residential, NES site          2834              2834
 6 Queen Street            Residential, NES site           230               230
 7 Queen Street            Traffic, NES site              2046              2046
 8 Sunnyhills East         Residential, NES site          2876               417
 9 Westlake                Residential, NES site           329                45
10 Westlake                Traffic, NES site              2494               479</code></pre>
</div>
<div class="sourceCode cell-code" id="cb398"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb398-1"><a href="#cb398-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Queen Street and Puni has all missing WindSpeed values, while others have partial missing data</span></span>
<span id="cb398-2"><a href="#cb398-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb398-3"><a href="#cb398-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out "Queen Street" and "Puni"</span></span>
<span id="cb398-4"><a href="#cb398-4" aria-hidden="true" tabindex="-1"></a>daily_windspeed <span class="ot">&lt;-</span> daily_windspeed <span class="sc">|&gt;</span></span>
<span id="cb398-5"><a href="#cb398-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(sa2_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Queen Street"</span>, <span class="st">"Puni"</span>)))</span>
<span id="cb398-6"><a href="#cb398-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb398-7"><a href="#cb398-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardized air temperature, air pollutants, and AQI for each site</span></span>
<span id="cb398-8"><a href="#cb398-8" aria-hidden="true" tabindex="-1"></a>standardized_windspeed <span class="ot">&lt;-</span> daily_windspeed <span class="sc">|&gt;</span></span>
<span id="cb398-9"><a href="#cb398-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sa2_name, site_type) <span class="sc">|&gt;</span></span>
<span id="cb398-10"><a href="#cb398-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb398-11"><a href="#cb398-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">WindSpeed =</span> (WindSpeed <span class="sc">-</span> <span class="fu">mean</span>(WindSpeed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(WindSpeed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb398-12"><a href="#cb398-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">AQI =</span> (AQI <span class="sc">-</span> <span class="fu">mean</span>(AQI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(AQI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb398-13"><a href="#cb398-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">NO2 =</span> (NO2 <span class="sc">-</span> <span class="fu">mean</span>(NO2)) <span class="sc">/</span> <span class="fu">sd</span>(NO2),</span>
<span id="cb398-14"><a href="#cb398-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">NO =</span> (NO <span class="sc">-</span> <span class="fu">mean</span>(NO)) <span class="sc">/</span> <span class="fu">sd</span>(NO),</span>
<span id="cb398-15"><a href="#cb398-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">PM10 =</span> (PM10 <span class="sc">-</span> <span class="fu">mean</span>(PM10)) <span class="sc">/</span> <span class="fu">sd</span>(PM10),</span>
<span id="cb398-16"><a href="#cb398-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">PM2.5 =</span> (PM2<span class="fl">.5</span> <span class="sc">-</span> <span class="fu">mean</span>(PM2<span class="fl">.5</span>)) <span class="sc">/</span> <span class="fu">sd</span>(PM2<span class="fl">.5</span>),</span>
<span id="cb398-17"><a href="#cb398-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">SO2 =</span> (SO2 <span class="sc">-</span> <span class="fu">mean</span>(SO2)) <span class="sc">/</span> <span class="fu">sd</span>(SO2)</span>
<span id="cb398-18"><a href="#cb398-18" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb398-19"><a href="#cb398-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
AQI vs Wind Speed
</summary>
<p>Visually check for correlation between raw and standardized wind speed and air quality index (AQI) levels across sites. Explore whether AQI vary consistently with wind speed. Assess whether standardizing wind speed and AQI improves clarity of trends. Reduces distortion from wind speed outliers for better pattern detection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb399"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb399-1"><a href="#cb399-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw wind speed vs AQI </span></span>
<span id="cb399-2"><a href="#cb399-2" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_aqi <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(daily_windspeed, <span class="st">"AQI"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb399-3"><a href="#cb399-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Air Quality Index (AQI)"</span>)</span>
<span id="cb399-4"><a href="#cb399-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb399-5"><a href="#cb399-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb399-6"><a href="#cb399-6" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_aqi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-windspeed-vs-aqi-for-all-sites-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
<p>This plot includes invalid negative WindSpeed values at Ellerslie South, which may obscure meaningful patterns. Filtering for valid WindSpeed values will help reveal clearer and more accurate trends.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb400"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb400-1"><a href="#cb400-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Limit the WindSpeed values of at least 0m/s</span></span>
<span id="cb400-2"><a href="#cb400-2" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_aqi <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(<span class="fu">filter</span>(daily_windspeed, WindSpeed <span class="sc">&gt;=</span> <span class="dv">0</span>) , <span class="st">"AQI"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb400-3"><a href="#cb400-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb400-4"><a href="#cb400-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Restricted Daily Wind Speed and AQI Concentration at sites in Auckland (2016–2024)"</span>,</span>
<span id="cb400-5"><a href="#cb400-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Positive Wind Speed Values (m/s)"</span>,</span>
<span id="cb400-6"><a href="#cb400-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Air Quality Index (AQI)"</span>)</span>
<span id="cb400-7"><a href="#cb400-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb400-8"><a href="#cb400-8" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_aqi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/restrict-windspeed-vs-aqi-for-valid-windspeed-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
<p>Trends vary by site, Sunnyhills East shows moderate positive correlation, while others exhibit no relationships due to local influences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb401"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb401-1"><a href="#cb401-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot standardized wind speed vs AQI standardized </span></span>
<span id="cb401-2"><a href="#cb401-2" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_aqi <span class="ot">&lt;-</span> <span class="fu">plot_windspeed_vs_pollutants</span>(<span class="fu">filter</span>(standardized_windspeed, WindSpeed <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">3</span> <span class="sc">&amp;</span> WindSpeed <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">&amp;</span> AQI <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">3</span> <span class="sc">&amp;</span> AQI <span class="sc">&lt;=</span> <span class="dv">3</span>), <span class="st">"AQI"</span>, <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb401-3"><a href="#cb401-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span></span>
<span id="cb401-4"><a href="#cb401-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb401-5"><a href="#cb401-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Standardised Daily Wind Speed and AQI Concentration at sites in Auckland (2016–2024)"</span>,</span>
<span id="cb401-6"><a href="#cb401-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Standardized Wind Speed (-3 to 3)"</span>, </span>
<span id="cb401-7"><a href="#cb401-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized Air Quality Index (AQI) (-3 to 3)"</span>)</span>
<span id="cb401-8"><a href="#cb401-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-9"><a href="#cb401-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plot</span></span>
<span id="cb401-10"><a href="#cb401-10" aria-hidden="true" tabindex="-1"></a>plot_windspeed_vs_aqi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="air-quality_files/figure-html/plot-standardized-windspeed-vs-aqi-standardized-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
Sunnyhills East, Glen Eden Central, and Henderson Lincoln South shows significant positive correlation between wind speed and AQI, suggesting significant pollutant dispersion. Ellerslie South and Westlake exhibits a weak non-significant positive correlation, indicating no wind influence.
</details>
<details>
<summary>
NO vs Wind Speed
</summary>
<p>Visually check for correlation between raw and standardized wind speed and Nitric Oxide (NO) levels across sites. Explore whether NO vary consistently with wind speed. Assess whether standardizing wind speed and NO improves clarity of trends. Reduces distortion from wind speed outliers for better pattern detection.</p>
</details></details></details></details></section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>